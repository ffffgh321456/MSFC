 
function t121_setHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	var videoBlock = document.getElementById('youtubeiframe' + recid);
	var videoParent = videoBlock ? videoBlock.parentNode : null;
	var videoWidth = videoBlock ? videoBlock.offsetWidth : 0;
	var videoHeight = videoWidth * 0.5625;
	
	if (videoBlock) videoBlock.style.height = videoHeight + 'px';
	if (videoParent) videoParent.style.height = videoHeight + 'px';
	
	var videoLazy = rec ? rec.querySelector('.t-video-lazyload') : null;
	if (videoLazy) {
		var iframeLazy = videoLazy.querySelector('iframe');
		var heightLazy = videoLazy.offsetWidth * 0.5625;
		
		videoLazy.style.height = heightLazy + 'px';
		if (iframeLazy) iframeLazy.style.height = heightLazy + 'px';
		
		setTimeout(function () {
			videoBlock = document.getElementById('youtubeiframe' + recid);
			videoWidth = videoBlock ? videoBlock.offsetWidth : 0;
			if (videoBlock) videoBlock.style.height = (videoWidth * 0.5625) + 'px';
		}, 200);
	}
} 
function t071_unifyHeights(recid) {
    $('#rec'+recid+' .t071 .t-container').each(function() {
        var highestBox = 0;
        $('.t071__wrapper', this).each(function(){
            if($(this).height() > highestBox)highestBox = $(this).height(); 
        });  
        if($(window).width()>=960){
        	$('.t071__wrapper',this).css('height', highestBox); 
        }else{
	        $('.t071__wrapper',this).css('height', "auto");    
        }
    });
} 
function t113_highlight(recid){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t113__list_item a[href='"+url+"']").addClass("t-active");
  $(".t113__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t113__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t113__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t113__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t113__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t113_showMenu(recid,pageid){
  var $flagmenudo = "2ok";
  $(window).bind('scroll', function() {
    if ($(window).scrollTop() > 200) {
      if($flagmenudo != "1ok"){$flagmenudo="1";}
    }
    else {
      if($flagmenudo!="2ok"){$flagmenudo="2";}
    }

    if ($flagmenudo=="1") {
      $('.t113').addClass('t113__fixed');
      $('.t113').css('display','none');
      $('.t113').fadeIn( "slow" );

	  $('#rec'+recid).find('.t113__space').hide();
      $flagmenudo="1ok";
    }
    if ($flagmenudo=="2") {
      $('.t113').removeClass('t113__fixed');
	  $('#rec'+recid).find('.t113__space').show();
      $flagmenudo="2ok";
    }
  });

  var current_path = window.location.pathname.split('/').pop();
  if(current_path=="page"+pageid+".html"){
    $("#t113linktopage"+pageid).css("opacity",".7");
  }
}

function t113_setWidth(recid){
  var t113timer;
  var el=$('#rec'+recid);
  $(window).resize(function() {
    if(t113timer) {
        window.clearTimeout(t113timer);
    }
    t113timer = window.setTimeout(function() {
        if($(window).width()>640){
          var w1= el.find("div[data-hook-left]").width()+20+50;
          el.find(".t113__list").css("padding-right",w1+"px");
        }else{
          el.find(".t113__list").css("padding-right",10+"px");  
        }
    }, 100);
  });
  $(window).resize();
} 
function t126_unifyHeights() {
    $('.t126 .t-container').each(function() {
        var highestBox = 0;
        $('.t126__title', this).each(function(){
        	$(this).css("height","auto");
            if($(this).height() > highestBox)highestBox = $(this).height(); 
        });  
        if($(window).width()>=960){
        	$('.t126__title',this).css('height', highestBox);   
        }else{
	        $('.t126__title',this).css('height', "auto");    
        }
        
        var highestBox = 0;
        $('.t126__descr', this).each(function(){
            if($(this).height() > highestBox)highestBox = $(this).height(); 
        });  
        if($(window).width()>=960){
        	$('.t126__descr',this).css('height', highestBox);   
        }else{
	        $('.t126__descr',this).css('height', "auto");    
        }
                
    });
}

 
function t131_unifyHeights() {
    $('.t131 .t-container').each(function() {
        var highestBox = 0;
        $('.t131__title', this).each(function(){
            if($(this).height() > highestBox)highestBox = $(this).height(); 
        });  
        if($(window).width()>=960){
        	$('.t131__title',this).css('height', highestBox);   
        }else{
	        $('.t131__title',this).css('height', "auto");    
        }
        
        var highestBox = 0;
        $('.t131__descr', this).each(function(){
            if($(this).height() > highestBox)highestBox = $(this).height(); 
        });  
        if($(window).width()>=960){
        	$('.t131__descr',this).css('height', highestBox);   
        }else{
	        $('.t131__descr',this).css('height', "auto");    
        }
    });
} 
function t132_unifyHeights() {
    var wrappers = document.querySelectorAll('.t132__box .t132__wrappper');

    for (var i = 0; i < wrappers.length; i++) {
        var wrapper = wrappers[i];
        var textWrapper = wrapper.querySelector('a div');
        var wrapperWidth = wrapper.offsetWidth - 1;
        var wrapperHeight = wrapper.offsetHeight - 40;

        textWrapper.style.width = wrapperWidth + 'px';
        textWrapper.style.height = wrapperHeight + 'px';
    }
} 
if (! window.yashare2scriptLoaded){
    var scriptService = document.createElement('script');
    scriptService .src = "https://yastatic.net/share2/share.js";
    scriptService .type = "text/javascript";
    scriptService .charset = "UTF-8";
    //document.documentElement.appendChild(scriptService);

    window.yashare2scriptLoaded = true;
}
 
function t142_checkSize(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var button = rec.querySelector('.t142__submit');
    if (!button) return;

    var buttonStyle = getComputedStyle(button, null);
    var buttonPaddingTop = parseInt(buttonStyle.paddingTop) || 0;
    var buttonPaddingBottom = parseInt(buttonStyle.paddingBottom) || 0;
    var buttonHeight = button.clientHeight - (buttonPaddingTop + buttonPaddingBottom) + 5;
    var textHeight = button.scrollHeight;

    if (buttonHeight < textHeight) {
        button.classList.add('t142__submit-overflowed');
    }
} 
function t179_showvideo(recid) {
	var rec = document.getElementById('rec' + recid);
	var youTubeCarrier = document.getElementById('youtubeiframe_carier' + recid);
	var playBtn = rec.querySelector('.t179__playbutton');
	var videoContainer = rec.querySelector('.t179__videocontainer');
	var videoHeight = videoContainer ? videoContainer.getAttribute('data-height') || '540' : '540';
	var videoID = videoContainer ? videoContainer.getAttribute('data-youtube-id') : '';
	var videoURL = videoID ? 'https://www.youtube.com/embed/' + videoID : '';
	var videoHeightForIframe = parseInt(videoHeight, 10);
	
	if (playBtn) playBtn.style.display = 'none';
	if (videoContainer) videoContainer.style.display = 'block';
	if (youTubeCarrier) {
		var iframe = document.createElement('iframe');
		iframe.id = 'youtubeiframe' + recid;
		iframe.width = '100%';
		iframe.height = videoHeightForIframe.toString();
		iframe.src = videoURL + (videoURL.indexOf('?') !== -1 ? '&' : '?') + 'autoplay=1&rel=0';
		iframe.frameBorder = '0';
		iframe.setAttribute('allowfullscreen', '');
		youTubeCarrier.insertAdjacentElement('beforeend', iframe);
	}
} 
function t190_scrollToTop() {
    var duration = 700;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = 0 - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t190__easeInOutCubic(currentTime) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t190__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t190__easeInOutCubic(currentTime));

        if (currentTime < duration) {
            setTimeout(t190__animateScroll, increment);
        }  else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t190__animateScroll();
} 
function t199_showMenu(recid) {
    var el = $('#rec' + recid);
    el.find('.t199__js__menu').each(function () {
        var $toggler = el.find('.t199__js__menu-toggler'),
            $menu = $(this),
            $body = $('body'),
            CLASS_MENU = 't199__is__menu';

        $menu.find('.t199__menu-item').each(function () {
            var curUrl = $(this).attr('href');
            if (typeof curUrl != 'undefined' && curUrl.indexOf('#') > -1 && curUrl.substring(0, 9) != '#submenu:') {
                $(this).on('click', function (e) {
                    $body.removeClass(CLASS_MENU);
                });
            }
        });
        
        $menu.find('.t199__menu-item-wrap .t-menusub__link-item').each(function () {
            var curUrl = $(this).attr('href');
            $(this).on('click', function (e) {
                $body.removeClass(CLASS_MENU);
            });
        });

        $toggler.on('click', function (e) {
            e.stopPropagation();
            e.preventDefault();
            $body.toggleClass(CLASS_MENU);
        });

        $(document).on('click', function (e) {
            var clickedInsideMenu = $(e.target).hasClass('t199__js__menu') || $(e.target).parents('.t199__js__menu').length > 0;
            if (!clickedInsideMenu) {
                $body.removeClass(CLASS_MENU);
            }
        });
    });
    $('.t199__mmenu').bind('clickedAnchorInTooltipMenu', function () {
        $('body').removeClass('t199__is__menu');
    });
}

function t199_positionHeader(recid) {
    var el = $('#rec' + recid);
    var $header = el.find('.t199__js__header');
    var bgcolor = $header.css('background-color');
    var isScrolling = false;
    var CLASS_ACTIVE = 't199__is__active';

    function updateHeader() {
        isScrolling = true;

        if ($(window).scrollTop() > 0) {
            $header.addClass(CLASS_ACTIVE);
            $header.css('background-color', '');
        } else {
            $header.removeClass(CLASS_ACTIVE);
            $header.css('background-color', bgcolor);
        }
    }

    setInterval(function () {
        if (isScrolling) {
            isScrolling = false;
        }
    }, 100);

    $(window).on('scroll', updateHeader);
    updateHeader();
}

function t199_setPath(pageid) {}

function t199_highlight(recid) {
    var url = window.location.href;
    var pathname = window.location.pathname;
    if (url.substr(url.length - 1) == '/') {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == '/') {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == '/') {
        pathname = pathname.slice(1);
    }
    if (pathname == '') {
        pathname = '/';
    }
    $(".t199__menu a[href='" + url + "']").addClass('t-active');
    $(".t199__menu a[href='" + url + "/']").addClass('t-active');
    $(".t199__menu a[href='" + pathname + "']").addClass('t-active');
    $(".t199__menu a[href='/" + pathname + "']").addClass('t-active');
    $(".t199__menu a[href='" + pathname + "/']").addClass('t-active');
    $(".t199__menu a[href='/" + pathname + "/']").addClass('t-active');
}

function t199_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t199_navLinks = $('#rec' + recid + " .t-menu__link-item:not(.tooltipstered)[href*='#']");
        if (t199_navLinks.length > 0) {
            t199_catchScroll(t199_navLinks);
        }
    }
}

function t199_catchScroll(t199_navLinks) {
    var t199_clickedSectionId = null,
        t199_sections = new Array(),
        t199_sectionIdTonavigationLink = [],
        t199_interval = 100,
        t199_lastCall,
        t199_timeoutId;
    t199_navLinks = $(t199_navLinks.get().reverse());
    t199_navLinks.each(function () {
        var t199_cursection = t199_getSectionByHref($(this));
        if (typeof t199_cursection.attr('id') != 'undefined') {
            t199_sections.push(t199_cursection);
        }
        t199_sectionIdTonavigationLink[t199_cursection.attr('id')] = $(this);
    });
    t199_updateSectionsOffsets(t199_sections);
    $(window).bind(
        'resize',
        t_throttle(function () {
            t199_updateSectionsOffsets(t199_sections);
        }, 200)
    );
    $('.t199').bind('displayChanged', function () {
        t199_updateSectionsOffsets(t199_sections);
    });
    setInterval(function () {
        t199_updateSectionsOffsets(t199_sections);
    }, 5000);
    t199_highlightNavLinks(t199_navLinks, t199_sections, t199_sectionIdTonavigationLink, t199_clickedSectionId);

    t199_navLinks.click(function () {
        if (!$(this).hasClass('tooltipstered')) {
            t199_navLinks.removeClass('t-active');
            t199_sectionIdTonavigationLink[t199_getSectionByHref($(this)).attr('id')].addClass('t-active');
            t199_clickedSectionId = t199_getSectionByHref($(this)).attr('id');
        }
    });
    $(window).scroll(function () {
        var t199_now = new Date().getTime();
        if (t199_lastCall && t199_now < t199_lastCall + t199_interval) {
            clearTimeout(t199_timeoutId);
            t199_timeoutId = setTimeout(function () {
                t199_lastCall = t199_now;
                t199_clickedSectionId = t199_highlightNavLinks(t199_navLinks, t199_sections, t199_sectionIdTonavigationLink, t199_clickedSectionId);
            }, t199_interval - (t199_now - t199_lastCall));
        } else {
            t199_lastCall = t199_now;
            t199_clickedSectionId = t199_highlightNavLinks(t199_navLinks, t199_sections, t199_sectionIdTonavigationLink, t199_clickedSectionId);
        }
    });
}

function t199_updateSectionsOffsets(sections) {
    $(sections).each(function () {
        var t199_curSection = $(this);
        t199_curSection.attr('data-offset-top', t199_curSection.offset().top);
    });
}

function t199_getSectionByHref(curlink) {
    var t199_curLinkValue = curlink.attr('href').replace(/\s+/g, '');
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + t199_curLinkValue.substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + t199_curLinkValue.substring(1) + "']");
    }
}

function t199_highlightNavLinks(t199_navLinks, t199_sections, t199_sectionIdTonavigationLink, t199_clickedSectionId) {
    var t199_scrollPosition = $(window).scrollTop(),
        t199_valueToReturn = t199_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (
        t199_sections.length != 0 &&
        t199_clickedSectionId == null &&
        t199_sections[t199_sections.length - 1].attr('data-offset-top') > t199_scrollPosition + 300
    ) {
        t199_navLinks.removeClass('t-active');
        return null;
    }

    $(t199_sections).each(function (e) {
        var t199_curSection = $(this),
            t199_sectionTop = t199_curSection.attr('data-offset-top'),
            t199_id = t199_curSection.attr('id'),
            t199_navLink = t199_sectionIdTonavigationLink[t199_id];
        if (
            t199_scrollPosition + 300 >= t199_sectionTop ||
            (t199_sections[0].attr('id') == t199_id && t199_scrollPosition >= $(document).height() - $(window).height())
        ) {
            if (t199_clickedSectionId == null && !t199_navLink.hasClass('t-active')) {
                t199_navLinks.removeClass('t-active');
                t199_navLink.addClass('t-active');
                t199_valueToReturn = null;
            } else {
                if (t199_clickedSectionId != null && t199_id == t199_clickedSectionId) {
                    t199_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t199_valueToReturn;
}
 
function t204_init(recid) {
    var el = $('#rec' + recid);

    el.find('.t204__burger').click(function (e) {
        t204_showMenu(recid);
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    });

    el.find('.t204__closelayer, .t204__close').click(function (e) {
        t204_hideMenu(recid);
    });

    el.find('.t204__burger').bind('clickedAnchorInTooltipMenu', function () {
        t204_hideMenu(recid);
    });

    el.find('.t204__item a').each(function () {
        $(this).on('click', function (e) {
            if ($(this).is('.t794__tm-link, .t978__tm-link, .t966__tm-link')) {
                return;
            }
            t204_hideMenu(recid);
        });
    });
}

function t204_showMenu(recid) {
    var el = $('#rec' + recid);

    $('body').addClass('t204__body_menushowed');
    el.find('.t204__menu').finish();
    el.find('.t204__menu').css('visibility', 'visible').css('opacity', '0').css('right', '-300px');
    el.find('.t204__menu').animate({
        'opacity': '1',
        'right': '0px'
    }, 300);
    el.find('.t204__closelayer').css('visibility', 'visible');
}

function t204_hideMenu(recid) {
    var el = $('#rec' + recid);

    $('body').removeClass('t204__body_menushowed');
    el.find('.t204__menu').finish();
    el.find('.t204__menu').css('visibility', 'hidden');
    el.find('.t204__closelayer').css('visibility', 'hidden');
}

/* old function */
function t204_clickBurger(recid) {
    var el = $("#rec" + recid);

    el.find('#t204__burger').click(function (e) {
        t204_showMenu(recid);
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    });

    el.find('#t204__closelayer').click(function (e) {
        t204_hideMenu(recid);
    });

    $('.t204__burger').bind('clickedAnchorInTooltipMenu', function () {
        t204_hideMenu(recid);
    });
} 
function t213_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = document.getElementById('t213-marker' + recId);
    var minScreenWidth = rec.getAttribute('data-screen-min');
    var maxScreenWidth = rec.getAttribute('data-screen-max');
    var windowWidth = window.innerWidth;

    if (minScreenWidth && windowWidth < parseInt(minScreenWidth, 10)) return;
    if (maxScreenWidth && windowWidth > parseInt(maxScreenWidth, 10)) return;

    var timer;
    var bgColor = container.getAttribute('data-bg-color');
    var documentBody = document.body;

    documentBody.style.transition = 'background-color 1s linear';

    if (window.t213higher === undefined) {
        window.t213higher = 1000000;
    }

    var containerOffsetTop = container.getBoundingClientRect().top + window.pageYOffset;
    
    if (window.t213higher > containerOffsetTop) {
        window.t213higher = containerOffsetTop;
        window.t213higher_id = recId;
    }

    var bodyDefBgColor = getComputedStyle(documentBody, null).backgroundColor || '';
    var timerCount = 0;

    function t213__scrollEvent() {
        if (timer) {
            window.clearTimeout(timer);

            if (timerCount >= 15) {
                t213_timer_do(container, bgColor, bodyDefBgColor, recId);
            }
            timerCount++;
        }

        timer = window.setTimeout(function() {
            t213_timer_do(container, bgColor, bodyDefBgColor, recId);
            timerCount = 0;
        }, 100);
    }

    window.addEventListener('scroll', t213__scrollEvent);
    t213__scrollEvent();
}

function t213_timer_do(container, bgColor, bodyDefBgColor, recId) {
    var top = container.getBoundingClientRect().top + window.pageYOffset;
    var scrollTop = window.pageYOffset;
    var windowHeight = window.innerHeight;
    var documentBody = document.body;

    if ((scrollTop + windowHeight) >= top) {
        documentBody.style.backgroundColor = bgColor;
    } else if (window.t213higher_id == recId) {
        documentBody.style.backgroundColor = bodyDefBgColor;
    }
} 
function t219_showcomments(recid){
  $("#rec"+recid+" .t-btn").css("display","none");
  $("#rec"+recid+" .t219__blocktitle").css("display","block");

  var disqus_shortname = $("#rec"+recid+" .t219__disqusthread").attr('data-disqus-shortname');
console.log(disqus_shortname);
  if(disqus_shortname!==""){
	  var disqus_identifier = disqus_shortname;    
  }else{
	  var disqus_identifier = "t_page_" + $("#rec"+recid+" .t219__disqusthread").attr("data-page-id");
  }

  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
} 
function t226_floating_init(el){
    var wnd=$(window);
    var col=el.parent();

    el.css('max-width',el.width());
    el.css('width','100%');
    col.css('min-height',el.height());

    var timer;
    var timer_count=0;
    var timer_react=5;

    wnd.scroll(function() {
        if(timer) {
            window.clearTimeout(timer);
            if(timer_count>=timer_react){
                t226_floating_scroll(el,wnd,col);
                timer_count=0;
            }
            timer_count++;
        }

        timer = window.setTimeout(function() {
                t226_floating_scroll(el,wnd,col);
                timer_count=0;    
        }, 50);
    });        


    wnd.resize(function() {
         wnd.scroll();
    });

    wnd.scroll();
}

function t226_floating_scroll(el,wnd,col){
    var wnd_height = wnd.height();
    var wnd_width = wnd.width();

    if(wnd_width<=1024){
        el.removeClass('t226__fixedTop');
        el.removeClass('t226__fixedBottom');
        el.removeClass('t226__floating');
        return('');
    }

    el.css('max-width',col.width());

    if(col.height()<el.height() && col.height()>0){
        col.height(el.height());
    }

    var el_height = el.height();
    var col_top = col.offset().top;
    var col_width = col.width();
    var col_height = col.height();
    var col_bottom = col_top + col_height;

    var wnd_top = wnd.scrollTop();
    var wnd_bottom = wnd_top + wnd_height;  

    if(wnd_top+el_height+50 >= col_bottom){
        //console.log('fixedbottom');
        el.addClass('t226__fixedBottom');
        el.removeClass('t226__fixedTop');
        el.removeClass('t226__floating');
    }else if(wnd_top+50 > col_top){
        //console.log('floating');
        el.addClass('t226__floating');
        el.removeClass('t226__fixedBottom');
        el.removeClass('t226__fixedTop');
    }else{
        //console.log('fixedtop');
        el.addClass('t226__fixedTop');
        el.removeClass('t226__fixedBottom');  
        el.removeClass('t226__floating');
    }
} 
function t228__init(recid) {
    var el = $('#rec' + recid);
    var mobile = el.find('.t228__mobile');
    var fixedBlock = mobile.css('position') === 'fixed' && mobile.css('display') === 'block';

    setTimeout(function() {
        el.on('click', '.t-menusub__target-link', function () {
            if (isMobile) {
                if ($(this).hasClass('t-menusub__target-link_active')) {
                    el.find('.t228').trigger('overflow');
                } else {
                    el.find('.t228').trigger('nooverflow');
                }
            }
        });
        el.find('.t-menu__link-item:not(.t-menusub__target-link):not(.tooltipstered):not(.t794__tm-link)').on('click', function () {
            if ($(this).is('.tooltipstered, .t-menusub__target-link, .t794__tm-link, .t966__tm-link, .t978__tm-link')) { return; }
            if (fixedBlock) {
                mobile.trigger('click');
            }
        });

        el.find('.t-menusub__link-item').on('click', function () {
            if (fixedBlock) {
                mobile.trigger('click');
            }
        });
        
        el.find('.t228__right_buttons_but .t-btn').on('click', function () {
            if (fixedBlock) {
                mobile.trigger('click');
            }
        });
        
        el.find('.t228__positionabsolute');
        
        el.find('.t228').on('overflow', function() {
            t228_checkOverflow(recid);
        });
        
        el.find('.t228').on('nooverflow', function() {
            t228_checkNoOverflow(recid);
        });
        
        el.find('.t228').on('showME601a', function() {
            el.find('.t966__menu-link').on('click', function () {
                if (fixedBlock) {
                    mobile.trigger('click');
                }
            });
        });
    }, 500);
}

function t228_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname == "") {
        pathname = "/";
    }
    $(".t228__list_item a[href='" + url + "']").addClass("t-active");
    $(".t228__list_item a[href='" + url + "/']").addClass("t-active");
    $(".t228__list_item a[href='" + pathname + "']").addClass("t-active");
    $(".t228__list_item a[href='/" + pathname + "']").addClass("t-active");
    $(".t228__list_item a[href='" + pathname + "/']").addClass("t-active");
    $(".t228__list_item a[href='/" + pathname + "/']").addClass("t-active");
}

function t228_checkAnchorLinks(recid) {
    var el = $('#rec' + recid);
    if ($(window).width() > 980) {
        var t228_navLinks = el.find(".t228__list_item a:not(.tooltipstered)[href*='#']");
        if (t228_navLinks.length > 0) {
            setTimeout(function () {
                t228_catchScroll(t228_navLinks);
            }, 500);
        }
    }
}

function t228_checkOverflow(recid) {
    var el = $('#rec' + recid);
    var menu = el.find('.t228');
    var winHeight = $(window).height();
    
    if (menu.css('position') === 'fixed') {
        menu.addClass('t228__overflow');
        menu[0].style.setProperty('height', winHeight - $('.t228__mobile_container').outerHeight(true) + 'px', 'important');
    }
}

function t228_checkNoOverflow(recid) {
    var el = $('#rec' + recid);
    var menu = el.find('.t228');
    var submenus = el.find('.t966__tooltip-menu_mobile');
    
    if (menu.css('position') === 'fixed') {
        menu.removeClass('t228__overflow');
        menu[0].style.setProperty('height', 'auto');
    }
}


function t228_catchScroll(t228_navLinks) {
    var t228_clickedSectionId = null,
        t228_sections = [],
        t228_sectionIdTonavigationLink = [],
        t228_interval = 100,
        t228_lastCall, t228_timeoutId;
    t228_navLinks = $(t228_navLinks.get().reverse());
    t228_navLinks.each(function () {
        var t228_cursection = t228_getSectionByHref($(this));
        if (typeof t228_cursection.attr("id") != "undefined") {
            t228_sections.push(t228_cursection);
        }
        t228_sectionIdTonavigationLink[t228_cursection.attr("id")] = $(this);
    });
    
    t228_sections.sort(function (a, b) {
        return b.offset().top - a.offset().top
    });

    t228_highlightNavLinks(t228_navLinks, t228_sections, t228_sectionIdTonavigationLink, t228_clickedSectionId);

    t228_navLinks.click(function () {
        var clickedSection = t228_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof clickedSection.attr("id") != "undefined") {
            t228_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t228_clickedSectionId = t228_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function () {
        var t228_now = new Date().getTime();
        if (t228_lastCall && t228_now < (t228_lastCall + t228_interval)) {
            clearTimeout(t228_timeoutId);
            t228_timeoutId = setTimeout(function () {
                t228_lastCall = t228_now;
                t228_clickedSectionId = t228_highlightNavLinks(t228_navLinks, t228_sections, t228_sectionIdTonavigationLink, t228_clickedSectionId);
            }, t228_interval - (t228_now - t228_lastCall));
        } else {
            t228_lastCall = t228_now;
            t228_clickedSectionId = t228_highlightNavLinks(t228_navLinks, t228_sections, t228_sectionIdTonavigationLink, t228_clickedSectionId);
        }
    });
}

function t228_getSectionByHref(curlink) {
    var curLinkValue = curlink.attr('href').replace(/\s+/g, '').replace(/.*#/, '');
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + curLinkValue + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curLinkValue + "']");
    }
}

function t228_highlightNavLinks(t228_navLinks, t228_sections, t228_sectionIdTonavigationLink, t228_clickedSectionId) {
    var t228_scrollPosition = $(window).scrollTop();
    var t228_valueToReturn = t228_clickedSectionId;

    /*if first section is not at the page top (under first blocks)*/
    if (t228_sections.length !== 0 && t228_clickedSectionId === null && t228_sections[t228_sections.length - 1].offset().top > (t228_scrollPosition + 300)) {
        t228_navLinks.removeClass('t-active');
        return null;
    }

    $(t228_sections).each(function (e) {
        var t228_curSection = $(this),
            t228_id = t228_curSection.attr('id'),
            t228_sectionTop = t228_curSection.offset().top,
            t228_navLink = t228_sectionIdTonavigationLink[t228_id];

        if (((t228_scrollPosition + 300) >= t228_sectionTop) || (t228_sections[0].attr("id") == t228_id && t228_scrollPosition >= $(document).height() - $(window).height())) {
            if (t228_clickedSectionId == null && !t228_navLink.hasClass('t-active')) {
                t228_navLinks.removeClass('t-active');
                t228_navLink.addClass('t-active');
                t228_valueToReturn = null;
            } else {
                if (t228_clickedSectionId != null && t228_id == t228_clickedSectionId) {
                    t228_valueToReturn = null;
                }
            }
            return false;
        }
    });

    return t228_valueToReturn;
}

function t228_setWidth(recid) {
    var el = $('#rec' + recid);
    if ($(window).width() > 980) {
        el.find(".t228").each(function () {
            var el = $(this);
            var left_exist = el.find('.t228__leftcontainer').length;
            var left_w = el.find('.t228__leftcontainer').outerWidth(true);
            var max_w = left_w;
            var right_exist = el.find('.t228__rightcontainer').length;
            var right_w = el.find('.t228__rightcontainer').outerWidth(true);
            var items_align = el.attr('data-menu-items-align');
            if (left_w < right_w) max_w = right_w;
            max_w = Math.ceil(max_w);
            var center_w = 0;
            el.find('.t228__centercontainer').find('li').each(function () {
                center_w += $(this).outerWidth(true);
            });
            var padd_w = 40;
            var maincontainer_width = el.find(".t228__maincontainer").outerWidth();
            if (maincontainer_width - max_w * 2 - padd_w * 2 > center_w + 20) {
                if (items_align == "center" || typeof items_align === "undefined") {
                    el.find(".t228__leftside").css("min-width", max_w + "px");
                    el.find(".t228__rightside").css("min-width", max_w + "px");
                    el.find(".t228__list").removeClass("t228__list_hidden");
                }
            } else {
                el.find(".t228__leftside").css("min-width", "");
                el.find(".t228__rightside").css("min-width", "");
            }
        });
    }
    
    el.find(".t228__centerside").removeClass("t228__centerside_hidden");
}

function t228_setBg(recid) {
    var el = $('#rec' + recid);
    if ($(window).width() > 980) {
        el.find(".t228").each(function () {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color", bgcolor);
            }
        });
    } else {
        el.find(".t228").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color", bgcolor);
            el.attr("data-bgcolor-setbyscript", "yes");
        });
    }
}

function t228_appearMenu(recid) {
    var el = $('#rec' + recid);
    if ($(window).width() > 980) {
        el.find(".t228").each(function () {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset != "") {
                if (appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        el.css("top", "-50px");
                        el.css("visibility", "visible");
                        var topoffset = el.data('top-offset');
                        if (topoffset && parseInt(topoffset) > 0) {
                            el.animate({
                                "opacity": "1",
                                "top": topoffset + "px"
                            }, 200, function () {});

                        } else {
                            el.animate({
                                "opacity": "1",
                                "top": "0px"
                            }, 200, function () {});
                        }
                    }
                } else {
                    el.stop();
                    el.css("visibility", "hidden");
                    el.css("opacity", "0");
                }
            }
        });
    }

}

function t228_changebgopacitymenu(recid) {
    var el = $('#rec' + recid);
    if ($(window).width() > 980) {
        el.find(".t228").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.' + menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if (bgopacitytwo == '0' || (typeof menushadow == "undefined" && menushadow == false)) {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            } else {
                el.css("background-color", bgcolor);
                if (bgopacityone == '0.0' || (typeof menushadow == "undefined" && menushadow == false)) {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            }
        });
    }
}

function t228_createMobileMenu(recid) {
    var el = $("#rec" + recid);
    var menu = el.find(".t228");
    var burger = el.find(".t228__mobile");
    burger.on('click', function (e) {
        menu.fadeToggle(300);
        burger.toggleClass("t228_opened");
    });
    $(window).bind('resize', t_throttle(function () {
        if ($(window).width() > 980) {
            menu.fadeIn(0);
        }
    }));
} 
function t229_highlight(recid){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t229__list_item a[href='"+url+"']").addClass("t-active");
  $(".t229__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t229__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t229__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t229__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t229__list_item a[href='/"+pathname+"/']").addClass("t-active");
}


function t229_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t229_navLinks = $("#rec" + recid + " .t229__list_item a:not(.tooltipstered)[href*='#']");
        if (t229_navLinks.length > 0) {
            t229_catchScroll(t229_navLinks);
        }
    }
}

function t229_catchScroll(t229_navLinks) {
    var t229_clickedSectionId = null,
        t229_sections = new Array(),
        t229_sectionIdTonavigationLink = [],
        t229_interval = 100,
        t229_lastCall, t229_timeoutId;
    t229_navLinks = $(t229_navLinks.get().reverse());
    t229_navLinks.each(function() {
        var t229_cursection = t229_getSectionByHref($(this));
        if (typeof t229_cursection.attr("id") != "undefined") {
            t229_sections.push(t229_cursection);
        }
        t229_sectionIdTonavigationLink[t229_cursection.attr("id")] = $(this);
    });
		t229_updateSectionsOffsets(t229_sections);
    t229_sections.sort(function(a, b) {
      return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
		$(window).bind('resize', t_throttle(function(){t229_updateSectionsOffsets(t229_sections);}, 200));
		$('.t229').bind('displayChanged',function(){t229_updateSectionsOffsets(t229_sections);});
		setInterval(function(){t229_updateSectionsOffsets(t229_sections);},5000);
    t229_highlightNavLinks(t229_navLinks, t229_sections, t229_sectionIdTonavigationLink, t229_clickedSectionId);

    t229_navLinks.click(function() {
        var t229_clickedSection = t229_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof t229_clickedSection.attr("id") != "undefined") {
            t229_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t229_clickedSectionId = t229_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function() {
        var t229_now = new Date().getTime();
        if (t229_lastCall && t229_now < (t229_lastCall + t229_interval)) {
            clearTimeout(t229_timeoutId);
            t229_timeoutId = setTimeout(function() {
                t229_lastCall = t229_now;
                t229_clickedSectionId = t229_highlightNavLinks(t229_navLinks, t229_sections, t229_sectionIdTonavigationLink, t229_clickedSectionId);
            }, t229_interval - (t229_now - t229_lastCall));
        } else {
            t229_lastCall = t229_now;
            t229_clickedSectionId = t229_highlightNavLinks(t229_navLinks, t229_sections, t229_sectionIdTonavigationLink, t229_clickedSectionId);
        }
    });
}


function t229_updateSectionsOffsets(sections){
	$(sections).each(function(){
		var t229_curSection = $(this);
		t229_curSection.attr("data-offset-top",t229_curSection.offset().top);
	});
}


function t229_getSectionByHref(curlink) {
    var t229_curLinkValue = curlink.attr("href").replace(/\s+/g, '').replace(/.*#/, '');
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + t229_curLinkValue + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + t229_curLinkValue + "']");
    }
}

function t229_highlightNavLinks(t229_navLinks, t229_sections, t229_sectionIdTonavigationLink, t229_clickedSectionId) {
    var t229_scrollPosition = $(window).scrollTop(),
        t229_valueToReturn = t229_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t229_sections.length != 0 && t229_clickedSectionId == null && t229_sections[t229_sections.length-1].attr("data-offset-top") > (t229_scrollPosition + 300)){
      t229_navLinks.removeClass('t-active');
      return null;
    }

    $(t229_sections).each(function(e) {
        var t229_curSection = $(this),
            t229_sectionTop = t229_curSection.attr("data-offset-top"),
            t229_id = t229_curSection.attr('id'),
            t229_navLink = t229_sectionIdTonavigationLink[t229_id];
        if (((t229_scrollPosition + 300) >= t229_sectionTop) || (t229_sections[0].attr("id") == t229_id && t229_scrollPosition >= $(document).height() - $(window).height())) {
            if (t229_clickedSectionId == null && !t229_navLink.hasClass('t-active')) {
                t229_navLinks.removeClass('t-active');
                t229_navLink.addClass('t-active');
                t229_valueToReturn = null;
            } else {
                if (t229_clickedSectionId != null && t229_id == t229_clickedSectionId) {
                    t229_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t229_valueToReturn;
}

function t229_setPath(pageid){
}

function t229_setBg(recid){
      var window_width=$(window).width();
      if(window_width>980){
          $(".t229").each(function() {
          	 var el=$(this);
             if(el.attr('data-bgcolor-setbyscript')=="yes"){
	             var bgcolor=el.attr("data-bgcolor-rgba");
	             el.css("background-color",bgcolor);             
             }
          });
      }else{
          $(".t229").each(function() {
             var el=$(this);
             var bgcolor=el.attr("data-bgcolor-hex");
             el.css("background-color",bgcolor);
             el.attr("data-bgcolor-setbyscript","yes");
		  });
      }
  }

function t229_appearMenu(recid) {
        var window_width=$(window).width();
        if(window_width>980){
	         $("#rec"+recid+" .t229").each(function() {
					var el=$(this);
					var appearoffset=el.attr("data-appearoffset");
					if(appearoffset!=""){
			                if(appearoffset.indexOf('vh') > -1){
				                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
			                }
					
							appearoffset=parseInt(appearoffset, 10);
		
							if ($(window).scrollTop() >= appearoffset) {
							  if(el.css('visibility') == 'hidden'){
								  el.finish();
								  el.css("top","-50px");	
								  el.css("visibility","visible");
								  el.animate({"opacity": "1","top": "0px"}, 200,function() {
								  });	  	  
							  }
							}else{
							  el.stop();
							  el.css("visibility","hidden");
							}
					}
	         });
        }
    
    }


function t229_changeBgOpacityMenu(recid) {
        var window_width=$(window).width();
        if(window_width>980){
	         $(".t229").each(function() {
					var el=$(this);
					var bgcolor=el.attr("data-bgcolor-rgba");
					var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
					if ($(window).scrollTop() > 20) {
						el.css("background-color",bgcolor_afterscroll);
					}else{
						el.css("background-color",bgcolor);
					}
	         });
        }
    
    } 
function t235__next() {
    var cur = parseInt($(".t235").attr("data-slide-count"), 10);

    if ($(window).width() > 980) {
        t235_addVideo();
    }

    if((cur+1) >= $(".r").not('[data-t263-block-notslide=yes]').size()) return;

    cur++;
    $(".r").not('[data-t263-block-notslide=yes]').each(function(i) {
        if((cur-1)==i){
            var el=$(this);
			var trans_out_y='-100px';
			if(el.height()+100>$(window).height())trans_out_y='0px';
			el.transition({ y: trans_out_y,opacity: 0},250,'out',function() {
				el.css('display','none');
		    });
        }
        if(cur == i) {
            var el = $(this);
            var speed='slow';
            if(cur == 0){
                speed = 0;
            }

            el.css('display','none');
			var trans_in_y='50px';
			if(el.height()+100>$(window).height())trans_in_y='0px';
			el.transition({y:trans_in_y},1,'ease',function() {});
			el.animate({opacity:"0"}, 300, function() {
                el.css('display','block');
                el.css('opacity','0');
                el.transition({y:'0px',opacity: 1},500,'ease',function() {});
				$('.r').removeClass('t235__active');
				el.addClass('t235__active');

				$('.t117, .t121, .t132, .t223, .t226, .t228, .t229, .t230, .t268, .t279, .t341, .t346, .t347, .t349, .t351, .t353, .t384, .t385, .t386, .t396, .t400, .t404, .t409, .t410, .t412, .t418, .t422, .t425, .t428, .t433, .t448, .t456, .t477, .t478, .t480, .t486, .t498, .t504, .t506, .t509, .t511, .t517, .t518, .t519, .t520, .t532, .t533, .t538, .t539, .t544, .t545, .t552, .t554, .t569, .t570, .t577, .t592, .t598, .t599, .t601, .t604, .t605, .t609, .t615, .t616, .t650, .t659, .t670, .t675, .t686, .t688, .t694, .t698, .t700, .t726, .t728, .t730, .t734, .t738, .t740, .t744, .t754, .t760, .t762, .t764, .t774, .t776, .t778, .t780, .t786, .t798, .t799, .t801, .t813, .t814, .t822, .t826, .t827, .t829, .t842, .t843, .t849, .t850, .t851, .t856, .t858, .t859, .t860, .t881, .t889, .t902, .t912, .t923, .t937, .t959, .t979, .t982, .t983, .t989, .t994').trigger('displayChanged');
				
                if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
			});

            if(el.height()>$(window).height()){
                $('#t235__scrldonwicon').fadeIn('slow',function(){
                    $('#t235__scrldonwicon').delay(1000).fadeOut('slow');
                });
            }

            var bg=el.attr('data-bg-color');
            if(bg!==undefined && bg!=='none'){
                $('#allrecordstable').css('background-color',bg);
            }else{
                $('#allrecordstable').css('background-color','');
            }
        }
    });

    $(".t235").attr("data-slide-count", cur);

    t235__update();
}

function t235__prev() {
    var cur = parseInt($(".t235").attr("data-slide-count"), 10);
    
    if((cur-1) == -1) return;
    
    cur--;

    $(".r").not('[data-t263-block-notslide=yes]').each(function(i) {
        if((cur+1)==i){
            var el=$(this);
            el.css('display','none');
        }
        if(cur==i){
            var el=$(this);
            el.css('display','block');
			el.css('opacity','0');
			el.transition({ y: '0px'},1,'easeOutSine');
			el.animate({opacity:"1"}, 50, function() {});
            $('.r').removeClass('t235__active');
            el.addClass('t235__active');

            var bg=el.attr('data-bg-color');
            if(bg!==undefined && bg!=='none'){
                $('#allrecordstable').css('background-color',bg);
            }else{
                $('#allrecordstable').css('background-color','');
            }
            
            $('.t117, .t121, .t132, .t223, .t226, .t228, .t229, .t230, .t268, .t279, .t341, .t346, .t347, .t349, .t351, .t353, .t384, .t385, .t386, .t396, .t400, .t404, .t409, .t410, .t412, .t418, .t422, .t425, .t428, .t433, .t448, .t456, .t477, .t478, .t480, .t486, .t498, .t504, .t506, .t509, .t511, .t517, .t518, .t519, .t520, .t532, .t533, .t538, .t539, .t544, .t545, .t552, .t554, .t569, .t570, .t577, .t592, .t598, .t599, .t601, .t604, .t605, .t609, .t615, .t616, .t650, .t659, .t670, .t675, .t686, .t688, .t694, .t698, .t700, .t726, .t728, .t730, .t734, .t738, .t740, .t744, .t754, .t760, .t762, .t764, .t774, .t776, .t778, .t780, .t786, .t798, .t799, .t801, .t813, .t814, .t822, .t826, .t827, .t829, .t842, .t843, .t849, .t850, .t851, .t856, .t858, .t859, .t860, .t881, .t889, .t902, .t912, .t923, .t937, .t959, .t979, .t982, .t983, .t989, .t994').trigger('displayChanged');
        }
    });
    $(".t235").attr("data-slide-count", cur);

    t235__update();
}

function t235__galnext(){
	var elactive=$('.t235__active');
	var tplid=elactive.attr('data-record-type');
	if(tplid=='5')elactive.find('[data-slide=next]').trigger('click');
}

function t235__update() {
    var cur = parseInt($(".t235").attr("data-slide-count"), 10);
    var c = cur+1;
    var t = $(".r").not('[data-t263-block-notslide=yes]').size();
    $('.t235__count').html(c + "/" + t);

    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}

function t235__init() {
  $("#allrecords").wrap("<table id='allrecordstable' width='100%' height='100%' style='height:100vh; border:0px; margin:0px; padding:0px; border-spacing:0px;'><tr><td></td></tr></table>");
  $("#allrecords").css('width', $(window).width()+'px');
  var wnd = $(window);
  $(".r").not('[data-t263-block-notslide=yes]').each(function(i) {
      var el=$(this);
      el.css('padding','0px');
      if(el.height()>wnd.height()){
          el.css('padding-top','150px');
          el.css('padding-bottom','150px');
      }
      el.css('display','none');
      el.css('opacity','');
	  el.css('background-color','');
  });

    var cur = -1;
    var slideCount = $(".t235").attr("data-slide-count");
    if(typeof slideCount !== "undefined") {
        cur = parseInt(slideCount, 10);
    } else {
        $(".t235").attr("data-slide-count", cur);
    }

  if(!isNaN(cur)) {
      $(".t235").find(".t235__next").on("click", function() {
          t235__next();
      });
      $(".t235").find(".t235__prev").on("click", function() {
          t235__prev();
      });
      t235__next();
      $('#tildacopy').css('display','none');
    
      $('.t235').css('right','-=100');
      setTimeout(function() {
          $('.t235').addClass('t235_anim');
          $('.t235').css('right','+=100');
      }, 800);
    
      $(document).keydown(function(e) {
          switch(e.which) {
              case 38: t235__prev();
              break;
    
              case 40: t235__next();
              break;
    
              case 33: t235__prev();
              break;
    
              case 34: t235__next();
              break;
    
              case 32: t235__next();
              break;
    
              case 190: t235__galnext();
              break;
    
              default: return;
          }
          if(e.which!=190){
    		e.preventDefault();
    	  }
      });
  }

  $('#allrecordstable').css('transition','background-color 500ms linear');
  $('.t-cover__carrier').css('background-attachment','scroll');
}

function t235_addVideo() {
    setTimeout(function() {
        if ($('.t235__active').next().find('.t-video-lazyload').length > 0) {
            $('.t235__active').next().find('.t-video-lazyload').each(function() {
                var $this = $(this);
                var videoHeight = $this.attr('data-videolazy-height') ? $(this).attr('data-videolazy-height') : '100%';

                if ($this.parents('.t223').length > 0 || $this.parents('.t230').length > 0 || $this.parents('.t368').length > 0) {
                    var videoHeight = '100%';
                }

                var videoId = $this.attr('data-videolazy-id').trim();
                var blockId = $this.attr('data-blocklazy-id') || '';
                var videoTwoId = '_' + $this.attr('data-videolazy-two-id') + '_' || '';

                if ($this.attr('data-videolazy-load') == 'false') {
                    $this.attr('data-videolazy-load', 'true');

                    if ($this.attr('data-videolazy-type') == 'youtube') {
                        $this.prepend('<iframe id="youtubeiframe' + videoTwoId + blockId + '" width="100%" height="' + videoHeight + '" src="//www.youtube.com/embed/' + videoId + '?rel=0&fmt=18&html5=1&showinfo=0" frameborder="0" allowfullscreen></iframe>');
                    }

                    if ($this.attr('data-videolazy-type') == 'vimeo') {
                        $this.prepend('<iframe src="//player.vimeo.com/video/' + videoId + '?title=0&byline=0&portrait=0&badge=0&color=ffffff" width="100%" height="' + videoHeight + '" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')
                    }
                }
            });
        }
    }, 0);
}
 
function t232_expandtext(recid){
  $("#rec"+recid).find(".t232__text").toggle();
}
 
function t270_scroll(hash, offset, speed) {
    if (hash.indexOf('#!/tproduct/') !== -1 || hash.indexOf('#!/tab/') !== -1) {
        return true;
    }

    var root = $('html, body');
    var target = "";

    if (speed === undefined) {
        speed = 400;
    }

    try {
        target = $(hash);
    } catch (event) {
        console.log("Exception t270: " + event.message);
        return true;
    }
    if (target.length === 0) {
        target = $('a[name="' + hash.substr(1) + '"]');
        if (target.length === 0) {
            return true;
        }
    }

    var isHistoryChangeAllowed = window.location.hash !== hash;
    var complete = function () {
        if (!isHistoryChangeAllowed) {
            return;
        }

        if (history.pushState) {
            history.pushState(null, null, hash);
        } else {
            window.location.hash = hash;
        }

        isHistoryChangeAllowed = false;
    }

    var dontChangeHistory = Boolean($('.t270').attr('data-history-disabled'));
    if (dontChangeHistory) {
        complete = function () {};
    }

    root.animate({
        scrollTop: target.offset().top - offset
    }, speed, complete);

    return true;
} 
window.t256showvideo = function (recid) {
	if (document.readyState !== 'loading') {
		t256_showVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t256_showVideo(recid);
		});
	}
	
	function t256_showVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t256__video-container');
		var videoCover = rec.querySelector('.t256__cover');
		var videoCarrier = rec.querySelector('.t256__video-carier');
		
		var youTubeID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
		var videoURL = youTubeID ? 'https://www.youtube.com/embed/' + youTubeID : '';
		
		document.body.classList.add('t256__overflow');
		if (videoCover) videoCover.classList.add('t256__hidden');
		if (videoContainer) videoContainer.classList.remove('t256__hidden');
		
		if (videoCarrier) {
			videoCarrier.innerHTML = '<iframe id="youtubeiframe' + recid + '" class="t256__iframe" width="100%" height="540" src="' +
				videoURL +
				'?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe><a class="t256__close-link" href="javascript:t256hidevideo(\'' +
				recid + '\');"><div class="t256__close"></div></a>';
		}
	}
};

window.t256hidevideo = function (recid) {
	if (document.readyState !== 'loading') {
		t256_hideVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t256_hideVideo(recid);
		});
	}
	
	function t256_hideVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t256__video-container');
		var videoCover = rec.querySelector('.t256__cover');
		var videoCarrier = rec.querySelector('.t256__video-carier');
		
		document.body.classList.remove('t256__overflow');
		if (videoCover) videoCover.classList.remove('t256__hidden');
		if (videoContainer) videoContainer.classList.add('t256__hidden');
		if (videoCarrier) videoCarrier.innerHTML = '<div class="t256__video-bg2"></div>';
	}
}; 
function t260_init(){
	$(".t260").each(function() {
		var el=$(this);
		if(el.attr('data-block-init')=='yes'){
		}else{
		  el.attr('data-block-init','yes');

          var toggler = el.find(".t260__header");
          var content = el.find(".t260__content");

          toggler.click(function() {
			$(this).toggleClass("t260__opened");
			if($(this).hasClass("t260__opened")==true){
				content.slideDown();
			}else{
				content.slideUp();
			}
          })

		}
	});
} 
function t262_appendGoogleMap(recid, key) {
	var grecid = recid;

	if (typeof google === 'object' && typeof google.maps === 'object') {
		t262_handleGoogleApiReady(grecid);
	} else {
		if(window.googleapiiscalled!==true){
			var runfunc = 'window.t262_handleGoogleApiReady_'+grecid+' = function () { t262_handleGoogleApiReady("'+grecid+'") }';
			eval(runfunc);

			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "//maps.google.com/maps/api/js?key="+jQuery.trim(key)+"&callback=t262_handleGoogleApiReady_"+grecid;
			document.body.appendChild(script);
			window.googleapiiscalled=true;
		} else {
			setTimeout(function(){
			  t262_appendGoogleMap(grecid, key);
			},200);
		}
	}
}

function t262_setMapHeight(recid) {
	var el=$('#rec'+recid);
	var map = el.find('.t262__map');
	var textwrapper = el.find('.t262__col_text').height();
	map.css('height', textwrapper);
}

function t262_handleGoogleApiReady(recid){
	$('#rec'+recid).find('.t262__map').each(function(index,Element) {
		var el=$(Element);
		var arMarkers = window['arMapMarkers'+recid];
		window.isDragMap = $isMobile ? false : true;
	
		var myLatLng = arMarkers.length > 0 ? new google.maps.LatLng(parseFloat(arMarkers[0].lat), parseFloat(arMarkers[0].lng)) : false;
		var myOptions = {
			zoom: parseInt(el.attr('data-map-zoom')),
			center:myLatLng,
			scrollwheel: false,
			draggable: window.isDragMap,
			zoomControl: true
		};

		var map = new google.maps.Map(Element, myOptions);

		var i, mrk, marker, markers=[], infowindow;
		var bounds = new google.maps.LatLngBounds();
		for(i in arMarkers) {
			mrk = arMarkers[i];
			myLatLng = new google.maps.LatLng(parseFloat(mrk.lat), parseFloat(mrk.lng));
			marker = new google.maps.Marker({
				position: myLatLng,
				map: map,
				title: mrk.title
			});
			bounds.extend(myLatLng);

			if (mrk.descr > '') {
				attachInfoMessage(marker, mrk.descr);
			} else {
				attachInfoMessage(marker, mrk.title);
			}

			markers[markers.length] = marker;
			infowindow='';
			marker='';
		}
		
		function attachInfoMessage(marker, descr) {
			var infowindow = new google.maps.InfoWindow({
				content:  $("<textarea/>").html(descr).text()
			});
		  
			marker.addListener('click', function() {
				infowindow.open(marker.get('map'), marker);
			});
		}
		
		if (arMarkers.length > 1) {
			map.fitBounds(bounds);
			if (map.getZoom() > parseInt(el.attr('data-map-zoom'))) {
				map.setZoom(parseInt(el.attr('data-map-zoom')));
			}
		}

	  
		// Resizing the map for responsive design
		google.maps.event.addDomListener(window, "resize", function() {
			var center = map.getCenter();
			google.maps.event.trigger(map, "resize");
			map.setCenter(center); 
		}); 

		// DBL Click - activate on mobile      
		if ($isMobile) {
			google.maps.event.addDomListener(window, "dblclick", function() {
				if (window.isDragMap) {
					window.isDragMap = false;
				} else {
					window.isDragMap = true;
				}
				map.setOptions({draggable: window.isDragMap});
			}); 
		}

	}); 
}


function t262_appendYandexMap(recid,key) {
	var yarecid = recid;
	if (typeof ymaps === 'object' && typeof ymaps.Map === 'function') {
		t262_handleYandexApiReady(recid);
	} else {
		if(window.yandexmapsapiiscalled!==true){
			var runfunc = 'window.t262_handleYandexApiReady_'+yarecid+' = function () { return t262_handleYandexApiReady("'+yarecid+'") }';
			eval(runfunc);

			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "https://api-maps.yandex.ru/2.1/?lang=ru-RU&coordorder=latlong&onload=t262_handleYandexApiReady_"+yarecid;
			if (key > '') {
				script.src = script.src + '&apikey='+key;
			}
			document.body.appendChild(script);
			window.yandexmapsapiiscalled=true;
		} else {
		  setTimeout(function(){
			t262_appendYandexMap(yarecid,key);
		  },200);
	  }
	}
}

function t262_handleYandexApiReady(recid){
	$('#rec'+recid).find('.t262__map').each(function(index,Element) {
		var el=$(Element);
		var arMarkers = window['arMapMarkers'+recid];

		window.isDragMap = $isMobile ? false : true;
			
		if(el.attr('data-map-style')!=''){var mapstyle=eval(el.attr('data-map-style'));}else{var mapstyle='[]';}
		var myLatlng = arMarkers.length > 0 ? [parseFloat(arMarkers[0].lat), parseFloat(arMarkers[0].lng)] : false;
		var myStates = {
			zoom: parseInt(el.attr('data-map-zoom')),
			center:myLatlng,
			scrollZoom: false,
			controls: ['typeSelector','zoomControl'],
			drag: window.isDragMap
		};

		var map = new ymaps.Map(Element, myStates), i, mrk, marker;
		var myGroup = new ymaps.GeoObjectCollection({}) ;
		map.behaviors.disable('scrollZoom');
		for(i in arMarkers) {
			mrk = arMarkers[i];
			myLatlng = [parseFloat(mrk.lat), parseFloat(mrk.lng)];

			myGroup.add(new ymaps.Placemark(myLatlng, { hintContent: mrk.title, balloonContent: mrk.descr > '' ? $("<textarea/>").html(mrk.descr).text() : mrk.title }));			
		}
		map.geoObjects.add(myGroup);
		if (arMarkers.length > 1) {
			map.setBounds(myGroup.getBounds(), {checkZoomRange: true}) ;
		}
		
		$(window).resize(function(){
			map.container.fitToViewport();
		});

		// DBL Click - activate on mobile      
		if ($isMobile) {
			$(window).dblclick(function() {
				if (window.isDragMap) {
					window.isDragMap = false;
				} else {
					window.isDragMap = true;
				}
				if (window.isDragMap) {
					map.behaviors.enable('drag');
				} else {
					map.behaviors.disable('drag');
				}
			});
		}

	});
} 
window.t266showvideo = function (recid) {
	if (document.readyState !== 'loading') {
		t266_showVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t266_showVideo(recid);
		});
	}
	
	function t266_showVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t266__video-container');
		var videoCover = rec.querySelector('.t266__cover');
		var videoCarrier = rec.querySelector('.t266__video-carier');
		
		var youTubeID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
		var videoURL = youTubeID ? 'https://www.youtube.com/embed/' + youTubeID : '';
		
		document.body.classList.add('t266__overflow');
		if (videoCover) videoCover.classList.add('t266__hidden');
		if (videoContainer) videoContainer.classList.remove('t266__hidden');
		
		if (videoCarrier) {
			var iframe = document.createElement('iframe');
			iframe.id = 'youtubeiframe' + recid;
			iframe.classList.add('t266__iframe');
			iframe.width = '100%';
			iframe.height = '540';
			iframe.src = videoURL + '?rel=0&autoplay=1';
			iframe.frameBorder = '0';
			iframe.setAttribute('allowfullscreen', '');
			var closeLink = document.createElement('a');
			closeLink.classList.add('t266__close-link');
			closeLink.href = 'javascript:t266hidevideo(\'' + recid + '\');';
			var closeLinkContent = document.createElement('div');
			closeLinkContent.classList.add('t266__close');
			closeLink.insertAdjacentElement('beforeend', closeLinkContent);
			videoCarrier.innerHTML = '';
			videoCarrier.insertAdjacentElement('beforeend', iframe);
			videoCarrier.insertAdjacentElement('beforeend', closeLink);
		}
	}
};

window.t266hidevideo = function (recid) {
	if (document.readyState !== 'loading') {
		t266_hideVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t266_hideVideo(recid);
		});
	}
	
	function t266_hideVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t266__video-container');
		var videoCover = rec.querySelector('.t256__cover');
		var videoCarrier = rec.querySelector('.t266__video-carier');
		
		document.body.classList.remove('t266__overflow');
		if (videoCover) videoCover.classList.remove('t266__hidden');
		if (videoContainer) videoContainer.classList.add('t266__hidden');
		if (videoCarrier) videoCarrier.innerHTML = '<div class="t266__video-bg2"></div>';
	}
}; 
function t268_init(recId) {
    var rec = document.getElementById('rec' + recId);
    var container = rec.querySelector('.t268');

    t268_setHeight(recId);

    window.addEventListener('resize', function () {
        t268_setHeight(recId);
    });

    /* TODO: jQyery event */
    $(container).on('displayChanged', function () {
        t268_setHeight(recId);
    });

    /* container.addEventListener('displayChanged', function () {
        t268_setHeight(recId);
    }); */
}

function t268_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t268');
    if (!container) return;
    var colRight = rec.querySelector('.t268__col-right');
    var colLeft = rec.querySelector('.t268__col-left');
    var colStyle = getComputedStyle(colRight, null);
    var colPaddingTop = parseInt(colStyle.paddingTop) || 0;
    var colPaddingBottom = parseInt(colStyle.paddingBottom) || 0;
    var colHeight = colRight.clientHeight - (colPaddingTop + colPaddingBottom);

    colLeft.style.height = colHeight + 'px';
} 
function t186C_init(recid){
	var t186C_el = $('#rec'+recid),
			t186C_btn = t186C_el.find('.t-submit');
	t186C_btn.click(function(){
		setTimeout(function(){t186C_checkSuccess(t186C_el);}, 100);
		setTimeout(function(){t186C_checkSuccess(t186C_el);}, 300);
		setTimeout(function(){t186C_checkSuccess(t186C_el);}, 700);
		setTimeout(function(){t186C_checkSuccess(t186C_el);}, 1500);
	});
}

function t186C_checkSuccess(t186C_el){
	var t186C_formWrapper = t186C_el.find('.t186C__wrapper');
	if (t186C_el.find('.js-form-proccess').hasClass('js-send-form-success') && !t186C_formWrapper.hasClass('t186C__hiding')){
		t186C_formWrapper.addClass('t186C__hiding');
		var t186C_root = $('html, body'),
				t186C_targetOffset = t186C_el.find('.t186C__blockinput-success').offset().top;
		if ($(window).width()>960) {
			var t186C_target = t186C_targetOffset - 200;
		}	else {
			var t186C_target = t186C_targetOffset - 100;
		}

		if (t186C_targetOffset > $(window).scrollTop()) {
			t186C_formWrapper.addClass('t186C__wrapper_hidden');
		} else {
			t186C_root.animate({ scrollTop: t186C_target}, 400);
			setTimeout(function(){t186C_formWrapper.addClass('t186C__wrapper_hidden');}, 400);
		}
	}
}
 
function t300_init() {
    var tooltipBlocks = document.querySelectorAll('.t300');
    Array.prototype.forEach.call(tooltipBlocks, function (tooltip) {
        var hook = tooltip.getAttribute('data-tooltip-hook');
        var tooltipId = tooltip.getAttribute('data-tooltip-id');
        if (hook !== '') {
            /* TODO: backward compatibility for jQuery */
            if (typeof jQuery !== 'undefined') {
                var link = $('a[href="' + hook + '"]:not(.tooltipstered)');
            } else {
                var link = document.querySelector('a[href="' + hook + '"]:not(.tooltipstered)');
            }
            
            var content = tooltip.querySelector('.t300__content').innerHTML;
            var touchDevices = !1;
            if (hook.charAt(0) == '#') {
                touchDevices = !0;
            }
            var position = tooltip.getAttribute('data-tooltip-position');
            if (position === '') {
                position = 'top';
            }
            link.tooltipster({
                theme: 't300__tooltipster-noir t300__tooltipster-noir_' + tooltipId + '',
                contentAsHTML: true,
                content: content,
                interactive: true,
                touchDevices: touchDevices,
                position: position,
            });
        }
    });
}
document.addEventListener('DOMContentLoaded', function () {
    t300_init();
    setTimeout(function () {
        var stores = document.querySelector('body .t-store');
        if (stores) {
            Array.prototype.forEach.call(stores, function (store) {
                new MutationObserver(function (mutationsList) {
                    for (var mutation in mutationsList) {
                        var event = mutationsList[mutation];
                        if (event.type === 'attributes') {
                            if (event.target.className.indexOf('t-popup_show') != -1) {
                                t300_init();
                            }
                        }
                    }
                }).observe(store, {
                    attributes: true,
                    attributeFilter: ['class'],
                    subtree: true
                });
            });
        }
        t300_init();
    }, 500);
}); 
    var t279 = {};
    
    t279.equalheight = function(recid) {

        var currentTallest = 0,
            currentRowStart = 0,
            rowDivs = new Array(),
            $el,
            topPosition = 0;
            
        $('#rec'+recid+' .t279__textwrapper').each(function() {
     
            $el = $(this);
            $($el).height('auto')
            topPostion = $el.position().top;
       
            if (currentRowStart != topPostion) {
                for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                    rowDivs[currentDiv].height(currentTallest);
                }
                rowDivs.length = 0;
                currentRowStart = topPostion;
                currentTallest = $el.height();
                rowDivs.push($el);
            } else {
                rowDivs.push($el);
                currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
            }
            for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                rowDivs[currentDiv].height(currentTallest);
            }
        });
    };
 
function t280_showMenu(recid){
  var el=$("#rec"+recid);
  
  
  el.find('.t280__burger, .t280__menu__bg, .t280__menu__item:not(".tooltipstered"):not(".t280__menu__item_submenu"), .t978__tooltip-menu_mobile').click(function(e){
    if ($(this).is(".t280__menu__item.tooltipstered, .t794__tm-link")) { return; }
    var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
    var menuItemsLength = el.find('.t280__menu__item').length;
    /* Hack for big amount of items in menu */
    var isAndroid = /(android)/i.test(navigator.userAgent);
    if (window.location.hash && isChrome && menuItemsLength > 10 && isAndroid) {
        setTimeout(function () {
            var hash = window.location.hash;
            window.location.hash = "";
            window.location.hash = hash;
        }, 50);
    }
    
    if (!$(this).is(".t978__tm-link, .t966__tm-link")) {
        $('body').toggleClass('t280_opened');
        el.find('.t280').toggleClass('t280__main_opened');
    }
    
    t280_changeSize(recid);
    t280_highlight(recid);
    
    el.find(".t978__tm-link, .t966__tm-link, .t-menusub__target-link").click(function() {
        t280_changeSize(recid);
        el.find(".t280__menu").css('transition', 'none');

        el.find(".t978__menu-link").click(function() {
            t280_changeSize(recid);
        });
    });
  });

  $('.t280').bind('clickedAnchorInTooltipMenu',function(){
    $('body').removeClass('t280_opened');
    el.find('.t280').removeClass('t280__main_opened');
  });
  
  if (el.find('.t-menusub__link-item')) {
    el.find('.t-menusub__link-item').on('click', function() {
      $('body').removeClass('t280_opened');
      el.find('.t280').removeClass('t280__main_opened');
    });
  }
}

function t280_changeSize(recid){
  var el=$("#rec"+recid);
  var div = el.find(".t280__menu").height();
  var bottomheight = el.find(".t280__bottom").height();
  var headerheight = el.find(".t280__container").height();
  var wrapper = el.find(".t280__menu__wrapper");
  var win = $(window).height() - bottomheight - headerheight - 160;
  if (div > win ) {
    wrapper.addClass('t280__menu_static');
  }
  else {
    wrapper.removeClass('t280__menu_static');
  }
}

function t280_changeBgOpacityMenu(recid) {
  var window_width=$(window).width();
  var record = $("#rec"+recid);
  record.find(".t280__container__bg").each(function() {
        var el=$(this);
        var bgcolor=el.attr("data-bgcolor-rgba");
        var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
        var bgopacity=el.attr("data-bgopacity");
        var bgopacity_afterscroll=el.attr("data-bgopacity2");
        var menu_shadow=el.attr("data-menu-shadow");
        if ($(window).scrollTop() > 20) {
            el.css("background-color",bgcolor_afterscroll);
            if (bgopacity_afterscroll != "0" && bgopacity_afterscroll != "0.0") {
              el.css('box-shadow',menu_shadow);
            } else {
              el.css('box-shadow','none');
            }
        }else{
            el.css("background-color",bgcolor);
            if (bgopacity != "0" && bgopacity != "0.0") {
              el.css('box-shadow',menu_shadow);
            } else {
              el.css('box-shadow','none');
            }
        }
  });
}

function t280_appearMenu() {
  $('.t280').each(function() {
    var el = $(this);
    var appearoffset = el.attr('data-appearoffset');
    if (appearoffset != '') {
      if (appearoffset.indexOf('vh') > -1) {
        appearoffset = Math.floor(
          window.innerHeight * (parseInt(appearoffset) / 100)
        );
      }
      appearoffset = parseInt(appearoffset, 10);
      if ($(window).scrollTop() >= appearoffset) {
        if (el.css('visibility') == 'hidden') {
          el.finish();
          el.css('top', '-50px');
          el.css('opacity', '1');
          el.css('visibility', 'visible');
        }
      } else {
        el.stop();
        el.css('opacity', '0');
        el.css('visibility', 'hidden');
      }
    }
  });
}

function t280_highlight(recid){
  var url=window.location.href;
  var pathname=window.location.pathname;
  var hash=window.location.hash;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  if(hash.substr(hash.length - 1) == "/"){ hash = hash.slice(0,-1); }

  $("#rec"+recid).find(".t280__menu a").removeClass("t-active");
  
  $(".t280__menu a[href='"+url+"']").addClass("t-active");
  $(".t280__menu a[href='"+url+"/']").addClass("t-active");
  $(".t280__menu a[href='"+pathname+"']").addClass("t-active");
  $(".t280__menu a[href='/"+pathname+"']").addClass("t-active");
  $(".t280__menu a[href='"+pathname+"/']").addClass("t-active");
  $(".t280__menu a[href='/"+pathname+"/']").addClass("t-active");
 
  if (hash !== "") {
    $(".t280__menu a[href='"+hash+"']").addClass("t-active");
    $(".t280__menu a[href='/"+hash+"']").addClass("t-active");
    $(".t280__menu a[href='"+hash+"/']").addClass("t-active");
    $(".t280__menu a[href='/"+hash+"/']").addClass("t-active");
  }
}
 
function t312_initPopup() {
    var links = document.querySelectorAll('a[href*="typeform.com"]');

    for (var i = 0; i < links.length; i++) {
        var link = links[i];

        link.setAttribute('data-mode', '1');
        link.setAttribute('target', '_blank');

        if (window.innerWidth > 980) {
            link.removeEventListener('click', t312_initEventClick);
            link.addEventListener('click', t312_initEventClick);
        }
    }
}

function t312_initEventClick(event) {
    var url = this.href;

    t312_showPopup(url);
    t312_resizePopup();
    event.preventDefault();
}

function t312_showPopup(url) {
    var containers = document.querySelectorAll('.t312');
    var windowHeight = window.innerHeight - 100;

    var iframe = document.createElement('iframe');
    iframe.id = 'typeform-full';
    iframe.width = '100%';
    iframe.height = '100%';
    iframe.src = url;
    iframe.setAttribute('frameborder', '0');
    iframe.setAttribute('data-hook-iframe', 't312');

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://s3-eu-west-1.amazonaws.com/share.typeform.com/embed.js?v=1';
    
    if (containers.length > 0) document.body.classList.add('t312__body_popupshowed');

    for (var i = 0; i < containers.length; i++) {
        var container = containers[i];
        var popup = container.querySelector('.t312__popup');
        var closeButtons = container.querySelectorAll('.t312__close, .t312__bg');
        var content = container.querySelector('[data-hook-typeform-carrier]');

        content.innerHTML = '';
        content.appendChild(iframe);
        content.appendChild(script);
        container.querySelector('[data-hook-iframe]').style.height = windowHeight + 'px';

        if (popup.getAttribute('style')) popup.removeAttribute('style');

        container.classList.add('t312__popup_show');

        for (var j = 0; j < closeButtons.length; j++) {
            var closeButton = closeButtons[j];

            closeButton.removeEventListener('click', t312_closePopup);
            closeButton.addEventListener('click', t312_closePopup);
        }
    }
}

function t312_closePopup() {
    var container = document.querySelector('.t312.t312__popup_show');

    document.body.classList.remove('t312__body_popupshowed');

    if (container) container.classList.remove('t312__popup_show');
}

function t312_resizePopup() {
    var popups = document.querySelectorAll('.t312__content');
    var main = document.querySelector('.t312__mainblock');
    var windowHeight = window.innerHeight;
    var mainHeight = 0;

    if (main) {
        var mainStyle = getComputedStyle(main, null);
        var mainPaddingTop = parseInt(mainStyle.paddingTop) || 0;
        var mainPaddingBottom = parseInt(mainStyle.paddingBottom) || 0;
        
        mainHeight = main.clientHeight - (mainPaddingTop + mainPaddingBottom);
    }

    if (mainHeight > windowHeight) {
        for (var i = 0; i < popups.length; i++) {
            popups[i].classList.add('t312__content_static');
        }
    } else {
        for (var i = 0; i < popups.length; i++) {
            popups[i].classList.remove('t312__content_static');
        }
    }
} 
function t315_showcomments(recid)
{
  var el=$("#rec"+recid);
  el.find(".t-btn").css("display","none");
  el.find(".t315__blocktitle").css("display","block");
  el.find(".t315__blockhtml").css("display","block");
}
 
function t281_initPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t281');
    if (!container) return;

    rec.setAttribute('data-animationappear', 'off');
    rec.setAttribute('data-popup-subscribe-inited', 'y');
    rec.style.opacity = 1;

    var documentBody = document.body;
    var hrefs = rec.querySelectorAll('a[href*="#"]');
    var popup = rec.querySelector('.t-popup');
    var popupCloseBtn = popup.querySelector('.t-popup__close');
    var popupTooltipHook = popup.getAttribute('data-tooltip-hook');
    var analitics = popup.getAttribute('data-track-popup');

    if (popupTooltipHook) {
        var recBlocks = document.querySelectorAll('.r');

        for (var i = 0; i < recBlocks.length; i++) {
            recBlocks[i].addEventListener('click', function(event) {
                var target = event.target;
                var href = target.closest('a[href="' + popupTooltipHook + '"]') ? target : false;

                if (!href) return;

                event.preventDefault();
                t281_showPopup(recId);
                t281_resizePopup(recId);
                t281__lazyLoad();

                if (analitics) {
                    Tilda.sendEventToStatistics(analitics, popupTooltipHook);
                }
            });
        }
    }

    popup.addEventListener('scroll', t_throttle(function () {
        t281__lazyLoad();
    }));

    popup.addEventListener('click', function(event) {
        if (event.target === this) t281_closePopup();
    });

    popupCloseBtn.addEventListener('click', t281_closePopup);

    for (var i = 0; i < hrefs.length; i++) {
        hrefs[i].addEventListener('click', function() {
            var url = this.getAttribute('href');

            if (!url || (url.substring(0, 7) != '#price:' && url.substring(0, 7) != '#order:')) {
                t281_closePopup();

                if (!url || url.substring(0, 7) == '#popup:') {
                    setTimeout(function() {
                        documentBody.classList.add('t-body_popupshowed');
                    }, 300);
                }
            }
        });
    }
}

function t281_lockScroll() {
    var documentBody = document.body;

    if (!documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || documentBody.parentNode || documentBody).scrollTop;

        documentBody.classList.add('t-body_scroll-locked');
        documentBody.style.top = '-' + bodyScrollTop + 'px';
        documentBody.setAttribute('data-popup-scrolltop', bodyScrollTop);
    }
}

function t281_unlockScroll() {
    var documentBody = document.body;

    if (documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = documentBody.getAttribute('data-popup-scrolltop');

        documentBody.classList.remove('t-body_scroll-locked');
        documentBody.style.top = null;
        documentBody.removeAttribute('data-popup-scrolltop');
        document.documentElement.scrollTop = parseInt(bodyScrollTop);
    }
}

function t281_showPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t281');
    if (!container) return;

    var popup = rec.querySelector('.t-popup');
    var popupContainer = popup.querySelector('.t-popup__container');
    var documentBody = document.body;

    popup.style.display = 'block';

    setTimeout(function() {
        popupContainer.classList.add('t-popup__container-animated');
        popup.classList.add('t-popup_show');
    }, 50);

    documentBody.classList.add('t-body_popupshowed');
    documentBody.classList.add('t281__body_popupshowed');

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        setTimeout(function() {
            t281_lockScroll();
        }, 500);
    }
    
    document.addEventListener('keydown', t281_escClosePopup);
}

function t281_escClosePopup(event) {
    if (event.key === 'Escape') t281_closePopup();
}

function t281_closePopup() {
    var popupAll = document.querySelectorAll('.t-popup');

    document.body.classList.remove('t-body_popupshowed');
    document.body.classList.remove('t281__body_popupshowed');

    for (var i = 0; i < popupAll.length; i++) {
        popupAll[i].classList.remove('t-popup_show');
    }

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        t281_unlockScroll();
    }

    setTimeout(function() {
        var popupHide = document.querySelectorAll('.t-popup:not(.t-popup_show)');

        for (var i = 0; i < popupHide.length; i++) {
            popupHide[i].style.display = 'none';
        }
    }, 300);
    
    document.removeEventListener('keydown', t281_escClosePopup);
}

function t281_resizePopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var popupContainer = rec.querySelector('.t-popup__container');
    if (!popupContainer) return;
    
    var popupStyle = getComputedStyle(popupContainer, null);
    var popupPaddingTop = parseInt(popupStyle.paddingTop) || 0;
    var popupPaddingBottom = parseInt(popupStyle.paddingBottom) || 0;
    var popupHeight = popupContainer.clientHeight - (popupPaddingTop + popupPaddingBottom);

    if (popupHeight > (window.innerHeight - 120)) {
        popupContainer.classList.add('t-popup__container-static');
    } else {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t281_sendPopupEventToStatistics(popupName) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';

    if (popupName.substring(0,7) == '#popup:') {
        popupName = popupName.substring(7);
    }

    virtPage += popupName;
    virtTitle += popupName;

    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {'hitType': 'pageview', 'page': virtPage, 'title': virtTitle});
            }
        }

        if (window.mainMetrika && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t281__lazyLoad() {
    if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
} 
function t282_showMenu(recid) {
    var el = $("#rec" + recid);

    el.find('.t282__burger, .t282__menu__item:not(".tooltipstered"):not(".t282__menu__item_submenu"), .t282__overlay').click(function () {
        if ($(this).is(".t282__menu__item.tooltipstered, .t794__tm-link, .t978__tm-link, .t966__tm-link")) {
            return;
        }
        $('body').toggleClass('t282_opened');
        el.find('.t282__menu__container, .t282__overlay').toggleClass('t282__closed');
        var height = el.find(".t282__container").get(0).getBoundingClientRect().height;
        el.find(".t282__menu__container").css({
            'top': height
        });
        t282_highlight(recid);
    });

    el.find('.t282').bind('clickedAnchorInTooltipMenu', function () {
        $('body').removeClass('t282_opened');
        $('#rec' + recid + ' .t282__menu__container, #rec' + recid + ' .t282__overlay').addClass('t282__closed');
    });

    if (el.find('.t-menusub__link-item')) {
        el.find('.t-menusub__link-item').on('click', function () {
            $('body').removeClass('t282_opened');
            $('#rec' + recid + ' .t282__menu__container, #rec' + recid + ' .t282__overlay').addClass('t282__closed');
        });
    }
}

function t282_changeSize(recid) {
    var el = $("#rec" + recid);
    var bottomheight = el.find(".t282__menu__container");
    var headerheight = el.find(".t282__container");
    var menu = bottomheight.height() + headerheight.height();
    var win = $(window).height();
    if (menu > win) {
        $("#nav" + recid).addClass('t282__menu_static');
    } else {
        $("#nav" + recid).removeClass('t282__menu_static');
    }
}

function t282_changeBgOpacityMenu(recid) {
    var window_width = $(window).width();
    var record = $("#rec" + recid);
    record.find(".t282__container__bg").each(function () {
        var el = $(this);
        var bgcolor = el.attr("data-bgcolor-rgba");
        var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
        var bgopacity = el.attr("data-bgopacity");
        var bgopacity_afterscroll = el.attr("data-bgopacity2");
        var menu_shadow = el.attr("data-menu-shadow");
        if ($(window).scrollTop() > 20) {
            el.css("background-color", bgcolor_afterscroll);
            if (bgopacity_afterscroll != "0" && bgopacity_afterscroll != "0.0") {
                el.css('box-shadow', menu_shadow);
            } else {
                el.css('box-shadow', 'none');
            }
        } else {
            el.css("background-color", bgcolor);
            if (bgopacity != "0" && bgopacity != "0.0") {
                el.css('box-shadow', menu_shadow);
            } else {
                el.css('box-shadow', 'none');
            }
        }
    });
}

function t282_highlight(recid) {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash=window.location.hash;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname === "") {
        pathname = "/";
    }
    if (hash.substr(hash.length - 1) == "/"){ 
        hash = hash.slice(0,-1); 
    }
    if (hash == ""){ 
        hash = "/"; 
    }
    
    $("#rec"+recid).find(".t282__menu a").removeClass("t-active");
    
    $(".t282__menu a[href='" + url + "']").addClass("t-active");
    $(".t282__menu a[href='" + url + "/']").addClass("t-active");
    $(".t282__menu a[href='" + pathname + "']").addClass("t-active");
    $(".t282__menu a[href='/" + pathname + "']").addClass("t-active");
    $(".t282__menu a[href='" + pathname + "/']").addClass("t-active");
    $(".t282__menu a[href='/" + pathname + "/']").addClass("t-active");
    
    $(".t282__menu a[href='"+hash+"']").addClass("t-active");
    $(".t282__menu a[href='/"+hash+"']").addClass("t-active");
    $(".t282__menu a[href='"+hash+"/']").addClass("t-active");
    $(".t282__menu a[href='/"+hash+"/']").addClass("t-active");
}

function t282_appearMenu(recid) {
    var window_width = $(window).width();
    $(".t282").each(function () {
        var el = $(this);
        var appearoffset = el.attr("data-appearoffset");
        if (appearoffset !== "") {
            if (appearoffset.indexOf('vh') > -1) {
                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
            }

            appearoffset = parseInt(appearoffset, 10);

            if ($(window).scrollTop() >= appearoffset) {
                if (el.css('visibility') == 'hidden') {
                    el.finish();
                    el.css("top", "-50px");
                    el.css("visibility", "visible");
                    el.animate({
                        "opacity": "1",
                        "top": "0px"
                    }, 200, function () {});
                }
            } else {
                el.stop();
                el.css("visibility", "hidden");
            }
        }
    });
}
 
function t330_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed t330__body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t330_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t330_closePopup();
  });

  el.find('a[href*=#]').click(function(e){
    var url = $(this).attr('href');
    if (!url || url.substring(0,7) != '#price:') {
      t330_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t330_closePopup(); }
  });
}

function t330_closePopup(){
  $('body').removeClass('t-body_popupshowed t330__body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t330_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 120,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}

function t330_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {
    if(ga) {
      if (window.mainTracker != 'tilda') {
        ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
      }
    }
  
    if (window.mainMetrika > '' && window[window.mainMetrika]) {
      window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
    }
  }
}

function t330_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t330_showPopup(recid);
      t330_resizePopup(recid);
      e.preventDefault();
      if(window.lazy=='y'){t_lazyload_update();}
      if (analitics == 'yes') {
        t330_sendPopupEventToStatistics(hook);
      }
    });
  }
} 
function t331_initPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	rec.setAttribute('data-animationappear', 'off');
	rec.style.opacity = '1';
	
	var currentBlock = rec.querySelector('.t-popup');
	var currentHook = currentBlock ? currentBlock.getAttribute('data-tooltip-hook') : '';
	var currentAnalitics = currentBlock ? currentBlock.getAttribute('data-track-popup') : '';
	if (!currentHook) return false;
	
	document.addEventListener('click', function (e) {
		if (e.target.closest('a[href="' + currentHook + '"]')) {
			e.preventDefault();
			t331_showPopup(recid);
			t331_resizePopup(recid);
			if (currentAnalitics) {
				var virtTitle = currentHook;
				if (virtTitle.substring(0, 7) === '#popup:') virtTitle = virtTitle.substring(7);
				Tilda.sendEventToStatistics(currentAnalitics, virtTitle);
			}
		}
	});
}

function t331_setHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var videoCarrier = rec.querySelector('.t331__video-carier');
	var carrierParent = videoCarrier ? videoCarrier.parentNode : null;
	var videoWidth = videoCarrier ? videoCarrier.getAttribute('data-video-width') : '0';
	var videoHeight = videoCarrier ? videoCarrier.getAttribute('data-video-height') : '0';
	
	if (videoHeight.indexOf('vh') !== -1) {
		videoHeight = parseInt(videoHeight, 10) * window.innerHeight / 100;
	} else {
		videoHeight = parseInt(videoHeight, 10);
	}
	
	var ratio = videoHeight / (parseInt(videoWidth, 10) || 1);
	var videoCurrentWidth = videoCarrier ? videoCarrier.offsetWidth : 0;
	var calculatedHeight = videoCurrentWidth * ratio;
	
	if (videoCarrier) videoCarrier.style.height = calculatedHeight + 'px';
	if (carrierParent) carrierParent.style.height = calculatedHeight + 'px';
}

function t331_showPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popup = rec.querySelector('.t-popup');
	var videoContainer = rec.querySelector('.t331__youtube');
	var videoCarrier = rec.querySelector('.t331__video-carier');
	var videoID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
	var videoURL = videoID ? 'https://www.youtube.com/embed/' + videoID : '';
	
	if (videoCarrier) {
		var iframe = document.createElement('iframe');
		iframe.id = 'youtubeiframe' + recid;
		iframe.classList.add('t331__iframe');
		iframe.width = '100%'; /*100.5%*/
		iframe.height = '100%'; /*100.5%*/
		iframe.src = videoURL + (videoURL.indexOf('?') !== -1 ? '&' : '?') + 'autoplay=1&rel=0';
		iframe.frameBorder = '0';
		iframe.setAttribute('allowfullscreen', '');
		videoCarrier.insertAdjacentElement('beforeend', iframe);
	}
	
	if (popup) popup.style.display = 'block';
	t331_setHeight(recid);
	
	setTimeout(function () {
		var popupContainer = popup ? popup.querySelector('.t-popup__container') : null;
		if (popupContainer) popupContainer.classList.add('t-popup__container-animated');
		if (popup) popup.classList.add('t-popup_show');
	}, 50);
	
	document.body.classList.add('t-body_popupshowed');
	document.body.classList.add('t331__body_popupshowed');
	
	if (popup) {
		popup.addEventListener('click', function (e) {
			if (e.target === popup) t331_popup_close(recid);
		});
	}
	
	var popupClose = popup ? popup.querySelector('.t-popup__close') : null;
	if (popupClose) {
		popupClose.addEventListener('click', function () {
			t331_popup_close(recid);
		});
	}
	
	document.addEventListener('keydown', function (e) {
		if (e.keyCode === 27) t331_popup_close(recid);
	});
}

function t331_popup_close(recid) {
	document.body.classList.remove('t-body_popupshowed');
	document.body.classList.remove('t331__body_popupshowed');
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popup = rec.querySelector('.t-popup');
	var videoCarrier = rec.querySelector('.t331__video-carier');
	if (popup) popup.classList.remove('t-popup_show');
	
	setTimeout(function () {
		if (videoCarrier) videoCarrier.innerHTML = '';
		if (popup && !popup.classList.contains('t-popup_show')) {
			popup.style.display = 'none';
		}
	}, 300);
}

function t331_resizePopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popupContainer = rec.querySelector('.t-popup__container');
	var popupContainerHeight = popupContainer ? popupContainer.offsetHeight : 0;
	
	if (popupContainerHeight > window.innerHeight) {
		if (popupContainer) {
            popupContainer.classList.add('t-popup__container-static');
        }
	} else if (popupContainer) {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t331_sendPopupEventToStatistics(popupname) {
	var virtPage = '/tilda/popup/';
	var virtTitle = 'Popup: ';
	if (popupname.substring(0, 7) === '#popup:') {
		popupname = popupname.substring(7);
	}
	
	virtPage += popupname;
	virtTitle += popupname;
	
	if (ga) {
		if (window.mainTracker !== 'tilda') {
			ga('send', {'hitType': 'pageview', 'page': virtPage, 'title': virtTitle});
		}
	}
	
	if (window.mainMetrika > '' && window[window.mainMetrika]) {
		window[window.mainMetrika].hit(virtPage, {title: virtTitle, referer: window.location.href});
	}
} 
var t334 = {};
t334.initeffect = function (recid){
    if ($('#rec'+recid).find('.t-container').attr('data-show-button')=="true") {
      $('#rec'+recid).find(".t334__cell").each(function() {
        var sizer = $(this).find(".t334__button-container").height();
        $(this).find(".t334__textwrapper__content").css({'padding-bottom':(sizer+'px')});
        $(this).find(".t334__button-container").addClass("t334__button-container_show");  
      });
    } else {
      $('#rec'+recid).find(".t334__cell").hover(function(){
        var sizer = $(this).find(".t334__button-container").height();
        $(this).find(".t334__textwrapper__content").css({'padding-bottom':(sizer+'px')});
        $(this).find(".t334__button-container").addClass("t334__button-container_show");
      }, function(){
        $(this).find(".t334__textwrapper__content").css("padding-bottom","0");
        $(this).find(".t334__button-container").removeClass("t334__button-container_show");
      });
    }
};
  
 
	var t335 = {};
    t335.initeffect = function(recid) {
        $('#rec'+recid).find(".t335__cell").hover(function(){
            var sizer = $(this).find(".t335__button-container").height();
            $(this).find(".t335__textwrapper__content").css({'padding-bottom':(sizer+'px')});
            $(this).find(".t335__button-container").addClass("t335__button-container_show");
        }, function(){
            $(this).find(".t335__textwrapper__content").css("padding-bottom","0");
            $(this).find(".t335__button-container").removeClass("t335__button-container_show");
        });
    };
 
var t336 = {};
t336.initeffect = function (recid) {
    $('#rec' + recid).find(".t336__cell").hover(function () {
        var sizer = $(this).find(".t336__button-container").height();
        $(this).find(".t336__textwrapper__content").css({
            'padding-bottom': (sizer + 'px')
        });
        $(this).find(".t336__button-container").addClass("t336__button-container_show");
    }, function () {
        $(this).find(".t336__textwrapper__content").css("padding-bottom", "0");
        $(this).find(".t336__button-container").removeClass("t336__button-container_show");
    });
}; 
function t341_showCaptions(recid){
  var el=$("#t-carousel"+recid);
  var caption = el.find('.item:nth-child(1) .t-carousel__caption-inside');
  var captioncontainer = el.find('.t-carousel__caption__container');
  captioncontainer.html(caption.html());
  caption.css('display','none');

  $("#t-carousel"+recid).on('slide.bs.carousel', function(evt) {
    var el=$("#t-carousel"+recid);
    var caption = el.find('.item:nth-child(' + ($(evt.relatedTarget).index()+1) + ') .t-carousel__caption-inside');
    var captioncontainer = el.find('.t-carousel__caption__container');
    captioncontainer.html(caption.html());
    caption.css('display','none');
  });
}

function t341_checkSize(recid){
  var el=$("#rec"+recid);
  var containerinside = el.find(".t-carousel__arrows__container_inside");
  var containeroutside = el.find(".t-carousel__arrows__container_outside");
  var inner = el.find(".t-carousel__inner");
  var arrowleft = el.find(".t-carousel__arrow_left");
  var arrowright = el.find(".t-carousel__arrow_right");
  containeroutside.css({'max-width':(arrowleft.width()+arrowright.width()+inner.width()+ 60 +'px')});
  containerinside.css({'max-width':(inner.width()+'px')});

  var sizer = el.find('.t-carousel__height');
  var height = sizer.height();
  var width = sizer.width();
  if (width==0) {
    var width = $(window).width();
  }
  var ratio = width/height;
  var gallerywrapper = el.find(".t-carousel__checksize");
  var gallerywidth = gallerywrapper.width();

  if (height != $(window).height()) {
    gallerywrapper.css({'height':((gallerywidth/ratio)+'px')});
  }
} 
function t341_sendPaymentEventToStatistics(product, price) {
    if (Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        var virtPage = '/tilda/payment/?product='+product+'&price='+price;
        var virtTitle = 'Order: '+product+' = '+price;
        Tilda.sendEventToStatistics(virtPage, virtTitle,'',price);
    } else {
        var virtPage = '/tilda/order/?product='+product+'&price='+price;
        var virtTtitle = 'Order: '+product+' = '+price;

        if(ga) {
            if (window.mainTracker == 'tilda') {
                ga('tilda.send', {'hitType':'pageview', 'page':virtPage,'title':virtTtitle});
            } else {
                ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTtitle});
            }
        }
        
        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTtitle,referer: window.location.href});
        }
    }
}

function t341_initStripePayment(recid, publishableapi, companyname, logo) {
	
	if (typeof StripeCheckout === 'object' ) {
		t341_handleStripeApiReady(recid,publishableapi, companyname, logo);
	} else {
		if(window.stripeapiiscalled!==true){
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "https://checkout.stripe.com/checkout.js";
			document.body.appendChild(script);
			window.stripeapiiscalled=true;
		}
		
		setTimeout(function(){
			t341_initStripePayment(recid, publishableapi, companyname, logo)
		}, 10);
	}

}

function t341_handleStripeApiReady(recid,publishableapi, companyname, logo) {
	if(! window.stripehandler) {
		window.stripehandler = StripeCheckout.configure({
			key: publishableapi,
			image: logo,
			name: (companyname ? companyname : window.location.host),
			locale: 'auto',
			token: function(token) {
				if (token && token.id) {
					t341_sendPaymentEventToStatistics($('#rec'+recid+' .js-product-name').val(), parseInt($('#rec'+recid+' .js-amount').val())*100);

					var data = {};
					data.projectid = $('#allrecords').attr('data-tilda-project-id');
					data.token = token.id;
					if (token.email) {
						data.email = token.email;
					}
					data.amount = parseInt($('#rec'+recid+' .js-amount').val())*100;
					data.products = [{
						product: $('#rec'+recid+' .js-product-name').val(),
						amount: parseInt($('#rec'+recid+' .js-amount').val())*100
						}
					];
					data.currency = $('#rec'+recid+' .js-currency').val();
					
					$.post('https://forms.tildacdn.com/payment/stripe/', data, function(json){
						},
						'json'
					);

					if ($('#rec'+recid+' .js-success-url').val() > '') {
						window.location.href = $('#rec'+recid+' .js-success-url').val();
					} else {
						$('#rec'+recid+' .t341__submit').val('Payed');
					}

				}
			}
		});
		// Close Checkout on page navigation:
		$(window).on('popstate', function() {
			window.stripehandler.close();
		});
	}
	
	$('#rec'+recid+' .t341__submit').on('click', function(e) {
		e.preventDefault();
		// Open Checkout with further options:
		window.stripehandler.open({
			name: companyname,
			image: logo,
			description: $('#rec'+recid+' .js-product-name').val(),
			amount: parseInt($('#rec'+recid+' .js-amount').val()*100),
			currency: $('#rec'+recid+' .js-currency').val(),
			shippingAddress: $('#rec'+recid+' .js-need-shipping').val() == '1' ? true : false,
			billingAddress: $('#rec'+recid+' .js-need-shipping').val() == '1' ? true : false,
		});
	});
}


function t341_initCloudPayments(recid, publishableapi) {
	
	if (typeof cp == "object" && typeof cp.CloudPayments == "function") {
		t341_handleCloudPaymentsApiReady(recid,publishableapi);
	} else {
		if(window.cloudpaymentsapiiscalled!==true){
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "https://widget.cloudpayments.ru/bundles/cloudpayments";
			document.body.appendChild(script);
			window.cloudpaymentsapiiscalled=true;
		}
		
		setTimeout(function(){
			t341_initCloudPayments(recid, publishableapi);
		}, 10);
	}

}

function t341_handleCloudPaymentsApiReady(recid,publishableapi) {
	
	$('#rec'+recid+' .t341__submit').on('click', function(e) {
		e.preventDefault();
		
		var currency = $('#rec'+recid+' .js-currency').val();
		if(! window.cloudpaymentshandler) {
			var lang='';
			if ( $('#rec'+recid+' .js-language').length > 0) {
				lang = $('#rec'+recid+' .js-language').val();
			}
			if (lang == '') {
				lang = (currency == 'RUB' || currency == 'BYR' ? 'ru-RU' : 'en-US');
			}
			window.cloudpaymentshandler = new cp.CloudPayments({language: lang});
		}

		/* Open Checkout with further options:*/
		window.cloudpaymentshandler.charge(
			{
				publicId: publishableapi, 
				description: $('#rec'+recid+' .js-product-name').val(), 
				amount: parseFloat($('#rec'+recid+' .js-amount').val()),
				currency: currency, 
			},
			function (options) { /* success*/
				//действие при успешной оплате
				t341_sendPaymentEventToStatistics($('#rec'+recid+' .js-product-name').val(), parseInt($('#rec'+recid+' .js-amount').val()));
				if ($('#rec'+recid+' .js-success-url').val() > '') {
					window.location.href = $('#rec'+recid+' .js-success-url').val();
				} else {
					$('#rec'+recid+' .t341__submit').val('Payed');
				}
				
			},
			function (reason, options) { // fail
				if ($('#rec'+recid+' .js-failure-url').val() > '') {
					window.location.href = $('#rec'+recid+' .js-failure-url').val();
				}
			}
		);
	});
}
 
function t342_sendPaymentEventToStatistics(product, price) {
    if (Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        var virtPage = '/tilda/payment/?product='+product+'&price='+price;
        var virtTitle = 'Order: '+product+' = '+price;
        Tilda.sendEventToStatistics(virtPage, virtTitle,'',price);
    } else {
        var virtPage = '/tilda/order/?product='+product+'&price='+price;
        var virtTitle = 'Order: '+product+' = '+price;

        if(window.ga && window.mainTracker != 'tilda') {
            ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
        }
        
        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t342_initStripePayment(recid, publishableapi, companyname, logo) {
	
	if (typeof StripeCheckout === 'object' ) {
		t342_handleStripeApiReady(recid,publishableapi, companyname, logo);
	} else {
		if(window.stripeapiiscalled!==true){
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "https://checkout.stripe.com/checkout.js";
			document.body.appendChild(script);
			window.stripeapiiscalled=true;
		}
		
		setTimeout(function(){
			t342_initStripePayment(recid, publishableapi, companyname, logo)
		}, 10);
	}

}

function t342_handleStripeApiReady(recid, publishableapi, companyname, logo) {
	if(! window.stripehandler) {
		window.stripehandler = StripeCheckout.configure({
			key: publishableapi,
			image: logo,
			name: (companyname ? companyname : window.location.host),
			locale: 'auto'
		});
		// Close Checkout on page navigation:
		$(window).on('popstate', function() {
			window.stripehandler.close();
		});
	}
	
	$('[href^="#price"]').click(function(e){
		e.preventDefault();

		var t342click = $(this);
		var tmp = $(this).attr('href');
		// format:  #price:Cost:Product name
		var arParam = tmp.split(':');
		var productprice = parseInt(arParam[1].replace(/[^0-9\.]/g,''));
		var productname = arParam[2];
		if (! productname) {
			var tmp=$(this).closest('.r').find('.title');
			if (tmp.length > 0) {
				productname = tmp.text();
			}
			productname = $(this).text();
		}
		
		window.stripehandler.open({
			name: companyname,
			image: logo,
			description: productname,
			amount: parseInt(productprice)*100,
			currency: $('#rec'+recid+' .js-stripe-currency').val(),
			shippingAddress: $('#rec'+recid+' .js-stripe-need-shipping').val() == '1' ? true : false,
			billingAddress: $('#rec'+recid+' .js-stripe-need-shipping').val() == '1' ? true : false,
			token: function(token, args) {
				if (token && token.id) {
					t342_sendPaymentEventToStatistics(productname, productprice*100);

					var data = {};
					data.projectid = $('#allrecords').attr('data-tilda-project-id');
					data.token = token.id;
					if (token.email) {
						data.email = token.email;
					}
					data.amount = parseInt(productprice)*100;
					data.products = [{
						product: productname,
						amount: parseInt(productprice)*100
						}
					];
					data.currency = $('#rec'+recid+' .js-stripe-currency').val();
					
					$.post('https://forms.tildacdn.com/payment/stripe/', data, function(json){
							if ($('#rec'+recid+' .js-success-url').val() > '') {
								window.location.href = $('#rec'+recid+' .js-success-url').val();
							} else {
								t342click.html('<span style="vertical-align: middle;">Payed</span>');
							}

						},
						'json'
					).fail(function(){

						if ($('#rec'+recid+' .js-success-url').val() > '') {
							window.location.href = $('#rec'+recid+' .js-success-url').val();
						} else {
							t342click.html('<span style="vertical-align: middle;">Try, again</span>');
						}
					});
				}
			}
			
		});

	});
}

function t342_initCloudPayments(recid, publishableapi) {
	
	if (typeof cp == "object" && typeof cp.CloudPayments == "function") {
		t342_handleCloudPaymentsApiReady(recid,publishableapi);
	} else {
		if(window.cloudpaymentsapiiscalled!==true){
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "https://widget.cloudpayments.ru/bundles/cloudpayments";
			document.body.appendChild(script);
			window.cloudpaymentsapiiscalled=true;
		}
		
		setTimeout(function(){
			t342_initCloudPayments(recid, publishableapi);
		}, 10);
	}

}

function t342_handleCloudPaymentsApiReady(recid,publishableapi) {
	
	$('[href^="#price"]').click(function(e){
		e.preventDefault();

		var currency = $('#rec'+recid+' .js-currency').val();
		if(! window.cloudpaymentshandler) {
			var lang='';
			if ( $('#rec'+recid+' .js-language').length > 0) {
				lang = $('#rec'+recid+' .js-language').val();
			}
			if (lang == '') {
				lang = (currency == 'RUB' || currency == 'BYR' ? 'ru-RU' : 'en-US');
			}
			window.cloudpaymentshandler = new cp.CloudPayments({language: lang});
		}

		var t342click = $(this);
		var tmp = $(this).attr('href');
		// format:  #price:Cost:Product name
		var arParam = tmp.split(':');
		var productprice = parseFloat(arParam[1].replace(/[^0-9\.]/g,''));
		var productname = arParam[2];
		if (! productname) {
			var tmp=$(this).closest('.r').find('.title');
			if (tmp.length > 0) {
				productname = tmp.text();
			}
			productname = $(this).text();
		}

		/* Open Checkout with further options:*/
		window.cloudpaymentshandler.charge(
			{
				publicId: publishableapi, 
				description: productname, 
				amount: productprice,
				currency: currency, 
			},
			function (options) { /* success*/
				//действие при успешной оплате
				t342_sendPaymentEventToStatistics(productname, productprice);
				if ($('#rec'+recid+' .js-success-url').val() > '') {
					window.location.href = $('#rec'+recid+' .js-success-url').val();
				} else {
					t342click.html('OK');
				}
				
			},
			function (reason, options) { // fail
				if ($('#rec'+recid+' .js-failure-url').val() > '') {
					window.location.href = $('#rec'+recid+' .js-failure-url').val();
				}
			}
		);
	});
}

function t342_initPayment(recid){
	if ($('#allrecords').find('.t362').length == 0) {

		if ($('.js-stripe-publishable-key').length > 0) {
			t342_initStripePayment(recid, $('.js-stripe-publishable-key').val(), $('.js-stripe-company-name').val(), $('.js-stripe-logo').val());
		} else {
			if ($('.js-cp-key').length > 0) {
				t342_initCloudPayments(recid, $('.js-cp-key').val());
			} else {
				$('[href^="#price"]').click(function(e){
					e.preventDefault();
		
					var tmp = $(this).attr('href');
					// format:  #price:Cost:Product name
					var arParam = tmp.split(':');
					var price = parseInt(arParam[1].replace(/[^0-9\.]/g,''));
					var name = arParam[2];
					if (! name) {
						var tmp=$(this).closest('.r').find('.title');
						if (tmp.length > 0) {
							name = tmp.text();
						}
						name = $(this).text();
					}
			
					var $form = $('#formpayment'+recid);
					$form.find('.js_payment_product').val(name);
					$form.find('.js_payment_price').val(price);
					
					var $yabox = $('.js-yapayment-paymentbox');
					if ( $yabox.length > 0) {
						var $parent = $(this).parent();
						$($parent).css('position','relative');
						$('.js-yapayment-paymentbox').appendTo($parent);
						$('.js-yapayment-paymentbox').show();
		
						$('.r').click(function(){ $('.js-yapayment-paymentbox').hide(); $('.r').off('click'); return false; });
		
						$('.js-yapayment-paymentbox a').click(function(){
							$form.find('input[name=paymentType]').val($(this).data('payment-currency'));
							var $ctrl=$form.find('[name=customerNumber]');
							if($ctrl.length > 0) {
								$ctrl.val(new Date().getTime());
							}
							t342_sendPaymentEventToStatistics(name,price);
							$form.submit();
							return false;
						});
					} else {
						t342_sendPaymentEventToStatistics(name,price);
						$form.submit();
					}
					return false;
				});
			}
		}
	}
} 
function t347_setHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	var table = rec ? rec.querySelector('.t347__table') : null;
	var tableWidth = table ? table.offsetWidth : 0;
	var tableHeight = tableWidth * 0.5625;
	if (table) table.style.height = tableHeight + 'px';
}

function t347showvideo(recid) {
	if (document.readyState !== 'loading') {
		t347_createVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t347_createVideo(recid);
		});
	}
}

function t347_createVideo(recid) {
	var rec = document.getElementById('rec' + recid);
	var videoContainer = rec.querySelector('.t347__video-container');
	var videoCarrier = rec.querySelector('.t347__video-carier');
	var youTubeURL = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
	var videoURL = youTubeURL ? 'https://www.youtube.com/embed/' + youTubeURL : '';
	
	if (videoContainer) videoContainer.classList.remove('t347__hidden');
	if (videoCarrier) {
		videoCarrier.insertAdjacentHTML('beforeend', '<iframe id="youtubeiframe' + recid +
			'" class="t347__iframe" width="100%" height="100%" src="' + videoURL +
			(videoURL.indexOf('?') !== -1 ? '&' : '?') +
			'autoplay=1&rel=0" frameborder="0" allowfullscreen allow="autoplay"></iframe>');
	}
} 
function t349_floating_init(el){
    /*console.log('floating_init');*/

    var wnd=$(window);
    var col=el.parent();

    el.css('max-width',el.width());
    el.css('width','100%');
    col.css('min-height',el.height());
	window.setTimeout(function() {col.css('min-height',el.height());}, 300);

    var timer;
    var timer_count=0;
    var timer_react=5;

    wnd.scroll(function() {
        if(timer) {
            window.clearTimeout(timer);
            if(timer_count>=timer_react){
                t349_floating_scroll(el,wnd,col);
                timer_count=0;
            }
            timer_count++;
        }

        timer = window.setTimeout(function() {
                t349_floating_scroll(el,wnd,col);
                timer_count=0;    
        }, 50);
    });        


    wnd.resize(function() {
         wnd.scroll();
    });

    wnd.scroll();
}

function t349_floating_scroll(el,wnd,col){
    var wnd_height = wnd.height();
    var wnd_width = wnd.width();

    if(wnd_width<=1024){
        el.removeClass('t349__fixedTop');
        el.removeClass('t349__fixedBottom');
        el.removeClass('t349__floating');
        return('');
    }

    el.css('max-width',col.width());

    if(col.height()<el.height() && col.height()>0){
        col.height(el.height());
    }

    var el_height = el.height();
    var col_top = col.offset().top;
    var col_width = col.width();
    var col_height = col.height();
    var col_bottom = col_top + col_height;

    var wnd_top = wnd.scrollTop();
    var wnd_bottom = wnd_top + wnd_height;  

    if(wnd_top+el_height+50 >= col_bottom){
        //console.log('fixedbottom');
        el.addClass('t349__fixedBottom');
        el.removeClass('t349__fixedTop');
        el.removeClass('t349__floating');
    }else if(wnd_top+50 > col_top){
        //console.log('floating');
        el.addClass('t349__floating');
        el.removeClass('t349__fixedBottom');
        el.removeClass('t349__fixedTop');
    }else{
        //console.log('fixedtop');
        el.addClass('t349__fixedTop');
        el.removeClass('t349__fixedBottom');  
        el.removeClass('t349__floating');
    }
} 
function t351_setSize(recid){
  var el=$("#rec"+recid);
  var height = el.find(".t351__sizer").height();
  var width = el.find(".t351__sizer").width();
  var ratio = width/height;
  var imgwrapper = el.find(".t351__imgwrapper");
  var imgwidth = imgwrapper.width();
  imgwrapper.css({'height':((imgwidth/ratio)+'px')});
} 
function t353_setSize(recid){
  var el=$("#rec"+recid);
  var height = el.find(".t353__sizer").height();
  var width = el.find(".t353__sizer").width();
  var ratio = width/height;
  var imgwrapper = el.find(".t353__imgwrapper");
  var imgwidth = imgwrapper.width();
  imgwrapper.css({'height':((imgwidth/ratio)+'px')});
}

function t353_setHeight(recid){
  var currentTallest = 0,
      currentRowStart = 0,
      rowDivs = new Array(),
      $el,
      topPosition = 0;

  $('#rec'+recid+' .t353__textwrapper').each(function() {

      $el = $(this);
      $($el).height('auto')
      topPostion = $el.position().top;
 
      if (currentRowStart != topPostion) {
          for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
              rowDivs[currentDiv].height(currentTallest);
          }
          rowDivs.length = 0;
          currentRowStart = topPostion;
          currentTallest = $el.height();
          rowDivs.push($el);
      } else {
          rowDivs.push($el);
          currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
      }
      for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
          rowDivs[currentDiv].height(currentTallest);
      }
  });
      
  $('#rec'+recid+' .t353__wrapper').each(function() {

      $el = $(this);
      $($el).height('auto')
      topPostion = $el.position().top;
 
      if (currentRowStart != topPostion) {
          for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
              rowDivs[currentDiv].height(currentTallest);
          }
          rowDivs.length = 0;
          currentRowStart = topPostion;
          currentTallest = $el.height();
          rowDivs.push($el);
      } else {
          rowDivs.push($el);
          currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
      }
      for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
          rowDivs[currentDiv].height(currentTallest);
      }
  });
} 
function t354_createCookie(name,value,days) {
  /*if (days == '' || parseInt(days) <= 0) {
    return;
  }*/    
  if (days) {
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
  }
  else var expires = "";
  document.cookie = name+"="+value+expires+"; path=/";
}

function t354_readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0;i < ca.length;i++) {
    var c = ca[i];
    while (c.charAt(0)==' ') c = c.substring(1,c.length);
    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
  }
  return null;
}

function t354_checkPosition(recid) {
    var winWidth = $(window).width();
    var screenMin = $('#rec' + recid).attr("data-screen-min");
    var screenMax = $('#rec' + recid).attr("data-screen-max");

    if(typeof screenMin !== 'undefined') {
        if(winWidth < parseInt(screenMin, 10)) {
            return false;
        }
    }

    if(typeof screenMax !== 'undefined') {
        if(winWidth > parseInt(screenMax, 10)) {
            return false;
        }
    }

  var el = $('#rec'+recid).find('.t354__opener');
  if (!t354_isPopupRecVisible(el)) {
    return;
  }  
  var name = el.attr('data-cookie-name');
  var time = el.attr('data-cookie-time');
  var multiplier = el.attr('data-trigger-position');
  var position = $(window).height() * multiplier;
  var value = "t354cookie";
  var cookie = t354_readCookie(name);
  if (cookie) {
    $("#rec"+recid+" .t354").html("");
  }else if (el.length){
    var scroll = $(window).scrollTop() + position;
    var objoffset = el.offset().top;
    if (scroll >= objoffset) {
      el.trigger('click');
      if (el.get(0)) {
          el.get(0).click();
      }
      $("#rec"+recid+" .t354").html("");
      t354_createCookie(name,value,time);
    }
  }
}

function t354_isPopupRecVisible(el) {
    var linkText = el.attr('href');
    var el_popup = $('.t-popup[data-tooltip-hook="'+linkText+'"]');
    var el_popupRec = el_popup.parents('.r');
    var minScreen = el_popupRec.attr('data-screen-min');
    if (minScreen && minScreen !== '') {
        minScreen = minScreen.replace('px', '');
        if (parseInt(minScreen, 10) > $(window).width()) {
            return false;
        }
    }
    return true;
} 
function t358_initPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	rec.setAttribute('data-animationappear', 'off');
	rec.style.opacity = '1';
	
	var currentBlock = rec.querySelector('.t-popup');
	var currentHook = currentBlock ? currentBlock.getAttribute('data-tooltip-hook') : '';
	var currentAnalitics = currentBlock ? currentBlock.getAttribute('data-track-popup') : '';
	if (!currentHook) return false;
	
	document.addEventListener('click', function (e) {
		if (e.target.closest('a[href="' + currentHook + '"]')) {
			e.preventDefault();
			t358_showPopup(recid);
			t358_resizePopup(recid);
			if (currentAnalitics) {
				var virtTitle = currentHook;
				if (virtTitle.substring(0, 7) === '#popup:') virtTitle = virtTitle.substring(7);
				Tilda.sendEventToStatistics(currentAnalitics, virtTitle);
			}
		}
	});
}

function t358_setHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var videoCarrier = rec.querySelector('.t358__video-carier');
	var carrierParent = videoCarrier ? videoCarrier.parentNode : null;
	var videoWidth = videoCarrier ? videoCarrier.offsetWidth : 0;
	var calculatedHeight = videoWidth * 0.5625;
	if (videoCarrier) videoCarrier.style.height = calculatedHeight + 'px';
	if (carrierParent) carrierParent.style.height = calculatedHeight + 'px';
}

function t358_showPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popup = rec.querySelector('.t-popup');
	var videoContainer = rec.querySelector('.t358__vimeo');
	var videoCarrier = rec.querySelector('.t358__video-carier');
	var videoID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-vimeo') : '';
	var videoHash = videoContainer ? videoContainer.getAttribute('data-content-popup-video-hash-vimeo') : '';
	var videoHashStr = videoHash ? 'h=' + videoHash + '&' : '';
	var videoURL = videoID ? 'https://player.vimeo.com/video/' + videoID : '';
	
	if (videoCarrier) {
		var iframe = document.createElement('iframe');
		iframe.id = 'vimeoiframe' + recid;
		iframe.classList.add('t358__iframe');
		iframe.width = '100%';
		iframe.height = '100%';
		iframe.src = videoURL + '?' + videoHashStr + 'title=0&byline=0&portrait=0&badge=0&color=ffffff&autoplay=1';
		iframe.frameBorder = '0';
		iframe.setAttribute('allowfullscreen', '');
		iframe.setAttribute('webkitallowfullscreen', '');
		iframe.setAttribute('mozallowfullscreen', '');
		videoCarrier.insertAdjacentElement('beforeend', iframe);
	}
	
	if (popup) popup.style.display = 'block';
	t358_setHeight(recid);
	
	setTimeout(function () {
		var popupContainer = popup ? popup.querySelector('.t-popup__container') : null;
		if (popupContainer) popupContainer.classList.add('t-popup__container-animated');
		if (popup) popup.classList.add('t-popup_show');
	}, 50);
	
	document.body.classList.add('t-body_popupshowed');
	document.body.classList.add('t358__body_popupshowed');
	
	if (popup) {
		popup.addEventListener('click', function (e) {
			if (e.target === popup) t358_popup_close(recid);
		});
	}
	
	var popupClose = popup ? popup.querySelector('.t-popup__close') : null;
	if (popupClose) {
		popupClose.addEventListener('click', function () {
			t358_popup_close(recid);
		});
	}
	
	document.addEventListener('keydown', function (e) {
		if (e.keyCode === 27) t358_popup_close(recid);
	});
}

function t358_popup_close(recid) {
	document.body.classList.remove('t-body_popupshowed');
	document.body.classList.remove('t358__body_popupshowed');
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popup = rec.querySelector('.t-popup');
	var videoCarrier = rec.querySelector('.t358__video-carier');
	if (popup) popup.classList.remove('t-popup_show');
	
	setTimeout(function () {
		if (videoCarrier) videoCarrier.innerHTML = '';
		if (popup && !popup.classList.contains('t-popup_show')) {
			popup.style.display = 'none';
		}
	}, 300);
}

function t358_resizePopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var popupContainer = rec.querySelector('.t-popup__container');
	var popupContainerHeight = popupContainer ? popupContainer.offsetHeight : 0;
	
	if (popupContainerHeight > window.innerHeight) {
		if (popupContainer) {
            popupContainer.classList.add('t-popup__container-static');
        }
	} else if (popupContainer) {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t358_sendPopupEventToStatistics(popupname) {
	var virtPage = '/tilda/popup/';
	var virtTitle = 'Popup: ';
	if (popupname.substring(0, 7) === '#popup:') {
		popupname = popupname.substring(7);
	}
	
	virtPage += popupname;
	virtTitle += popupname;
	
	if (ga) {
		if (window.mainTracker !== 'tilda') {
			ga('send', {
				'hitType': 'pageview',
				'page': virtPage,
				'title': virtTitle,
			});
		}
	}
	
	if (window.mainMetrika > '' && window[window.mainMetrika]) {
		window[window.mainMetrika].hit(virtPage, {
			title: virtTitle,
			referer: window.location.href,
		});
	}
} 
function t359_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t359_showPopup(recid);
      t359_resizePopup(recid);
      e.preventDefault();
      if (analitics == 'yes') {
        t359_sendPopupEventToStatistics(hook);
      }
      t359_positionArrows(recid);
    });
  }
}

function t359_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  t359_resizeGallery(recid);
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t359_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t359_closePopup();
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t359_closePopup(); }
  });
}

function t359_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t359_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 120,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}

function t359_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
    
  if(ga) {
    if (window.mainTracker != 'tilda') {
      ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
    }
  }
  
  if (window.mainMetrika > '' && window[window.mainMetrika]) {
    window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
  }
}

function t359_showCaptions(recid){
  var el=$("#t-carousel"+recid);
  var caption = el.find('.item:nth-child(1) .t-carousel__caption-inside');
  var captioncontainer = el.find('.t-carousel__caption__container');
  captioncontainer.html(caption.html());
  caption.css('display','none');

  $("#t-carousel"+recid).on('slide.bs.carousel', function(evt) {
    var el=$("#t-carousel"+recid);
    var caption = el.find('.item:nth-child(' + ($(evt.relatedTarget).index()+1) + ') .t-carousel__caption-inside');
    var captioncontainer = el.find('.t-carousel__caption__container');
    captioncontainer.html(caption.html());
    caption.css('display','none');
  });
}

function t359_positionArrows(recid){
  var el=$("#rec"+recid);
  var containerinside = el.find(".t-carousel__arrows__container_inside");
  var containeroutside = el.find(".t-carousel__arrows__container_outside");
  var inner = el.find(".t-carousel__inner");
  var arrowleft = el.find(".t-carousel__arrow_left");
  var arrowright = el.find(".t-carousel__arrow_right");
  containeroutside.css({'max-width':(arrowleft.width()+arrowright.width()+inner.width()+ 60 +'px')});
  containerinside.css({'max-width':(inner.width()+'px')});
}

function t359_resizeGallery(recid){
  var el=$("#rec"+recid);
  var element = el.find('.t-carousel__checksize');
  var sizer = el.find('.t-carousel__height');
  if (window.matchMedia('(max-width: 800px)').matches) {
    var ratio = 0.9;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 700px)').matches) {
    var ratio = 0.8;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 600px)').matches) {
    var ratio = 0.7;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 500px)').matches) {
    var ratio = 0.6;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 400px)').matches) {
    var ratio = 0.5;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(min-width: 800px)').matches) {
    element.height(sizer.height());
  }
} 
function t362_sendPopupEventToStatistics(link_recid, popupname)
{
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Payment popup: ';
    if (popupname.substring(0,7) == '#price:') {
        popupname = popupname.substring(7);
    }
    
    virtPage = virtPage + link_recid + '/';
    virtTitle += popupname;
    
    if (Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle,'',0);
    } else {
        if (window.ga && window.mainTracker != 'tilda') {
            ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
        }
        
        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }

}

function t362_sendPaymentEventToStatistics(product, price) {
    if (Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        var virtPage = '/tilda/payment/?product='+product+'&price='+price;
        var virtTitle = 'Order: '+product+' = '+price;
        Tilda.sendEventToStatistics(virtPage, virtTitle,'',price);
    } else {
        var virtPage = '/tilda/order/?product='+product+'&price='+price;
        var virtTitle = 'Order: '+product+' = '+price;

        if(window.ga && window.mainTracker != 'tilda') {
            ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
        }
        
        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t362_showPopup(recid,name,price){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  el.find('.js-product-title').html(name+' = ' + price);
  el.find('.js-successbox').hide();
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed t362__body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t362_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t362_closePopup();
  });
}

function t362_closePopup(){
  $('body').removeClass('t-body_popupshowed t362__body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t362_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 120,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}

window.t362_sendPaymentForm = function($form) {
  var recid = $form.attr('id').replace('form','');
  var $paymentForm = $('#formpayment'+recid);
  
  if($paymentForm.length == 0) {
    if ($form.data('success-url') > '') {
      window.location.href = $form.data('success-url');
    }
    return false;
  }

  var name = $paymentForm.find('.js_payment_product').val();
  var price = $paymentForm.find('.js_payment_price').val();

  if ($form.data('success-url') > '') {
    $paymentForm.find('.js_payment_successurl').val($form.data('success-url'));
  }
  if($paymentForm.find('.js_payment_successurl').val() == '') {
	$paymentForm.find('.js_payment_successurl').val(window.location.href);
  }

  if ($('#rec'+recid).find('.js-payment-type').length>0) {
    $paymentForm.find('input[name=paymentType]').val( $('#rec'+recid).find('.js-payment-type').val() );
  }

  var $ctrl=$paymentForm.find('[name=customerNumber]');

  var tildaformresult = $form.data('tildaformresult');
  if (tildaformresult && tildaformresult.tranid > '0') {
    if($ctrl.length > 0) {
      $ctrl.val(tildaformresult.tranid); /* dataid */
    }
    
    $ctrl=$paymentForm.find('.js_payment_ordernumber');
    if($ctrl.length > 0) {
      if (tildaformresult.orderid > '0') {
        $ctrl.val(tildaformresult.orderid);
      } else {
        $ctrl.val('');
      }
    }
  } else {
    if($ctrl.length > 0) {
      $ctrl.val('');
    }
  }

  t362_sendPaymentEventToStatistics(name,price);

  var actionUrl = $paymentForm.attr('action');
  if(actionUrl && actionUrl.indexOf('eshop.xml') > 0) {
    var allData = '';
    $form.find('input[type=text]').each(function(){
      var str = $(this).val();
      var cssclass=$(this).attr('class');
      if (!cssclass || cssclass.indexOf('js_pay')==-1) {
        allData = allData+''+str+'; ';
      }
      
      if (str > '' && str.indexOf('@')>0) {
        var $jqemail = $paymentForm.find('input[name=custEmail]');
        if (!$jqemail || $jqemail.length == 0) {
          $paymentForm.append("<input type=hidden name=custEmail value='"+str+"'>");
        } else {
          $jqemail.val(str);
        }
        
        $jqemail = $paymentForm.find('input[name=cps_email]');
        if (!$jqemail || $jqemail.length == 0) {
          $paymentForm.append("<input type=hidden name=cps_email value='"+str+"'>");
        } else {
          $jqemail.val(str);
        }

        if ($paymentForm.find('input[name=business]').length > 0) {
          var $jqemail = $paymentForm.find('input[name=email]');
          if (!$jqemail || $jqemail.length == 0) {
            $paymentForm.append("<input type=hidden name=email value='"+str+"'>");
          } else {
            $jqemail.val(str);
          }
        }
      }
    });
    
    var $jqord = $paymentForm.find('input[name=orderDetails]');
    if($jqord && $jqord.length > 0 && allData > '') {
      $jqord.val($jqord.val()+' ['+allData+']'); 
    }
  }

  $paymentForm.submit();
}

function t362_proccessError($form, recid) {
  var $recbox = $('#rec'+recid);

  $form.find('.js-errorbox-all').hide();
  $form.find('.js-rule-error').hide();
  $form.find('.js-error-rule-all').html('');
  $form.find('.js-successbox').hide();
  $form.find('.js-error-control-box').removeClass('js-error-control-box');

  $form.removeClass('js-send-form-error');
  $form.removeClass('js-send-form-success');

  var arError = validateForm($form);
  var $blockinput='';
  if (arError && arError.length > 0) {
    var clsInputBoxSelector = $form.data('inputbox');
    if ( !clsInputBoxSelector ) {
      clsInputBoxSelector = '.blockinput';
    }

    for(var i=0; i<arError.length; i++) {
      if (!arError[i] || !arError[i].obj) { continue; }
      
      arError[i].obj.closest(clsInputBoxSelector).addClass('js-error-control-box');
      
      for(j=0;j < arError[i].type.length;j++) {
        error = arError[i].type[j];
        var $errItem = $form.find('.js-rule-error-'+error);
        if ($errItem.length > 0){
          $errItem.css('display','block').show();
        }
      }
    }
    $form.find('.js-errorbox-all').css('display','block').show();
    return false;
  } else {
    return true;
  }
}

function t362_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');

  var el=$('#rec'+recid).find('.t362');
  $('[href^="#price"]').click(function(e){
    t362_closePopup();
    e.preventDefault();
    var tmp = $(this).attr('href');
    // format:  #price:Cost:Product name
    var arParam = tmp.split(':');
        var price = arParam[1].replace(',','.');
        price = parseInt(price.replace(/[^0-9\.]/g,''));
    var pricetext = arParam[1];
    var name = arParam[2];
    var link_recid='0';
    var $link_rec = $(this).closest('.r');
    var htmlpayment = '';
    
    if ($link_rec.length > 0) {
      link_recid = $link_rec.attr('id');
    
      if (! name) {
        var tmp=$link_rec.find('.t-title');
        if (tmp.length > 0) {
          name = tmp.text();
        }
        name = $(this).text();
      }
    }
    

    var $recbox = $('#rec'+recid);
    $recbox.find('.js_payment_product').val(name);
    $recbox.find('.js_payment_price').val(price);
    $recbox.find('#form'+recid).show();

    if(window.tilda_payment_type>'') {
      $recbox.find('.js-tilda-payment').remove();

      /* если Я.Касса подключенная по HTTP */
      if (window.tilda_payment_type == 'yakassa_http') {
		var strvalue = '';
		htmlpayment = '<input class="js-tilda-payment" type="hidden" name="tilda_p_projectid" value="'+$('#allrecords').attr('data-tilda-project-id')+'">';
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_p_amount" value="'+price+'">';
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_p_product_name_0" value="'+name+'">';
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_p_product_amount_0" value="'+price+'">';
		strvalue = window.location.href;
        strvalue = strvalue.substring(0,250);
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_srv_page" value="'+strvalue+'">';
		strvalue = (document.referrer ? document.referrer : '');
        strvalue = strvalue.substring(0,250);
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_srv_referrer" value="'+strvalue+'">';
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_srv_uagent" value="'+navigator.userAgent+'">';
		strvalue = (document.cookie ? document.cookie : '');
        strvalue = strvalue.substring(0,250);
        htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_srv_cookie" value="'+strvalue+'">';
        var $paymentForm = $('#formpayment'+recid);
        $paymentForm.append(htmlpayment);
        htmlpayment = '';

        /* заменяем обработчик формы на свой */
        $('#form'+recid).removeClass('js-form-proccess').data('success-callback','');
        $('#form'+recid).addClass('js-form-yakassa-proccess');

        
        function t362_YaKassaPayment(e) {
          if (! $(this).hasClass('js-form-yakassa-proccess')) {
            return;
          }
          var $recbox = $('#rec'+recid);
          var $paymentForm = $('#formpayment'+recid);
          //var htmlpayment = '';
          
          e.stopPropagation();
          e.preventDefault();

          if (t362_proccessError($(this))) {
            var i,arFormElements = $('#form'+recid).serializeArray();
            var iCntSrv=0;
            for(i in arFormElements) {
              var elemvalue = arFormElements[i].value, elemname = arFormElements[i].name;
              
              if (elemname == 'productprice' || elemname == 'productname' || elemname == 'form-spec-comments' || elemname == 'tildaspec-cookie') {
                continue;
              }

              if (elemvalue > '' && elemvalue.indexOf('@')>0) {
                var $jqemail;
                /*
                $jqemail = $paymentForm.find('input[name=custEmail]');
                if (!$jqemail || $jqemail.length == 0) {
                  $paymentForm.append("<input type=hidden name=custEmail value='"+elemvalue+"'>");
                } else {
                  $jqemail.val(elemvalue);
                }
                */
                
                $jqemail = $paymentForm.find('input[name=cps_email]');
                if (!$jqemail || $jqemail.length == 0) {
                  $paymentForm.append("<input type=hidden name=cps_email value='"+elemvalue+"'>");
                } else {
                  $jqemail.val(elemvalue);
                }

                $jqemail = $paymentForm.find('input[name=customerNumber]');
                if (!$jqemail || $jqemail.length == 0) {
                  $paymentForm.append("<input type=hidden name=customerNumber value='"+elemvalue+"'>");
                } else {
                  $jqemail.val(elemvalue);
                }

                elemname = elemname.replace('[','_');
                elemname = elemname.replace(']','_');
                /* htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildaform_'+elemname+'" value="'+elemvalue+'">'; */
                htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildaform__'+parseInt(i)+'_'+elemname+'" value="'+elemvalue+'">';

              } else {
                
                if(arFormElements[i].name == 'formservices[]') {
                  htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tilda_fs_'+iCntSrv+'" value="'+elemvalue+'">';
                  iCntSrv = parseInt(iCntSrv)+1;
                } else {
                  elemname = elemname.replace('[','_');
                  elemname = elemname.replace(']','_');
                  /*
htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildaform_'+elemname+'" value="'+elemvalue+'">';
*/
                  htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildaform__'+parseInt(i)+'_'+elemname+'" value="'+elemvalue+'">';
                }
              }
            }

            if ($paymentForm.find('input[name=customerNumber]').val() == '') {
              var t = new Date();
              t = t.getTime();
              $paymentForm.find('input[name=customerNumber]').val(t);
            }

            if ($paymentForm.find('input[name=orderNumber]').val() == '') {
              $paymentForm.find('input[name=orderNumber]').remove();
            }

            if ($(this).data('success-url') > '') {
              $paymentForm.find('.js_payment_successurl').val($(this).data('success-url'));
            } else {
				if ($paymentForm.find('.js_payment_successurl').val() == '') {
              		$paymentForm.find('.js_payment_successurl').val(window.location.href);
				}
            }
            
            if ($paymentForm.find('.js_payment_failurl').val() == '') {
              $paymentForm.find('.js_payment_failurl').val(window.location.href);
            }
          
            if ($recbox.find('.js-payment-type').length>0) {
              $paymentForm.find('input[name=paymentType]').val( $recbox.find('.js-payment-type').val() );
            }

            $paymentForm.append(htmlpayment);

            $paymentForm.submit();
          }
        }
        
        $('#rec'+recid+' .js-form-yakassa-proccess').off('submit');
        $('#rec'+recid+' .js-form-yakassa-proccess').on('submit', t362_YaKassaPayment);
      } else {
            if(window.tilda_payment_type == 'robokassa') {
                /* заменяем обработчик формы на свой */
                $('#form'+recid).removeClass('js-form-proccess').data('success-callback','');
                $('#form'+recid).addClass('js-form-robokassa-proccess');

                $('#rec'+recid+' .js-form-robokassa-proccess').off('submit');
                $('#rec'+recid+' .js-form-robokassa-proccess').on('submit', function(e){
                    e.preventDefault();
                    $('#rec'+recid).find('.js-btn-robokassa').trigger('click');
                    return false;
                });
                
                $('#rec'+recid).find('.js-btn-robokassa').off('click');
                $('#rec'+recid).find('.js-btn-robokassa').on('click', function(e){
                    e.preventDefault();
                    var $recbox = $('#rec'+recid);
                    
                    var btnformsubmit = $(this);
                    var $form = $(this).closest('form');
                
                    if (!$form || $form.length == 0) {
                        return false;
                    }

                    if (! $form.hasClass('js-form-robokassa-proccess')) {
                        return;
                    }

                    var btnstatus = btnformsubmit.data('form-sending-status');
                    if (btnstatus >= '1') {
                        /* 0 - могу отправлять, 1 - отправляю, как только отправлено снова в ставим в 0 */
                        return false;
                    }
                    
                    btnformsubmit.addClass('t-btn_sending');
                    btnformsubmit.data('form-sending-status','1');
                    btnformsubmit.data('submitform', $form);
                    
                    var $errBox = $form.find('.js-errorbox-all');
                    if ($errBox && $errBox.length > 0) {
                        $errBox.hide();
                    }

                    if (t362_proccessError($form)) {

                        var $elem = $form.find('input[name=tildaspec-cookie]');
                        if (!$elem || $elem.length == 0){
                            $form.append('<input type="hidden" name="tildaspec-cookie" value="">');
                            $elem = $form.find('input[name=tildaspec-cookie]');
                        }
                        if ($elem.length > 0) {
                            $elem.val(document.cookie);
                        }
                        
                        $elem = $form.find('input[name=tildaspec-referer]');
                        if (!$elem || $elem.length == 0){
                            $form.append('<input type="hidden" name="tildaspec-referer" value="">');
                            $elem = $form.find('input[name=tildaspec-referer]');
                        }
                        if ($elem.length > 0) {
                            $elem.val(window.location.href);
                        }
                    
                        $elem = $form.find('input[name=tildaspec-projectid]');
                        if (!$elem || $elem.length == 0){
                            $form.append('<input type="hidden" name="tildaspec-projectid" value="'+parseInt($('#allrecords').data('tilda-project-id'))+'">');
                        }
                        $elem = $form.find('input[name=tildaspec-hash]');
                        if (!$elem || $elem.length == 0){
                            console.log('Empty hash for payment form');
                            return false;
                        }
                        
                        var amount = $form.find('.js_payment_price').val();
                        Tilda.robokassaPayment($form, btnformsubmit,'',amount);
                    } else {
                        btnformsubmit.removeClass('t-btn_sending');
                        btnformsubmit.data('form-sending-status','0');
                        btnformsubmit.data('submitform', $form);
                    }
                    return false;
                });
            
            } else {
                var htmlpayment = '<input class="js-tilda-payment" type="hidden" name="tildapayment[projectid]" value="'+$('#allrecords').attr('data-tilda-project-id')+'">';
                htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildapayment[amount]" value="'+price+'">';
                htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildapayment[products][0][product]" value="'+name+'">';
                htmlpayment = htmlpayment + '<input class="js-tilda-payment" type="hidden" name="tildapayment[products][0][amount]" value="'+price+'">';
          
                $('#form'+recid).append(htmlpayment);
            }
      }
    }
    
    t362_showPopup(recid,name,pricetext);
    t362_sendPopupEventToStatistics(link_recid,name);
    t362_resizePopup(recid);

    if ($recbox.find('.js-stripe-publishable-key').length > 0) {
      var companyname = $recbox.find('.js-stripe-company-name').val()
      if(! window.stripehandler) {
        window.stripehandler = StripeCheckout.configure({
          key: $recbox.find('.js-stripe-publishable-key').val(),
          image: $recbox.find('.js-stripe-logo').val(),
          name: (companyname ? companyname : window.location.host),
          locale: 'auto'
        });
        /* Close Checkout on page navigation:*/
        $(window).on('popstate', function() {
          window.stripehandler.close();
        });
      }
      
      
      /* заменяем обработчик формы на свой */
      $('#form'+recid).removeClass('js-form-proccess').data('success-callback','');
      //$('#rec'+recid).off('submit','.js-form-proccess');
      if($('#formpayment'+recid).attr('action') > '') {
        $('#form'+recid).data('success-url', $('#formpayment'+recid).attr('action'));
      }
      $('#form'+recid).addClass('js-form-stripe-proccess');

      function t362_stripePayment(e){
        if (! $(this).hasClass('js-form-stripe-proccess')) {
          return;
        }
        var $recbox = $('#rec'+recid);
        e.stopPropagation();
        e.preventDefault();
        
        if (t362_proccessError($(this),recid)) {
          
          window.stripehandler.open({
            name: $recbox.find('.js-stripe-company-name').val(),
            image: $recbox.find('.js-stripe-logo').val(),
            description: $recbox.find('.js_payment_product').val(),
            amount:  $recbox.find('.js_payment_price').val()*100,
            currency: $recbox.find('.js-stripe-currency').val(),
            shippingAddress: $recbox.find('.js-stripe-need-shipping').val() == '1' ? true : false,
            token: function(token, args) {
              if (token && token.id) {
                t362_sendPaymentEventToStatistics(name,price*100);
                $('#form'+recid).removeClass('js-form-stripe-proccess');
                $('#form'+recid).off('submit', t362_stripePayment);

                var htmlpayment = '<input class="js-tilda-payment js-stripe-tokenoptions" type="hidden" name="tildapayment[stripetoken]" value="'+token.id+'">';
                if (token.email) {
                  htmlpayment = htmlpayment + '<input class="js-tilda-payment js-stripe-tokenoptions" type="hidden" name="tildapayment[email]" value="'+token.email+'">';
                }
                htmlpayment = htmlpayment + '<input class="js-tilda-payment js-stripe-tokenoptions" type="hidden" name="tildapayment[currency]" value="'+$recbox.find('.js-stripe-currency').val()+'">';
                
                $('#form'+recid).find('.js-stripe-tokenoptions').remove();
                $('#form'+recid).append(htmlpayment);

                $('#form'+recid).addClass('js-form-proccess').submit();
              }
            }
            
          });
          
        }
        return false;
      }

      $('#rec'+recid+' .js-form-stripe-proccess').on('submit', t362_stripePayment);

    }

    if ($recbox.find('.js-cp-key').length > 0) {

      /* заменяем обработчик формы на свой */
      $('#form'+recid).removeClass('js-form-proccess').data('success-callback','');
      //$('#rec'+recid).off('submit','.js-form-proccess');
      if($('#formpayment'+recid).attr('action') > '') {
        $('#form'+recid).data('success-url', $('#formpayment'+recid).attr('action'));
      }
      $('#form'+recid).addClass('js-form-cp-proccess');

      function t362_cloudPayments(e){
        if (! $(this).hasClass('js-form-cp-proccess')) {
          return;
        }

        var $recbox = $('#rec'+recid);
        e.stopPropagation();
        e.preventDefault();
        
        var currency = $('#rec'+recid+' .js-currency').val();
        if(! window.cloudpaymentshandler) {
          var lang='';
          if ( $('#rec'+recid+' .js-language').length > 0) {
            lang = $('#rec'+recid+' .js-language').val();
          }
          if (lang == '') {
            lang = (currency == 'RUB' || currency == 'BYR' ? 'ru-RU' : 'en-US');
          }
          window.cloudpaymentshandler = new cp.CloudPayments({language: lang});
        }
        
        if (t362_proccessError($(this),recid)) {
          $recbox.find('.t-popup').css('z-index','8000');
          var $paymentForm = $('#formpayment'+recid), $form = $('#form'+recid), email, allData={};
          $form.find('input,textarea').each(function(){
            var str = $(this).val();
            var ctrlname = $(this).attr('name');
            if ( ctrlname.substring(0,8)!= 'formserv' && ctrlname != 'form-spec-comments' && str > '') {
              allData[ctrlname] = str;
            }
            if (str > '' && str.indexOf('@')>0) {
              var $jqemail = $paymentForm.find('input[name=accountId]');
              if (!$jqemail || $jqemail.length == 0) {
                $paymentForm.append("<input type=hidden name=accountId value='"+str+"'>");
              } else {
                $jqemail.val(str);
              }
            }
          });
          email = $paymentForm.find('input[name=accountId]').val();

          if ($paymentForm.data('recurrent') == 1) {
            allData.cloudPayments = {recurrent: { interval: 'Month', period: 1 }};
            if ($paymentForm.data('recurrent-interval') > '') {
                allData.cloudPayments.recurrent.interval = $paymentForm.data('recurrent-interval');
            }
            if ($paymentForm.data('recurrent-period') > '') {
                allData.cloudPayments.recurrent.period = parseInt($paymentForm.data('recurrent-period'));
            }
          }
          
         /* $('#rec'+recid).find('.t-popup').css('z-index','8000');*/

          window.cloudpaymentshandler.charge(
            {
              publicId: $recbox.find('.js-cp-key').val(), 
              description: $recbox.find('.js_payment_product').val(), 
              amount: parseFloat($recbox.find('.js_payment_price').val()),
              currency: $recbox.find('.js-currency').val(), 
              accountId: (email ? email : ''),
              data: allData
            },
            function (options) { /* success*/
              //действие при успешной оплате
              t362_sendPaymentEventToStatistics(name, price);
              $('#form'+recid).removeClass('js-form-cp-proccess');
              $('#form'+recid).off('submit', t362_cloudPayments);
              
              $('#form'+recid).addClass('js-form-proccess').submit();
              $recbox.find('.t-popup').css('z-index','');
            },
            function (reason, options) { // fail
              if ($('#rec'+recid+' .js-failure-url').val() > '') {
                window.location.href = $('#rec'+recid+' .js-failure-url').val();
              }
              $recbox.find('.t-popup').css('z-index','');
            }
          );

        }
        return false;
      }

      $('#rec'+recid+' .js-form-cp-proccess').on('submit', t362_cloudPayments);

    }

    return false;
  });

  if ($('#rec'+recid).find('[name=tildaspec-cookie]').length > 0 ) {
    $('#rec'+recid).find('[name=tildaspec-cookie]').val(document.cookie);
  }

  if ($('#rec'+recid).find('.js-stripe-publishable-key').length > 0 && window.stripeapiiscalled!==true){
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://checkout.stripe.com/checkout.js";
      document.body.appendChild(script);
      window.stripeapiiscalled=true;
  }

  if ($('#rec'+recid).find('.js-cp-key').length > 0 && window.cloudpaymentsapiiscalled!==true){
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://widget.cloudpayments.ru/bundles/cloudpayments";
      document.body.appendChild(script);
      window.cloudpaymentsapiiscalled=true;
  }

} 
function t364_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t364_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t364_closePopup();
  });

  el.find('.t364__text').click(function(){
    t364_closePopup();
    t364_createCookie('t364closefb','yes',30);
  });

  el.find('a[href*="#"]').click(function(e){
    var url = $(this).attr('href');
    if (!url || url.substring(0,7) != '#price:') {
      t364_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t364_closePopup(); }
  });
}

function t364_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t364_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 30,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}
/*deprecated*/
function t364_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
    
  if(ga) {
    if (window.mainTracker != 'tilda') {
      ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
    }
  }
  
  if (window.mainMetrika > '' && window[window.mainMetrika]) {
    window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
  }
}

function t364_createCookie(name,value,days) {
  if (days) {
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
  }
  else { var expires = ""; }
  document.cookie = name+"="+value+expires+"; path=/";
}

function t364_readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0)==' '){ c = c.substring(1,c.length);}
    if (c.indexOf(nameEQ) == 0){ return c.substring(nameEQ.length,c.length);}
  }
  return null;
}

function t364_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  var cookieexist=el.attr('data-cookies-exist');
  if(cookieexist!=='yes'){
    var cookie = t364_readCookie('');
  } else { var cookie = t364_readCookie('t364closefb'); }
  if(hook!=='' && cookie!=='yes'){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t364_showPopup(recid);
      t364_resizePopup(recid);
      e.preventDefault();
      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
            virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }

    });
  }
} 
function t365_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    $('#vk_groups_'+recid).css('height', '250px');
    $('#vk_groups_'+recid+' iframe').css('height', '250px');
  }, 50);

  $('body').addClass('t-body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t365_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t365_closePopup();
  });

  el.find('.t365__text').click(function(){
    t365_closePopup();
    t365_createCookie('t365closefb','yes',30);
  });

  el.find('a[href*="#"]').click(function(e){
    var url = $(this).attr('href');
    if (!url || url.substring(0,7) != '#price:') {
      t365_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t365_closePopup(); }
  });
}

function t365_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t365_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 30,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}
/* deprecated */
function t365_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
    
  if(ga) {
    if (window.mainTracker != 'tilda') {
      ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
    }
  }
  
  if (window.mainMetrika > '' && window[window.mainMetrika]) {
    window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
  }
}

function t365_createCookie(name,value,days) {
  if (days) {
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
  }
  else { var expires = ""; }
  document.cookie = name+"="+value+expires+"; path=/";
}

function t365_readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0;i < ca.length;i++) {
    var c = ca[i];
    while (c.charAt(0)==' '){ c = c.substring(1,c.length); }
    if (c.indexOf(nameEQ) == 0){ return c.substring(nameEQ.length,c.length); }
  }
  return null;
}

function t365_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  var cookieexist=el.attr('data-cookies-exist');
  if(cookieexist!=='yes'){
    var cookie = t365_readCookie('');
  } else { var cookie = t365_readCookie('t365closefb'); }
  if(hook!=='' && cookie!=='yes'){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t365_showPopup(recid);
      t365_resizePopup(recid);
      e.preventDefault();
      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
            virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }

    });
  }
} 
function t366_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  t366_resizeGallery(recid);
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t366_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t366_closePopup();
  });

  el.find('a[href*=#]:not(.carousel-control,.t-carousel__control)').click(function(e){
    var url = $(this).attr('href');
    if (!url || url.substring(0,7) != '#price:') {
      t366_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t366_closePopup(); }
  });
}

function t366_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t366_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 120,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}

function t366_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {
    if(ga) {
      if (window.mainTracker != 'tilda') {
        ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
      }
    }
  
    if (window.mainMetrika > '' && window[window.mainMetrika]) {
      window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
    }
  }
}

function t366_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t366_showPopup(recid);
      t366_resizePopup(recid);
      e.preventDefault();
      if(window.lazy=='y'){t_lazyload_update();}
      if (analitics == 'yes') {
        t366_sendPopupEventToStatistics(hook);
      }
    });
  }
}

function t366_resizeGallery(recid){
  var el=$("#rec"+recid);
  var element = el.find('.t-carousel__checksize');
  var sizer = el.find('.t-carousel__height');
  if (window.matchMedia('(max-width: 800px)').matches) {
    var ratio = 0.9;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 700px)').matches) {
    var ratio = 0.8;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 600px)').matches) {
    var ratio = 0.7;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 500px)').matches) {
    var ratio = 0.6;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 400px)').matches) {
    var ratio = 0.5;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(min-width: 800px)').matches) {
    element.height(sizer.height());
  }
} 
function t367_createCookie(name,value,days) {
  /*if (days == '' || parseInt(days) <= 0) {
    return;
  }*/    
  if (days) {
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
  }
  else var expires = "";
  document.cookie = name+"="+value+expires+"; path=/";
}

function t367_readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0;i < ca.length;i++) {
    var c = ca[i];
    while (c.charAt(0)==' ') c = c.substring(1,c.length);
    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
  }
  return null;
}

function t367_autoInit(recid) {
    var winWidth = $(window).width();
    var screenMin = $('#rec' + recid).attr("data-screen-min");
    var screenMax = $('#rec' + recid).attr("data-screen-max");

    if(typeof screenMin !== 'undefined') {
        if(winWidth < parseInt(screenMin, 10)) {
            return false;
        }
    }

    if(typeof screenMax !== 'undefined') {
        if(winWidth > parseInt(screenMax, 10)) {
            return false;
        }
    }

  var el = $('#rec' + recid).find('.t367__opener');
  var name = el.attr('data-cookie-name');
  var time = el.attr('data-cookie-time');
  var value = "t367cookie";
  var cookie = t367_readCookie(name);
  var delay = el.attr('data-trigger-time');
  var delaytime = delay * 1000;
  if (cookie) {
    $("#rec"+recid+" .t367").html("");
  } else if (el.length) {
    setTimeout(function() {
      el.trigger('click');
      if (el.get(0) && el.get(0).getAttribute('href')) {
        el.get(0).click();
      }
      $("#rec"+recid+" .t367").html("");
      t367_createCookie(name,value,time);
    }, delaytime);
  }
} 
function t368_alignVertical(recid) {
	var rec = document.getElementById('rec' + recid);
	var videoBlock = rec.querySelector('.t368__video');
	var textBlock = rec.querySelector('.t368__text');
	t368_calcPaddingBottom(videoBlock, textBlock);
	window.addEventListener('resize', function () {
		t368_calcPaddingBottom(videoBlock, textBlock);
	});
}

function t368_calcPaddingBottom(videoBlock, textBlock) {
	var extraIndent = 12;
	var textBlockHeight = textBlock ? textBlock.offsetHeight : 0;
	if (window.innerWidth > 640) {
		if (videoBlock) {
            videoBlock.style.paddingBottom = (textBlockHeight + extraIndent) + 'px';
        }
	} else if (videoBlock) {
        videoBlock.style.paddingBottom = '';
    }
} 
function t369_init(recid){
  t_sldsInit(recid);

  setTimeout(function(){
    t_prod__init(recid);
  }, 500);

  $('#rec'+recid).find('.t744').bind('displayChanged',function(){
      t744_updateSlider(recid);
  });
}

function t369_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup');

  popup.css('display', 'block');
  t369_resizeGallery(recid);
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed');

  el.find('.t-popup').click(function(e){
    if (e.target == this) { t369_closePopup(); }
  });

  el.find('.t-popup__close').click(function(e){
    t369_closePopup();
  });

  el.find('a[href*=#]:not(.carousel-control,.t-carousel__control)').click(function(e){
    var url = $(this).attr('href');
    if (!url || url.substring(0,7) != '#price:') {
      t369_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t369_closePopup(); }
  });
}

function t369_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}

function t369_resizePopup(recid){
  var el = $("#rec"+recid),
      div = el.find(".t-popup__container").height(),
      win = $(window).height() - 120,
      popup = el.find(".t-popup__container");
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}

function t369_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {
    if(ga) {
      if (window.mainTracker != 'tilda') {
        ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
      }
    }
  
    if (window.mainMetrika > '' && window[window.mainMetrika]) {
      window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
    }
  }
}

function t369_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    var obj = $('a[href="'+hook+'"]');
    obj.click(function(e){
      t369_showPopup(recid);
      t369_resizePopup(recid);
      e.preventDefault();
      if(window.lazy=='y'){t_lazyload_update();}
      if (analitics == 'yes') {
        t369_sendPopupEventToStatistics(hook);
      }
    });
  }
}

function t369_resizeGallery(recid){
  var el=$("#rec"+recid);
  var element = el.find('.t-carousel__checksize');
  var sizer = el.find('.t-carousel__height');
  if (window.matchMedia('(max-width: 800px)').matches) {
    var ratio = 0.9;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 700px)').matches) {
    var ratio = 0.8;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 600px)').matches) {
    var ratio = 0.7;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 500px)').matches) {
    var ratio = 0.6;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(max-width: 400px)').matches) {
    var ratio = 0.5;
    element.height(sizer.height() * ratio);
  }
  if (window.matchMedia('(min-width: 800px)').matches) {
    element.height(sizer.height());
  }
} 
function t376_setbg() {
    var recs = document.querySelectorAll('.r');
    var background = 'no';

    for (var i = 0; i < recs.length; i++) {
        var rec = recs[i];
        var container = rec.querySelector('.t376');

        if (container) {
            background = container.getAttribute('data-section-bg-color');
        }

        if (!rec.getAttribute('data-bg-color')) {
            var bgManualSetted = rec.getAttribute('data-t376-bg-manual-setted');

            if (background !== 'no') {
                if(!bgManualSetted || (bgManualSetted && bgManualSetted !== background)) {
                    rec.style.backgroundColor = background;
                    rec.setAttribute('data-t376-bg-manual-setted', background);
                }
            }

            if (background === 'no' && bgManualSetted) {
                rec.style.backgroundColor = '';
                rec.removeAttribute('data-t376-bg-manual-setted');
            }
        }
    }
} 
function t381_appearMenu(recid) {
    var window_width=$(window).width();
    if(window_width>980){
         $(".t381").each(function() {
                var el=$(this);
                var appearoffset=el.attr("data-appearoffset");
                var hideoffset=el.attr("data-hideoffset");
                if(appearoffset!=""){
                        if(appearoffset.indexOf('vh') > -1){
                            appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                        }

                        appearoffset=parseInt(appearoffset, 10);

                        if ($(window).scrollTop() >= appearoffset) {
                          if(el.css('visibility') == 'hidden'){
                              el.finish();
                              el.css("visibility","visible");
                              el.animate({"opacity": "1"}, 300,function() {
                              });       
                          }
                        }else{
                          el.stop();
                          el.css("visibility","hidden");
                        }
                }

                if(hideoffset!=""){
                        if(hideoffset.indexOf('vh') > -1){
                            hideoffset = Math.floor((window.innerHeight * (parseInt(hideoffset) / 100)));
                        }

                        hideoffset=parseInt(hideoffset, 10);

                        if ($(window).scrollTop()+$(window).height() >= $(document).height() - hideoffset) {
                          if(el.css('visibility') != 'hidden'){
                              el.finish();
                              el.css("visibility","hidden");
                          }
                        }else{
                          if (appearoffset!="") {
                              if($(window).scrollTop() >= appearoffset){
                                el.stop();
                                el.css("visibility","visible");
                              }
                          }else{
                              el.stop();
                              el.css("visibility","visible");
                          }
                        }
                }
         });
    }
}

 
function t383_highlight(link){
  if(link && link!=''){
	  $("a[href='"+link+"']").addClass("t-active");
  }
}


 
function t384_checkSize(recid){
  var el=$("#rec"+recid);
  var sizer = el.find('.t-carousel__height');
  var height = sizer.height();
  var width = sizer.width();
  var ratio = width/height;
  var gallerywrapper = el.find(".t-carousel__checksize");
  var gallerywidth = gallerywrapper.width();

  if (height != $(window).height()) {
    gallerywrapper.css({'height':((gallerywidth/ratio)+'px')});
  }
} 
    var t385 = {};
    
    t385.equalheight = function(recid) {

        var currentTallest = 0,
            currentRowStart = 0,
            rowDivs = new Array(),
            $el,
            topPosition = 0;
            
        $('#rec'+recid+' .t385__textwrapper').each(function() {
     
            $el = $(this);
            $($el).height('auto')
            topPostion = $el.position().top;
       
            if (currentRowStart != topPostion) {
                for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                    rowDivs[currentDiv].height(currentTallest);
                }
                rowDivs.length = 0;
                currentRowStart = topPostion;
                currentTallest = $el.height();
                rowDivs.push($el);
            } else {
                rowDivs.push($el);
                currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
            }
            for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                rowDivs[currentDiv].height(currentTallest);
            }
        });
    };
 
var t386 = {};

t386.equalheight = function(recId) {
    var rec = document.getElementById('rec' + recId);
    var textWrappers = rec.querySelectorAll('.t386__textwrapper');
    var maxHeight = 0;
    
    for (var i = 0; i < textWrappers.length; i++) {
        textWrappers[i].style.height = '';
    }

    for (var i = 0; i < textWrappers.length; i++) {
        var element = textWrappers[i];
        var elementStyle = getComputedStyle(element, null);
        var elementPaddingTop = parseInt(elementStyle.paddingTop) || 0;
        var elementPaddingBottom = parseInt(elementStyle.paddingBottom) || 0;
        var elementHeight = element.clientHeight - (elementPaddingTop + elementPaddingBottom);
    
        if (elementHeight > maxHeight) maxHeight = elementHeight;
    }
    
    if (window.innerWidth >= 960) {
        for (var i = 0; i < textWrappers.length; i++) {
            textWrappers[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < textWrappers.length; i++) {
            textWrappers[i].style.height = 'auto';
        }
    }
}; 
function t389_scrollToTop() {
	var duration = 700;
	var difference = window.pageYOffset;
	var step = 10 * difference / duration;
	var timer = setInterval(function () {
		difference -= step;
		window.scrollTo(0, difference);
		document.body.setAttribute('data-scrollable', 'true');
		if (window.pageYOffset === 0) {
			document.body.removeAttribute('data-scrollable');
			clearInterval(timer);
		}
	}, 10);
} 
function t390_initPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t390');
    if (!container) return;

    rec.setAttribute('data-animationappear', 'off');
    rec.style.opacity = 1;

    var popup = rec.querySelector('.t-popup');
    var popupTooltipHook = popup.getAttribute('data-tooltip-hook');
    var analitics = popup.getAttribute('data-track-popup');
    var popupCloseBtn = popup.querySelector('.t-popup__close');
    var hrefs = rec.querySelectorAll('a[href*="#"]');

    if (popupTooltipHook) {
        var recBlocks = document.querySelectorAll('.r');

        for (var i = 0; i < recBlocks.length; i++) {
            recBlocks[i].addEventListener('click', function(event) {
                var target = event.target;
                var href = target.closest('a[href="' + popupTooltipHook + '"]') ? target : false;

                if (!href) return;

                event.preventDefault();
                t390_showPopup(recId);
                t390_resizePopup(recId);
                t390__lazyLoad();

                if (analitics) {
                    Tilda.sendEventToStatistics(analitics, popupTooltipHook);
                }
            });
        }
    }

    popup.addEventListener('scroll', t_throttle(function () {
        t390__lazyLoad();
    }));

    popup.addEventListener('click', function(event) {
        if (event.target === this) t390_closePopup();
    });

    popupCloseBtn.addEventListener('click', t390_closePopup);

    for (var i = 0; i < hrefs.length; i++) {
        hrefs[i].addEventListener('click', function() {
            var url = this.getAttribute('href');

            if (!url || url.substring(0, 7) != '#price:') {
                t390_closePopup();

                if (!url || url.substring(0, 7) == '#popup:') {
                    setTimeout(function() {
                        document.body.classList.add('t-body_popupshowed');
                    }, 300);
                }
            }
        });
    }

    var curPath = window.location.pathname;
    var curFullPath = window.location.origin + curPath;

    /* Fix for Android unable to scroll to anchor point from "ScrollView" */
    var isAndroid = /(android)/i.test(navigator.userAgent);

    if (isAndroid) {
        var selects = 'a[href^="#"]:not([href="#"], [href^="#price"], [href^="#popup"], [href^="#prodpopup"], [href^="#order"], a[href^="#!"]), a[href^="' + curPath + '#"]:not(a[href*="#!/tproduct/"], a[href*="#!/tab/"], [href*="#popup"]), a[href^="' + curFullPath + '#"]:not(a[href*="#!/tproduct/"], a[href*="#!/tab/"], [href*="#popup"])';
        var selectors = rec.querySelectorAll(selects);

        for (var i = 0; i < selectors.length; i++) {
            selectors[i].addEventListener('click', function(event) {
                event.preventDefault();

                var hash = this.hash.trim();

                if (window.location.hash) {
                    setTimeout(function() {
                        window.location.href = hash;
                    }, 50);
                }
            });
        }
    }
}

function t390_showPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t390');
    if (!container) return;

    var popup = rec.querySelector('.t-popup');
    var popupContainer = popup.querySelector('.t-popup__container');
    var documentBody = document.body;

    popup.style.display = 'block';

    setTimeout(function() {
        popupContainer.classList.add('t-popup__container-animated');
        popup.classList.add('t-popup_show');
    }, 50);

    documentBody.classList.add('t-body_popupshowed');
    documentBody.classList.add('t390__body_popupshowed');
    document.addEventListener('keydown', t390_escClosePopup);
}

function t390_escClosePopup(event) {
    if (event.key === 'Escape') t390_closePopup();
}

function t390_closePopup() {
    var popupAll = document.querySelectorAll('.t-popup');

    document.body.classList.remove('t-body_popupshowed');

    for (var i = 0; i < popupAll.length; i++) {
        popupAll[i].classList.remove('t-popup_show');
    }

    setTimeout(function() {
        var popupHide = document.querySelectorAll('.t-popup:not(.t-popup_show)');

        for (var i = 0; i < popupHide.length; i++) {
            popupHide[i].style.display = 'none';
        }
    }, 300);

    document.removeEventListener('keydown', t390_escClosePopup);
}

function t390_resizePopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var popupContainer = rec.querySelector('.t-popup__container');
    if (!popupContainer) return;
    var popupStyle = getComputedStyle(popupContainer, null);
    var popupPaddingTop = parseInt(popupStyle.paddingTop) || 0;
    var popupPaddingBottom = parseInt(popupStyle.paddingBottom) || 0;
    var popupHeight = popupContainer.clientHeight - (popupPaddingTop + popupPaddingBottom);

    if (popupHeight > (window.innerHeight - 120)) {
        popupContainer.classList.add('t-popup__container-static');
    } else {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t390_sendPopupEventToStatistics(popupName) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';

    if (popupName.substring(0,7) == '#popup:') {
        popupName = popupName.substring(7);
    }

    virtPage += popupName;
    virtTitle += popupName;

    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {'hitType': 'pageview', 'page': virtPage, 'title': virtTitle});
            }
        }

        if (window.mainMetrika && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t390__lazyLoad() {
    if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
} 
function t391_checkSize(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var cover = rec.querySelector('.t-cover');
	var carrier = rec.querySelector('.t-cover__carrier');
	var filter = rec.querySelector('.t-cover__filter');
	var firstCol = rec.querySelector('.t391__firstcol');
	var secondCol = rec.querySelector('.t391__secondcol');
	var firstColHeight = firstCol ? firstCol.offsetHeight : 0;
	var secondColHeight = secondCol ? secondCol.offsetHeight : 0;
	var height = firstColHeight + secondColHeight;
	if (typeof window.matchMedia === 'function' && window.matchMedia('(max-width: 960px)').matches && height > 0) {
		if (cover) cover.style.height = height + 'px';
		if (carrier) carrier.style.height = height + 'px';
		if (filter) filter.style.height = height + 'px';
	}
} 
function t393_appearMenu(recId) {
    if (window.innerWidth > 980) {
        var recs = document.querySelectorAll('.t393');
        var scrollTop = window.pageYOffset;
        var body = document.body;
        var html = document.documentElement;
        var documentHeight = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);

        for (var i = 0; i < recs.length; i++) {
            var rec = recs[i];
            var appearOffset = rec.getAttribute('data-appearoffset');
            var hideOffset = rec.getAttribute('data-hideoffset');

            if (appearOffset) {
                if (appearOffset.indexOf('vh') > -1) {
                    appearOffset = Math.floor((window.innerHeight * (parseInt(appearOffset) / 100)));
                }

                appearOffset = parseInt(appearOffset, 10);

                if (scrollTop >= appearOffset) {
                    if (rec.style.visibility === 'hidden') {
                        rec.style.visibility = 'visible';
                        t393__fadeIn(rec);
                    }
                } else {
                    rec.style.visibility = 'hidden';
                }
            }

            if (hideOffset) {
                if (hideOffset.indexOf('vh') > -1) {
                    hideOffset = Math.floor((window.innerHeight * (parseInt(hideOffset) / 100)));
                }

                hideOffset = parseInt(hideOffset, 10);

                if (scrollTop + window.innerHeight >= documentHeight - hideOffset) {
                    if (rec.style.visibility !== 'hidden') {
                        rec.style.visibility = 'hidden';
                    }
                } else if (appearOffset) {
                    if (scrollTop >= appearOffset) {
                        rec.style.visibility = 'visible';
                    }
                } else {
                    rec.style.visibility = 'visible';
                }
            }
        }
    }
}

function t393__fadeIn(el) {
    if (el.style.display === 'block') return;

    var opacity = 0;
    
    el.style.opacity = opacity;
    el.style.display = 'block';

    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity += 0.1;

        if (opacity >= 1.0) {
            clearInterval(timer);
            el.style.display = '';
        }
    }, 30);
} 
function t395_init(recid) {
    var el = $('#rec' + recid);
    var curMode = $('.t-records').attr('data-tilda-mode');
    var tabs = el.find('.t395__tab');

    if (curMode != 'edit' && curMode != 'preview') {
        t395_scrollToTabs(recid);
    }

    if (tabs.length > 0) {
        tabs.on('click', function (event) {
            if ($(this).hasClass('t395__tab_active') && event.isTrigger !== 3) {
                return;
            }

            el.find('.t395__tab').removeClass('t395__tab_active');
            $(this).addClass('t395__tab_active');

            t395_removeUrl();
            var tabNumber = el.find(".t395__tab_active").index() + 1;
            if (curMode != 'edit' && curMode != 'preview' && tabNumber !== 0) {
                if (typeof history.replaceState != 'undefined') {
                    window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumber);
                }
            }

            t395_alltabs_updateContent(recid);
            t395_updateSelect(recid);

            var recids = $(this).attr('data-tab-rec-ids').split(',');
            recids.forEach(function (recid) {
                var el = $('#rec' + recid);
                el.find('.t-feed, .t-store, .t-store__product-snippet, .t117, .t121, .t132, .t223, .t226, .t228, .t229, .t230, .t268, .t279, .t341, .t346, .t347, .t349, .t351, .t353, .t384, .t385, .t386, .t396, .t400, .t404, .t409, .t410, .t412, .t418, .t422, .t425, .t428, .t433, .t448, .t456, .t477, .t478, .t480, .t486, .t498, .t504, .t506, .t509, .t511, .t517, .t518, .t519, .t520, .t532, .t533, .t538, .t539, .t544, .t545, .t552, .t554, .t569, .t570, .t577, .t592, .t598, .t599, .t601, .t604, .t605, .t609, .t615, .t616, .t650, .t659, .t670, .t675, .t686, .t688, .t694, .t698, .t700, .t726, .t728, .t730, .t734, .t738, .t740, .t744, .t754, .t760, .t762, .t764, .t774, .t776, .t778, .t780, .t786, .t798, .t799, .t801, .t813, .t814, .t822, .t826, .t827, .t829, .t842, .t843, .t849, .t850, .t851, .t856, .t858, .t859, .t860, .t881, .t889, .t902, .t912, .t923, .t937, .t959, .t979, .t982, .t983, .t989, .t994').trigger('displayChanged');
            });
            
            /* Blocks that affect others */
            $('.t826').trigger('displayChanged');

            t395_startUpdateLazyLoad($(this));
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });

        t395_alltabs_updateContent(recid);
        t395_updateContentBySelect(recid);

        var bgcolor = el.css("background-color");
        var bgcolor_target = el.find(".t395__select, .t395__firefoxfix");
        bgcolor_target.css("background", bgcolor);
    }
}

function t395_alltabs_updateContent(recid) {
    var mainRecid = recid;
    var el = $('#rec' + recid);

    var activeTab = el.find(".t395__tab_active");
    if (activeTab.length === 1) {
        var active = activeTab.attr('data-tab-rec-ids').split(',');
        var noactive = [];

        el.find(".t395__tab:not(.t395__tab_active)").each(function (i, tab) {
            noactive = noactive.concat($(tab).attr('data-tab-rec-ids').split(','));
        });

        var unique = noactive.filter(function (value, index, self) {
            return self.indexOf(value) === index;
        });

        var off = unique.filter(function (value) {
            return $.inArray(value, active) === -1;
        });

        if (el.find(".t395__tab_active").is(":visible") || el.find(".t395__select").is(":visible")) {
            active.forEach(function (recid) {
                if (recid !== '') {
                    var el = $('#rec' + recid);
                    var recordType = el.attr('data-record-type');
                    el.removeClass('t395__off');
                    el.css('opacity', '');

                    if (recordType === '395' && mainRecid !== recid) {
                        t395_alltabs_updateContent(recid);
                        t395_updateSelect(recid);
                        el.find('.t395__tab:nth-child(1)').trigger('click');
                    }

                    if (recordType === '397' && t397_alltabs_updateContent !== undefined && t397_updateSelect !== undefined && mainRecid !== recid) {
                        t397_alltabs_updateContent(recid);
                        t397_updateSelect(recid);
                        el.find('.t397__tab:nth-child(1)').trigger('click');
                    }
                }
            });
        } else {
            active.forEach(function (recid) {
                var el = $('#rec' + recid);
                el.attr('data-animationappear', 'off');
                el.addClass('t395__off');
            });
        }

        off.forEach(function (recid) {
            if (recid !== '') {
                var el = $('#rec' + recid);
                var recordType = el.attr('data-record-type');
                el.attr('data-connect-with-tab', 'yes');
                el.attr('data-animationappear', 'off');
                el.addClass('t395__off');

                if(recordType === '395' && mainRecid !== recid) {
                    t395_alltabs_updateContent(recid);
                    t395_updateSelect(recid);
                    el.find('.t395__tab:nth-child(1)').trigger('click');
                }

                if(recordType === '397' && t397_alltabs_updateContent !== undefined && t397_updateSelect !== undefined && mainRecid !== recid) {
                    t397_alltabs_updateContent(recid);
                    t397_updateSelect(recid);
                    el.find('.t397__tab:nth-child(1)').trigger('click');
                }
            }
        });

    }
}

function t395_updateContentBySelect(recid) {
    var el = $('#rec' + recid);
    el.find(".t395__select").change(function () {
        var select_val = el.find(".t395__select").val();
        var tab_index = el.find(".t395__tab[data-tab-rec-ids='" + select_val + "']");
        tab_index.trigger('click');
    });
}

function t395_updateSelect(recid) {
    var el = $('#rec' + recid);
    var current_tab = el.find(".t395__tab_active").attr('data-tab-rec-ids');
    var el_select = el.find(".t395__select");
    el_select.val(current_tab);
}

function t395_startUpdateLazyLoad($this) {
    var rec_ids = $this.attr('data-tab-rec-ids').split(',');
    rec_ids.forEach(function (rec_id, i, arr) {
        var rec_el = $('#rec' + rec_id);

        var video = rec_el.find('.t-video-lazyload');
        if (video.length > 0) {
            t395_updateVideoLazyLoad(video);
        }
    });
}

function t395_updateVideoLazyLoad(video) {
    setTimeout(function () {
        video.each(function () {
            var div = $(this);

            if (!div.hasClass('t-video__isload')) {

                var height = div.attr('data-videolazy-height') ? $(this).attr('data-videolazy-height') : '100%';
                if (height.indexOf('vh') != -1) {
                    height = '100%';
                }

                var videoId = div.attr('data-videolazy-id').trim();
                var blockId = div.attr('data-blocklazy-id') || '';
                if (typeof div.attr('data-videolazy-two-id') != 'undefined') {
                    var videoTwoId = '_' + div.attr('data-videolazy-two-id') + '_';
                } else {
                    var videoTwoId = '';
                }

                if (div.attr('data-videolazy-type') == 'youtube') {
                    div.find('iframe').remove();
                    div.prepend('<iframe id="youtubeiframe' + videoTwoId + blockId + '" width="100%" height="' + height + '" src="//www.youtube.com/embed/' + videoId + '?rel=0&fmt=18&html5=1&showinfo=0" frameborder="0" allowfullscreen></iframe>');
                }
            }

            div.addClass('t-video__isload');
        });
    }, 2);
}

function t395_scrollToTabs(recid) {
    var el = $('#rec' + recid);
    var curUrl = window.location.href;
    var tabIndexNumber = curUrl.indexOf('#!/tab/');
    var tabIndexNumberStart = curUrl.indexOf('tab/');

    el.find('.t395__wrapper_mobile .t395__select option:eq(0)').prop('selected', false);

    if (tabIndexNumber !== -1) {
        var tabRec = curUrl.substring(tabIndexNumberStart + 4, tabIndexNumberStart + 4 + recid.length);

        if (tabRec == recid) {
            var tabBlock = $('#rec' + tabRec).find('.t395');
            var tabNumber = parseInt(curUrl.slice(tabIndexNumberStart + 4 + recid.length + 1), 10);
            el.find('.t395__tab').removeClass('t395__tab_active');
            el.find('.t395__tab:eq(' + (tabNumber - 1) + ')').addClass('t395__tab_active');
            el.find('.t395__wrapper_mobile .t395__select option:eq(' + (tabNumber - 1) + ')').prop('selected', true);

            var targetOffset = tabBlock.offset().top;
            var target = targetOffset;

            if ($(window).width() > 960) {
                target = targetOffset - 200;
            } else {
                target = targetOffset - 100;
            }

            $('html, body').animate({
                scrollTop: target
            }, 300);
        }
    }
}

function t395_removeUrl() {
    var curUrl = window.location.href;
    var indexToRemove = curUrl.indexOf('#!/tab/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
        indexToRemove = curUrl.indexOf('%23!/tab/');
    }

    curUrl = curUrl.substring(0, indexToRemove);
    if (indexToRemove != -1) {
        if (typeof history.replaceState != 'undefined') {
            window.history.replaceState('', '', curUrl);
        }
    }
}
 
function t396_init(recid) {
	var data = '';
	var resolution = t396_detectResolution();
	var allRecords = document.getElementById('allrecords');
	var record = document.getElementById('rec' + recid);
	var zeroBlock = record ? record.querySelector('.t396') : null;
	var artBoard = record ? record.querySelector('.t396__artboard') : null;
	
	window.tn_window_width = window.innerWidth;
	window.tn_scale_factor = Math.round((window.tn_window_width / resolution) * 100) / 100;
	
	t396_initTNobj();
	t396_switchResolution(resolution);
	t396_updateTNobj();
	t396_artboard_build(data, recid);
	
	window.addEventListener('resize', function () {
		tn_console('>>>> t396: Window on Resize event >>>>');
		
		t396_waitForFinalEvent(function () {
			if (window.isMobile) {
				if (window.innerWidth !== window.tn_window_width) {
					t396_doResize(recid);
				}
			} else {
				t396_doResize(recid);
			}
		}, 500, 'resizeruniqueid' + recid);
	});
	
	window.addEventListener('orientationchange', function () {
		tn_console('>>>> t396: Orient change event >>>>');
		t396_waitForFinalEvent(function () {
			t396_doResize(recid);
		}, 600, 'orientationuniqueid' + recid);
	});
	
	window.addEventListener('load', function () {
		t396_allelems__renderView(artBoard);
		var blockOverflow = artBoard ? window.getComputedStyle(artBoard).getPropertyValue('overflow') : '';
		
		if (typeof t_lazyload_update === 'function' && blockOverflow === 'auto' && artBoard) {
			artBoard.addEventListener('scroll', t_throttle(function () {
				var dataLazy = allRecords ? allRecords.getAttribute('data-tilda-lazy') : null;
				if (window.lazy === 'y' || dataLazy === 'yes') {
					t_onFuncLoad('t_lazyload_update', function () {
						t_lazyload_update();
					});
				}
			}, 500));
		}
		
		if (window.location.hash !== '' && blockOverflow === 'visible') {
			if (artBoard) artBoard.style.overflow = 'hidden';
			setTimeout(function () {
				if (artBoard) artBoard.style.overflow = 'visible';
			}, 1);
		}
	});
	
	if (record && zeroBlock && artBoard && record.getAttribute('data-connect-with-tab') === 'yes') {
		zeroBlock.addEventListener('displayChanged', function () {
			t396_allelems__renderView(artBoard);
		});
	}
	
	/* fix for disappearing elements in safari */
	if (window.isSafari && zeroBlock) {
		zeroBlock.classList.add('t396_safari');
	}
	
	var isScaled = t396_ab__getFieldValue(artBoard, 'upscale') === 'window';
	var isTildaModeEdit = allRecords ? allRecords.getAttribute('data-tilda-mode') === 'edit' : null;
	if (isScaled && !isTildaModeEdit) t396_scaleBlock(recid);
}

function t396_isOnlyScalableBrowser() {
	var isFirefox = navigator.userAgent.search('Firefox') !== -1;
	var isOpera = (!!window.opr && !!window.opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') !== -1;
	return isFirefox || isOpera;
}

function t396_scaleBlock(recid) {
	var isOnlyScalable = t396_isOnlyScalableBrowser();
	var resolution = t396_detectResolution();
	var record = document.getElementById('rec' + recid);
	var zeroBlockElements = record ? record.querySelectorAll('.t396__elem') : [];
	var artBoard = record ? record.querySelector('.t396__artboard') : null;
	if (artBoard) {
		var artBoardWidth = artBoard.clientWidth;
		var updatedBlockHeight = Math.floor(artBoard.clientHeight * window.tn_scale_factor);
		var artBoardHeightVH = t396_ab__getFieldValue(artBoard, 'height_vh');
		window.tn_scale_offset = (artBoardWidth * window.tn_scale_factor - artBoardWidth) / 2;
		
		if (!artBoardHeightVH) {
			var artBoardMinHeight = t396_ab__getFieldValue(artBoard, 'height');
			var artBoardMaxHeight = t396_ab__getHeight(artBoard);
			var scaledMinHeight = artBoardMinHeight * window.tn_scale_factor;
			updatedBlockHeight = (scaledMinHeight >= artBoardMaxHeight) ? scaledMinHeight :
				artBoardMaxHeight;
		}
		
		artBoard.classList.add('t396__artboard_scale');
		
		var styleStr =
			'<style class="t396__scale-style">' +
			'.t-rec#rec' + recid + ' { overflow: visible; }' +
			'#rec' + recid + ' .t396__carrier,' +
			'#rec' + recid + ' .t396__filter,' +
			'#rec' + recid + ' .t396__artboard {' +
			'height: ' + updatedBlockHeight + 'px !important;' +
			'width: 100vw !important;' +
			'max-width: 100%;' +
			'}' +
			'</style>';
		
		artBoard.insertAdjacentHTML('beforeend', styleStr);
	}
	
	Array.prototype.forEach.call(zeroBlockElements, function (zeroBlockElement) {
		var atom = zeroBlockElement.querySelector('.tn-atom');
		var containerProp = t396_elem__getFieldValue(zeroBlockElement, 'container');
		if (containerProp === 'grid') {
			if (isOnlyScalable) {
				if (atom) {
					var atomParent = atom.parentNode;
					var div = document.createElement('div');
					div.classList.add('tn-atom__scale-wrapper');
					div.style.transform = 'scale(' + window.tn_scale_factor + ')';
					if (atomParent) atomParent.removeChild(atom);
					div.appendChild(atom);
					if (atomParent) atomParent.appendChild(div);
				}
			} else {
				zeroBlockElement.style.zoom = window.tn_scale_factor;
				if (zeroBlockElement.getAttribute('data-elem-type') === 'text' && resolution < 1200 && atom) {
					atom.style.webkitTextSizeAdjust = 'auto';
				}
				if (atom) atom.style.transformOrigin = 'center';
			}
		}
	});
}

function t396_doResize(recid) {
	var isOnlyScalable = t396_isOnlyScalableBrowser();
	var record = document.getElementById('rec' + recid);
	var allRecords = document.getElementById('allrecords');
	var resolution = t396_detectResolution();
	var scaleStyle = record ? record.querySelector('.t396__scale-style') : null;
	t396_removeElementFromDOM(scaleStyle);
	if (!isOnlyScalable) {
		var elements = record ? record.querySelectorAll('.t396__elem') : [];
		Array.prototype.forEach.call(elements, function (element) {
			element.style.zoom = '';
			var atom = element.querySelector('.tn-atom');
			if (atom) atom.style.transformOrigin = '';
		});
	} else {
		var atoms = record.querySelectorAll('.tn-atom');
		Array.prototype.forEach.call(atoms, function (atom) {
			var atomWrapper = atom.closest('.tn-atom__scale-wrapper');
			var atomParent = atomWrapper ? atomWrapper.parentNode : null;
			if (atomParent) atomParent.removeChild(atomWrapper);
			if (atomParent) atomParent.appendChild(atom);
		});
	}
	var artBoard = record ? record.querySelector('.t396__artboard') : null;
	var artBoardWidth = artBoard ? artBoard.clientWidth : 0;
	window.tn_window_width = window.innerWidth;
	window.tn_scale_factor = Math.round((window.tn_window_width / resolution) * 100) / 100;
	window.tn_scale_offset = (artBoardWidth * window.tn_scale_factor - artBoardWidth) / 2;
	t396_switchResolution(resolution);
	t396_updateTNobj();
	t396_ab__renderView(artBoard);
	t396_allelems__renderView(artBoard);
	var tildaMode = allRecords ? allRecords.getAttribute('data-tilda-mode') : '';
	var isScaled = t396_ab__getFieldValue(artBoard, 'upscale') === 'window';
	if (isScaled && tildaMode !== 'edit') t396_scaleBlock(recid);
}

function t396_detectResolution() {
	var windowWidth = window.innerWidth;
	var resolution = 1200;
	var breakpoints = [1200, 960, 640, 480, 320];
	
	for (var i = 0; i < breakpoints.length - 1; i++) {
		if (windowWidth < breakpoints[i]) {
			resolution = breakpoints[i + 1];
		}
	}
	return resolution;
}

function t396_initTNobj() {
	tn_console('func: initTNobj');
	window.tn = {};
	window.tn.canvas_min_sizes = ['320', '480', '640', '960', '1200'];
	window.tn.canvas_max_sizes = ['480', '640', '960', '1200', ''];
	window.tn.ab_fields = ['height', 'width', 'bgcolor', 'bgimg', 'bgattachment', 'bgposition',
		'filteropacity', 'filtercolor', 'filteropacity2', 'filtercolor2', 'height_vh', 'valign'];
}

function t396_updateTNobj() {
	tn_console('func: updateTNobj');
	var allRecords = document.getElementById('allrecords');
	if (window.zero_window_width_hook && window.zero_window_width_hook === 'allrecords' && allRecords) {
		window.tn.window_width = allRecords.clientWidth;
	} else {
		window.tn.window_width = window.innerWidth;
	}
	window.tn.window_height = window.innerHeight;
	
	var breakpoints = [1200, 960, 640, 480, 320];
	
	for (var i = 0; i < breakpoints.length; i++) {
		if (+window.tn.curResolution === breakpoints[i]) {
			window.tn.canvas_min_width = breakpoints[i];
			window.tn.canvas_max_width = i === 0 ? window.tn.window_width : breakpoints[i - 1];
		}
	}
	
	window.tn.grid_width = window.tn.canvas_min_width;
	window.tn.grid_offset_left = (window.tn.window_width - window.tn.grid_width) / 2;
}


var t396_waitForFinalEvent = (function () {
	var timers = {};
	return function (callback, ms, uniqueId) {
		if (!uniqueId) {
			uniqueId = 'Don\'t call this twice without a uniqueId';
		}
		if (timers[uniqueId]) {
			clearTimeout(timers[uniqueId]);
		}
		timers[uniqueId] = setTimeout(callback, ms);
	};
})();


function t396_switchResolution(resolution, resolutionMax) {
	tn_console('func: switchResolution');
	
	if (typeof resolutionMax === 'undefined') {
		var breakpoints = [1200, 960, 640, 480, 320];
		breakpoints.forEach(function (breakpoint, i) {
			if (+resolution === breakpoint) {
				resolutionMax = i === 0 ? '' : breakpoints[i - 1];
			}
		});
	}
	window.tn.curResolution = resolution;
	window.tn.curResolution_max = resolutionMax;
}

function t396_artboard_build(data, recid) {
	tn_console('func: t396_artboard_build. Recid:' + recid);
	tn_console(data);
	
	/* set style to artboard */
	var record = document.getElementById('rec' + recid);
	var allRecords = document.getElementById('allrecords');
	var artBoard = record ? record.querySelector('.t396__artboard') : null;
	if (!artBoard) return false;
	
	t396_ab__renderView(artBoard);
	
	/* create elements */
	var elements = artBoard.querySelectorAll('.tn-elem');
	Array.prototype.forEach.call(elements, function (element) {
		var dataType = element.getAttribute('data-elem-type');
		switch (dataType) {
			case 'text':
				t396_addText(artBoard, element);
				break;
			case 'image':
				t396_addImage(artBoard, element);
				break;
			case 'shape':
				t396_addShape(artBoard, element);
				break;
			case 'button':
				t396_addButton(artBoard, element);
				break;
			case 'video':
				t396_addVideo(artBoard, element);
				break;
			case 'html':
				t396_addHtml(artBoard, element);
				break;
			case 'tooltip':
				t396_addTooltip(artBoard, element);
				break;
			case 'form':
				t396_addForm(artBoard, element);
				break;
			case 'gallery':
				t396_addGallery(artBoard, element);
				break;
		}
	});
	
	artBoard.classList.remove('rendering');
	artBoard.classList.add('rendered');
	
	var artBoardOverflow = artBoard.getAttribute('data-artboard-ovrflw');
	if ((artBoardOverflow === 'visible' || artBoardOverflow === 'visibleX') && allRecords) {
		allRecords.style.overflow = 'hidden';
	}
	
	if (window.isMobile) {
		var style = document.createElement('style');
		style.textContent = '@media only screen and (min-width:1366px) and (orientation:landscape) and (-webkit-min-device-pixel-ratio:2) {.t396__carrier {background-attachment:scroll!important;}}';
		
		record.insertAdjacentElement('beforeend', style);
	}
}

function t396_ab__renderView(artBoard) {
	if (!artBoard) return false;
	var fields = window.tn.ab_fields;
	var allRecords = document.getElementById('allrecords');
	var artBoardHeightVH;
	
	for (var i = 0; i < fields.length; i++) {
		t396_ab__renderViewOneField(artBoard, fields[i]);
	}
	
	var artBoardMinHeight = t396_ab__getFieldValue(artBoard, 'height');
	var artBoardMaxHeight = t396_ab__getHeight(artBoard);
	
	var isTildaModeEdit = allRecords ? allRecords.getAttribute('data-tilda-mode') === 'edit' : false;
	var isScaled = t396_ab__getFieldValue(artBoard, 'upscale') === 'window';
	artBoardHeightVH = t396_ab__getFieldValue(artBoard, 'height_vh');
	if (isScaled && !isTildaModeEdit && artBoardHeightVH) {
		var scaledMinHeight = parseInt(artBoardMinHeight, 10) * window.tn_scale_factor;
	}
	var offsetTop;
	if (artBoardMinHeight === artBoardMaxHeight || (scaledMinHeight && scaledMinHeight >= artBoardMaxHeight)) {
		offsetTop = 0;
	} else {
		var artBoardVerticalAlign = t396_ab__getFieldValue(artBoard, 'valign');
		switch (artBoardVerticalAlign) {
			case 'top':
				offsetTop = 0;
				break;
			case 'center':
				if (scaledMinHeight) {
					offsetTop = parseFloat(((artBoardMaxHeight - scaledMinHeight) / 2).toFixed(1));
				} else {
					offsetTop = parseFloat(((artBoardMaxHeight - artBoardMinHeight) / 2).toFixed(1));
				}
				break;
			case 'bottom':
				if (scaledMinHeight) {
					offsetTop = parseFloat((artBoardMaxHeight - scaledMinHeight).toFixed(1));
				} else {
					offsetTop = parseFloat((artBoardMaxHeight - artBoardMinHeight).toFixed(1));
				}
				break;
			case 'stretch':
				offsetTop = 0;
				artBoardMinHeight = artBoardMaxHeight;
				break;
			default:
				offsetTop = 0;
				break;
		}
	}
	
	artBoard.setAttribute('data-artboard-proxy-min-offset-top', offsetTop);
	artBoard.setAttribute('data-artboard-proxy-min-height', artBoardMinHeight);
	artBoard.setAttribute('data-artboard-proxy-max-height', artBoardMaxHeight);
	
	var filter = artBoard.querySelector('.t396__filter');
	var carrier = artBoard.querySelector('.t396__carrier');
	artBoardHeightVH = t396_ab__getFieldValue(artBoard, 'height_vh');
	artBoardHeightVH = parseFloat(artBoardHeightVH);
	if (window.isMobile && artBoardHeightVH) {
		var height = document.documentElement.clientHeight * artBoardHeightVH / 100;
		artBoard.style.height = height + 'px';
		if (filter) filter.style.height = height + 'px';
		if (carrier) carrier.style.height = height + 'px';
	}
}

function t396_addText(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addText');
	
	/*add data atributes*/
	var fieldsString = 'top,left,width,container,axisx,axisy,widthunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
}

function t396_addImage(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addImage');
	
	/*add data atributes*/
	var fieldsString = 'img,width,filewidth,fileheight,top,left,container,axisx,axisy,widthunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
	
	var images = element.querySelectorAll('img');
	Array.prototype.forEach.call(images, function (img) {
		img.addEventListener('load', function () {
			t396_elem__renderViewOneField(element, 'top');
			if (img.src) {
				setTimeout(function () {
					t396_elem__renderViewOneField(element, 'top');
				}, 2000);
			}
		});
		if (img.complete) {
			t396_elem__renderViewOneField(element, 'top');
			if (img.src) {
				setTimeout(function () {
					t396_elem__renderViewOneField(element, 'top');
				}, 2000);
			}
		}
		img.addEventListener('tuwidget_done', function () {
			t396_elem__renderViewOneField(element, 'top');
		});
	});
}

function t396_addShape(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addShape');
	
	/*add data atributes*/
	var fieldsString = 'width,height,top,left,';
	fieldsString += 'container,axisx,axisy,widthunits,heightunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
	
}

function t396_addButton(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addButton');
	
	/*add data atributes*/
	var fieldsString = 'top,left,width,height,container,axisx,axisy,caption,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
	
	return (element);
}

function t396_addVideo(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addVideo');
	
	/*add data atributes*/
	var fieldsString = 'width,height,top,left,';
	fieldsString += 'container,axisx,axisy,widthunits,heightunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
	
	var videoEl = element.querySelector('.tn-atom__videoiframe');
	var atom = element.querySelector('.tn-atom');
	if (atom) atom.style.backgroundColor = '#000';
	
	var videoCover = atom ? atom.getAttribute('data-atom-video-has-cover') : '';
	if (!videoCover) videoCover = '';
	
	if (videoCover === 'y' && atom) {
		atom.addEventListener('click', function () {
			var iframe = videoEl ? videoEl.querySelector('iframe') : null;
			var dataOriginal = iframe ? iframe.getAttribute('data-original') : '';
			if (iframe) iframe.setAttribute('src', dataOriginal);
			atom.style.backgroundImage = 'none';
			var playBtn = atom.querySelector('.tn-atom__video-play-link');
			if (playBtn) playBtn.style.display = 'none';
		});
	}
	
	var allRecords = document.getElementById('allrecords');
	var autoplay = t396_elem__getFieldValue(element, 'autoplay');
	var showinfo = t396_elem__getFieldValue(element, 'showinfo');
	var loop = t396_elem__getFieldValue(element, 'loop');
	var mute = t396_elem__getFieldValue(element, 'mute');
	var startSec = t396_elem__getFieldValue(element, 'startsec');
	var endSec = t396_elem__getFieldValue(element, 'endsec');
	var tildaMode = allRecords ? allRecords.getAttribute('data-tilda-mode') : '';
	var url = '';
	
	var script = document.createElement('script');
	script.textContent = 'lazyload_iframe = new LazyLoad({elements_selector: ".t-iframe"});';
	
	var youtubeID = videoEl ? videoEl.getAttribute('data-youtubeid') : '';
	if (youtubeID) {
		url = '//youtube.com/embed/';
		url += youtubeID + '?rel=0&fmt=18&html5=1';
		url += '&showinfo=' + (showinfo === 'y' ? '1' : '0');
		if (loop === 'y') {
			url += '&loop=1&playlist=' + youtubeID;
		}
		if (startSec > 0) {
			url += '&start=' + startSec;
		}
		if (endSec > 0) {
			url += '&end=' + endSec;
		}
		if (mute === 'y') {
			url += '&mute=1';
		}
		
		if (videoCover === 'y') {
			url += '&autoplay=1';
			var instFlag = 'y';
			var iframeClass = '';
			if (autoplay === 'y' && mute === 'y' && window.lazy === 'y') {
				instFlag = 'lazy';
				iframeClass = ' class="t-iframe"';
			}
			
			videoEl.innerHTML = '<iframe id="youtubeiframe"' + iframeClass +
				' width="100%" height="100%" data-original="' + url +
				'" frameborder="0" allowfullscreen data-flag-inst="' + instFlag + '"></iframe>';
			if (autoplay === 'y' && mute === 'y' && window.lazy === 'y') {
				element.insertAdjacentElement('beforeend', script);
			}
			if (autoplay === 'y' && mute === 'y') {
				atom.click();
			}
		} else {
			if (tildaMode !== 'edit' && autoplay === 'y') {
				url += '&autoplay=1';
			}
			if (window.lazy === 'y') {
				videoEl.innerHTML = '<iframe id="youtubeiframe" class="t-iframe" width="100%" height="100%" data-original="' +
					url + '" frameborder="0" allowfullscreen data-flag-inst="lazy"></iframe>';
				element.insertAdjacentElement('beforeend', script);
			} else {
				videoEl.innerHTML = '<iframe id="youtubeiframe" width="100%" height="100%" src="' + url +
					'" frameborder="0" allowfullscreen data-flag-inst="y"></iframe>';
			}
		}
	}
	
	var vimeoID = videoEl ? videoEl.getAttribute('data-vimeoid') : '';
	if (vimeoID) {
		url = '//player.vimeo.com/video/';
		url += vimeoID + '?color=ffffff&badge=0';
		if (showinfo === 'y') {
			url += '&title=1&byline=1&portrait=1';
		} else {
			url += '&title=0&byline=0&portrait=0';
		}
		if (loop === 'y') {
			url += '&loop=1';
		}
		if (mute === 'y') {
			url += '&muted=1';
		}
		if (videoCover === 'y') {
			url += '&autoplay=1';
			videoEl.innerHTML = '<iframe data-original="' + url +
				'" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';
		} else {
			if (tildaMode !== 'edit' && autoplay === 'y') {
				url += '&autoplay=1';
			}
			if (window.lazy === 'y') {
				videoEl.innerHTML = '<iframe class="t-iframe" data-original="' + url +
					'" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';
				element.insertAdjacentElement('beforeend', script);
			} else {
				videoEl.innerHTML = '<iframe src="' + url +
					'" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';
			}
		}
	}
	
}

function t396_addHtml(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addHtml');
	
	/*add data atributes*/
	var fieldsString = 'width,height,top,left,';
	fieldsString += 'container,axisx,axisy,widthunits,heightunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
}

function t396_addTooltip(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addTooltip');
	var fieldsString = 'width,height,top,left,';
	fieldsString += 'container,axisx,axisy,widthunits,heightunits,leftunits,topunits,tipposition';
	element.setAttribute('data-fields', fieldsString);
	t396_elem__renderView(element);
	
	var tooltip = element.querySelector('.tn-atom__pin');
	var tooltipContent = element.querySelector('.tn-atom__tip');
	var tooltipOpenTrigger = element.getAttribute('data-field-tipopen-value');
	
	if (window.isMobile || tooltipOpenTrigger === 'click') {
		t396_setUpTooltip_mobile(element, tooltip, tooltipContent);
	} else {
		t396_setUpTooltip_desktop(element, tooltip, tooltipContent);
	}
	
	setTimeout(function () {
		var atomImages = document.querySelectorAll('.tn-atom__tip-img');
		Array.prototype.forEach.call(atomImages, function (img) {
			var imgOriginal = img.getAttribute('data-tipimg-original');
			if (imgOriginal) img.src = imgOriginal;
		});
	}, 3000);
}

function t396_addForm(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addForm');
	
	/*add data atributes*/
	var fieldsString = 'width,top,left,';
	fieldsString += 'inputs,container,axisx,axisy,widthunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
}

function t396_addGallery(artBoard, element) {
	element = t396_getEl(element);
	if (!element) return;
	tn_console('func: addForm');
	
	/*add data atributes*/
	var fieldsString = 'width,height,top,left,';
	fieldsString += 'imgs,container,axisx,axisy,widthunits,heightunits,leftunits,topunits';
	element.setAttribute('data-fields', fieldsString);
	
	/*render elem view*/
	t396_elem__renderView(element);
}

function t396_elem__setFieldValue(element, prop, val, flag_render, flag_updateui, resolution) {
	element = t396_getEl(element);
	if (!element) return;
	if (!resolution) resolution = window.tn.curResolution;
	if (+resolution < 1200 && prop !== 'zindex') {
		element.setAttribute('data-field-' + prop + '-res-' + resolution + '-value', val);
	} else {
		element.setAttribute('data-field-' + prop + '-value', val);
	}
	if (flag_render === 'render') elem__renderViewOneField(element, prop);
	if (flag_updateui === 'updateui') panelSettings__updateUi(element, prop, val);
}

function t396_elem__getFieldValue(element, prop) {
	element = t396_getEl(element);
	if (!element) return;
	var resolution = window.tn.curResolution;
	var breakpoints = [1200, 960, 640, 480, 320];
	var dataField;
	
	breakpoints.forEach(function (breakpoint, i) {
		if (i === 0 && +resolution >= breakpoint) {
			dataField = element.getAttribute('data-field-' + prop + '-value');
		}
		if (i > 0 && +resolution === breakpoint) {
			dataField = element.getAttribute('data-field-' + prop + '-res-' + breakpoint + '-value');
			if (i > 1 && !dataField) {
				var slicedBreakpoints = breakpoints.slice(1, i);
				for (var n = slicedBreakpoints.length - 1; n >= 0; n--) {
					dataField = element.getAttribute('data-field-' + prop + '-res-' + slicedBreakpoints[n] + '-value');
					if (dataField) break;
				}
			}
			if (!dataField) dataField = element.getAttribute('data-field-' + prop + '-value');
		}
	});
	
	return dataField ? dataField : '';
}

function t396_elem__renderView(element) {
	element = t396_getEl(element);
	tn_console('func: elem__renderView');
	var fields = element ? element.getAttribute('data-fields') : '';
	if (!fields) return false;
	fields = fields.split(',');
	
	/*set to element value of every field  via css*/
	fields.forEach(function (field) {
		t396_elem__renderViewOneField(element, field);
	});
}

function t396_elem__renderViewOneField(element, field) {
	element = t396_getEl(element);
	if (!element) return;
	var value = t396_elem__getFieldValue(element, field);
	var elementType;
	var borderWidth;
	var borderStyle;
	var currentValue;
	var slidesMain;
	var slidesImg;
	
	switch (field) {
		case 'left':
			value = t396_elem__convertPosition__Local__toAbsolute(element, field, value);
			element.style.left = parseFloat(value).toFixed(1) + 'px';
			break;
		case 'top':
			value = t396_elem__convertPosition__Local__toAbsolute(element, field, value);
			element.style.top = parseFloat(value).toFixed(1) + 'px';
			break;
		case 'width':
			value = t396_elem__getWidth(element, value);
			element.style.width = parseFloat(value).toFixed(1) + 'px';
			elementType = element.getAttribute('data-elem-type');
			switch (elementType) {
				case 'tooltip':
					var pinSvgIcon = element.querySelectorAll('.tn-atom__pin-icon');
					/* add width to near parent svg to fix InternerExplorer problem */
					Array.prototype.forEach.call(pinSvgIcon, function (pin) {
						var pinSize = parseFloat(value).toFixed(1) + 'px';
						pin.style.width = pinSize;
						pin.style.height = pinSize;
					});
					element.style.height = parseInt(value).toFixed(1) + 'px';
					break;
				case 'gallery':
					borderWidth = t396_elem__getFieldValue(element, 'borderwidth');
					borderStyle = t396_elem__getFieldValue(element, 'borderstyle');
					if (!borderStyle || !borderWidth || borderStyle === 'none') {
						borderWidth = 0;
					}
					value -= borderWidth * 2;
					currentValue = parseFloat(value).toFixed(1) + 'px';
					slidesMain = element.querySelector('.t-slds__main');
					slidesImg = element.querySelectorAll('.tn-atom__slds-img');
					
					element.style.width = currentValue;
					if (slidesMain) slidesMain.style.width = currentValue;
					Array.prototype.forEach.call(slidesImg, function (img) {
						img.style.width = currentValue;
					});
					break;
			}
			break;
		case 'height':
			elementType = element.getAttribute('data-elem-type');
			if (elementType === 'tooltip') return;
			value = t396_elem__getHeight(element, value);
			element.style.height = parseFloat(value).toFixed(1) + 'px';
			
			if (elementType === 'gallery') {
				borderWidth = t396_elem__getFieldValue(element, 'borderwidth');
				borderStyle = t396_elem__getFieldValue(element, 'borderstyle');
				if (!borderStyle || !borderWidth || borderStyle === 'none') {
					borderWidth = 0;
				}
				value -= borderWidth * 2;
				currentValue = parseFloat(value).toFixed(1) + 'px';
				slidesMain = element.querySelector('.t-slds__main');
				slidesImg = element.querySelectorAll('.tn-atom__slds-img');
				
				element.style.height = currentValue;
				if (slidesMain) slidesMain.style.height = currentValue;
				Array.prototype.forEach.call(slidesImg, function (img) {
					img.style.height = currentValue;
				});
			}
			break;
		case 'container':
			t396_elem__renderViewOneField(element, 'left');
			t396_elem__renderViewOneField(element, 'top');
			break;
		case 'inputs':
			var textArea = element.querySelector('.tn-atom__inputs-textarea');
			value = textArea ? textArea.value : '';
			try {
				/*TODO jquery*/
				t_zeroForms__renderForm($(element), value);
			} catch (err) {
			}
			break;
	}
	
	if (field === 'width' || field === 'height' || field === 'fontsize' || field === 'fontfamily' ||
		field === 'letterspacing' || field === 'fontweight' || field === 'img') {
		t396_elem__renderViewOneField(element, 'left');
		t396_elem__renderViewOneField(element, 'top');
	}
}

function t396_elem__convertPosition__Local__toAbsolute(element, field, value) {
	element = t396_getEl(element);
	if (!element) return;
	var artBoard = element.closest('.t396__artboard');
	var verticalAlignValue = t396_ab__getFieldValue(artBoard, 'valign');
	var isScaled = t396_ab__getFieldValue(artBoard, 'upscale') === 'window';
	var allRecords = document.getElementById('allrecords');
	var tildaMode = allRecords ? allRecords.getAttribute('data-tilda-mode') : '';
	var isTildaModeEdit = tildaMode === 'edit';
	var isOnlyScalable = t396_isOnlyScalableBrowser();
	var isScaledElement = !isTildaModeEdit && isScaled && isOnlyScalable;
	var isZoomedElement = !isTildaModeEdit && isScaled && !isOnlyScalable;
	var valueAxisY = t396_elem__getFieldValue(element, 'axisy');
	var valueAxisX = t396_elem__getFieldValue(element, 'axisx');
	var container = t396_elem__getFieldValue(element, 'container');
	
	value = parseInt(value);
	
	var elementContainer;
	var offsetLeft;
	var offsetTop;
	var elementWidth;
	var elementContainerWidth;
	var elementHeight;
	var elementContainerHeight;
	
	switch (field) {
		case 'left':
			elementContainer = container === 'grid' ? 'grid' : 'window';
			offsetLeft = container === 'grid' ? window.tn.grid_offset_left : 0;
			elementContainerWidth = container === 'grid' ? window.tn.grid_width : window.tn.window_width;
			
			/*fluid or not*/
			var elementLeftUnits = t396_elem__getFieldValue(element, 'leftunits');
			if (elementLeftUnits === '%') {
				value = t396_roundFloat(elementContainerWidth * value / 100);
			}
			
			/*with scale logic*/
			if (!isTildaModeEdit && isScaled) {
				if (container === 'grid' && isOnlyScalable) value = value * window.tn_scale_factor;
			} else {
				value = offsetLeft + value;
			}
			
			if (valueAxisX === 'center') {
				elementWidth = t396_elem__getWidth(element);
				
				if (isScaledElement && elementContainer !== 'window') {
					elementContainerWidth *= window.tn_scale_factor;
					elementWidth *= window.tn_scale_factor;
				}
				
				value = elementContainerWidth / 2 - elementWidth / 2 + value;
			}
			
			if (valueAxisX === 'right') {
				elementWidth = t396_elem__getWidth(element);
				if (isScaledElement && elementContainer !== 'window') {
					elementContainerWidth *= window.tn_scale_factor;
					elementWidth *= window.tn_scale_factor;
				}
				value = elementContainerWidth - elementWidth + value;
			}
			
			if (isScaledElement && elementContainer !== 'window') {
				elementWidth = t396_elem__getWidth(element);
				value = value + (elementWidth * window.tn_scale_factor - elementWidth) / 2;
			}
			
			break;
		
		case 'top':
			var artBoardParent = element.parentNode;
			var proxyMinOffsetTop = artBoardParent ? artBoardParent.getAttribute('data-artboard-proxy-min-offset-top') : '0';
			var proxyMinHeight = artBoardParent ? artBoardParent.getAttribute('data-artboard-proxy-min-height') : '0';
			var proxyMaxHeight = artBoardParent ? artBoardParent.getAttribute('data-artboard-proxy-max-height') : '0';
			
			var getElementHeight = function (element) {
				var height = t396_elem__getHeight(element);
				
				if (element && element.getAttribute('data-elem-type') === 'image') {
					var width = t396_elem__getWidth(element);
					var fileWidth = t396_elem__getFieldValue(element, 'filewidth');
					var fileHeight = t396_elem__getFieldValue(element, 'fileheight');
					
					if (fileWidth && fileHeight) {
						var ratio = parseInt(fileWidth) / parseInt(fileHeight);
						height = width / ratio;
					}
				}
				return height;
			};
			
			elementContainer = container === 'grid' ? 'grid' : 'window';
			offsetTop = container === 'grid' ? parseFloat(proxyMinOffsetTop) : 0;
			elementContainerHeight = container === 'grid' ? parseFloat(proxyMinHeight) : parseFloat(proxyMaxHeight);
			
			/*fluid or not*/
			var elTopUnits = t396_elem__getFieldValue(element, 'topunits');
			if (elTopUnits === '%') {
				value = (elementContainerHeight * (value / 100));
			}
			
			if (isScaledElement && elementContainer !== 'window') {
				value *= window.tn_scale_factor;
			}
			
			if (isZoomedElement && elementContainer !== 'window') {
				offsetTop = verticalAlignValue === 'stretch' ? 0 : (offsetTop / window.tn_scale_factor);
			}
			
			value = offsetTop + value;
			
			
			var artBoardHeightVH = t396_ab__getFieldValue(artBoardParent, 'height_vh');
			var artBoardMinHeight = t396_ab__getFieldValue(artBoardParent, 'height');
			var artBoardMaxHeight = t396_ab__getHeight(artBoardParent);
			if (isScaled && !isTildaModeEdit && artBoardHeightVH) {
				var scaledMinHeight = parseInt(artBoardMinHeight, 10) * window.tn_scale_factor;
			}
			
			if (valueAxisY === 'center') {
				elementHeight = getElementHeight(element);
				
				if (isScaledElement && elementContainer !== 'window') {
					if (verticalAlignValue !== 'stretch') {
						elementContainerHeight = elementContainerHeight * window.tn_scale_factor;
					} else {
						if (scaledMinHeight) {
							elementContainerHeight = scaledMinHeight > artBoardMaxHeight ? scaledMinHeight : artBoardMaxHeight;
						} else {
							elementContainerHeight = artBoardParent.clientHeight;
						}
					}
					elementHeight *= window.tn_scale_factor;
				}
				
				if (!isTildaModeEdit && isScaled && !isOnlyScalable && elementContainer !== 'window' &&
					verticalAlignValue === 'stretch') {
					if (scaledMinHeight) {
						elementContainerHeight = scaledMinHeight > artBoardMaxHeight ? scaledMinHeight : artBoardMaxHeight;
					} else {
						elementContainerHeight = artBoardParent.clientHeight;
					}
					elementContainerHeight = elementContainerHeight / window.tn_scale_factor;
				}
				
				value = elementContainerHeight / 2 - elementHeight / 2 + value;
			}
			
			if (valueAxisY === 'bottom') {
				elementHeight = getElementHeight(element);
				
				if (isScaledElement && elementContainer !== 'window') {
					if (verticalAlignValue !== 'stretch') {
						elementContainerHeight = elementContainerHeight * window.tn_scale_factor;
					} else {
						if (scaledMinHeight) {
							elementContainerHeight = scaledMinHeight > artBoardMaxHeight ? scaledMinHeight : artBoardMaxHeight;
						} else {
							elementContainerHeight = artBoardParent.clientHeight;
						}
					}
					elementHeight *= window.tn_scale_factor;
				}
				
				if (!isTildaModeEdit && isScaled && !isOnlyScalable && elementContainer !== 'window' &&
					verticalAlignValue === 'stretch') {
					if (scaledMinHeight) {
						elementContainerHeight = scaledMinHeight > artBoardMaxHeight ? scaledMinHeight : artBoardMaxHeight;
					} else {
						elementContainerHeight = artBoardParent.clientHeight;
					}
					elementContainerHeight = elementContainerHeight / window.tn_scale_factor;
				}
				
				value = elementContainerHeight - elementHeight + value;
			}
			
			if (isScaledElement && elementContainer !== 'window') {
				elementHeight = getElementHeight(element);
				value = value + (elementHeight * window.tn_scale_factor - elementHeight) / 2;
			}
			
			break;
	}
	
	return value;
}

function t396_ab__setFieldValue(artBoard, prop, val, resolution) {
	/* tn_console('func: ab__setFieldValue '+prop+'='+val);	*/
	if (!resolution) resolution = window.tn.curResolution;
	if (resolution < 1200) {
		if (artBoard) artBoard.setAttribute('data-artboard-' + prop + '-res-' + resolution, val);
	} else {
		if (artBoard) artBoard.setAttribute('data-artboard-' + prop, val);
	}
}

function t396_ab__getFieldValue(artBoard, prop) {
	if (!artBoard) return;
	var resolution = window.tn.curResolution;
	var breakpoints = [1200, 960, 640, 480, 320];
	var dataField;
	
	breakpoints.forEach(function (breakpoint, i) {
		if (i === 0 && +resolution >= breakpoint) {
			dataField = artBoard.getAttribute('data-artboard-' + prop);
		}
		if (i > 0 && +resolution === breakpoint) {
			dataField = artBoard.getAttribute('data-artboard-' + prop + '-res-' + breakpoint);
			if (i > 1 && !dataField) {
				var slicedBreakpoints = breakpoints.slice(1, i);
				for (var n = slicedBreakpoints.length - 1; n >= 0; n--) {
					dataField = artBoard.getAttribute('data-artboard-' + prop + '-res-' + slicedBreakpoints[n]);
					if (dataField) break;
				}
			}
			if (!dataField) dataField = artBoard.getAttribute('data-artboard-' + prop);
		}
	});
	
	return dataField ? dataField : '';
}

function t396_ab__renderViewOneField(artBoard, field) {
	t396_ab__getFieldValue(artBoard, field);
}

function t396_allelems__renderView(artBoard) {
	if (!artBoard) return false;
	tn_console('func: allelems__renderView: abid:' + artBoard.getAttribute('data-artboard-recid'));
	var ArtBoardelements = artBoard.querySelectorAll('.tn-elem');
	Array.prototype.forEach.call(ArtBoardelements, function (element) {
		t396_elem__renderView(element);
	});
}

function t396_ab__filterUpdate(artBoard) {
	var filter = artBoard.querySelector('.t396__filter');
	if (!filter) return;
	var filterColorRgb = filter.getAttribute('data-filtercolor-rgb');
	var filterColorRgb2 = filter.getAttribute('data-filtercolor2-rgb');
	var filterOpacity = filter.getAttribute('data-filteropacity');
	var filterOpacity2 = filter.getAttribute('data-filteropacity2');
	
	if (filterColorRgb && !filterColorRgb2) {
		filter.style.backgroundColor = 'rgba(' + filterColorRgb + ',' + filterOpacity + ')';
	} else if (!filterColorRgb && filterColorRgb2) {
		filter.style.backgroundColor = 'rgba(' + filterColorRgb2 + ',' + filterOpacity2 + ')';
	} else if (filterColorRgb && filterColorRgb2) {
		filter.style.background = '-webkit-gradient(linear, left top, left bottom, from(rgba(' + filterColorRgb + ',' +
			filterOpacity +
			')), to(rgba(' + filterColorRgb2 + ',' + filterOpacity2 + ')) )';
	} else {
		filter.style.backgroundColor = 'transparent';
	}
}

function t396_ab__getHeight(artBoard, artBoardHeight) {
	if (!artBoardHeight) artBoardHeight = t396_ab__getFieldValue(artBoard, 'height');
	artBoardHeight = parseFloat(artBoardHeight);
	
	/* get Artboard height (fluid or px) */
	var artBoardHeightVH = t396_ab__getFieldValue(artBoard, 'height_vh');
	if (artBoardHeightVH) {
		artBoardHeightVH = parseFloat(artBoardHeightVH);
		if (!isNaN(artBoardHeightVH)) {
			var artBoardHeightVHpx = window.tn.window_height * artBoardHeightVH / 100;
			if (artBoardHeight < artBoardHeightVHpx) {
				artBoardHeight = artBoardHeightVHpx;
			}
		}
	}
	return artBoardHeight;
}

function t396_hex2rgb(hexStr) {
	/*  note: hexStr should be #rrggbb */
	var hex = parseInt(hexStr.substring(1), 16);
	var r = (hex & 0xff0000) >> 16;
	var g = (hex & 0x00ff00) >> 8;
	var b = hex & 0x0000ff;
	return [r, g, b];
}

String.prototype.t396_replaceAll = function (search, replacement) {
	var target = this;
	return target.replace(new RegExp(search, 'g'), replacement);
};


function t396_elem__getWidth(element, value) {
	element = t396_getEl(element);
	if (!value) value = t396_elem__getFieldValue(element, 'width');
	value = parseFloat(value);
	var elWidthUnits = t396_elem__getFieldValue(element, 'widthunits');
	if (elWidthUnits === '%') {
		var elementContainer = t396_elem__getFieldValue(element, 'container');
		if (elementContainer === 'window') {
			value = window.tn.window_width * value / 100;
		} else {
			value = window.tn.grid_width * value / 100;
		}
	}
	return value;
}

function t396_elem__getHeight(element, value) {
	element = t396_getEl(element);
	if (!value) value = t396_elem__getFieldValue(element, 'height');
	value = parseFloat(value);
	var elemType = element.getAttribute('data-elem-type');
	
	if (elemType === 'shape' || elemType === 'video' || elemType === 'html' || elemType === 'gallery') {
		var elHeightUnits = t396_elem__getFieldValue(element, 'heightunits');
		if (elHeightUnits === '%') {
			var artBoard = element.parentNode;
			var proxyMinHeight = artBoard ? artBoard.getAttribute('data-artboard-proxy-min-height') : '0';
			var proxyMaxHeight = artBoard ? artBoard.getAttribute('data-artboard-proxy-max-height') : '0';
			var artBoardMinHeight = parseFloat(proxyMinHeight);
			var artBoardMaxHeight = parseFloat(proxyMaxHeight);
			var elementContainer = t396_elem__getFieldValue(element, 'container');
			
			if (elementContainer === 'window') {
				value = artBoardMaxHeight * (value / 100);
			} else {
				value = artBoardMinHeight * (value / 100);
			}
		}
	} else if (elemType !== 'button') {
		value = element.clientHeight;
	}
	
	return value;
}

function t396_roundFloat(n) {
	n = Math.round(n * 100) / 100;
	return (n);
}

function tn_console(str) {
	if (+(window.tn_comments) === 1) console.log(str);
}

function t396_setUpTooltip_desktop(element, tooltip, tooltipContent) {
	element = t396_getEl(element);
	var timer;
	if (tooltip) {
		tooltip.addEventListener('mouseover', function () {
			/* if any other tooltip is waiting its timeout to be hided — hide it */
			var visibleEls = document.querySelectorAll('.tn-atom__tip_visible');
			Array.prototype.forEach.call(visibleEls, function (visibleEl) {
				var curTipEl = visibleEl.closest('.t396__elem');
				var cirTipElID = curTipEl ? curTipEl.getAttribute('data-elem-id') : '';
				if (cirTipElID !== element.getAttribute('data-elem-id')) {
					t396_hideTooltip(curTipEl, visibleEl);
				}
			});
			
			clearTimeout(timer);
			if (tooltipContent && tooltipContent.style.display === 'block') return;
			t396_showTooltip(element, tooltipContent);
		});
		
		tooltip.addEventListener('mouseout', function () {
			timer = setTimeout(function () {
				t396_hideTooltip(element, tooltipContent);
			}, 300);
		});
	}
}

function t396_setUpTooltip_mobile(element, tooltip, tooltipContent) {
	element = t396_getEl(element);
	if (tooltip) {
		tooltip.addEventListener('click', function () {
			if (tooltipContent && tooltipContent.style.display === 'block' && tooltip.classList.contains('tn-atom__pin')) {
				t396_hideTooltip(element, tooltipContent);
			} else {
				t396_showTooltip(element, tooltipContent);
			}
		});
	}
	
	var elementID = element.getAttribute('data-elem-id');
	document.addEventListener('click', function (e) {
		if (e.target.closest('.tn-atom__pin')) {
			var zbEl = e.target.closest('.t396__elem');
			var clickedPinId = zbEl ? zbEl.getAttribute('data-elem-id') : '';
			if (clickedPinId === elementID) return;
		}
		t396_hideTooltip(element, tooltipContent);
	});
}

function t396_hideTooltip(element, tooltipContent) {
	if (tooltipContent) tooltipContent.style.display = '';
	if (tooltipContent) tooltipContent.style.left = '';
	if (tooltipContent) tooltipContent.style.transform = '';
	if (tooltipContent) tooltipContent.style.right = '';
	if (tooltipContent) tooltipContent.classList.remove('tn-atom__tip_visible');
	if (element) element.style.zIndex = '';
}

function t396_showTooltip(element, tooltipContent) {
	element = t396_getEl(element);
	var pos = element.getAttribute('data-field-tipposition-value');
	if (!pos) pos = 'top';
	var elSize = element.clientHeight;
	var elTop = element.getBoundingClientRect().top + window.pageYOffset;
	var elBottom = elTop + elSize;
	var elLeft = element.getBoundingClientRect().left + window.pageXOffset;
	var elRight = elLeft + elSize;
	var winTop = window.pageYOffset;
	var winWidth = window.innerWidth;
	var winBottom = winTop + window.innerHeight;
	var tipElHeight = tooltipContent ? tooltipContent.offsetHeight : 0;
	var tipElWidth = tooltipContent ? tooltipContent.offsetWidth : 0;
	var padding = 15;
	var tipElRight;
	var tipElLeft;
	var tipElTop;
	var tipElBottom;
	
	if (pos === 'right' || pos === 'left') {
		tipElRight = elRight + padding + tipElWidth;
		tipElLeft = elLeft - padding - tipElWidth;
		if ((pos === 'right' && tipElRight > winWidth) || (pos === 'left' && tipElLeft < 0)) {
			pos = 'top';
		}
	}
	if (pos === 'top' || pos === 'bottom') {
		tipElRight = elRight + (tipElWidth / 2 - elSize / 2);
		tipElLeft = elLeft - (tipElWidth / 2 - elSize / 2);
		if (tipElRight > winWidth) {
			var rightOffset = -(winWidth - elRight - padding);
			if (tooltipContent) tooltipContent.style.left = 'auto';
			if (tooltipContent) tooltipContent.style.transform = 'none';
			if (tooltipContent) tooltipContent.style.right = rightOffset + 'px';
		}
		if (tipElLeft < 0) {
			var leftOffset = -(elLeft - padding);
			if (tooltipContent) tooltipContent.style.left = leftOffset + 'px';
			if (tooltipContent) tooltipContent.style.transform = 'none';
		}
	}
	if (pos === 'top') {
		tipElTop = elTop - padding - tipElHeight;
		tipElBottom = elBottom + padding + tipElHeight;
		if (winBottom > tipElBottom && winTop > tipElTop) {
			pos = 'bottom';
		}
	}
	if (pos === 'bottom') {
		tipElTop = elTop - padding - tipElHeight;
		tipElBottom = elBottom + padding + tipElHeight;
		if (winBottom < tipElBottom && winTop < tipElTop) {
			pos = 'top';
		}
	}
	
	if (tooltipContent) tooltipContent.setAttribute('data-tip-pos', pos);
	if (tooltipContent) tooltipContent.style.display = 'block';
	if (tooltipContent) tooltipContent.classList.add('tn-atom__tip_visible');
	if (element) element.style.zIndex = '1000';
}

function t396_hex2rgba(hexStr, opacity) {
	if (!hexStr) return false;
	var hex = parseInt(hexStr.substring(1), 16);
	var r = (hex & 0xff0000) >> 16;
	var g = (hex & 0x00ff00) >> 8;
	var b = hex & 0x0000ff;
	return [r, g, b, parseFloat(opacity)];
}

function t396_removeElementFromDOM(el) {
	el = t396_getEl(el);
	if (el && el.parentNode) {
		el.parentNode.removeChild(el);
	}
}

function t396_getEl(el) {
	if (el instanceof jQuery) {
		return el.length ? el.get(0) : null;
	} else {
		return el;
	}
}

if (!Element.prototype.matches) {
	Element.prototype.matches =
		Element.prototype.matchesSelector ||
		Element.prototype.msMatchesSelector ||
		Element.prototype.mozMatchesSelector ||
		Element.prototype.webkitMatchesSelector ||
		Element.prototype.oMatchesSelector;
}

/* Polyfill: Element.closest */
if (!Element.prototype.closest) {
	Element.prototype.closest = function (s) {
		var el = this;
		while (el && el.nodeType === 1) {
			if (Element.prototype.matches.call(el, s)) {
				return el;
			}
			el = el.parentElement || el.parentNode;
		}
		return null;
	};
} 
function t397_init(recid) {
    var el = $('#rec' + recid);
    var curMode = $('.t-records').attr('data-tilda-mode');
    var tabs = el.find('.t397__tab');

    if (curMode != 'edit' && curMode != 'preview') {
        t397_scrollToTabs(recid);
    }

    if (tabs.length > 0) {
        tabs.on('click', function (event) {
            if ($(this).hasClass('t397__tab_active') && event.isTrigger !== 3) {
                return;
            }
            el.find('.t397__tab').removeClass('t397__tab_active');
            $(this).addClass('t397__tab_active');

            t397_removeUrl();
            var tabNumber = el.find(".t397__tab_active").index() + 1;
            if (curMode != 'edit' && curMode != 'preview' && tabNumber !== 0) {
                if (typeof history.replaceState != 'undefined') {
                    window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumber);
                }
            }

            t397_alltabs_updateContent(recid);
            t397_updateSelect(recid);

            var recids = $(this).attr('data-tab-rec-ids').split(',');
            recids.forEach(function (recid) {
                var el = $('#rec' + recid);
                el.find('.t-feed, .t-store, .t-store__product-snippet, .t117, .t121, .t132, .t223, .t226, .t228, .t229, .t230, .t268, .t279, .t341, .t346, .t347, .t349, .t351, .t353, .t384, .t385, .t386, .t396, .t400, .t404, .t409, .t410, .t412, .t418, .t422, .t425, .t428, .t433, .t448, .t456, .t477, .t478, .t480, .t486, .t498, .t504, .t506, .t509, .t511, .t517, .t518, .t519, .t520, .t532, .t533, .t538, .t539, .t544, .t545, .t552, .t554, .t569, .t570, .t577, .t592, .t598, .t599, .t601, .t604, .t605, .t609, .t615, .t616, .t650, .t659, .t670, .t675, .t686, .t688, .t694, .t698, .t700, .t726, .t728, .t730, .t734, .t738, .t740, .t744, .t754, .t760, .t762, .t764, .t774, .t776, .t778, .t780, .t786, .t798, .t799, .t801, .t813, .t814, .t822, .t826, .t827, .t829, .t842, .t843, .t849, .t850, .t851, .t856, .t858, .t859, .t860, .t881, .t889, .t902, .t912, .t923, .t937, .t958, .t959, .t979, .t982, .t983, .t989, .t994').trigger('displayChanged');
            });
            
            /* Blocks that affect others */
            $('.t826').trigger('displayChanged');

            t397_startUpdateLazyLoad($(this));
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });

        t397_alltabs_updateContent(recid);
        t397_updateContentBySelect(recid);

        var bgcolor = el.css("background-color");
        var bgcolor_target = el.find(".t397__select, .t397__firefoxfix");
        bgcolor_target.css("background-color", bgcolor);
    }

    /* Scroll and open proper tab on a valid link click */
    $('.r').on('click', '[href*="#!/tab/' + recid + '"]', function (e) {
        var hash = e.currentTarget.hash;
        t397_scrollToTabs(recid, hash);
    });
}

function t397_alltabs_updateContent(recid) {
    var mainRecid = recid;
    var el = $('#rec' + recid);

    var activeTab = el.find(".t397__tab_active");
    if (activeTab.length === 1) {
        var active = activeTab.attr('data-tab-rec-ids').split(',');
        var noactive = [];

        el.find(".t397__tab:not(.t397__tab_active)").each(function (i, tab) {
            noactive = noactive.concat($(tab).attr('data-tab-rec-ids').split(','));
        });

        var unique = noactive.filter(function (value, index, self) {
            return self.indexOf(value) === index;
        });

        var off = unique.filter(function (value) {
            return $.inArray(value, active) === -1;
        });

        if (el.find(".t397__tab_active").is(":visible") || el.find(".t397__select").is(":visible")) {
            active.forEach(function (recid) {
                if (recid !== '') {
                    var el = $('#rec' + recid);
                    var recordType = el.attr('data-record-type');
                    el.removeClass('t397__off');
                    el.css('opacity', '');

                    if (recordType === '395' && t395_alltabs_updateContent !== undefined && t395_updateSelect !== undefined && mainRecid !== recid) {
                        t395_alltabs_updateContent(recid);
                        t395_updateSelect(recid);
                        el.find('.t395__tab:nth-child(1)').trigger('click');
                    }

                    if (recordType === '397' && mainRecid !== recid) {
                        t397_alltabs_updateContent(recid);
                        t397_updateSelect(recid);
                        el.find('.t397__tab:nth-child(1)').trigger('click');
                    }
                }
            });
        } else {
            active.forEach(function (recid) {
                var el = $('#rec' + recid);
                el.attr('data-animationappear', 'off');
                el.addClass('t397__off');
            });
        }

        off.forEach(function (recid) {
            if (recid !== '') {
                var el = $('#rec' + recid);
                var recordType = el.attr('data-record-type');
                el.attr('data-connect-with-tab', 'yes');
                el.attr('data-animationappear', 'off');
                el.addClass('t397__off');

                if (recordType === '395' && t395_alltabs_updateContent !== undefined && t395_updateSelect !== undefined && mainRecid !== recid) {
                    t395_alltabs_updateContent(recid);
                    t395_updateSelect(recid);
                    el.find('.t395__tab:nth-child(1)').trigger('click');
                }

                if (recordType === '397' && mainRecid !== recid) {
                    t397_alltabs_updateContent(recid);
                    t397_updateSelect(recid);
                    el.find('.t397__tab:nth-child(1)').trigger('click');
                }
            }
        });
    }
}

function t397_updateContentBySelect(recid) {
    var el = $('#rec' + recid);
    el.find(".t397__select").change(function () {
        var select_val = el.find(".t397__select").val();
        var tab_index = el.find(".t397__tab[data-tab-rec-ids='" + select_val + "']");
        tab_index.trigger('click')
    })
}

function t397_updateSelect(recid) {
    var el = $('#rec' + recid);
    var current_tab = el.find(".t397__tab_active").attr('data-tab-rec-ids');
    var el_select = el.find(".t397__select");
    el_select.val(current_tab)
}

function t397_startUpdateLazyLoad($this) {
    var rec_ids = $this.attr('data-tab-rec-ids').split(',');
    rec_ids.forEach(function (rec_id, i, arr) {
        var rec_el = $('#rec' + rec_id);

        var video = rec_el.find('.t-video-lazyload');
        if (video.length > 0) {
            t397_updateVideoLazyLoad(video);
        }
    });
}

function t397_updateVideoLazyLoad(video) {
    setTimeout(function () {
        video.each(function () {
            var div = $(this);

            if (!div.hasClass('t-video__isload')) {

                var height = div.attr('data-videolazy-height') ? $(this).attr('data-videolazy-height') : '100%';
                if (height.indexOf('vh') != -1) {
                    height = '100%';
                }

                var videoId = div.attr('data-videolazy-id').trim();
                var blockId = div.attr('data-blocklazy-id') || '';
                if (typeof div.attr('data-videolazy-two-id') != 'undefined') {
                    var videoTwoId = '_' + div.attr('data-videolazy-two-id') + '_';
                } else {
                    var videoTwoId = '';
                }

                if (div.attr('data-videolazy-type') == 'youtube') {
                    div.find('iframe').remove();
                    div.prepend('<iframe id="youtubeiframe' + videoTwoId + blockId + '" width="100%" height="' + height + '" src="//www.youtube.com/embed/' + videoId + '?rel=0&fmt=18&html5=1&showinfo=0" frameborder="0" allowfullscreen></iframe>');
                }
            }

            div.addClass('t-video__isload');
        });
    }, 2);
}

function t397_scrollToTabs(recid, hash) {
    var el = $('#rec' + recid);
    var curUrl = '';
    if (hash) {
        curUrl = hash;
    } else {
        curUrl = window.location.href;
    }
    var tabIndexNumber = curUrl.indexOf('#!/tab/');
    var tabIndexNumberStart = curUrl.indexOf('tab/');

    el.find('.t397__wrapper_mobile .t397__select option:eq(0)').prop('selected', false);

    if (tabIndexNumber !== -1) {
        var tabRec = curUrl.substring(tabIndexNumberStart + 4, tabIndexNumberStart + 4 + recid.length);

        if (tabRec == recid) {
            var tabBlock = $('#rec' + tabRec).find('.t397');
            var tabNumber = parseInt(curUrl.slice(tabIndexNumberStart + 4 + recid.length + 1), 10);
            el.find('.t397__tab').removeClass('t397__tab_active');
            el.find('.t397__tab:eq(' + (tabNumber - 1) + ')').trigger('click').addClass('t397__tab_active');
            el.find('.t397__wrapper_mobile .t397__select option:eq(' + (tabNumber - 1) + ')').prop('selected', true);

            var targetOffset = tabBlock.offset().top;
            var target = targetOffset;

            if ($(window).width() > 960) {
                target = targetOffset - 200;
            } else {
                target = targetOffset - 100;
            }

            $('html, body').animate({
                scrollTop: target
            }, 300);
        }
    }
}

function t397_removeUrl() {
    var curUrl = window.location.href;
    var indexToRemove = curUrl.indexOf('#!/tab/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
        indexToRemove = curUrl.indexOf('%23!/tab/');
    }

    curUrl = curUrl.substring(0, indexToRemove);
    if (indexToRemove != -1) {
        if (typeof history.replaceState != 'undefined') {
            window.history.replaceState('', '', curUrl);
        }
    }
}
 
function t398_init(recid){
  t398_addArrow(recid);
  t398_highlight();
  $('#rec'+recid).find(".t398").each(function() {
	var $hook=$(this).attr('data-tooltip-hook');
    var $margin=$(this).attr('data-tooltip-margin');
    if($hook!==''){
      var $obj = $('a[href="'+$hook+'"]');
      var $content=$(this).find('.t398__content').html();
      if($hook.charAt(0)=='#'){var touchDevices=true;}else{var touchDevices=false;}
      var position=$(this).attr('data-tooltip-position');
      if(position!==''){}else{position='top';}
      $obj.click(function(e){
        e.preventDefault();
      });
      $obj.tooltipster({
        'theme':'t398__tooltipster-noir t398__tooltipster-noir_'+recid+'',
        'contentAsHTML': true,
        'content': $content,
        interactive:true,
        touchDevices:touchDevices,
        position:position,
        functionReady: function(origin, tooltip) {
          $(".t398__tooltipster-noir_"+recid+"").css("margin-top", $margin);
        }
      });
    }
  });
}

function t398_addArrow(recid){
  $('#rec'+recid).find(".t398").each(function() {
	var $hook=$(this).attr('data-tooltip-hook');
    var $obj = $('a[href="'+$hook+'"]');
    var arrow=$(this).attr('data-add-arrow');
    var arrow_height = $obj.height();
    if($hook!=='' && arrow!==''){
      $obj.append("<div class=\"t398__arrow t398__arrow_"+recid+"\" style=\"height: "+arrow_height+"\px;\"></div>");
    }
  });
}

function t398_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t398__list_item a[href='"+url+"']").addClass("t-active");
  $(".t398__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t398__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t398__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t398__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t398__list_item a[href='/"+pathname+"/']").addClass("t-active");
}
 
function t400_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t400');
    if (!container) return;

    var button = rec.querySelector('.t400__submit');
    var hideBackText = button.getAttribute('data-hide-back-text');
    var showMoreText = button.textContent;

    button.addEventListener('click', function() {
        if (hideBackText && button.classList.contains('t400__submit_hide-back')) {
            t400_alltabs_updateContent(recId);
            button.classList.remove('t400__submit_hide-back');

            if (button.classList.contains('t400__submit-overflowed')) {
                button.innerHTML = '<span class="t400__text">' + showMoreText + '</span>';
            } else {
                button.innerHTML = showMoreText;
            }

            var zeroBlocks = document.querySelectorAll('.t396');

            for (var i = 0; i < zeroBlocks.length; i++) {
                t400__triggerEvent(zeroBlocks[i], 'displayChanged');
            }

            return;
        }

        var recIds = button.getAttribute('data-hidden-rec-ids').split(',');
        
        for (var i = 0; i < recIds.length; i++) {
            var recShowBlock = document.getElementById('rec' + recIds[i]);
            
            if (recShowBlock) {
                recShowBlock.classList.remove('t400__off');
                recShowBlock.style.opacity = '';

                var videos = recShowBlock.querySelectorAll('.t-video-lazyload');

                if (videos.length > 0) {
                    var video = videos[0];

                    if (video.closest('.t121') || video.closest('.t223') || video.closest('.t230') || video.closest('.t368')) {
                        t400_updateVideoLazyLoad(videos);
                    }
                }

                var selectors = recShowBlock.querySelectorAll('.t-feed, .t-store, .t-store__product-snippet, .t117, .t121, .t132, .t223, .t226, .t228, .t229, .t230, .t268, .t279, .t341, .t346, .t347, .t349, .t351, .t353, .t384, .t385, .t386, .t396, .t400, .t404, .t409, .t410, .t412, .t418, .t422, .t425, .t428, .t433, .t456, .t477, .t478, .t480, .t486, .t498, .t504, .t506, .t509, .t511, .t517, .t518, .t519, .t520, .t527, .t531, .t532, .t533, .t538, .t539, .t544, .t545, .t552, .t554, .t570, .t577, .t592, .t598, .t599, .t601, .t604, .t605, .t609, .t615, .t616, .t650, .t659, .t670, .t675, .t686, .t688, .t694, .t698, .t700, .t726, .t728, .t730, .t734, .t738, .t740, .t744, .t754, .t760, .t762, .t764, .t774, .t776, .t778, .t780, .t786, .t798, .t799, .t801, .t813, .t814, .t822, .t826, .t827, .t829, .t842, .t843, .t849, .t850, .t851, .t856, .t858, .t859, .t860, .t881, .t889, .t899, .t902, .t905, .t912, .t923, .t937, .t958, .t959, .t979, .t982, .t983, .t989, .t994, .t1000, .t1003');

                for (var j = 0; j < selectors.length; j++) {
                    t400__triggerEvent(selectors[j], 'displayChanged');
                }
            }
        }

        if (hideBackText) {
            button.classList.add('t400__submit_hide-back');

            if (button.classList.contains('t400__submit-overflowed')) {
                button.innerHTML = '<span class="t400__text">' + hideBackText + '</span>';
            } else {
                button.innerHTML = hideBackText;
            }
        } else {
            rec.classList.add('t400__off');
            rec.style.display = 'none';
        }

        if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function() {
                t_lazyload_update();
            });
        }
    });

    t400_alltabs_updateContent(recId);
    t400_checkSize(recId);

    /* TODO: jq event*/
    $(container).bind('displayChanged', function() {
        t400_checkSize(recId);
    });

    /*container.addEventListener('displayChanged', function() {
        t400_checkSize(recId);
    });*/
}

function t400_alltabs_updateContent(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var button = rec.querySelector('.t400__submit');
    if (!button) return;

    var recIds = button.getAttribute('data-hidden-rec-ids').split(',');

    for (var i = 0; i < recIds.length; i++) {
        var recHideBlock = document.getElementById('rec' + recIds[i]);

        if (!recHideBlock) return;

        recHideBlock.setAttribute('data-animationappear', 'off');
        recHideBlock.setAttribute('data-connect-with-tab', 'yes');
        recHideBlock.classList.add('t400__off');
    }
}

function t400_checkSize(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var button = rec.querySelector('.t400__submit');
    if (!button) return;

    var buttonStyle = getComputedStyle(button, null);
    var buttonPaddingTop = parseInt(buttonStyle.paddingTop) || 0;
    var buttonPaddingBottom = parseInt(buttonStyle.paddingBottom) || 0;
    var buttonHeight = button.clientHeight - (buttonPaddingTop + buttonPaddingBottom);
    var buttonScrollHeight = button.scrollHeight;

    if (buttonHeight < buttonScrollHeight) {
        var buttonText = button.textContent;
        button.classList.add('t400__submit-overflowed');
        button.innerHTML = '<span class="t400__text">' + buttonText + '</span>';
    }
}

function t400_updateVideoLazyLoad(videos) {
    setTimeout(function() {
        for (var i = 0; i < videos.length; i++) {
            var video = videos[i];
            var videoHeight = video.getAttribute('data-videolazy-height') || '100%';

            if (videoHeight.indexOf('vh') !== -1) {
                videoHeight = '100%';
            }

            var videoId = video.getAttribute('data-videolazy-id').trim();
            var blockId = video.getAttribute('data-blocklazy-id') || '';
            var videoTwoId = video.getAttribute('data-videolazy-two-id') || '';

            if (videoTwoId) videoTwoId = '_' + videoTwoId + '_';

            if (video.getAttribute('data-videolazy-type') === 'youtube') {
                var iframes = video.querySelectorAll('iframe');

                for (var j = 0; j < iframes.length; j++) {
                    var oldFrame = iframes[j];

                    if (oldFrame && oldFrame.parentNode) oldFrame.parentNode.removeChild(oldFrame);
                }

                var iframe = document.createElement('iframe');
                iframe.id = 'youtubeiframe' + videoTwoId + blockId;
                iframe.width = '100%';
                iframe.height = videoHeight;
                iframe.src = '//www.youtube.com/embed/' + videoId + '?rel=0&fmt=18&html5=1&showinfo=0';
                iframe.setAttribute('frameborder', '0');
                iframe.setAttribute('allowfullscreen', '');
                video.insertBefore(iframe, video.firstChild);
            }
        }
    });
}

function t400__triggerEvent(el, eventName) {
    var event;
    if (typeof window.CustomEvent === 'function') {
        event = new CustomEvent(eventName);
    } else if (document.createEvent) {
        event = document.createEvent('HTMLEvents');
        event.initEvent(eventName, true, false);
    } else if (document.createEventObject) {
        event = document.createEventObject();
        event.eventType = eventName;
    }

    event.eventName = eventName;

    if (el.dispatchEvent) {
        el.dispatchEvent(event);
    } else if (el.fireEvent) {
        el.fireEvent('on' + event.eventType, event);
    } else if (el[eventName]) {
        el[eventName]();
    } else if (el['on' + eventName]) {
        el['on' + eventName]();
    }

    if (t400__checkJqueryEvent(el, eventName)) {
        $(el).trigger(eventName);
    }
}

function t400__checkJqueryEvent(element, eventName) {
    var events = $._data(element, 'events') || false;
    var isEvent = false;

    if (events) {
        for (var key in events) {
            if (key === eventName) {
                isEvent = true;
                break;
            }
        }
    }

    return isEvent;
} 
function t401_showMore(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t401');
    if (!container) return;
    var cols = container.querySelectorAll('.t-col');
    var allRecords = document.getElementById('allrecords');

    for (var i = 0; i < cols.length; i++) {
        cols[i].style.display = 'none';
    }

    var cardsLength = cols.length;
    var cardsCount = parseInt(container.getAttribute('data-show-count'), 10);

    if (cardsCount > 500) cardsCount = 500;

    var startIndexShowBlock = cardsCount;
    var countShowBlock = cardsCount;
    var colsShow = t401__getShowBlocks(cols, startIndexShowBlock);
    
    for (var i = 0; i < colsShow.length; i++) {
        colsShow[i].style.display = 'block';
    }

    var showMoreBtn = rec.querySelector('.t401__showmore');

    if (showMoreBtn) {
        showMoreBtn.addEventListener('click', function() {
            startIndexShowBlock = (startIndexShowBlock + countShowBlock <= cardsLength) ? startIndexShowBlock + countShowBlock : cardsLength;
    
            var newColsShow = t401__getShowBlocks(cols, startIndexShowBlock);
            
            for (var i = 0; i < newColsShow.length; i++) {
                newColsShow[i].style.display = 'block';
            }
    
            if (startIndexShowBlock === cardsLength) {
                showMoreBtn.style.display = 'none';
            }
    
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function() {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t401__getShowBlocks(elements, index) {
    var newElements = [];

    for (var i = 0; i < elements.length; i++) {
        if (i <= index - 1) newElements.push(elements[i]);
    }

    return newElements;
} 
function t403_showMore(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t403');
    if (!container) return;
    var containerTable = rec.querySelectorAll('.t403__container-table');
    var allRecords = document.getElementById('allrecords');

    for (var i = 0; i < containerTable.length; i++) {
        containerTable[i].style.display = 'none';
    }

    var cardsLength = containerTable.length;
    var cardsCount = parseInt(container.getAttribute('data-show-count'), 10);
    var startIndexShowBlock = cardsCount;
    var countShowBlock = cardsCount;
    var tableShow = t403__getShowBlocks(containerTable, startIndexShowBlock);
    
    for (var i = 0; i < tableShow.length; i++) {
        tableShow[i].style.display = 'block';
    }

    var showMoreBtn = rec.querySelector('.t403__showmore');

    if (showMoreBtn) {
        showMoreBtn.addEventListener('click', function() {
            startIndexShowBlock = (startIndexShowBlock + countShowBlock <= cardsLength) ? startIndexShowBlock + countShowBlock : cardsLength;
            
            var newTableShow = t403__getShowBlocks(containerTable, startIndexShowBlock);
            
            for (var i = 0; i < newTableShow.length; i++) {
                newTableShow[i].style.display = 'block';
            }
    
            if (startIndexShowBlock === cardsLength) {
                showMoreBtn.style.display = 'none';
            }
    
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function() {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t403__getShowBlocks(elements, index) {
    var newElements = [];

    for (var i = 0; i < elements.length; i++) {
        if (i <= index - 1) newElements.push(elements[i]);
    }

    return newElements;
} 
function t404_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var mainContainer = rec.querySelector('.t404');
    if (!mainContainer) return;
    var containers = rec.querySelectorAll('.t-container');

    for (var i = 0; i < containers.length; i++) {
        var container = containers[i];
        var titles = container.querySelectorAll('.t404__title');
        var descrs = container.querySelectorAll('.t404__descr');
        var maxHeight = 0;

        for (var j = 0; j < titles.length; j++) {
            var title = titles[j];

            title.style.height = '';

            var titleStyle = getComputedStyle(title, null);
            var titlePaddingTop = parseInt(titleStyle.paddingTop) || 0;
            var titlePaddingBottom = parseInt(titleStyle.paddingBottom) || 0;
            var titleHeight = title.clientHeight - (titlePaddingTop + titlePaddingBottom);

            if (titleHeight > maxHeight) maxHeight = titleHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < titles.length; j++) {
                titles[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < titles.length; j++) {
                titles[j].style.height = 'auto';
            }
        }

        maxHeight = 0;

        for (var j = 0; j < descrs.length; j++) {
            var descr = descrs[j];

            descr.style.height = '';

            var descrStyle = getComputedStyle(descr, null);
            var descrPaddingTop = parseInt(descrStyle.paddingTop) || 0;
            var descrPaddingBottom = parseInt(descrStyle.paddingBottom) || 0;
            var descrHeight = descr.clientHeight - (descrPaddingTop + descrPaddingBottom);

            if (descrHeight > maxHeight) maxHeight = descrHeight;
            
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < descrs.length; j++) {
                descrs[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < descrs.length; j++) {
                descrs[j].style.height = 'auto';
            }
        }
    }
}

function t404_unifyHeightsTextwrapper(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var mainContainer = rec.querySelector('.t404');
    if (!mainContainer) return;
    var containers = rec.querySelectorAll('.t-container');

    for (var i = 0; i < containers.length; i++) {
        var container = containers[i];
        var textWrappers = container.querySelectorAll('.t404__textwrapper');
        var maxHeight = 0;

        for (var j = 0; j < textWrappers.length; j++) {
            var textWrapper = textWrappers[j];

            textWrapper.style.height = 'auto';

            var textWrapperStyle = getComputedStyle(textWrapper, null);
            var textWrapperPaddingTop = parseInt(textWrapperStyle.paddingTop) || 0;
            var textWrapperPaddingBottom = parseInt(textWrapperStyle.paddingBottom) || 0;
            var textWrapperHeight = textWrapper.clientHeight - (textWrapperPaddingTop + textWrapperPaddingBottom);

            if (textWrapperHeight > maxHeight) maxHeight = textWrapperHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < textWrappers.length; j++) {
                textWrappers[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < textWrappers.length; j++) {
                textWrappers[j].style.height = 'auto';
            }
        }
    }
}

function t404_showMore(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t404');
    if (!container) return;
    var cols = container.querySelectorAll('.t-col');
    var allRecords = document.getElementById('allrecords');

    for (var i = 0; i < cols.length; i++) {
        cols[i].style.display = 'none';
    }

    var cardsLength = cols.length;
    var cardsCount = parseInt(container.getAttribute('data-show-count'), 10);

    if (cardsCount > 500) cardsCount = 500;

    var startIndexShowBlock = cardsCount;
    var countShowBlock = cardsCount;
    var colsShow = t404__getShowBlocks(cols, startIndexShowBlock);
    
    for (var i = 0; i < colsShow.length; i++) {
        colsShow[i].style.display = 'block';
    }

    var showMoreBtn = rec.querySelector('.t404__showmore');

    if (showMoreBtn) {
        showMoreBtn.addEventListener('click', function() {
            startIndexShowBlock = (startIndexShowBlock + countShowBlock <= cardsLength) ? startIndexShowBlock + countShowBlock : cardsLength;
    
            var newColsShow = t404__getShowBlocks(cols, startIndexShowBlock);
            
            for (var i = 0; i < newColsShow.length; i++) {
                newColsShow[i].style.display = 'block';
            }
    
            if (startIndexShowBlock === cardsLength) {
                showMoreBtn.style.display = 'none';
            }

            t404__triggerEvent(container, 'displayChanged');
    
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function() {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t404__getShowBlocks(elements, index) {
    var newElements = [];

    for (var i = 0; i < elements.length; i++) {
        if (i <= index - 1) newElements.push(elements[i]);
    }

    return newElements;
}

function t404__triggerEvent(el, eventName) {
	var event;
	if (typeof window.CustomEvent === 'function') {
		event = new CustomEvent(eventName);
	} else if (document.createEvent) {
		event = document.createEvent('HTMLEvents');
		event.initEvent(eventName, true, false);
	} else if (document.createEventObject) {
		event = document.createEventObject();
		event.eventType = eventName;
	}

	event.eventName = eventName;

	if (el.dispatchEvent) {
		el.dispatchEvent(event);
	} else if (el.fireEvent) {
		el.fireEvent('on' + event.eventType, event);
	} else if (el[eventName]) {
		el[eventName]();
	} else if (el['on' + eventName]) {
		el['on' + eventName]();
	}

	if (t404__checkJqueryEvent(el, eventName)) {
		$(el).trigger(eventName);
	}
}

function t404__checkJqueryEvent(element, eventName) {
	var events = $._data(element, 'events') || false;
	var isEvent = false;

	if (events) {
		for (var key in events) {
			if (key === eventName) {
				isEvent = true;
				break;
			}
		}
	}

	return isEvent;
} 
function t405_showMore(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t405');
    if (!container) return;
    var cols = container.querySelectorAll('.t-col');
    var allRecords = document.getElementById('allrecords');

    for (var i = 0; i < cols.length; i++) {
        cols[i].style.display = 'none';
    }

    var cardsLength = cols.length;
    var cardsCount = parseInt(container.getAttribute('data-show-count'), 10);

    if (cardsCount > 500) cardsCount = 500;

    var startIndexShowBlock = cardsCount;
    var countShowBlock = cardsCount;
    var colsShow = t405__getShowBlocks(cols, startIndexShowBlock);
    
    for (var i = 0; i < colsShow.length; i++) {
        colsShow[i].style.display = 'block';
    }

    var showMoreBtn = rec.querySelector('.t405__showmore');

    if (showMoreBtn) {
        showMoreBtn.addEventListener('click', function() {
            startIndexShowBlock = (startIndexShowBlock + countShowBlock <= cardsLength) ? startIndexShowBlock + countShowBlock : cardsLength;
    
            var newColsShow = t405__getShowBlocks(cols, startIndexShowBlock);
            
            for (var i = 0; i < newColsShow.length; i++) {
                newColsShow[i].style.display = 'block';
            }
    
            if (startIndexShowBlock === cardsLength) {
                showMoreBtn.style.display = 'none';
            }

            t405__triggerEvent(container, 'displayChanged');
    
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function() {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t405__getShowBlocks(elements, index) {
    var newElements = [];

    for (var i = 0; i < elements.length; i++) {
        if (i <= index - 1) newElements.push(elements[i]);
    }

    return newElements;
}

function t405__triggerEvent(el, eventName) {
	var event;
	if (typeof window.CustomEvent === 'function') {
		event = new CustomEvent(eventName);
	} else if (document.createEvent) {
		event = document.createEvent('HTMLEvents');
		event.initEvent(eventName, true, false);
	} else if (document.createEventObject) {
		event = document.createEventObject();
		event.eventType = eventName;
	}

	event.eventName = eventName;

	if (el.dispatchEvent) {
		el.dispatchEvent(event);
	} else if (el.fireEvent) {
		el.fireEvent('on' + event.eventType, event);
	} else if (el[eventName]) {
		el[eventName]();
	} else if (el['on' + eventName]) {
		el['on' + eventName]();
	}

	if (t405__checkJqueryEvent(el, eventName)) {
		$(el).trigger(eventName);
	}
}

function t405__checkJqueryEvent(element, eventName) {
	var events = $._data(element, 'events') || false;
	var isEvent = false;

	if (events) {
		for (var key in events) {
			if (key === eventName) {
				isEvent = true;
				break;
			}
		}
	}

	return isEvent;
} 
function t409_unifyHeights(recid) {
  if($(window).width()>=960){
    var el = $("#rec"+recid);
    var imgwidth = el.find(".t409__img").width();
    var imgwrapperwidth = el.find(".t409__imgwrapper").css("max-width");
    var imgwrapperwidthpx = parseInt(imgwrapperwidth, 10);
    var margin = imgwrapperwidthpx - imgwidth;
    el.find(".t409__img").css("margin-left", margin);
  }
}
 
function t410_init(recid) {
	var rec = document.getElementById('rec' + recid);
	var wrapper = rec ? rec.querySelector('.t410__wrapper') : null;
	if (!wrapper) return false;
	var firstImgURL = wrapper.getAttribute('data-juxtapose-imgurl-first');
	var firstImgDescr = wrapper.getAttribute('data-juxtapose-imgdescr-first');
	var firstImgAlt = wrapper.getAttribute('data-juxtapose-imgalt-first');
	var secondImgURL = wrapper.getAttribute('data-juxtapose-imgurl-second');
	var secondImgDescr = wrapper.getAttribute('data-juxtapose-imgdescr-second');
	var secondImgAlt = wrapper.getAttribute('data-juxtapose-imgalt-second');
	
	t410_onObjLoad('juxtapose', function () {
		new juxtapose.JXSlider('#t410-juxtapose__' + recid, [{
			src: firstImgURL,
			label: firstImgDescr,
		}, {
			src: secondImgURL,
			label: secondImgDescr,
		}], {
			animate: false,
			showLabels: true,
			showCredits: false,
			startingPosition: '50%',
			makeResponsive: true,
			callback: function () {
				
				if (firstImgAlt) {
					var imgLeft = rec.querySelector('.t410__wrapper .jx-image.jx-left img');
					if (imgLeft) imgLeft.alt = firstImgAlt;
				}
				
				if (secondImgAlt) {
					var imgRight = rec.querySelector('.t410__wrapper .jx-image.jx-right img');
					if (imgRight) imgRight.alt = secondImgAlt;
				}
				
				if (window.isMobile) {
					var leftBlock = document.createElement('div');
					leftBlock.classList.add('t410__mobile_left');
					var rightBlock = document.createElement('div');
					rightBlock.classList.add('t410__mobile_right');
					
					wrapper.insertAdjacentElement('beforeend', leftBlock);
					wrapper.insertAdjacentElement('beforeend', rightBlock);
					
					var handler = rec.querySelector('.jx-handle');
					var handlerWidth = handler ? handler.offsetWidth : 0;
					var leftSize = rec.querySelector('.jx-image.jx-left');
					var rightSize = rec.querySelector('.jx-image.jx-right');
					var leftSizeWidth = leftSize ? leftSize.offsetWidth : 0;
					var rightSizeWidth = rightSize ? rightSize.offsetWidth : 0;
					var halfHandlerWidth = handlerWidth / 2;
					var leftWidth = halfHandlerWidth > leftSizeWidth ? 0 : leftSizeWidth - halfHandlerWidth;
					var rightWidth = halfHandlerWidth > rightSizeWidth ? 0 : rightSizeWidth - halfHandlerWidth;
					
					var mobileLeft = rec.querySelector('.t410__mobile_left');
					var mobileRight = rec.querySelector('.t410__mobile_right');
					
					if (mobileLeft) mobileLeft.style.width = leftWidth + 'px';
					if (mobileRight) mobileRight.style.width = rightWidth + 'px';
					
					wrapper.addEventListener('touchend', function () {
						leftSizeWidth = leftSize ? leftSize.offsetWidth : 0;
						rightSizeWidth = rightSize ? rightSize.offsetWidth : 0;
						
						leftWidth = halfHandlerWidth > leftSizeWidth ? 0 : leftSizeWidth - halfHandlerWidth;
						rightWidth = halfHandlerWidth > rightSizeWidth ? 0 : rightSizeWidth - halfHandlerWidth;
						
						if (mobileLeft) mobileLeft.style.width = leftWidth + 'px';
						if (mobileRight) mobileRight.style.width = rightWidth + 'px';
					});
				}
			},
		});
	});
	
	var block = rec.querySelector('.t410');
	if (typeof jQuery !== 'undefined') {
		$(block).on('displayChanged', function () {
			window.juxtapose.sliders.forEach(function (obj) {
				if (obj.selector === '#t410-juxtapose__' + recid) {
					console.log(obj);
					obj.setWrapperDimensions();
				}
			});
		});
	} else {
		if (block) {
			block.addEventListener('displayChanged', function () {
				window.juxtapose.sliders.forEach(function (obj) {
					if (obj.selector === '#t410-juxtapose__' + recid) {
						console.log(obj);
						obj.setWrapperDimensions();
					}
				});
			});
		}
	}
}

function t410_onObjLoad(objName, okFunc, time) {
	if (typeof window[objName] === 'object') {
		okFunc();
	} else {
		var timerId = setTimeout(function checkFuncExist() {
			if (typeof window[objName] === 'object') {
				okFunc();
				return;
			}
			timerId = setTimeout(checkFuncExist, time || 100);
		});
	}
} 
function t412_init(recid) {
  var rec = $('#rec' + recid);
  if (rec.find('a[href^="#order"]')) {
    rec.find('a[href^="#order"]').on('click', function(e) {
      var $linkelem = $(this);
      var $jspaybox = $('.js-payment-systembox');

      t412_setCoordinateToPaymentBox(e, $linkelem, $jspaybox);
      $jspaybox.css('margin-top', '0');
      $jspaybox.css('margin-left', '0');

      $(window).resize(function() {
        if ($jspaybox.css('display') == 'block' && $linkelem) {
          t412_setCoordinateToPaymentBox(e, $linkelem, $jspaybox);
        }
      });
    });
  }
}


function t412_setCoordinateToPaymentBox(event, $linkelem, $jspaybox) {
  var oldTopCoord = 0;
  var newTopCoord = 0;
  var offset = $linkelem.offset();

  var top = offset.top + $linkelem.parents('.t412__col').height() - $jspaybox.height();
  var left = offset.left + $linkelem.parents('.t412__col').width()/2 - $jspaybox.width()/2;

  oldTopCoord = $jspaybox.css('top');

  $jspaybox.css('top', top + 'px');
  $jspaybox.css('left', left + 'px');

  newTopCoord = $jspaybox.css('top');

  if (parseInt(oldTopCoord) - parseInt(newTopCoord) == 21) {
    $jspaybox.css('top', (top+21) + 'px');
  }
}


function t412_unifyHeights(recid) {
    var el=$("#rec"+recid);

    el.find('.t412__descr').css('height', "auto");  
    $('#rec'+recid+' .t412 .t-container').each(function() {
        var highestBox2 = 0;
        $('.t412__descr', this).each(function(){
            if($(this).height() > highestBox2)highestBox2 = $(this).height(); 
        });  
        if($(window).width()>=960 && $(this).is(':visible')){
        	$('.t412__descr',this).css('height', highestBox2); 
        }else{
	        $('.t412__descr',this).css('height', "auto");    
        }
    });

    el.find('.t412__title').css('height', "auto");
    $('#rec'+recid+' .t412 .t-container').each(function() {
        var highestBox3 = 0;
        $('.t412__title', this).each(function(){
            if($(this).height() > highestBox3)highestBox3 = $(this).height(); 
        });  
        if($(window).width()>=960 && $(this).is(':visible')){
        	$('.t412__title',this).css('height', highestBox3); 
        }else{
	        $('.t412__title',this).css('height', "auto");    
        }
    });

    el.find('.t412__wrapper').css('height', "auto");
    $('#rec'+recid+' .t412 .t-container').each(function() {
        var highestBox = 0;
        $('.t412__wrapper', this).each(function(){
            if($(this).height() > highestBox)highestBox = $(this).height();
        });  
        if($(window).width()>=960 && $(this).is(':visible')){
        	$('.t412__wrapper',this).css('height', highestBox); 
        }else{
	        $('.t412__wrapper',this).css('height', "auto");    
        }
    });
} 
function t414_showPopup(recid){
  var el=$('#rec'+recid).find('.t414');
  $('body').addClass('t414__body_popupshowed');
  el.show();
  el.find('.t414__close, .t414__bg, .t414__closer').click(function(){
    t414_closePopup(recid);
  });
  $(document).keydown(function(e) {
    if (e.keyCode == 27) {
      $('body').removeClass('t414__body_popupshowed');
      $('.t414').hide();
    }
  });
}

function t414_closePopup(recid){
  $('body').removeClass('t414__body_popupshowed');
  $('.t414').hide();
}

function t414_initPopup(recid){
  var el=$('#rec'+recid).find('.t414');
  var hook=el.attr('data-tooltip-hook');
  if(hook!==''){
      var obj = $('a[href="'+hook+'"]');
      obj.click(function(e){
        t414_showPopup(recid);
        var popup = el.find(".t414__content");
        popup.addClass('t414__content_static');
        e.preventDefault();
      });
  }
}

function t414_resizePopup(recid){
  var el = $("#rec"+recid);
  var div = el.find(".t414__mainblock").height();
  var win = $(window).height();
  var popup = el.find(".t414__content");
  if (div > win ) {
    popup.addClass('t414__content_static');
  }
  else {
    popup.removeClass('t414__content_static');
  }
} 
function t418_init(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var container = rec.querySelector('.t418__slidecontainer');
	if (!container) return false;
	var slides = rec.querySelectorAll('.t418__item');
	var sliderWidth = slides[0] ? slides[0].offsetWidth : 0;
	
	var allRecords = document.getElementById('allrecords');
	var lazyMode = allRecords ? allRecords.getAttribute('data-tilda-lazy') : null;
	var isLazy = lazyMode === 'yes';
	
	t418_checkSize(rec, slides);
	container.style.width = (sliderWidth * slides.length) + 'px';
	
	window.addEventListener('resize', t_throttle(function () {
		t418_checkSize(rec, slides);
		sliderWidth = slides[0] ? slides[0].offsetWidth : 0;
		container.style.width = (sliderWidth * slides.length) + 'px';
		
		var transformValue = window.getComputedStyle(container).getPropertyValue('transform');
		var matrix = transformValue.replace(/[^0-9\-.,]/g, '').split(',');
		var x = matrix[12] || matrix[4];
		
		if (-((slides.length - 1) * sliderWidth) > x) {
			container.style.transform = 'translate(-' + (slides.length - 1) * sliderWidth + 'px, 0)';
		}
	}));
	
	if (typeof jQuery !== 'undefined') {
		$(rec).find('.t418').bind('displayChanged', function () {
			sliderWidth = slides[0] ? window.getComputedStyle(slides[0]).maxWidth : 0;
			container.style.width = (parseInt(sliderWidth, 10) * slides.length) + 'px';
			t418_checkSize(rec, slides);
		});
	} else {
		var currentBlock = rec.querySelector('.t418');
		if (currentBlock) {
			currentBlock.addEventListener('displayChanged', function () {
				sliderWidth = slides[0] ? window.getComputedStyle(slides[0]).maxWidth : 0;
				container.style.width = (parseInt(sliderWidth, 10) * slides.length) + 'px';
				t418_checkSize(rec, slides);
			});
		}
	}
	
	var nextBtn = rec.querySelector('.t418__next');
	if (nextBtn) {
		nextBtn.addEventListener('click', function () {
			t418_slideRight(container, slides, isLazy);
		});
	}
	
	var prevBtn = rec.querySelector('.t418__previous');
	if (prevBtn) {
		prevBtn.addEventListener('click', function () {
			t418_slideLeft(container, slides, isLazy);
		});
	}
}

function t418_slideLeft(container, slides, isLazy) {
	var sliderWidth = slides[0] ? slides[0].offsetWidth : 0;
	var sliderPos = container.getAttribute('data-slide-pos');
	var sliderPosValue = parseInt(sliderPos, 10);
	container.setAttribute('data-slide-pos', --sliderPosValue);
	
	if (sliderPosValue <= -1) {
		sliderPosValue = slides.length - 1;
		container.setAttribute('data-slide-pos', sliderPosValue);
	}
	container.style.transform = 'translate(-' + (sliderWidth * sliderPosValue) + 'px, 0)';
	container.style.transitionDuration = '.3s';
	
	if (window.lazy === 'y' || isLazy) {
		t_onFuncLoad('t_lazyload_update', function () {
			t_lazyload_update();
		});
	}
}

function t418_slideRight(container, slides, isLazy) {
	var sliderWidth = slides[0] ? slides[0].offsetWidth : 0;
	var sliderPos = container.getAttribute('data-slide-pos');
	var sliderPosValue = parseInt(sliderPos, 10);
	container.setAttribute('data-slide-pos', ++sliderPosValue);
	
	if (sliderPosValue >= slides.length) {
		sliderPosValue = 0;
		container.setAttribute('data-slide-pos', sliderPosValue);
	}
	container.style.transform = 'translate(-' + (sliderWidth * sliderPosValue) + 'px, 0)';
	container.style.transitionDuration = '.3s';
	
	if (window.lazy === 'y' || isLazy) {
		t_onFuncLoad('t_lazyload_update', function () {
			t_lazyload_update();
		});
	}
}

function t418_checkSize(rec, slides) {
	var sizer = rec.querySelector('.t418__height');
	var galleryWrapper = rec.querySelector('.t418__slider');
	var sizerWidth = sizer ? sizer.offsetWidth : 0;
	var sizerHeight = sizer ? sizer.offsetHeight : 0;
	var sizerRatio = sizerWidth / sizerHeight;
	var galleryWrapperWidth = galleryWrapper ? galleryWrapper.offsetWidth : 0;
	
	if (galleryWrapper) galleryWrapper.style.height = (galleryWrapperWidth / sizerRatio) + 'px';
	
	sizer = rec.querySelector('.t418__height');
	var maxWidth = sizer ? sizer.offsetWidth : 0;
	
	Array.prototype.forEach.call(slides, function (slide) {
		var img = slide.querySelector('.t418__img');
		if (maxWidth > window.innerWidth) {
			slide.style.maxWidth = (window.innerWidth - 80) + 'px';
			img.style.left = '20px';
			img.style.right = '20px';
		} else {
			slide.style.maxWidth = '';
			img.style.left = '';
			img.style.right = '';
		}
	});
} 
t422_setHeight = function(recid) {
  if ($(window).width()>960) {
    t422_checkEqualHeight(recid);
  } else {
    $('#rec'+recid+' .t422__img-mobile').height(200);
    $('#rec'+recid+' .t422__text').height('auto');
  }
};

t422_checkEqualHeight = function(recid) {
  var t422__txtel=$('#rec'+recid+' .t422__text');
  var t422__imgel=$('#rec'+recid+' .t422__img');
  var t422__textwrapperel = $('#rec'+recid+' .t422__textwrapper');
  var t422__borderwidth = 0;
  if (t422__txtel.css("border-top-width") && t422__txtel.css("border-top-width")[1]!='p') {
    t422__borderwidth = + (t422__txtel.css("border-top-width")[0] + t422__txtel.css('border-top-width')[1]);
  }else{if (t422__txtel.css("border-top-width"))
    	t422__borderwidth = +(t422__txtel.css("border-top-width")[0]);
  }
  /* if (t422__imgel.height() < (t422__txtel.height() + t422__borderwidth*2)) {
      t422__imgel.height(t422__txtel.height() + t422__borderwidth*2);
  }else{if ((t422__imgel.height() - t422__borderwidth*2) > t422__txtel.height()) {
        t422__txtel.height(t422__imgel.height() - t422__borderwidth*2);
    }
  } */
  if (t422__imgel.height() < (t422__textwrapperel.outerHeight() + t422__borderwidth*2)) {
      t422__imgel.height(t422__textwrapperel.outerHeight() + t422__borderwidth*2);
  }else{if ((t422__imgel.height() - t422__borderwidth*2) > t422__textwrapperel.outerHeight()) {
        t422__textwrapperel.outerHeight(t422__imgel.height() - t422__borderwidth*2);
    }
  }
}; 
function t425_unifyHeights(recid) {
    var el=$("#rec"+recid);

    el.find('.t425__col').css('height', "auto");
    $('#rec'+recid+' .t425 .t-container').each(function() {
        var t425__highestBox = 0;
        $('.t425__col', this).each(function(){						
			var t425__curcol=$(this);	
			var t425__curcolchild=t425__curcol.find('.t425__col-wrapper');
			if(t425__curcol.height() < t425__curcolchild.height())t425__curcol.height(t425__curcolchild.height());
            if(t425__curcol.height() > t425__highestBox)t425__highestBox = t425__curcol.height();			
        });  
        if($(window).width()>=960){
        	$('.t425__col',this).css('height', t425__highestBox); 
        }else{
	        $('.t425__col',this).css('height', "auto");    
        }
    });
}; 
function t426_unifyHeights(recid) {  
	$('#rec'+recid+' .t426 .t-container').each(function() {        		
        var t426__largestHeight = 0;
        $('.t426__col', this).each(function(){                
        	var t426__curimg=$(this).find('img');		
        	if(t426__curimg.height() > t426__largestHeight)t426__largestHeight = t426__curimg.height();        
        });            
        $('.t426__col', this).each(function(){        	
        	$(this).height(t426__largestHeight);
        });        
	});
};
 
t427_alignMiddle = function(recid) {
	if ($(window).width()>960) {
		var t427__img = $('#rec'+recid+' .t427__img');
		var t427__arrow = $('#rec'+recid+' .t427__arrow');		
		t427__arrow.css('top', (t427__img.height()-t427__arrow.height())/2);
	}
}; 
function t428_unifyHeights(recid) {
    $('#rec'+recid+' .t428 .t-container').each(function() {
        var t428__highestBox = 0;
        $('.t428__col', this).each(function(){
			var t428__curcol=$(this);
			var t428__curcolchild=t428__curcol.find('.t428__col-wrapper');
			if(t428__curcol.height() < t428__curcolchild.height())t428__curcol.height(t428__curcolchild.height());
            if(t428__curcol.height() > t428__highestBox)t428__highestBox = t428__curcol.height();
        });
        if($(window).width()>=960){
        	$('.t428__col',this).css('height', t428__highestBox);
        }else{
	        $('.t428__col',this).css('height', "auto");
        }
    });
}; 
function t431_init(recId) {
    var table = document.querySelector('#rec' + recId + ' .t431 .t431__table');
    if (!table) return;
    var dataPart1 = document.querySelector('#rec' + recId + ' .t431 .t431__data-part1');
    var dataPart2 = document.querySelector('#rec' + recId + ' .t431 .t431__data-part2');
    var tableHead = t431__escapeHTML(dataPart1 && dataPart1.innerHTML || '');
    var tableBody = t431__escapeHTML(dataPart2 && dataPart2.innerHTML || '');
    var tableColSize = table.getAttribute('data-table-width');
    var hasTargetBlank = table.getAttribute('data-target-blank');
    var tHead = t431_parseData(tableHead);
    var tBody = t431_parseData(tableBody);
    var colSize = t431_parseData(tableColSize);
    var maxColNum = t431__findMaxRowLengthInTable(tHead, tBody);
    var colWidth = t431__setColumnsWidth(colSize, maxColNum, recId);
    var html = '';

    if (tHead) {
        html += t431__generateTable(tHead, 'th', hasTargetBlank, colWidth, maxColNum);
    }
    if (tBody) {
        html += t431__generateTable(tBody, 'td', hasTargetBlank, colWidth, maxColNum);
    }
    table.insertAdjacentHTML('beforeend', html);
}

function t431__findMaxRowLengthInTable(arrayHead, arrayData) {
    var headMaxLength = 0;
    var dataMaxLength = 0;
    if (arrayHead) {
        headMaxLength = t431__findMaxRowLengInArray(arrayHead);
    }
    if (arrayData) {
        dataMaxLength = t431__findMaxRowLengInArray(arrayData);
    }
    if (dataMaxLength > headMaxLength) {
        return dataMaxLength;
    } else {
        return headMaxLength;
    }
}

function t431__escapeHTML(string) {
    var html = string.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&nbsp;/g, ' ');
    var result = '';
    var allowedTags = '';
    ['b', 'i', 'u', 'ul', 'li', 'ol', 'br', 'img', 's', 'sub', 'sup', 'span', 'hr', 'pre', 'code', 'mark', 'strong', 'small'].forEach(function (value) {
        allowedTags += ':not(' + value + ')';
    });
    var allowedAttrs = ['alt', 'class', 'title', 'id', 'src', 'style', 'width', 'height', 'data-replace-key'];
    var parseHTML = function (str) {
        var fakeDOM = document.implementation.createHTMLDocument('fake');
        fakeDOM.body.innerHTML = str;
        return fakeDOM.body.childNodes;
    };
    var createdStructure;
    if (parseHTML(html)) {
        createdStructure = parseHTML(html);
    } else {
        createdStructure = [];
    }
    for (var i = 0; i < createdStructure.length; i++) {
        var element = createdStructure[i];
        if (element !== allowedTags) {
            if (element.nodeType !== 3 && element.nodeType !== 8) {
                var temp = document.createElement(element.tagName);
                allowedAttrs.forEach(function (value) {
                    if (element.getAttribute(value) !== null) {
                        temp.setAttribute(value, element.getAttribute(value).replace(/javascript:/gi, ''));
                    }
                });
                temp.textContent = element.textContent;
                result += temp.outerHTML;
            } else {
                result += element.textContent;
            }
        }
    }
    return result;
}

function t431__findMaxRowLengInArray(currentArray) {
    var maxLength = 0;
    for (var i = 0; i < currentArray.length; i++) {
        if (currentArray[i].length > maxLength) {
            maxLength = currentArray[i].length;
        }
    }
    return maxLength;
}

function t431__setColumnsWidth(colWidth, colsNumber, recId) {
    if (colWidth) {
        return colWidth[0];
    } else {
        var tableWidth = document.querySelector('#rec' + recId + ' .t431 .t-container .t-col');
        var computedWidth = parseFloat(getComputedStyle(tableWidth, null).width.replace('px', ''));
        return (computedWidth / colsNumber + 'px');
    }
}

function t431__generateTable(arrayValues, colTag, hasTargetBlank, colWidth, maxColNumber) {
    var html = '';
    var tag = '';
    if (colTag == 'td') {
        tag = 'tbody';
    } else {
        tag = 'thead';
    }
    html += '<' + tag + ' class="t431__' + tag + '">';
    for (var i = 0; i < arrayValues.length; i++) {
        /*add classes for striped table*/
        if (colTag == 'td') {
            if ((i + 1) % 2 > 0) {
                html += '<tr class="t431__oddrow">';
            } else {
                html += '<tr class="t431__evenrow">';
            }
        } else {
            html += '<tr>';
        }
        var addingCols = 0;
        if (arrayValues[i].length < maxColNumber) {
            addingCols = maxColNumber - arrayValues[i].length;
        }
        for (var j = 0; j < (arrayValues[i].length + addingCols); j++) {
            if (arrayValues[i][j]) {
                /*define col width*/
                var currentWidth = '';
                if (Array.isArray(colWidth) && colWidth[j]) {
                    currentWidth = colWidth[j].myText;
                } else {
                    currentWidth = colWidth;
                }
                var colWithAttr = '';
                if (colTag == 'td') {
                    colWithAttr = '<td class="t431__td t-text" width="' + currentWidth + '">';
                } else {
                    colWithAttr = '<th class="t431__th t-title" width="' + currentWidth + '">';
                }
                if (arrayValues[i][j].myHref) {
                    var targetBlank = '';
                    if (hasTargetBlank) {
                        targetBlank = 'target="_blank"';
                    }
                     /*define link type*/
                    var linkWithAttr = '';
                    var linkCloseTag = '';
                    if (arrayValues[i][j].myHrefType == 'link') {
                        linkWithAttr = '<a href="' + arrayValues[i][j].myHref + '"' + targetBlank + '>';
                        linkCloseTag = '</a>';
                    } else {
                        linkWithAttr = '<div class="t431__btnwrapper"><a href="' + arrayValues[i][j].myHref + '"' + targetBlank + ' class="t-btn t-btn_sm"><table style="width:100%; height:100%"><tr><td>';
                        linkCloseTag = '</td></tr></table></a></div>';
                    }
                    html += colWithAttr + linkWithAttr + arrayValues[i][j].myText + linkCloseTag + '</' + colTag + '>';
                } else {
                    html += colWithAttr + arrayValues[i][j].myText + '</' + colTag + '>';
                }
            } else {
                html += '<' + colTag + ' class="t431__' + colTag + '" width="' + currentWidth + '">' + '</' + colTag + '>';
            }
        }
        html += '</tr>';
    }
    html += '</' + tag + '>';
    return html;
}

function t431_parseData(data) {
    if (data !== '' && typeof data != 'undefined') {
        data = t431__addBrTag(data);
        var arrayTable = [];
        var arrayRow = [];
        var currentItem = {
            myText: '',
            myHref: '',
            myHrefType: ''
        };
        var hasLink = '';
        var hasLinkWithSpace = '';
        var hasButton = '';
        var hasButtonWithSpace = '';
        var endLine = '';
        for (var i = 0; i < data.length; i++) {
            /*col end and check of special symbols: «>», «<», «&&#187; and « »*/
            if (data[i] == ';' && !(data.slice(i - 4, i) == '&lt;' || data.slice(i - 4, i) == '&gt;' || data.slice(i - 5, i) == '&amp;' || data.slice(i - 6, i) == '&nbsp;')) {
                arrayRow.push(currentItem);
                currentItem = {
                    myText: '',
                    myHref: ''
                };
                hasLink = '';
                hasLinkWithSpace = '';
                hasButton = '';
                hasButtonWithSpace = '';
            } else {
                if (hasLink == 'link=' || hasLinkWithSpace == ' link=' || hasButton == 'button=' || hasButtonWithSpace == ' button=') {
                    if (currentItem.myHref === '' && hasLink === 'link=') {
                        currentItem.myText = currentItem.myText.slice(0, -5);
                        currentItem.myHrefType = 'link';
                    } else if (currentItem.myHref === '' && hasLinkWithSpace === ' link=') {
                        currentItem.myText = currentItem.myText.slice(0, -6);
                        currentItem.myHrefType = 'link';
                    } else if (currentItem.myHref === '' && hasButton === 'button=') {
                        currentItem.myText = currentItem.myText.slice(0, -7);
                        currentItem.myHrefType = 'btn';
                    } else if (currentItem.myHref === '' && hasButtonWithSpace === ' button=') {
                        currentItem.myText = currentItem.myText.slice(0, -8);
                        currentItem.myHrefType = 'btn';
                    }
                    currentItem.myHref += (data[i]);
                } else {
                    currentItem.myText += (data[i]);
                    hasLink = t431__checkSubstr('link=', hasLink, data[i]);
                    hasLinkWithSpace = t431__checkSubstr(' link=', hasLinkWithSpace, data[i]);
                    hasButton = t431__checkSubstr('button=', hasButton, data[i]);
                    hasButtonWithSpace = t431__checkSubstr(' button=', hasButtonWithSpace, data[i]);
                }
                endLine = t431__checkSubstr('<br />', endLine, data[i]);
                if (endLine == '<br />') {
                    if (currentItem.myHref) {
                        currentItem.myHref = currentItem.myHref.slice(0, -6);
                    } else {
                        currentItem.myText = currentItem.myText.slice(0, -6);
                    }
                    arrayRow.push(currentItem);
                    arrayTable.push(arrayRow);
                    currentItem = {
                        myText: '',
                        myHref: ''
                    };
                    hasLink = '';
                    hasLinkWithSpace = '';
                    hasButton = '';
                    hasButtonWithSpace = '';
                    arrayRow = [];
                }
            }
        }
        if (arrayRow.length > 0 || currentItem.myText !== '') {
            if (currentItem !== '') {
                arrayRow.push(currentItem);
            }
            arrayTable.push(arrayRow);
        }
    }
    return arrayTable;
}

/* checking a step by step combining of t431__targetSubstr*/
function t431__checkSubstr(targetSubstr, currentSubstr, curSymbol) {
    if (!currentSubstr && curSymbol == targetSubstr[0]) {
        return curSymbol;
    } else if (currentSubstr) {
        for (var i = 0; i < (targetSubstr.length - 1); i++) {
            if (currentSubstr[currentSubstr.length - 1] == targetSubstr[i] && curSymbol == targetSubstr[i + 1]) {
                return (currentSubstr += curSymbol);
            }
        }
    }
}

function t431__addBrTag(oldStringItem) {
    var newStringItem = '';
    if (oldStringItem) {
        for (var i = 0; i < oldStringItem.length; i++) {
            if (oldStringItem[i] == '\n' || oldStringItem[i] == '\r') {
                newStringItem += '<br />';
            } else {
                newStringItem += oldStringItem[i];
            }
        }
    }
    return newStringItem.replace(/&nbsp;/g, ' ');
}

/* backward compatibility. todo: delete t431_createTable */
function t431_createTable(recId, tableHead, tableData, tableColSize, hasTargetBlank, buttonStyles, tdStyles, thStyles, oddRowStyles, evenRowStyles) {
    var arrayColSize = t431_parseData(tableColSize);
    var tableArrayHead = t431_parseData(tableHead);
    var tableArrayData = t431_parseData(tableData);
    var tableMaxColNumber = t431__findMaxRowLengthInTable(tableArrayHead, tableArrayData);
    var tableColWidth = t431__setColumnsWidth(arrayColSize, tableMaxColNumber, recId);
    if (tableColWidth[0].myText && tableColWidth[0].myText[tableColWidth[0].myText.length - 1] == '%') {
        for (var i = 0; i < tableColWidth.length; i++) {
            tableColWidth[i].myText = tableColWidth[i].myText.slice(0, -1);
            tableColWidth[i].myText += 'vw';
        }
    }
    var tableContainer = document.querySelector('#rec' + recId + ' .t431 .t-container .t431__table');
    var tableHTML = '';
    if (tableArrayHead) {
        tableHTML += t431__generateHtml(recId, tableArrayHead, 'th', hasTargetBlank, tableColWidth, buttonStyles, thStyles, null, null, tableMaxColNumber);
    }
    tableContainer.insertAdjacentHTML('afterbegin', tableHTML);
    tableHTML = '';
    if (tableArrayData) {
        tableHTML += t431__generateHtml(recId, tableArrayData, 'td', hasTargetBlank, tableColWidth, buttonStyles, tdStyles, oddRowStyles, evenRowStyles, tableMaxColNumber);
    }
    tableContainer.insertAdjacentHTML('afterbegin', tableHTML);
}

/* backward compatibility. todo: delete t431__generateHtml */
function t431__generateHtml(recId, arrayValues, colTag, hasTargetBlank, colWidth, buttonStyles, colstyles, oddRowStyles, evenRowStyles, maxcolnumber) {
    var partHTML = '';
    var headOrBodyTag;
    if (colTag == 'td') {
        headOrBodyTag = 'tbody';
    } else {
        headOrBodyTag = 'thead';
    }
    partHTML += '<' + headOrBodyTag + ' class="t431__' + headOrBodyTag + '">';
    var firstBodyRowStyle = '';

    /*remove first body row top border, if table head has bottom border*/
    if (document.querySelector('#rec' + recId + ' .t431 .t-container .t431__thead th').length > 0 && document.querySelector('#rec' + recId + ' .t431 .t-container .t431__thead th').style.borderBottomWidth != '0') {
        firstBodyRowStyle = 'border-top: 0 !important;';
    }
    for (var i = 0; i < arrayValues.length; i++) {
        /*add classes for striped table*/
        if (colTag == 'td') {
            if ((i + 1) % 2 > 0) {
                partHTML += '<tr class="t431__oddrow"' + 'style="' + oddRowStyles + '">';
            } else {
                partHTML += '<tr class="t431__evenrow"' + 'style="' + evenRowStyles + '">';
            }
        } else {
            partHTML += '<tr>';
        }
        var htmlAddingCols = 0;
        if (arrayValues[i].length < maxcolnumber) {
            htmlAddingCols = maxcolnumber - arrayValues[i].length;
        }
        for (var j = 0; j < (arrayValues[i].length + htmlAddingCols); j++) {
            if (arrayValues[i][j]) {
                /*define col width*/
                var currentWidthHTML;
                if (Array.isArray(colWidth) && colWidth[j]) {
                    currentWidthHTML = colWidth[j].myText;
                } else {
                    currentWidthHTML = colWidth;
                }
                 var colWithAttrHTML;
                if (i == 0 && colTag == 'td') {
                    colWithAttrHTML = '<' + colTag + ' class="t431__' + colTag + '" style="width:' + currentWidthHTML + ';' + colstyles + firstBodyRowStyle + '">';
                } else {
                    colWithAttrHTML = '<' + colTag + ' class="t431__' + colTag + '" style="width:' + currentWidthHTML + ';' + colstyles + '">';
                }
                if (arrayValues[i][j].myHref) {
                    var targetBlankHTML = '';
                    if (hasTargetBlank) {
                        var targetBlankHTML = 'target="_blank"';
                    }
                    var linkWithAttrHTML;
                    var linkCloseTagHTML;
                    /*define link type*/
                    if (arrayValues[i][j].myHrefType == 'link') {
                        linkWithAttrHTML = '<a href="' + arrayValues[i][j].myHref + '"' + targetBlankHTML + '>';
                        linkCloseTagHTML = '</a>';
                    } else {
                        linkWithAttrHTML = '<div class="t431__btnwrapper"><a href="' + arrayValues[i][j].myHref + '"' + targetBlankHTML + ' class="t-btn t-btn_sm" style="' + buttonStyles + '"><table style="width:100%; height:100%;"><tr><td>';
                        linkCloseTagHTML = '</td></tr></table></a></div>';
                    }
                    partHTML += colWithAttrHTML + linkWithAttrHTML + arrayValues[i][j].myText + linkCloseTagHTML + '</' + colTag + '>';
                } else {
                    partHTML += colWithAttrHTML + arrayValues[i][j].myText + '</' + colTag + '>';
                }
            } else {
                partHTML += '<' + colTag + ' class="t431__' + colTag + '" style="width:' + currentWidthHTML + ';' + colstyles + '">' + '</' + colTag + '>';
            }
        }
        partHTML += '</tr>';
    }
    partHTML += '</' + headOrBodyTag + '>';
    return partHTML;
} 
function t433_init(recid) {
    var el = $('#rec' + recid);
    $('#separateMap' + recid).css("height", "auto");
    t433_setMapHeight(recid);

    el.find('.t433').bind('displayChanged', function () {
        t433_setMapHeight(recid);
    });

    $(window).bind('resize', t_throttle(function () {
        t433_setMapHeight(recid);
    }));
}


function t433_setMapHeight(recid) {
    var el = $('#rec' + recid);
    var map = el.find('.t433__map');
    var textwrapper = el.find('.t433__col_text').height();
    map.css('height', textwrapper);
    el.find('.t-map').css('height', textwrapper).trigger('sizechange');
} 
function t441__createPieChart(recid,data1,data2,data3,data4,sectorcolor,piebgcolor,bgcolor,blocksnumber,diagramwidth,diameter) {		
	if(diameter>300 || diameter=="" || diameter<100) {
		if(diameter=="") {var t441__radius = 100; diameter = 200;}
		if(diameter>300) {var t441__radius = 150; diameter = 300;}
        if(diameter<100) {var t441__radius = 50; diameter = 100;}
	} else {
		var t441__radius = diameter/2;
	}

	if(diagramwidth=="") { diagramwidth = 10;}
    if(diagramwidth>t441__radius) { diagramwidth = 10;}
	if(diagramwidth<1) { diagramwidth = 1;}
	                    
	//check Retina
	if(window.devicePixelRatio >= 2) {
		var t441__oldsize = diameter;                       
        t441__radius = t441__radius*2;
		diameter = diameter*2;
		diagramwidth = diagramwidth*2;
	}                       
                       
	//border id drawing at the edge of circle, so we need correct the radius to fin into canvas                        
	var t441__correction = +diagramwidth/2;

    var t441__dataarray = [data1,data2,data3,data4];    
    for (var i=0; i<4; i++) {
        if (t441__dataarray[i]!="" && blocksnumber>i) {
            var t441__canvas = document.querySelector('#rec'+recid+' .t441__pie'+(i+1));
			t441__canvas.setAttribute("width", diameter);
			t441__canvas.setAttribute("height", diameter);						
            var t441__context = t441__canvas.getContext("2d");
			if(window.devicePixelRatio >= 2) {								
				t441__canvas.style.width = t441__oldsize + "px";
				t441__canvas.style.height = t441__oldsize + "px";
			}			
			for (var j = 0; j < 2; j++) {				                               
				if(j==1 && t441__dataarray[i]==0) {continue;}                                  
				//0 - bg, 1 - percent sector                                  
                if (j==0) {                    					                                  
					t441__context.strokeStyle = piebgcolor;
					var t441__angle = Math.PI*2;           
					t441__context.lineWidth = diagramwidth-1;                                  
                } else {
                    t441__context.strokeStyle = sectorcolor;
					var t441__angle = Math.PI*2*(t441__dataarray[i]/100);
					t441__context.lineWidth = diagramwidth;                                  
				}
                t441__context.beginPath();								
				t441__context.lineCap="round";
				t441__context.moveTo(diameter-t441__correction,t441__radius);
				t441__context.arc(t441__radius, t441__radius, t441__radius-t441__correction, 0, t441__angle, false);				
				t441__context.stroke();				
			}			
		}
	}
} 
function t446_init(recid) {
    var el = $('#rec' + recid);
    var mobile = el.find('.t446__mobile');
    var fixedBlock = mobile.css('position') === 'fixed' && mobile.css('display') === 'block';

    setTimeout(function() {
        el.find('.t-menu__link-item:not(.t-menusub__target-link):not(.tooltipstered):not(.t794__tm-link)').on('click', function () {
            if ($(this).is(".t-menu__link-item.tooltipstered, .t-menu__link-item.t-menusub__target-link, .t-menu__link-item.t794__tm-link, .t-menu__link-item.t966__tm-link, .t-menu__link-item.t978__tm-link")) { return; }
            if (fixedBlock) {
                mobile.trigger('click');
            }
        });

        el.find('.t-menusub__link-item').on('click', function () {
            if (fixedBlock) {
                mobile.trigger('click');
            }
        });
    }, 500);
}

function t446_setLogoPadding(recid){
	if($(window).width()>980){			  
        var t446__menu = $('#rec'+recid+' .t446');
        var t446__logo=t446__menu.find('.t446__logowrapper');	  
        var t446__leftpart=t446__menu.find('.t446__leftwrapper');
        var t446__rightpart=t446__menu.find('.t446__rightwrapper');
        t446__leftpart.css("padding-right",t446__logo.width()/2+50);
        t446__rightpart.css("padding-left",t446__logo.width()/2+50);			        
	}
}

function t446_checkOverflow(recid, menuheight){    
  var t446__menu = $('#rec'+recid+' .t446');
  var t446__rightwr=t446__menu.find('.t446__rightwrapper');	  
  var t446__rightmenuwr=t446__rightwr.find('.t446__rightmenuwrapper');
  var t446__rightadditionalwr=t446__rightwr.find('.t446__additionalwrapper');
  var t446__burgeroverflow=t446__rightwr.find('.t446__burgerwrapper_overflow');  
  var t446__burgerwithoutoverflow=t446__rightwr.find('.t446__burgerwrapper_withoutoverflow');      

  if (menuheight>0) {var t446__height = menuheight;} else {var t446__height = 80;}  

  if($(window).width()>980 && (t446__rightmenuwr.width() + t446__rightadditionalwr.width()) > t446__rightwr.width()){    	  	  	  	  	  	  
		t446__menu.css("height", t446__height*2);
		t446__rightadditionalwr.css("float","right");

		t446__burgeroverflow.css("display","table-cell");
		t446__burgerwithoutoverflow.css("display","none");				
  } else {
		if(t446__menu.height()>t446__height) {t446__menu.css("height",t446__height);}
		if(t446__rightadditionalwr.css("float")=="right") {t446__rightadditionalwr.css("float","none");}

		t446__burgeroverflow.css("display","none");
		t446__burgerwithoutoverflow.css("display","table-cell");		
  }
}

function t446_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t446__list_item a[href='"+url+"']").addClass("t-active");
  $(".t446__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t446__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t446__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t446__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t446__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t446_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t446_navLinks = $("#rec" + recid + " .t446__list_item a:not(.tooltipstered)[href*='#']");
        if (t446_navLinks.length > 0) {
            t446_catchScroll(t446_navLinks);
        }
    }
}

function t446_catchScroll(t446_navLinks) {
    var t446_clickedSectionId = null,
        t446_sections = new Array(),
        t446_sectionIdTonavigationLink = [],
        t446_interval = 100,
        t446_lastCall, t446_timeoutId;
    t446_navLinks = $(t446_navLinks.get().reverse());
    t446_navLinks.each(function() {
        var t446_cursection = t446_getSectionByHref($(this));
        if (typeof t446_cursection.attr("id") != "undefined") {
            t446_sections.push(t446_cursection);
        }
        t446_sectionIdTonavigationLink[t446_cursection.attr("id")] = $(this);
    });
		t446_updateSectionsOffsets(t446_sections);
    t446_sections.sort(function(a, b) {
      return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
		$(window).bind('resize', t_throttle(function(){t446_updateSectionsOffsets(t446_sections);}, 200));
		$('.t446').bind('displayChanged',function(){t446_updateSectionsOffsets(t446_sections);});
		setInterval(function(){t446_updateSectionsOffsets(t446_sections);},5000);
    t446_highlightNavLinks(t446_navLinks, t446_sections, t446_sectionIdTonavigationLink, t446_clickedSectionId);

    t446_navLinks.click(function() {
        var t446_clickedSection = t446_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof t446_clickedSection.attr("id") != "undefined") {
            t446_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t446_clickedSectionId = t446_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function() {
        var t446_now = new Date().getTime();
        if (t446_lastCall && t446_now < (t446_lastCall + t446_interval)) {
            clearTimeout(t446_timeoutId);
            t446_timeoutId = setTimeout(function() {
                t446_lastCall = t446_now;
                t446_clickedSectionId = t446_highlightNavLinks(t446_navLinks, t446_sections, t446_sectionIdTonavigationLink, t446_clickedSectionId);
            }, t446_interval - (t446_now - t446_lastCall));
        } else {
            t446_lastCall = t446_now;
            t446_clickedSectionId = t446_highlightNavLinks(t446_navLinks, t446_sections, t446_sectionIdTonavigationLink, t446_clickedSectionId);
        }
    });
}


function t446_updateSectionsOffsets(sections){
	$(sections).each(function(){
		var t446_curSection = $(this);
		t446_curSection.attr("data-offset-top",t446_curSection.offset().top);
	});
}


function t446_getSectionByHref(curlink) {
    var t446_curLinkValue = curlink.attr("href").replace(/\s+/g, '');
    if (t446_curLinkValue[0]=='/') { t446_curLinkValue = t446_curLinkValue.substring(1); }
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + t446_curLinkValue.substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + t446_curLinkValue.substring(1) + "']");
    }
}

function t446_highlightNavLinks(t446_navLinks, t446_sections, t446_sectionIdTonavigationLink, t446_clickedSectionId) {
    var t446_scrollPosition = $(window).scrollTop(),
        t446_valueToReturn = t446_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t446_sections.length != 0 && t446_clickedSectionId == null && t446_sections[t446_sections.length-1].attr("data-offset-top") > (t446_scrollPosition + 300)){
      t446_navLinks.removeClass('t-active');
      return null;
    }

    $(t446_sections).each(function(e) {
        var t446_curSection = $(this),
            t446_sectionTop = t446_curSection.attr("data-offset-top"),
            t446_id = t446_curSection.attr('id'),
            t446_navLink = t446_sectionIdTonavigationLink[t446_id];
        if (((t446_scrollPosition + 300) >= t446_sectionTop) || (t446_sections[0].attr("id") == t446_id && t446_scrollPosition >= $(document).height() - $(window).height())) {
            if (t446_clickedSectionId == null && !t446_navLink.hasClass('t-active')) {
                t446_navLinks.removeClass('t-active');
                t446_navLink.addClass('t-active');
                t446_valueToReturn = null;
            } else {
                if (t446_clickedSectionId != null && t446_id == t446_clickedSectionId) {
                    t446_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t446_valueToReturn;
}

function t446_setPath(){
}

function t446_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t446").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);
      }
      });
      }else{
        $(".t446").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t446_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t446").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("top","-50px");
                                el.css("visibility","visible");
                                el.animate({"opacity": "1","top": "0px"}, 200,function() {
                                });
                            }
                          }else{
                            el.stop();
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t446_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t446").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t446_createMobileMenu(recid) {
    var window_width = $(window).width(),
        el = $("#rec" + recid),
        menu = el.find(".t446"),
        burger = el.find(".t446__mobile");

    if (menu.hasClass('t446__mobile_burgerhook')) {
        burger.find('.t446__mobile_burger').wrap('<a href="#menuopen"></a>');
    } else {
        burger.click(function (e) {
            menu.fadeToggle(300);
            $(this).toggleClass("t446_opened");
        });
    }

    $(window).bind('resize', t_throttle(function () {
        window_width = $(window).width();
        if (window_width > 980) {
            menu.fadeIn(0);
        }
    }, 200));
    
    /* Fix for clicking anchor links on mobile. 
    Hide menu on click as expected */
    el.find('.t-menu__link-item').on('click', function () {
        if (!$(this).hasClass('t966__tm-link') && !$(this).hasClass('t978__tm-link')) {
            t446_hideMenuOnMobile($(this), el);   
        }
    });
    
    el.find('.t446__logowrapper2 a').on('click', function () {
        t446_hideMenuOnMobile($(this), el);
    });
}


function t446_hideMenuOnMobile($this, el) {
    if ($(window).width() < 960) {
        var url = $this.attr('href').trim();
        var menu = el.find('.t446');
        var burger = el.find('.t446__mobile');
    
        if (url.length && url[0] === '#') {
            burger.removeClass('t446_opened');
            if (menu.is('.t446__positionabsolute') || !burger.is('.t446__positionfixed')) {
                menu.fadeOut(0);
            } else {
                menu.fadeOut(300);
            }
            return true;
        }
    }
} 
function t448_setHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var cover = rec.querySelector('.t-cover');
	var coverHeight = cover ? cover.offsetHeight : 0;
	var coverWrapper = rec.querySelector('.t448-cover__wrapper');
	var textWrapper = rec.querySelector('.t448__wrapper');
	var textHeight = textWrapper ? textWrapper.clientHeight : 0;
	var screenShot = rec.querySelector('.t448__screenshot');
	var imgHeight = screenShot ? screenShot.offsetHeight : 0;
	var height = textHeight + imgHeight;
	var newHeight = coverHeight - imgHeight;
	var container = rec.querySelector('.t448');
	var cropImg = container ? container.getAttribute('data-crop-image') : '';
	
	if (cropImg && container) {
		container.classList.add('t448__no-overflow');
		if (coverWrapper) {
			container.style.height = coverWrapper.offsetHeight + 'px';
		}
	}
	
	if (coverHeight > height) {
		rec.classList.add('t448__stretched');
		if (coverWrapper) coverWrapper.style.height = newHeight + 'px';
		if (cropImg && container) {
			container.classList.remove('t448__no-overflow');
			container.style.height = '';
		}
	} else {
		rec.classList.remove('t448__stretched');
		if (coverWrapper) coverWrapper.style.height = '';
	}
} 
function t449_appearMenu(recid) {
    var window_width=$(window).width();
    if(window_width>980){
         $(".t449").each(function() {
                var el=$(this);
                var appearoffset=el.attr("data-appearoffset");
                var hideoffset=el.attr("data-hideoffset");
                if(appearoffset!=""){
                        if(appearoffset.indexOf('vh') > -1){
                            appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                        }

                        appearoffset=parseInt(appearoffset, 10);

                        if ($(window).scrollTop() >= appearoffset) {
                          if(el.hasClass('t449__beforeready')){
                              el.finish(); 
                              el.removeClass("t449__beforeready");
                          }
                        }else{
                          el.stop();
                          el.addClass("t449__beforeready");
                        }
                }

                if(hideoffset!=""){
                        if(hideoffset.indexOf('vh') > -1){
                            hideoffset = Math.floor((window.innerHeight * (parseInt(hideoffset) / 100)));
                        }

                        hideoffset=parseInt(hideoffset, 10);

                        if ($(window).scrollTop()+$(window).height() >= $(document).height() - hideoffset) {
                          if(!el.hasClass('t449__beforeready')){
                              el.finish();
                              el.addClass("t449__beforeready");
                          }
                        }else{
                          if (appearoffset!="") {
                              if($(window).scrollTop() >= appearoffset){
                                el.stop();
                                el.removeClass("t449__beforeready");
                              }
                          }else{
                              el.stop();
                              el.removeClass("t449__beforeready");
                          }
                        }
                }
         });
    }
} 
function t450_showMenu(recid) {
    var el = $('#rec' + recid);
    $('body').addClass('t450__body_menushowed');
    el.find('.t450').addClass('t450__menu_show');
    el.find('.t450__overlay').addClass('t450__menu_show');
    $('.t450').bind('clickedAnchorInTooltipMenu', function () {
        t450_closeMenu();
    });
    el.find('.t450__overlay, .t450__close, a[href*="#"]').click(function () {
        var url = $(this).attr('href');
        if (typeof url != 'undefined' && url != '' && (url.substring(0, 7) == '#price:' || url.substring(0, 9) == '#submenu:')) { return; }
        if ($(this).is('.tooltipstered, .t-menusub__target-link, .t794__tm-link, .t966__tm-link, .t978__tm-link')) { return; }
        t450_closeMenu();
    });
    $(document).keydown(function (e) {
        if (e.keyCode === 27) {
            $('body').removeClass('t390__body_popupshowed');
            $('.t390').removeClass('t390__popup_show');
        }
    });

    el.find('.t-menu__link-item').each(function () {
        var $this = $(this);

        /* me601a */
        if ($this.hasClass('t966__tm-link')) {
            $this.on('click', function () {
                setTimeout(function () {
                    t450_checkSize(recid);
                }, 300);
            });
        }

        /* me601b */
        if ($this.hasClass('t978__tm-link')) {
            $this.on('click', function () {
                t450_checkSize(recid);
                el.find(".t978__menu-link").on('click', function () {
                    t450_checkSize(recid);
                });
            });
        }
    });

    t450_highlight();
}

function t450_closeMenu() {
    $('body').removeClass('t450__body_menushowed');
    $('.t450').removeClass('t450__menu_show');
    $('.t450__overlay').removeClass('t450__menu_show');
}

function t450_checkSize(recid) {
    var el = $('#rec' + recid).find('.t450');
    var windowheight = $(window).height() - 80;
    setTimeout(function () {
        var contentheight = el.find(".t450__top").height() + el.find(".t450__rightside").height();
        if (contentheight > windowheight) {
            el.addClass('t450__overflowed');
            el.find(".t450__container").css('height', 'auto');
        } else {
            el.removeClass('t450__overflowed');
            el.find(".t450__container").css('height', '');
        }
    }); /* css transition is completed */
}

function t450_appearMenu(recid) {
    var el = $('#rec' + recid);
    var burger = el.find(".t450__burger_container");
    burger.each(function () {
        var el = $(this);
        var appearoffset = el.attr("data-appearoffset");
        var hideoffset = el.attr("data-hideoffset");
        if (appearoffset != "") {
            if (appearoffset.indexOf('vh') > -1) {
                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
            }

            appearoffset = parseInt(appearoffset, 10);

            if ($(window).scrollTop() >= appearoffset) {
                if (el.hasClass('t450__beforeready')) {
                    el.finish();
                    el.removeClass("t450__beforeready");
                }
            } else {
                el.stop();
                el.addClass("t450__beforeready");
            }
        }

        if (hideoffset != "") {
            if (hideoffset.indexOf('vh') > -1) {
                hideoffset = Math.floor((window.innerHeight * (parseInt(hideoffset) / 100)));
            }

            hideoffset = parseInt(hideoffset, 10);

            if ($(window).scrollTop() + $(window).height() >= $(document).height() - hideoffset) {
                if (!el.hasClass('t450__beforeready')) {
                    el.finish();
                    el.addClass("t450__beforeready");
                }
            } else {
                if (appearoffset != "") {
                    if ($(window).scrollTop() >= appearoffset) {
                        el.stop();
                        el.removeClass("t450__beforeready");
                    }
                } else {
                    el.stop();
                    el.removeClass("t450__beforeready");
                }
            }
        }
    });
}

function t450_initMenu(recid) {
    var el = $('#rec' + recid).find('.t450');
    var hook = el.attr('data-tooltip-hook');
    if (hook !== '') {
        $('.r').on('click', 'a[href="' + hook + '"]', function (e) {
            t450_closeMenu();
            t450_showMenu(recid);
            t450_checkSize(recid);
            e.preventDefault();
        });
    }
    $('#rec' + recid).find('.t450__burger_container').click(function (e) {
        t450_closeMenu();
        t450_showMenu(recid);
        t450_checkSize(recid);
    });

    if (window.isMobile) {
        $('#rec' + recid).find('.t-menu__link-item').each(function () {
            var $this = $(this);
            if ($this.hasClass('t450__link-item_submenu')) {
                $this.on('click', function () {
                    t450_checkSize(recid);
                });
            }
        });
    }

    $(window).on('resize', function () {
        t450_checkSize(recid);
    });
}

function t450_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash = window.location.hash;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }

    if (pathname == "") {
        pathname = "/";
    }

    $(".t450__menu a").removeClass("t-active");
    $(".t450__menu a[href='" + url + "']").addClass("t-active");
    $(".t450__menu a[href='" + url + "/']").addClass("t-active");
    $(".t450__menu a[href='" + pathname + "']").addClass("t-active");
    $(".t450__menu a[href='/" + pathname + "']").addClass("t-active");
    $(".t450__menu a[href='" + pathname + "/']").addClass("t-active");
    $(".t450__menu a[href='/" + pathname + "/']").addClass("t-active");

    if (hash !== "") {
        $(".t450__menu a[href='" + hash + "']").addClass("t-active");
    }
} 
function t451_initMenu(recid) {
    var el = $('#rec' + recid);
    var obj = el.find('.t451__burger');

    obj.click(function (e) {
        t451_closeMenu();
        t451_showMenu(recid);
        t451_checkSize(recid);
        e.preventDefault();
    });

    el.find('.t451').bind('clickedAnchorInTooltipMenu', function () {
        t451_closeMenu();
    });

    if (window.isMobile) {
        $('#rec' + recid).find('.t-menu__link-item').each(function () {
            var $this = $(this);
            if ($this.hasClass('t451__link-item_submenu')) {
                $this.on('click', function () {
                    t451_checkSize(recid);
                    setTimeout(function () {
                        t451_checkSize(recid);
                    }, 1);
                });
            }
        });
    }
    
    $(window).on('resize', function() {
        t451_checkSize(recid);
    });

    var navLinks = el.find('.t451 a.t-menu__link-item:not(.tooltipstered)[href*="#"], .t451 a.t-menusub__link-item:not(.tooltipstered)[href*="#"]');
    if (navLinks.length > 0) {
        t451_catchScroll(navLinks);
    }

    t451_highlight();
}

function t451_showMenu(recid) {
    var el = $('#rec' + recid);
    $('body').addClass('t451__body_menushowed');
    el.find('.t451m').addClass('t451m__menu_show');
    el.find('.t451m__overlay').addClass('t451m__menu_show');
    el.find('.t451m__overlay, .t451m__close, a[href*="#"]').click(function () {
        if ($(this).is('.tooltipstered, .t794__tm-link, .t978__tm-link, .t966__tm-link')) { return; }
        t451_closeMenu();
    });
    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            $('body').removeClass('t451__body_menushowed');
            $('.t451m').removeClass('t451m__menu_show');
            $('.t451m__overlay').removeClass('t451m__menu_show');
        }
    });
    el.find('.t-menu__link-item').each(function() {
        var $this = $(this);

        /* me601a */
        if ($this.hasClass('t966__tm-link')) {
            $this.on('click', function () {
                setTimeout(function () {
                    t451_checkSize(recid);
                }, 305);
            });
        }
        
        /* me601b */
        if ($this.hasClass('t978__tm-link')) {
            $this.on('click', function () {
                el.find(".t978__menu-link").on('click', function() {
                    t451_checkSize(recid);
                });
            });
        }
    });
}

function t451_closeMenu() {
    $('body').removeClass('t451__body_menushowed');
    $('.t451m').removeClass('t451m__menu_show');
    $('.t451m__overlay').removeClass('t451m__menu_show');
}

function t451_checkSize(recid) {
    var el = $('#rec' + recid).find('.t451m');
    var windowheight = $(window).height() - 80;
    var contentheight = el.find('.t451m__top').height() + el.find('.t451m__rightside').height();
    if (contentheight > windowheight) {
        el.addClass('t451m__overflowed');
        el.find('.t451m__container').css('height', 'auto');
    } else {
        el.removeClass('t451m__overflowed');
        el.find('.t451m__container').css('height', '');
    }
}

function t451_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash=window.location.hash;
    if (url.substr(url.length - 1) == '/') { url = url.slice(0, -1); }
    if (pathname.substr(pathname.length - 1) == '/') { pathname = pathname.slice(0, -1); }
    if (pathname.charAt(0) == '/') { pathname = pathname.slice(1); }
    if (pathname == '') { pathname = '/'; }
    if (hash.substr(hash.length - 1) == "/"){ hash = hash.slice(0,-1); }
    if (hash == ""){ hash = "/"; }
    
    $('.t451m__menu a').removeClass('t-active');

    $('.t451m__menu a[href="' + url + '"]').addClass('t-active');
    $('.t451m__menu a[href="' + url + '/"]').addClass('t-active');
    $('.t451m__menu a[href="' + pathname + '"]').addClass('t-active');
    $('.t451m__menu a[href="/' + pathname + '"]').addClass('t-active');
    $('.t451m__menu a[href="' + pathname + '/"]').addClass('t-active');
    $('.t451m__menu a[href="/' + pathname + '/"]').addClass('t-active');
    
    $('.t451m__menu a[href="'+hash+'"]').addClass('t-active');
    $('.t451m__menu a[href="/'+hash+'"]').addClass('t-active');
    $('.t451m__menu a[href="'+hash+'/"]').addClass('t-active');
    $('.t451m__menu a[href="/'+hash+'/"]').addClass('t-active');
}

function t451_changeBgOpacityMenu(recid) {
    var window_width = $(window).width();
    var record = $('#rec' + recid);
    record.find('.t451__container__bg').each(function () {
        var el = $(this);
        var bgcolor = el.attr('data-bgcolor-rgba');
        var bgcolor_afterscroll = el.attr('data-bgcolor-rgba-afterscroll');
        var bgopacity = el.attr('data-bgopacity');
        var bgopacity_afterscroll = el.attr('data-bgopacity2');
        var menu_shadow = el.attr('data-menu-shadow');
        if ($(window).scrollTop() > 20) {
            el.css('background-color', bgcolor_afterscroll);
            if (bgopacity_afterscroll != '0' && bgopacity_afterscroll != '0.0') {
                el.css('box-shadow', menu_shadow);
            } else {
                el.css('box-shadow', 'none');
            }
        } else {
            el.css('background-color', bgcolor);
            if (bgopacity != '0' && bgopacity != '0.0') {
                el.css('box-shadow', menu_shadow);
            } else {
                el.css('box-shadow', 'none');
            }
        }
    });
}

function t451_appearMenu(recid) {
    var window_width = $(window).width();
    var record = $('#rec' + recid);
    record.find('.t451__panel').each(function () {
        var el = $(this);
        var appearoffset = el.attr('data-appearoffset');
        if (appearoffset != '') {
            if (appearoffset.indexOf('vh') > -1) {
                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
            }

            appearoffset = parseInt(appearoffset, 10);

            if ($(window).scrollTop() >= appearoffset) {
                if (el.hasClass('t451__beforeready')) {
                    el.removeClass('t451__beforeready');
                }
            } else {
                el.addClass('t451__beforeready');
            }
        }
    });

}

function t451_catchScroll(navLinks) {
    var clickedSectionId = null;
    var sections = new Array();
    var sectionIdTonavigationLink = [];
    var interval = 100;
    var lastCall;
    var timeoutId;

    navLinks = $(navLinks.get().reverse());
    navLinks.each(function () {
        var cursection = t451_getSectionByHref($(this));
        if (typeof cursection.attr('id') != 'undefined') {
            sections.push(cursection);
        }
        sectionIdTonavigationLink[cursection.attr('id')] = $(this);
    });
    $(window).bind('resize', t_throttle(function () {
        t451_updateSectionsOffsets(sections);
    }, 200));
    $('.t451').bind('displayChanged', function () {
        t451_updateSectionsOffsets(sections);
    });
    setInterval(function () {
        t451_updateSectionsOffsets(sections);
    }, 5000);
    setTimeout(function () {
        t451_updateSectionsOffsets(sections);
        t451_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
    }, 1000);
    navLinks.click(function () {
        if (!$(this).hasClass('tooltipstered')) {
            navLinks.removeClass('t-active');
            sectionIdTonavigationLink[t451_getSectionByHref($(this)).attr('id')].addClass('t-active');
            clickedSectionId = t451_getSectionByHref($(this)).attr('id');
        }
    });
    $(window).scroll(function () {
        var now = new Date().getTime();
        if (lastCall && now < (lastCall + interval)) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(function () {
                lastCall = now;
                clickedSectionId = t451_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
            }, interval - (now - lastCall));
        } else {
            lastCall = now;
            clickedSectionId = t451_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
        }
    });
}

function t451_updateSectionsOffsets(sections) {
    $(sections).each(function () {
        var curSection = $(this);
        curSection.attr('data-offset-top', curSection.offset().top);
    });
}

function t451_getSectionByHref(curlink) {
    var curLinkValue = curlink.attr('href').replace(/\s+/g, '');
    if (curlink.is('[href*="#rec"]')) {
        var curLinkRecId = curlink.is('[href*="/#rec"]') ? curLinkValue.substring(2) : curLinkValue.substring(1);
        return $(".r[id='" + curLinkRecId + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curLinkValue.substring(1) + "']");
    }
}

function t451_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId) {
    var scrollPosition = $(window).scrollTop();
    var valueToReturn = clickedSectionId;

    if (sections.length != 0 && clickedSectionId == null && sections[sections.length - 1].attr('data-offset-top') > (scrollPosition + 300)) {
        navLinks.removeClass('t-active');
        return null;
    }

    $(sections).each(function () {
        var curSection = $(this);
        var sectionTop = curSection.attr('data-offset-top');
        var id = curSection.attr('id');
        var navLink = sectionIdTonavigationLink[id];

        if (((scrollPosition + 300) >= sectionTop) || (sections[0].attr('id') == id && scrollPosition >= $(document).height() - $(window).height())) {
            if (clickedSectionId == null && !navLink.hasClass('t-active')) {
                navLinks.removeClass('t-active');
                navLink.addClass('t-active');
                valueToReturn = null;
            } else {
                if (clickedSectionId != null && id == clickedSectionId) {
                    valueToReturn = null;
                }
            }
            return !1;
        }
    });
    return valueToReturn;
} 
function t452_scrollToTop() {
	var duration = 700;
	var difference = window.pageYOffset;
	var step = 10 * difference / duration;
	var timer = setInterval(function () {
		difference -= step;
		window.scrollTo(0, difference);
		document.body.setAttribute('data-scrollable', 'true');
		if (window.pageYOffset === 0) {
			document.body.removeAttribute('data-scrollable');
			clearInterval(timer);
		}
	}, 10);
} 
function t453_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname == "") {
        pathname = "/";
    }
    $(".t453__item a[href='" + url + "']").addClass("t-active");
    $(".t453__item a[href='" + url + "/']").addClass("t-active");
    $(".t453__item a[href='" + pathname + "']").addClass("t-active");
    $(".t453__item a[href='/" + pathname + "']").addClass("t-active");
    $(".t453__item a[href='" + pathname + "/']").addClass("t-active");
    $(".t453__item a[href='/" + pathname + "/']").addClass("t-active");
}

function t453_checkAnchorLinks(recid) {
    var t453_navLinks = $("#rec" + recid + " .t453__item a:not(.tooltipstered)[href*='#']");
    if (t453_navLinks.length > 0) {
        t453_catchScroll(t453_navLinks);
    }
}

function t453_catchScroll(t453_navLinks) {
    var t453_clickedSectionId = null,
        t453_sections = new Array(),
        t453_sectionIdTonavigationLink = {},
        t453_interval = 100,
        t453_lastCall,
        t453_timeoutId,
        t453_offsetTop = $(".t453").attr("data-offset-top");
    if (typeof t453_offsetTop == "undefined") {
        t453_offsetTop = 0;
    }
    t453_navLinks.each(function () {
        var t453_cursection = t453_getSectionByHref($(this));
        if (typeof t453_cursection.attr("id") != "undefined") {
            t453_sections.push(t453_cursection);
        }
        t453_sectionIdTonavigationLink[t453_cursection.attr("id")] = $(this);
    });

    t453_highlightNavLinks(t453_navLinks, t453_sections, t453_sectionIdTonavigationLink, t453_clickedSectionId, t453_offsetTop);
    t453_navLinks.click(function () {
        if (!$(this).hasClass("tooltipstered")) {
            t453_navLinks.removeClass('t-active');
            t453_sectionIdTonavigationLink[t453_getSectionByHref($(this)).attr("id")].addClass('t-active');
            t453_clickedSectionId = t453_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function () {
        var t453_now = new Date().getTime();
        if (t453_lastCall && t453_now < (t453_lastCall + t453_interval)) {
            clearTimeout(t453_timeoutId);
            t453_timeoutId = setTimeout(function () {
                t453_lastCall = t453_now;
                t453_clickedSectionId = t453_highlightNavLinks(t453_navLinks, t453_sections, t453_sectionIdTonavigationLink, t453_clickedSectionId, t453_offsetTop);
            }, t453_interval - (t453_now - t453_lastCall));
        } else {
            t453_lastCall = t453_now;
            t453_clickedSectionId = t453_highlightNavLinks(t453_navLinks, t453_sections, t453_sectionIdTonavigationLink, t453_clickedSectionId, t453_offsetTop);
        }
    });
}

function t453_getSectionByHref(curlink) {
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + curlink.attr("href").substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curlink.attr("href").substring(1) + "']");
    }
}

function t453_highlightNavLinks(t453_navLinks, t453_sections, t453_sectionIdTonavigationLink, t453_clickedSectionId, offsetTop) {
    var t453_scrollPosition = $(window).scrollTop(),
        t453_valueToReturn = t453_clickedSectionId;
    $(t453_sections).each(function (e) {
        var t453_curSection = $(this),
            t453_sectionTop = t453_curSection.offset().top,
            t453_id = t453_curSection.attr('id'),
            t453_navLink = t453_sectionIdTonavigationLink[t453_id];
        if (t453_scrollPosition >= (t453_sectionTop - offsetTop) || (t453_sections[0].attr("id") == t453_id && $(window).scrollTop() >= $(document).height() - $(window).height())) {

            if (t453_clickedSectionId == null && !t453_navLink.hasClass('t-active')) {
                t453_navLinks.removeClass('t-active');
                t453_navLink.addClass('t-active');
                t453_valueToReturn = null;
            } else if (t453_clickedSectionId != null && t453_id == t453_clickedSectionId) {
                t453_valueToReturn = null;
            }
            return false;
        }
    });
    return t453_valueToReturn;
}

function t453_appearMenu(recid) {
    var window_width = $(window).width();
    var record = $("#rec" + recid);
    record.find(".t453").each(function () {
        var el = $(this);
        var appearoffset = el.attr("data-appearoffset");

        if (appearoffset != "") {
            if (appearoffset.indexOf('vh') > -1) {
                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
            }

            appearoffset = parseInt(appearoffset, 10);

            if ($(window).scrollTop() >= appearoffset) {
                if (el.hasClass('t453__beforeready')) {
                    el.removeClass('t453__beforeready');
                }

                $('body').addClass('t453__body_menushowed');
            } else {
                el.addClass('t453__beforeready');
                $('body').removeClass('t453__body_menushowed');
            }
        }
    });
}
 
function t454_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t454__list_item a[href='"+url+"']").addClass("t-active");
  $(".t454__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t454__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t454__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t454__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t454__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t454_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t454_navLinks = $("#rec" + recid + " .t454__list_item a:not(.tooltipstered)[href*='#']");
        if (t454_navLinks.length > 0) {
            setTimeout(function(){
                t454_catchScroll(t454_navLinks);
            }, 500);
        }
    }
}

function t454_catchScroll(t454_navLinks) {
    var t454_clickedSectionId = null,
        t454_sections = new Array(),
        t454_sectionIdTonavigationLink = [],
        t454_interval = 100,
        t454_lastCall, t454_timeoutId;
    t454_navLinks = $(t454_navLinks.get().reverse());
    t454_navLinks.each(function() {
        var t454_cursection = t454_getSectionByHref($(this));
        if (typeof t454_cursection.attr("id") != "undefined") {
            t454_sections.push(t454_cursection);
        }
        t454_sectionIdTonavigationLink[t454_cursection.attr("id")] = $(this);
    });
		t454_updateSectionsOffsets(t454_sections);
		$(window).bind('resize', t_throttle(function(){t454_updateSectionsOffsets(t454_sections);}, 200));
		$('.t454').bind('displayChanged',function(){t454_updateSectionsOffsets(t454_sections);});
		setInterval(function(){t454_updateSectionsOffsets(t454_sections);},5000);
    t454_highlightNavLinks(t454_navLinks, t454_sections, t454_sectionIdTonavigationLink, t454_clickedSectionId);

    t454_navLinks.click(function() {
        var clickedSection = t454_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof clickedSection.attr("id") != "undefined") {
            t454_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t454_clickedSectionId = t454_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function() {
        var t454_now = new Date().getTime();
        if (t454_lastCall && t454_now < (t454_lastCall + t454_interval)) {
            clearTimeout(t454_timeoutId);
            t454_timeoutId = setTimeout(function() {
                t454_lastCall = t454_now;
                t454_clickedSectionId = t454_highlightNavLinks(t454_navLinks, t454_sections, t454_sectionIdTonavigationLink, t454_clickedSectionId);
            }, t454_interval - (t454_now - t454_lastCall));
        } else {
            t454_lastCall = t454_now;
            t454_clickedSectionId = t454_highlightNavLinks(t454_navLinks, t454_sections, t454_sectionIdTonavigationLink, t454_clickedSectionId);
        }
    });
}


function t454_updateSectionsOffsets(sections){
	$(sections).each(function(){
		var t454_curSection = $(this);
		t454_curSection.attr("data-offset-top",t454_curSection.offset().top);
	});
}


function t454_getSectionByHref(curlink) {
    var curLinkValue = curlink.attr('href').replace(/\s+/g, '').replace(/.*#/, '');
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + curLinkValue + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curLinkValue + "']");
    }
}


function t454_highlightNavLinks(t454_navLinks, t454_sections, t454_sectionIdTonavigationLink, t454_clickedSectionId) {
    var t454_scrollPosition = $(window).scrollTop(),
        t454_valueToReturn = t454_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t454_sections.length != 0 && t454_clickedSectionId == null && t454_sections[t454_sections.length-1].attr("data-offset-top") > (t454_scrollPosition + 300)){
      t454_navLinks.removeClass('t-active');
      return null;
    }

    $(t454_sections).each(function(e) {
        var t454_curSection = $(this),
            t454_sectionTop = t454_curSection.attr("data-offset-top"),
            t454_id = t454_curSection.attr('id'),
            t454_navLink = t454_sectionIdTonavigationLink[t454_id];
        if (((t454_scrollPosition + 300) >= t454_sectionTop) || (t454_sections[0].attr("id") == t454_id && t454_scrollPosition >= $(document).height() - $(window).height())) {
            if (t454_clickedSectionId == null && !t454_navLink.hasClass('t-active')) {
                t454_navLinks.removeClass('t-active');
                t454_navLink.addClass('t-active');
                t454_valueToReturn = null;
            } else {
                if (t454_clickedSectionId != null && t454_id == t454_clickedSectionId) {
                    t454_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t454_valueToReturn;
}

function t454_setPath(){
}

function t454_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t454").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);
      }
      });
      }else{
        $(".t454").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t454_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t454").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("top","-80px");
                                el.css("visibility","visible");
                                el.animate({"opacity": "1","top": "0px"}, 200,function() {
                                });
                            }
                          }else{
                            el.stop();
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t454_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t454").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t454_createMobileMenu(recid) {
  var window_width=$(window).width(),
      el=$("#rec"+recid),
      menu=el.find(".t454"),
      burger=el.find(".t454__mobile");
  burger.click(function(e){
    menu.fadeToggle(300);
    $(this).toggleClass("t454_opened")
  })
  $(window).bind('resize', t_throttle(function(){
    window_width=$(window).width();
    if(window_width>980){
      menu.fadeIn(0);
    }
  }, 200));
}

function t454_setLogoPadding(recid) {
	if($(window).width()>980){
        var t454__menu = $('#rec'+recid+' .t454');
        var t454__logo=t454__menu.find('.t454__logowrapper');
        var t454__leftpart=t454__menu.find('.t454__leftwrapper');
        var t454__rightpart=t454__menu.find('.t454__rightwrapper');
        t454__leftpart.css("padding-right",t454__logo.width()/2+50);
        t454__rightpart.css("padding-left",t454__logo.width()/2+50);
	}
} 
function t456_setListMagin(recid, imglogo) {
    if ($(window).width() > 980) {
        var t456__menu = $('#rec' + recid + ' .t456');
        var t456__leftpart = t456__menu.find('.t456__leftwrapper');
        var t456__listpart = t456__menu.find('.t456__list');
        if (imglogo) {
            t456__listpart.css("margin-right", t456__leftpart.width());
        } else {
            t456__listpart.css("margin-right", t456__leftpart.width() + 30);
        }
    }
}

function t456_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname == "") {
        pathname = "/";
    }
    $(".t456__list_item a[href='" + url + "']").addClass("t-active");
    $(".t456__list_item a[href='" + url + "/']").addClass("t-active");
    $(".t456__list_item a[href='" + pathname + "']").addClass("t-active");
    $(".t456__list_item a[href='/" + pathname + "']").addClass("t-active");
    $(".t456__list_item a[href='" + pathname + "/']").addClass("t-active");
    $(".t456__list_item a[href='/" + pathname + "/']").addClass("t-active");
}


function t456_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t456_navLinks = $("#rec" + recid + " .t456__list_item a:not(.tooltipstered)[href*='#']");
        if (t456_navLinks.length > 0) {
            t456_catchScroll(t456_navLinks);
        }
    }
}

function t456_catchScroll(t456_navLinks) {
    var t456_clickedSectionId = null,
        t456_sections = new Array(),
        t456_sectionIdTonavigationLink = [],
        t456_interval = 100,
        t456_lastCall, t456_timeoutId;
    t456_navLinks = $(t456_navLinks.get().reverse());
    t456_navLinks.each(function () {
        var t456_cursection = t456_getSectionByHref($(this));
        if (typeof t456_cursection !== "undefined") {
            if (typeof t456_cursection.attr("id") != "undefined") {
                t456_sections.push(t456_cursection);
            }
            t456_sectionIdTonavigationLink[t456_cursection.attr("id")] = $(this);
        }
    });
    t456_updateSectionsOffsets(t456_sections);
    t456_sections.sort(function (a, b) {
        return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
    $(window).bind('resize', t_throttle(function () {
        t456_updateSectionsOffsets(t456_sections);
    }, 200));
    $('.t456').bind('displayChanged', function () {
        t456_updateSectionsOffsets(t456_sections);
    });
    setInterval(function () {
        t456_updateSectionsOffsets(t456_sections);
    }, 5000);
    t456_highlightNavLinks(t456_navLinks, t456_sections, t456_sectionIdTonavigationLink, t456_clickedSectionId);

    t456_navLinks.click(function () {
        var t456_clickedSection = t456_getSectionByHref($(this));
        if (typeof t456_clickedSection !== "undefined" && !$(this).hasClass("tooltipstered") && typeof t456_clickedSection.attr("id") != "undefined") {
            t456_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t456_clickedSectionId = t456_getSectionByHref($(this)).attr("id");
        }
    });
    
    $(window).scroll(function () {
        var t456_now = new Date().getTime();
        if (t456_lastCall && t456_now < (t456_lastCall + t456_interval)) {
            clearTimeout(t456_timeoutId);
            t456_timeoutId = setTimeout(function () {
                t456_lastCall = t456_now;
                t456_clickedSectionId = t456_highlightNavLinks(t456_navLinks, t456_sections, t456_sectionIdTonavigationLink, t456_clickedSectionId);
            }, t456_interval - (t456_now - t456_lastCall));
        } else {
            t456_lastCall = t456_now;
            t456_clickedSectionId = t456_highlightNavLinks(t456_navLinks, t456_sections, t456_sectionIdTonavigationLink, t456_clickedSectionId);
        }
    });
}


function t456_updateSectionsOffsets(sections) {
    $(sections).each(function () {
        var t456_curSection = $(this);
        t456_curSection.attr("data-offset-top", t456_curSection.offset().top);
    });
}


function t456_getSectionByHref(curlink) {
    var hash = curlink.attr("href").replace(/\s+/g, '').replace(/.*#/, '');
    var block = $(".r[id='" + hash + "']");
    var anchor = $(".r[data-record-type='215']").has("a[name='" + hash + "']");
    
    if (curlink.is('[href*="#rec"]')) {
        return block;
    } else if (anchor.length === 1) {
        return anchor;
    } else {
        return undefined;
    }
}


function t456_highlightNavLinks(t456_navLinks, t456_sections, t456_sectionIdTonavigationLink, t456_clickedSectionId) {
    var t456_scrollPosition = $(window).scrollTop(),
        t456_valueToReturn = t456_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t456_sections.length != 0 && t456_clickedSectionId == null && t456_sections[t456_sections.length - 1].attr("data-offset-top") > (t456_scrollPosition + 300)) {
        t456_navLinks.removeClass('t-active');
        return null;
    }

    $(t456_sections).each(function (e) {
        var t456_curSection = $(this),
            t456_sectionTop = t456_curSection.attr("data-offset-top"),
            t456_id = t456_curSection.attr('id'),
            t456_navLink = t456_sectionIdTonavigationLink[t456_id];
        if (((t456_scrollPosition + 300) >= t456_sectionTop) || (t456_sections[0].attr("id") == t456_id && t456_scrollPosition >= $(document).height() - $(window).height())) {
            if (t456_clickedSectionId == null && !t456_navLink.hasClass('t-active')) {
                t456_navLinks.removeClass('t-active');
                t456_navLink.addClass('t-active');
                t456_valueToReturn = null;
            } else {
                if (t456_clickedSectionId != null && t456_id == t456_clickedSectionId) {
                    t456_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t456_valueToReturn;
}

function t456_setPath() {}

function t456_setBg(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t456").each(function () {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color", bgcolor);
            }
        });
    } else {
        $(".t456").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color", bgcolor);
            el.attr("data-bgcolor-setbyscript", "yes");
        });
    }
}

function t456_appearMenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t456").each(function () {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset != "") {
                if (appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        el.css("top", "-50px");
                        el.css("visibility", "visible");
                        el.animate({
                            "opacity": "1",
                            "top": "0px"
                        }, 200, function () {});
                    }
                } else {
                    el.stop();
                    el.css("visibility", "hidden");
                }
            }
        });
    }

}

function t456_changebgopacitymenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t456").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.' + menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if (bgopacitytwo == '0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            } else {
                el.css("background-color", bgcolor);
                if (bgopacityone == '0.0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            }
        });
    }
}

function t456_createMobileMenu(recid) {
    var window_width = $(window).width(),
        el = $("#rec" + recid),
        menu = el.find(".t456"),
        burger = el.find(".t456__mobile");
    burger.click(function (e) {
        menu.fadeToggle(300);
        $(this).toggleClass("t456_opened")
    });
    $(window).bind('resize', t_throttle(function () {
        window_width = $(window).width();
        if (window_width > 980) {
            menu.fadeIn(0);
        }
    }, 200));
} 
function t461_setLogoPadding(recid){
	if($(window).width()>980){			  
        var t461__menu = $('#rec'+recid+' .t461');
        var t461__logo=t461__menu.find('.t461__logowrapper');	  
        var t461__leftpart=t461__menu.find('.t461__leftwrapper');
        var t461__rightpart=t461__menu.find('.t461__rightwrapper');
        t461__leftpart.css("padding-right",t461__logo.width()/2+50);
        t461__rightpart.css("padding-left",t461__logo.width()/2+50);			        
	}
}

function t461_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t461__list_item a[href='"+url+"']").addClass("t-active");
  $(".t461__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t461__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t461__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t461__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t461__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t461_checkAnchorLinks(recid) {
	if($(window).width()>=960) {
	  var t461_navLinks = $("#rec"+recid+" .t461__desktoplist .t461__list_item a:not(.tooltipstered)[href*='#']");
      if (t461_navLinks.length>0){
      	t461_catchScroll(t461_navLinks);
      };
	}
}

function t461_catchScroll(t461_navLinks) {
    var t461_clickedSectionId = null,
        t461_sections = new Array(),
        t461_sectionIdTonavigationLink = [],
        t461_interval = 100,
        t461_lastCall, t461_timeoutId;
    t461_navLinks = $(t461_navLinks.get().reverse());
    t461_navLinks.each(function() {
        var t461_cursection = t461_getSectionByHref($(this));
        if (typeof t461_cursection.attr("id") != "undefined") {
            t461_sections.push(t461_cursection);
        }
        t461_sectionIdTonavigationLink[t461_cursection.attr("id")] = $(this);
    });
		t461_updateSectionsOffsets(t461_sections);
    t461_sections.sort(function(a, b) {
      return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
		$(window).bind('resize', t_throttle(function(){t461_updateSectionsOffsets(t461_sections);}, 200));
		$('.t461').bind('displayChanged',function(){t461_updateSectionsOffsets(t461_sections);});
		setInterval(function(){t461_updateSectionsOffsets(t461_sections);},5000);
    t461_highlightNavLinks(t461_navLinks, t461_sections, t461_sectionIdTonavigationLink, t461_clickedSectionId);

    t461_navLinks.click(function() {
        var t461_clickedSection = t461_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof t461_clickedSection.attr("id") != "undefined") {
            t461_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t461_clickedSectionId = t461_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function() {
        var t461_now = new Date().getTime();
        if (t461_lastCall && t461_now < (t461_lastCall + t461_interval)) {
            clearTimeout(t461_timeoutId);
            t461_timeoutId = setTimeout(function() {
                t461_lastCall = t461_now;
                t461_clickedSectionId = t461_highlightNavLinks(t461_navLinks, t461_sections, t461_sectionIdTonavigationLink, t461_clickedSectionId);
            }, t461_interval - (t461_now - t461_lastCall));
        } else {
            t461_lastCall = t461_now;
            t461_clickedSectionId = t461_highlightNavLinks(t461_navLinks, t461_sections, t461_sectionIdTonavigationLink, t461_clickedSectionId);
        }
    });
}


function t461_updateSectionsOffsets(sections){
	$(sections).each(function(){
		var t461_curSection = $(this);
		t461_curSection.attr("data-offset-top",t461_curSection.offset().top);
	});
}


function t461_getSectionByHref(curlink) {
    var t461_curLinkValue = curlink.attr("href").replace(/\s+/g, '');
    if (t461_curLinkValue[0]=='/') { t461_curLinkValue = t461_curLinkValue.substring(1); }
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + t461_curLinkValue.substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + t461_curLinkValue.substring(1) + "']");
    }
}

function t461_highlightNavLinks(t461_navLinks, t461_sections, t461_sectionIdTonavigationLink, t461_clickedSectionId) {
    var t461_scrollPosition = $(window).scrollTop(),
        t461_valueToReturn = t461_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t461_sections.length != 0 && t461_clickedSectionId == null && t461_sections[t461_sections.length-1].attr("data-offset-top") > (t461_scrollPosition + 300)){
      t461_navLinks.removeClass('t-active');
      return null;
    }

    $(t461_sections).each(function(e) {
        var t461_curSection = $(this),
            t461_sectionTop = t461_curSection.attr("data-offset-top"),
            t461_id = t461_curSection.attr('id'),
            t461_navLink = t461_sectionIdTonavigationLink[t461_id];
        if (((t461_scrollPosition + 300) >= t461_sectionTop) || (t461_sections[0].attr("id") == t461_id && t461_scrollPosition >= $(document).height() - $(window).height())) {
            if (t461_clickedSectionId == null && !t461_navLink.hasClass('t-active')) {
                t461_navLinks.removeClass('t-active');
                t461_navLink.addClass('t-active');
                t461_valueToReturn = null;
            } else {
                if (t461_clickedSectionId != null && t461_id == t461_clickedSectionId) {
                    t461_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t461_valueToReturn;
}


function t461_setPath(){
}

function t461_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t461").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);
      }
      });
      }else{
        $(".t461").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t461_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t461").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("top","-50px");
                                el.css("visibility","visible");
                                el.animate({"opacity": "1","top": "0px"}, 200,function() {
                                });
                            }
                          }else{
                            el.stop();
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t461_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t461").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t461_createMobileMenu(recid) {
    var el = $("#rec" + recid);
    var menu = el.find(".t461");
    var burger = el.find(".t461__mobile");

    burger.on('click', function (e) {
        $(menu).fadeToggle(300);
        $(this).toggleClass("t461_opened")
    });

    $(window).on('resize', t_throttle(function () {
        if ($(window).width() > 980) {
            $(menu).fadeIn(0);
        }
    }));
} 
function t462_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t462__list_item a[href='"+url+"']").addClass("t-active");
  $(".t462__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t462__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t462__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t462__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t462__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t462_checkAnchorLinks(recid) {
	if($(window).width()>=960) {
	  var t462_navLinks = $("#rec"+recid+" .t462__list_item a:not(.tooltipstered)[href*='#']");
      if (t462_navLinks.length>0){
      	t462_catchScroll(t462_navLinks);
      };
	}
}

function t462_catchScroll(t462_navLinks) {
    var t462_clickedSectionId = null,
      t462_sections = new Array(),
      t462_sectionIdTonavigationLink = {},
      t462_interval = 100,
      t462_lastCall,
      t462_timeoutId,
	  t462_offsetTop = $(".t270").attr("data-offset-top");
	if (typeof t462_offsetTop == "undefined") { t462_offsetTop = 0; }
	t462_navLinks = $(t462_navLinks.get().reverse());
	t462_navLinks.each(function(){
		var t462_cursection = t462_getSectionByHref($(this));
		if (typeof t462_cursection.attr("id") != "undefined") { t462_sections.push(t462_cursection); }
		t462_sectionIdTonavigationLink[t462_cursection.attr("id")] = $(this);
	});

	t462_highlightNavLinks(t462_navLinks,t462_sections,t462_sectionIdTonavigationLink,t462_clickedSectionId,t462_offsetTop);
	t462_navLinks.click(function() {		
		if (!$(this).hasClass("tooltipstered")) {
		  t462_navLinks.removeClass('t-active');	
          t462_sectionIdTonavigationLink[t462_getSectionByHref($(this)).attr("id")].addClass('t-active');
          t462_clickedSectionId = t462_getSectionByHref($(this)).attr("id");
		}
  	});
	$(window).scroll( function() {
		var t462_now = new Date().getTime();
		if (t462_lastCall && t462_now < (t462_lastCall + t462_interval) ) {
				clearTimeout(t462_timeoutId);
				t462_timeoutId = setTimeout(function () {
						t462_lastCall = t462_now;
						t462_clickedSectionId = t462_highlightNavLinks(t462_navLinks,t462_sections,t462_sectionIdTonavigationLink,t462_clickedSectionId,t462_offsetTop);
				}, t462_interval - (t462_now - t462_lastCall) );
		} else {
				t462_lastCall = t462_now;
				t462_clickedSectionId = t462_highlightNavLinks(t462_navLinks,t462_sections,t462_sectionIdTonavigationLink,t462_clickedSectionId,t462_offsetTop);
		}
	});
}

function t462_getSectionByHref (curlink) {
	if (curlink.is('[href*="#rec"]')) { return $(".r[id='"+curlink.attr("href").substring(1)+"']"); }
	else { 
	    var link = curlink.attr("href").replace('/','').substring(1);
	    return $(".r[data-record-type='215']").has("a[name='"+link+"']");
	}
}

function t462_highlightNavLinks(t462_navLinks,t462_sections,t462_sectionIdTonavigationLink,t462_clickedSectionId,offsetTop) {	   
	var t462_scrollPosition = $(window).scrollTop(),
		t462_valueToReturn = t462_clickedSectionId;
	$(t462_sections).each(function(e) {
			var t462_curSection = $(this),
					t462_sectionTop = t462_curSection.offset().top,
					t462_id = t462_curSection.attr('id'),
					t462_navLink = t462_sectionIdTonavigationLink[t462_id];
			if (t462_scrollPosition >= (t462_sectionTop - offsetTop) || (t462_sections[0].attr("id") == t462_id && $(window).scrollTop() >= $(document).height() - $(window).height())) {
				if (t462_clickedSectionId == null && !t462_navLink.hasClass('t-active')) {
					t462_navLinks.removeClass('t-active');
					t462_navLink.addClass('t-active');
					t462_valueToReturn = null;
				} else {
					if (t462_clickedSectionId != null && t462_id == t462_clickedSectionId) {
						t462_valueToReturn = null;
					}
				}
				return false;
			}
	});
	return t462_valueToReturn;
}

function t462_setPath(){
}

function t462_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t462").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);
      }
      });
      }else{
        $(".t462").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t462_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t462").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("top","-50px");
                                el.css("visibility","visible");
                                el.animate({"opacity": "1","top": "0px"}, 200,function() {
                                });
                            }
                          }else{
                            el.stop();
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t462_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t462").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t462_createMobileMenu(recid){
  var window_width=$(window).width(),
      el=$("#rec"+recid),
      menu=el.find(".t462"),
      burger=el.find(".t462__mobile");
  burger.click(function(e){
    menu.fadeToggle(300);
    $(this).toggleClass("t462_opened")
  })
  $(window).bind('resize', t_throttle(function(){
    window_width=$(window).width();
    if(window_width>980){
      menu.fadeIn(0);
    }
  }, 200));
}
 
function t466_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t466__item a[href='"+url+"']").addClass("t-active");
  $(".t466__item a[href='"+url+"/']").addClass("t-active");
  $(".t466__item a[href='"+pathname+"']").addClass("t-active");
  $(".t466__item a[href='/"+pathname+"']").addClass("t-active");
  $(".t466__item a[href='"+pathname+"/']").addClass("t-active");
  $(".t466__item a[href='/"+pathname+"/']").addClass("t-active");
}

function t466_checkAnchorLinks(recid) {
	if($(window).width()>=960) {
	  var t466_navLinks = $("#rec"+recid+" .t466__menu a:not(.tooltipstered)[href*='#']");
      if (t466_navLinks.length>0){
      	t466_catchScroll(t466_navLinks);
      };
	}
}

function t466_catchScroll(t466_navLinks) {
    var t466_clickedSectionId = null,
      t466_sections = new Array(),
      t466_sectionIdTonavigationLink = {},
      t466_interval = 100,
      t466_lastCall,
      t466_timeoutId,
	  t466_offsetTop = $(".t466").attr("data-offset-top");
	if (typeof t466_offsetTop == "undefined") { t466_offsetTop = 0; }
	t466_navLinks = $(t466_navLinks.get().reverse());
	t466_navLinks.each(function(){
		var t466_cursection = t466_getSectionByHref($(this));
		if (typeof t466_cursection.attr("id") != "undefined") { t466_sections.push(t466_cursection); }
		t466_sectionIdTonavigationLink[t466_cursection.attr("id")] = $(this);
	});

	t466_highlightNavLinks(t466_navLinks,t466_sections,t466_sectionIdTonavigationLink,t466_clickedSectionId,t466_offsetTop);
	t466_navLinks.click(function() {		
		if (!$(this).hasClass("tooltipstered")) {
		  t466_navLinks.removeClass('t-active');	
          t466_sectionIdTonavigationLink[t466_getSectionByHref($(this)).attr("id")].addClass('t-active');
          t466_clickedSectionId = t466_getSectionByHref($(this)).attr("id");
		}
  	});
	$(window).scroll( function() {
		var t466_now = new Date().getTime();
		if (t466_lastCall && t466_now < (t466_lastCall + t466_interval) ) {
				clearTimeout(t466_timeoutId);
				t466_timeoutId = setTimeout(function () {
						t466_lastCall = t466_now;
						t466_clickedSectionId = t466_highlightNavLinks(t466_navLinks,t466_sections,t466_sectionIdTonavigationLink,t466_clickedSectionId,t466_offsetTop);
				}, t466_interval - (t466_now - t466_lastCall) );
		} else {
				t466_lastCall = t466_now;
				t466_clickedSectionId = t466_highlightNavLinks(t466_navLinks,t466_sections,t466_sectionIdTonavigationLink,t466_clickedSectionId,t466_offsetTop);
		}
	});
}

function t466_getSectionByHref (curlink) {
	if (curlink.is('[href*="#rec"]')) { return $(".r[id='"+curlink.attr("href").substring(1)+"']"); }
	else { return $(".r[data-record-type='215']").has("a[name='"+curlink.attr("href").substring(1)+"']"); }
}

function t466_highlightNavLinks(t466_navLinks,t466_sections,t466_sectionIdTonavigationLink,t466_clickedSectionId,offsetTop) {	                                                      
	var t466_scrollPosition = $(window).scrollTop(),
		t466_valueToReturn = t466_clickedSectionId;
	$(t466_sections).each(function(e) {
			var t466_curSection = $(this),
					t466_sectionTop = t466_curSection.offset().top,
					t466_id = t466_curSection.attr('id'),
					t466_navLink = t466_sectionIdTonavigationLink[t466_id];
			if (t466_scrollPosition >= (t466_sectionTop - offsetTop) || (t466_sections[0].attr("id") == t466_id && $(window).scrollTop() >= $(document).height() - $(window).height())) {
				if (t466_clickedSectionId == null && !t466_navLink.hasClass('t-active')) {
					t466_navLinks.removeClass('t-active');
					t466_navLink.addClass('t-active');
					t466_valueToReturn = null;
				} else {
					if (t466_clickedSectionId != null && t466_id == t466_clickedSectionId) {
						t466_valueToReturn = null;
					}
				}
				return false;
			}
	});
	return t466_valueToReturn;
}

function t466_initMobileMenu(recid) {
  var window_width=$(window).width();
  var el = $("#rec"+recid);
  if(980>window_width){
    el.find(".t466").each(function() {
      $(this).find(".t466__mobile").css("top", $(this).find(".t466__container__bg_main").innerHeight() + 2);
      $(this).find(".t466__burger, a[href*='#']").click(function(){
        if ($(this).is(".tooltipstered, .t794__tm-link, .t978__tm-link, .t966__tm-link")) { return; }  
        el.toggleClass('t466_opened');
        $(this).closest(".t466").find(".t466__mobile").slideToggle(300);
      });
    });
  }
  $('.t466').bind('clickedAnchorInTooltipMenu',function(){
    el.removeClass('t466_opened');
    $(this).closest(".t466").find(".t466__mobile").slideUp(300);
  });  
}

function t466_appearMenu(recid) {
      var window_width=$(window).width();
      var record = $("#rec"+recid);
           record.find(".t466").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.hasClass('t466__beforeready')){
                                el.removeClass('t466__beforeready');
                            }
                          }else{
                            el.addClass('t466__beforeready');
                          }
                  }
           });

}

function t466_changeBgOpacityMenu(recid) {
  var window_width=$(window).width();
  var record = $("#rec"+recid);
  record.find(".t466__container__bg").each(function() {
        var el=$(this);
        var bgcolor=el.attr("data-bgcolor-rgba");
        var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
        var bgopacity=el.attr("data-bgopacity");
        var bgopacity_afterscroll=el.attr("data-bgopacity2");
        var menu_shadow=el.attr("data-menu-shadow");
        if ($(window).scrollTop() > 20) {
            el.css("background-color",bgcolor_afterscroll);
            if (bgopacity_afterscroll != "0" && bgopacity_afterscroll != "0.0") {
              el.css('box-shadow',menu_shadow);
            } else {
              el.css('box-shadow','none');
            }
        }else{
            el.css("background-color",bgcolor);
            if (bgopacity != "0" && bgopacity != "0.0") {
              el.css('box-shadow',menu_shadow);
            } else {
              el.css('box-shadow','none');
            }
        }
  });
} 
function t477_setHeight(recId, imgHeight) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var image = rec.querySelector('.t477__blockimg');
    var textWraps = rec.querySelectorAll('.t477__textwrapper');
    if (!textWraps) return;
    var cols = rec.querySelectorAll('.t477__col');
    var maxHeight = 0;
    
    if (imgHeight) image.style.height = imgHeight;

    for (var i = 0; i < cols.length; i++) {
        var col = cols[i];
        var colStyle = getComputedStyle(col, null);
        var colPaddingTop = parseInt(colStyle.paddingTop) || 0;
        var colPaddingBottom = parseInt(colStyle.paddingBottom) || 0;
        var colHeight = col.clientHeight - (colPaddingTop + colPaddingBottom);

        if (colHeight > maxHeight) maxHeight = colHeight;
    }
    
    for (var i = 0; i < textWraps.length; i++) {
        textWraps[i].style.height = maxHeight + 'px';
    }

    image.style.height = maxHeight + 'px';
} 
function t478_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var sizer = rec.querySelector('.t478__sizer');
    if (!sizer) return;
    var sizerStyle = getComputedStyle(sizer, null);
    var sizerPaddingTop = parseInt(sizerStyle.paddingTop);
    var sizerPaddingBottom = parseInt(sizerStyle.paddingBottom);
    var sizerPaddingLeft = parseInt(sizerStyle.paddingLeft);
    var sizerPaddingRight = parseInt(sizerStyle.paddingRight);
    var sizerHeight = sizer.clientHeight - (sizerPaddingTop + sizerPaddingBottom);
    var sizerWidth = sizer.clientWidth - (sizerPaddingLeft + sizerPaddingRight);
    var ratio = sizerWidth / sizerHeight;
    var wrappers = rec.querySelectorAll('.t478__blockimg, .t478__textwrapper');
    
    if (sizerHeight !== window.innerHeight) {
        for (var i = 0; i < wrappers.length; i++) {
            wrappers[i].style.height = (sizerWidth / ratio) + 'px';
        }
    }
} 
function t480_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t480');
    if (!container) return;

    t480_setHeight(recId);

    if (window.isMobile) {
        /* TODO: jq event */
        $(window).on('orientationchange', t_throttle(function() {
            setTimeout(function() {
                t480_setHeight(recId);
            }, 200);
        }));
        /* window.addEventListener('orientationchange', t_throttle(function() {
            setTimeout(function() {
                t480_setHeight(recId);
            }, 200);
        })); */
    } else {
        window.addEventListener('resize', t_throttle(function() {
            if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
            t480_setHeight(recId);
        }));
    }

    /* TODO: jq event */
    $(container).on('displayChanged', function() {
        t480_setHeight(recId);
    });

    /* container.addEventListener('displayChanged', function() {
        t480_setHeight(recId);
    }); */
}

function t480_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t480');
    if (!container) return;
    var sizer = rec.querySelector('.t480__sizer');
    var sizerStyle = getComputedStyle(sizer, null);
    var sizerPaddingTop = parseInt(sizerStyle.paddingTop);
    var sizerPaddingBottom = parseInt(sizerStyle.paddingBottom);
    var sizerPaddingLeft = parseInt(sizerStyle.paddingLeft);
    var sizerPaddingRight = parseInt(sizerStyle.paddingRight);
    var sizerHeight = sizer.clientHeight - (sizerPaddingTop + sizerPaddingBottom);
    var sizerWidth = sizer.clientWidth - (sizerPaddingLeft + sizerPaddingRight);
    var ratio = sizerWidth / sizerHeight;
    var imgWrapper = rec.querySelector('.t480__blockimg');
    var imgWidth = imgWrapper.clientWidth;
    var sizerAttrStyle = sizer.getAttribute('style');
    var windowHeight = window.innerHeight;

    if (window.isMobile && sizerAttrStyle && sizerAttrStyle.indexOf('vh') !== -1) {
        sizerHeight = document.documentElement.clientHeight * parseFloat(windowHeight / sizerHeight);
        imgWrapper.style.height = (imgWidth / ratio) + 'px';
    } else if (sizerHeight != windowHeight) {
        imgWrapper.style.height = (imgWidth / ratio) + 'px';
    }
} 
function t481_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t481__list_item a[href='"+url+"']").addClass("t-active");
  $(".t481__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t481__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t481__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t481__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t481__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t481_checkAnchorLinks(recid) {
	if($(window).width()>=960) {
	  var t481_navLinks = $("#rec"+recid+" .t481__list_item a:not(.tooltipstered)[href*='#']");
      if (t481_navLinks.length>0){
      	t481_catchScroll(t481_navLinks);
      };
	}
}

function t481_catchScroll(t481_navLinks) {
    var t481_clickedSectionId = null,
      t481_sections = new Array(),
      t481_sectionIdTonavigationLink = {},
      t481_interval = 100,
      t481_lastCall,
      t481_timeoutId,
	  t481_offsetTop = $(".t270").attr("data-offset-top");
	if (typeof t481_offsetTop == "undefined") { t481_offsetTop = 0; }
	t481_navLinks = $(t481_navLinks.get().reverse());
	t481_navLinks.each(function(){
		var t481_cursection = t481_getSectionByHref($(this));
		if (typeof t481_cursection.attr("id") != "undefined") { t481_sections.push(t481_cursection); }
		t481_sectionIdTonavigationLink[t481_cursection.attr("id")] = $(this);
	});

	t481_highlightNavLinks(t481_navLinks,t481_sections,t481_sectionIdTonavigationLink,t481_clickedSectionId,t481_offsetTop);
	t481_navLinks.click(function() {		
		if (!$(this).hasClass("tooltipstered")) {
		  t481_navLinks.removeClass('t-active');	
          t481_sectionIdTonavigationLink[t481_getSectionByHref($(this)).attr("id")].addClass('t-active');
          t481_clickedSectionId = t481_getSectionByHref($(this)).attr("id");
		}
  	});
	$(window).scroll( function() {
		var t481_now = new Date().getTime();
		if (t481_lastCall && t481_now < (t481_lastCall + t481_interval) ) {
				clearTimeout(t481_timeoutId);
				t481_timeoutId = setTimeout(function () {
						t481_lastCall = t481_now;
						t481_clickedSectionId = t481_highlightNavLinks(t481_navLinks,t481_sections,t481_sectionIdTonavigationLink,t481_clickedSectionId,t481_offsetTop);
				}, t481_interval - (t481_now - t481_lastCall) );
		} else {
				t481_lastCall = t481_now;
				t481_clickedSectionId = t481_highlightNavLinks(t481_navLinks,t481_sections,t481_sectionIdTonavigationLink,t481_clickedSectionId,t481_offsetTop);
		}
	});
}

function t481_getSectionByHref (curlink) {
	if (curlink.is('[href*="#rec"]')) { return $(".r[id='"+curlink.attr("href").substring(1)+"']"); }
	else { return $(".r[data-record-type='215']").has("a[name='"+curlink.attr("href").substring(1)+"']"); }
}

function t481_highlightNavLinks(t481_navLinks,t481_sections,t481_sectionIdTonavigationLink,t481_clickedSectionId,offsetTop) {	                                                      
	var t481_scrollPosition = $(window).scrollTop(),
		t481_valueToReturn = t481_clickedSectionId;
	$(t481_sections).each(function(e) {
			var t481_curSection = $(this),
					t481_sectionTop = t481_curSection.offset().top,
					t481_id = t481_curSection.attr('id'),
					t481_navLink = t481_sectionIdTonavigationLink[t481_id];                                                 			                                                      
			if (t481_scrollPosition >= (t481_sectionTop - offsetTop) || (t481_sections[0].attr("id") == t481_id && $(window).scrollTop() >= $(document).height() - $(window).height())) {
				if (t481_clickedSectionId == null && !t481_navLink.hasClass('t-active')) {
					t481_navLinks.removeClass('t-active');
					t481_navLink.addClass('t-active');					
					t481_valueToReturn = null;
				} else {
					if (t481_clickedSectionId != null && t481_id == t481_clickedSectionId) {
						t481_valueToReturn = null;
					}
				}
				return false;
			}
	});
	return t481_valueToReturn;
}

function t481_setPath(){
}

function t481_setWidth(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t481").each(function() {
      var el=$(this);
      var left_exist=el.find('.t481__leftcontainer').length;
      var left_w=el.find('.t481__leftcontainer').outerWidth(true);
      var max_w=left_w;
      var right_exist=el.find('.t481__rightcontainer').length;
      var right_w=el.find('.t481__rightcontainer').outerWidth(true);
    var items_align=el.attr('data-menu-items-align');
      if(left_w<right_w)max_w=right_w;
      max_w=Math.ceil(max_w);
      var center_w=0;
      el.find('.t481__centercontainer').find('li').each(function() {
        center_w+=$(this).outerWidth(true);
      });
      //console.log(max_w);
      //console.log(center_w);
      var padd_w=40;
      var maincontainer_width=el.find(".t481__maincontainer").outerWidth(true);
      if(maincontainer_width-max_w*2-padd_w*2>center_w+20){
          //if(left_exist>0 && right_exist>0){
      if(items_align=="center" || typeof items_align==="undefined"){
            el.find(".t481__leftside").css("min-width",max_w+"px");
            el.find(".t481__rightside").css("min-width",max_w+"px");
            
          }
       }else{
          el.find(".t481__leftside").css("min-width","");
          el.find(".t481__rightside").css("min-width","");  
          
      }
    });
  }
}

function t481_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t481").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);             
      }
      });
      }else{
        $(".t481").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t481_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t481").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("visibility","visible");
                                el.animate({"opacity": "1"}, 200,function() {
                                });       
                            }
                          }else{
                            el.stop();
                            el.animate({"opacity": "0"}, 200,function() {
                            });
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t481_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t481").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t481_createMobileMenu(recid){
  var window_width=$(window).width(),
      el=$("#rec"+recid),
      menu=el.find(".t481"),
      burger=el.find(".t481__mobile");
  burger.click(function(e){
    menu.fadeToggle(300);
    $(this).toggleClass("t481_opened")
  })
  $(window).bind('resize', t_throttle(function(){
    window_width=$(window).width();
    if(window_width>980){
      menu.fadeIn(0);
    }
  }, 200));
}

 
function t486_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var textWrapper = rec.querySelector('.t486__textwrapper');
    if (!textWrapper) return;
    var images = rec.querySelectorAll('.t486__blockimg');
    var imageContainer = rec.querySelector('.t486__imgcontainer');
    var imageHeight = images[0].clientWidth;

    if (window.innerWidth > 980) {
        for (var i = 0; i < images.length; i++) {
            images[i].style.height = imageHeight + 'px';
        }
        textWrapper.style.height = imageContainer.clientWidth + 'px';
    } else {
        var imageStyle = getComputedStyle(images[0], null);
        var imagePaddingLeft = parseInt(imageStyle.paddingLeft) || 0;
        var imagePaddingRight = parseInt(imageStyle.paddingRight) || 0;
        var imageWidth = images[0].clientWidth - (imagePaddingLeft + imagePaddingRight);

        for (var i = 0; i < images.length; i++) {
            images[i].style.height = imageWidth + 'px';
        }
        textWrapper.style.height = 'auto';
    }
} 
function t498_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var containers = rec.querySelectorAll('.t498 .t-container');

    for (var i = 0; i < containers.length; i++) {
        var container = containers[i];
        var heightBox = 0;
        var cols = container.querySelectorAll('.t498__col');
        
        for (var j = 0; j < cols.length; j++) {
            cols[j].style.height = '';
        }

        for (var j = 0; j < cols.length; j++) {
            var col = cols[j];
            var colStyle = getComputedStyle(col, null);
            var colPaddingTop = parseInt(colStyle.paddingTop) || 0;
            var colPaddingBottom = parseInt(colStyle.paddingBottom) || 0;
            var colHeight = col.clientHeight - (colPaddingTop + colPaddingBottom);
            var colWrap = col.querySelector('.t498__col-wrapper');
            var colWrapStyle = getComputedStyle(colWrap, null);
            var colWrapPaddingTop = parseInt(colWrapStyle.paddingTop) || 0;
            var colWrapPaddingBottom = parseInt(colWrapStyle.paddingBottom) || 0;
            var colWrapHeight = colWrap.clientHeight - (colWrapPaddingTop + colWrapPaddingBottom);

            if (colHeight < colWrapHeight) {
                col.style.height = colWrapHeight + 'px';
                heightBox = colWrapHeight;
            }

            if (colHeight > heightBox) heightBox = colHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = heightBox + 'px';
            }
        } else {
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = 'auto';
            }
        }
    }
}; 
function t504_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var containers = rec.querySelectorAll('.t504 .t-container');

    for (var i = 0; i < containers.length; i++) {
        var container = containers[i];
        var maxHeight = 0;
        var cols = container.querySelectorAll('.t504__col');
        
        for (var j = 0; j < cols.length; j++) {
            cols[j].style.height = '';
        }

        for (var j = 0; j < cols.length; j++) {
            var col = cols[j];
            var colStyle = getComputedStyle(col, null);
            var colPaddingTop = parseInt(colStyle.paddingTop) || 0;
            var colPaddingBottom = parseInt(colStyle.paddingBottom) || 0;
            var colHeight = col.clientHeight - (colPaddingTop + colPaddingBottom);
            var colWrap = col.querySelector('.t504__col-wrapper');
            var colWrapStyle = getComputedStyle(colWrap, null);
            var colWrapPaddingTop = parseInt(colWrapStyle.paddingTop) || 0;
            var colWrapPaddingBottom = parseInt(colWrapStyle.paddingBottom) || 0;
            var colWrapHeight = colWrap.clientHeight - (colWrapPaddingTop + colWrapPaddingBottom);

            if (colHeight < colWrapHeight) {
                col.style.height = colWrapHeight + 'px';
                maxHeight = colWrapHeight;
            }

            if (colHeight > maxHeight) maxHeight = colHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = 'auto';
            }
        }
    }
} 
function t505__createPieChart(recId, data1, data2, data3, data4, sectorColor, pieBgColor, bgcolor, blocksNumber, diagramWidth, diameter) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t505');
    if (!container) return;
    
    var radius;

    if (diameter > 300 || diameter == '' || diameter < 100) {
        if (diameter == '') {
            radius = 100;
            diameter = 200;
        }
        if (diameter > 300) {
            radius = 150;
            diameter = 300;
        }
        if (diameter < 100) {
            radius = 50;
            diameter = 100;
        }
    } else {
        radius = diameter / 2;
    }
    
    if (diagramWidth == '') diagramWidth = 10;
    if (diagramWidth > radius) diagramWidth = 10;
    if (diagramWidth < 1) diagramWidth = 1;

    /*check Retina*/
    if (window.devicePixelRatio >= 2) {
        var oldSize = diameter;

        radius = radius * 2;
        diameter = diameter * 2;
        diagramWidth = diagramWidth * 2;
    }

    /*border id drawing at the edge of circle, so we need correct the radius to fin into canvas*/
    var correction = +diagramWidth / 2;
    var dataArray = [data1, data2, data3, data4];
    
    for (var i = 0; i < 4; i++) {
        if (dataArray[i] != '' && blocksNumber > i) {
            var canvas = rec.querySelector('.t505__pie' + (i+1));
            
            canvas.setAttribute('width', diameter);
            canvas.setAttribute('height', diameter);

            var context = canvas.getContext('2d');

            if (window.devicePixelRatio >= 2) {
                canvas.style.width = oldSize + 'px';
                canvas.style.height = oldSize + 'px';
            }

            for (var j = 0; j < 2; j++) {
                if (j === 1 && dataArray[i] == 0) continue;

                /*0 - bg, 1 - percent sector*/
                if (j == 0) {
                    context.strokeStyle = pieBgColor;
                    var angle = Math.PI * 2;
                    context.lineWidth = diagramWidth - 1;
                } else {
                    context.strokeStyle = sectorColor;
                    var angle = Math.PI * 2 * (dataArray[i] / 100);
                    context.lineWidth = diagramWidth;
                }

                context.beginPath();
                context.lineCap = 'round';
                context.moveTo(diameter - correction, radius);
                context.arc(radius, radius, radius - correction, 0, angle, false);
                context.stroke();
            }
        }
    }
} 
function t509_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t509');
    if (!container) return;
    var images = rec.querySelectorAll('.t509__blockimg');

    for (var i = 0; i < images.length; i++) {
        var image = images[i];
        var imageWidth = image.getAttribute('data-image-width');
        var imageHeight = image.getAttribute('data-image-height');

        if (imageHeight.indexOf('vh') === -1) {
            imageHeight = parseInt(imageHeight, 10);
        } else {
            imageHeight = parseInt(imageHeight, 10) / 100 * window.innerHeight;
        }

        var imageRatio = imageHeight / imageWidth;
        var imagePadding = imageRatio * 100;

        image.style.paddingBottom = imagePadding + '%';
    }

    if (window.innerWidth > 960) {
        var desktopImage = rec.querySelector('.t509__desktopimg');
        if (desktopImage) {
            var height = desktopImage.clientHeight;
            var textWrappers = rec.querySelectorAll('.t509__textwrapper');
            for (var i = 0; i < textWrappers.length; i++) {
                textWrappers[i].style.height = height + 'px';
            }
        }
    }
} 
function t517_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t517');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var rows = rec.querySelectorAll('.t-container .t517__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var cols = row.querySelectorAll('.t517__col');
            var maxHeight = 0;

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var info = col.querySelector('.t517__sectioninfowrapper');
                var person = col.querySelector('.t517__personwrapper');
                var colHeight = (info ? info.offsetHeight : 0) + (person ? person.offsetHeight : 0);

                if (colHeight > maxHeight) maxHeight = colHeight;
            }

            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        }
    }
} 
function t518_unifyColHeadersHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t518');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var maxHeight = 0;
        var cols = rec.querySelectorAll('.t518__col-header');

        for (var i = 0; i < cols.length; i++) {
            var col = cols[i];
            var header = col.querySelector('.t518__col-header-inner');
            var headerHeight = header ? header.offsetHeight : 0;

            if (headerHeight > maxHeight) maxHeight = headerHeight;
        }

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = maxHeight + 'px';
        }
    }
}

function t518_unifyColItems(recId, prefixWidth) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t518');
    if (!container) return;

    /*if prefixwidth>400, there is just one column or block is empty*/
    if (window.innerWidth >= 960 && prefixWidth != 400) {
        var filterItems = [];
        var minItems = 0;
        var cols = rec.querySelectorAll('.t518__col');

        for (var i = 0; i < cols.length; i++) {
            var col = cols[i];
            var items = col.querySelectorAll('.t518__item');
            var itemsLength = items.length;

            if (itemsLength> 0) {
                filterItems.push(items);
            }

            if (itemsLength > 0 && ((itemsLength < minItems) || (minItems === 0))) {
                minItems = itemsLength;
            }
        }

        /*unifying items heights*/
        for (var i = 0; i < minItems; i++) {
            var maxHeight = 0;

            for (var j = 0; j < filterItems.length; j++) {
                var item = filterItems[j][i];
                var info = item.querySelector('.t518__sectioninfowrapper');
                var person = item.querySelector('.t518__personwrapper');
                var itemHeight = (info ? info.offsetHeight : 0) + (person ? person.offsetHeight : 0);

                if (itemHeight > maxHeight) maxHeight = itemHeight;
            }

            for (var j = 0; j < filterItems.length; j++) {
                var item = filterItems[j][i];

                if (item) item.style.height = maxHeight + 'px';

                var person = item.querySelector('.t518__personwrapper');

                if (person) person.style.position = 'absolute';
            }
        }
    }
} 
function t527_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t527');
    if (!container) return;
    var images = rec.querySelectorAll('.t527__bgimg');
    if (!images[0]) return;
    var imageWidth = images[0].getAttribute('data-image-width');
    var imageHeight = images[0].getAttribute('data-image-height');
    var imageRatio = imageHeight / imageWidth;
    var imagePadding = imageRatio * 100;

    for (var i = 0; i < images.length; i++) {
        images[i].style.paddingBottom = imagePadding + '%';
    }
} 
function t531_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t531');
    if (!container) return;
    var images = rec.querySelectorAll('.t531__blockimg');
    if (!images[0]) return;
    var imageWidth = images[0].getAttribute('data-image-width');
    var imageHeight = images[0].getAttribute('data-image-height');
    var imageRatio = imageHeight / imageWidth;
    var imagePadding = imageRatio * 100;

    for (var i = 0; i < images.length; i++) {
        images[i].style.paddingBottom = imagePadding + '%';
    }

    if (window.innerWidth > 480) {
        var textWrappers = rec.querySelectorAll('.t531__textwrapper');
        var imageWrapperHeight = rec.querySelector('.t531__imgwrapper').clientHeight;

        for (var i = 0; i < textWrappers.length; i++) {
            textWrappers[i].style.height = imageWrapperHeight + 'px';
        }
    }
} 
function t532__emulateMobileHover(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t532');
    if (!container) return;
    var cells = rec.querySelectorAll('.t532__cell');

    for (var i = 0; i < cells.length; i++) {
        var cell = cells[i];

        cell.addEventListener('mouseover', function() {
            this.classList.add('t532__cell_hover');
        });
    
        cell.addEventListener('mouseout', function() {
            this.classList.remove('t532__cell_hover');
        });
    }
}
  
function t532_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t532');
    if (!container) return;
    var bg = rec.querySelector('.t532__bg');
    if (!bg) return;
    var tables = rec.querySelectorAll('.t532__table');
    var bgWidth = bg.getAttribute('data-image-width');
    var bgHeight = bg.getAttribute('data-image-height');
    var bgRatio = bgHeight / bgWidth;
    var height = tables[0].clientWidth * bgRatio;

    for (var i = 0; i < tables.length; i++) {
        tables[i].style.height = height + 'px';
    }
}   
function t533_equalHeight(recId){
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t533');
    if (!container) return;
    var rows = rec.querySelectorAll('.t533__row');
    var wrapTexts = rec.querySelectorAll('.t533__textwrapper');

    container.style.visibility = 'visible';

    for (var i = 0; i < wrapTexts.length; i++) {
        wrapTexts[i].style.height = 'auto';
    }

    for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var heightBox = 0;
        var rowWrapTexts = row.querySelectorAll('.t533__textwrapper');

        for (var j = 0; j < rowWrapTexts.length; j++) {
            var element = rowWrapTexts[j];
            var styleElement = getComputedStyle(element, null);
            var paddingTop = parseInt(styleElement.paddingTop.replace('px', '')) || 0;
            var paddingBottom = parseInt(styleElement.paddingBottom.replace('px', '')) || 0;
            var elementHeight = element.clientHeight - (paddingTop + paddingBottom);
            
            if (elementHeight > heightBox) heightBox = elementHeight;
        }

        for (var j = 0; j < rowWrapTexts.length; j++) {
            var element = rowWrapTexts[j];

            if (window.innerWidth >= 960 && element.offsetParent !== null) {
                element.style.height = heightBox + 'px';
            } else {
                element.style.height = 'auto';
            }
        }
    }
}; 
function t534_setWidth(recid){
  var el = $('#rec'+recid),
      topsection = el.find('.t534__topsection'),
      slidewidth = el.find('.t-slides__container').width();
  topsection.css('max-width', slidewidth);
} 
function t536_setWidth(recid){
  var el = $('#rec'+recid),
      topsection = el.find('.t536__topsection'),
      slidewidth = el.find('.t-slides__container').width();
  topsection.css('max-width', slidewidth);
} 
function t537_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t537');
    if (!container) return;
    var images = rec.querySelectorAll('.t537__bgimg');
    if (!images[0]) return;
    var imageWidth = images[0].getAttribute('data-image-width');
    var imageHeight = images[0].getAttribute('data-image-height');
    var imageRatio = imageHeight / imageWidth;
    var imagePadding = imageRatio * 100;

    for (var i = 0; i < images.length; i++) {
        images[i].style.paddingBottom = imagePadding + '%';
    }
} 
function t538_setWidth(recid){
  var el = $('#rec'+recid),
      topsection = el.find('.t538__topsection'),
      slidewidth = el.find('.t-slides__container').width();
  topsection.css('max-width', slidewidth);
} 
function t539_equalHeight(recId, blocks) {
    if (!blocks || +blocks === 0) return false;
    
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t539');
    if (!container) return;
    var textWrappers = rec.querySelectorAll('.t539__textwrapper');
    var contents = Array.prototype.slice.call(textWrappers);
    var count = 0;

    for (var i = 0; i < contents.length; i++) {
        contents[i].style.height = 'auto';
    }

    if (window.innerWidth <= 480) {
        container.style.visibility = 'visible';
        return;
    }

    if (window.innerWidth <= 960) {
        count = 2;
    } else {
        count = +blocks;
    }

    for (var i = 0; i < contents.length; i += count) {
        var maxHeight = 0;
        var cols = contents.slice(i, i + count);

        for (var j = 0; j < cols.length; j++) {
            var col = cols[j];
            var colHeight = col.offsetHeight;
            
            if (colHeight > maxHeight) maxHeight = colHeight;
        }
        
        for (var j = 0; j < cols.length; j++) {
            cols[j].style.height = maxHeight + 'px';
        }
    }

    container.style.visibility = 'visible';
}

function t539_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t539');
    if (!container) return;
    var images = rec.querySelectorAll('.t539__bgimg');
    if (!images[0]) return;
    var imageWidth = images[0].getAttribute('data-image-width');
    var imageHeight = images[0].getAttribute('data-image-height');
    var imageRatio = imageHeight / imageWidth;
    var imagePadding = imageRatio * 100;

    for (var i = 0; i < images.length; i++) {
        images[i].style.paddingBottom = imagePadding + '%';
    }
} 
function t544_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t544');
    if (!container) return;
    var sizer = rec.querySelector('.t544__sizer');
    var sizerStyle = getComputedStyle(sizer, null);
    var sizerPaddingLeft = parseInt(sizerStyle.paddingLeft) || 0;
    var sizerPaddingRight = parseInt(sizerStyle.paddingRight) || 0;
    var sizerPaddingTop = parseInt(sizerStyle.paddingTop) || 0;
    var sizerPaddingBottom = parseInt(sizerStyle.paddingBottom) || 0;
    var sizerHeight = sizer.clientHeight - (sizerPaddingTop + sizerPaddingBottom);
    var sizerWidth = sizer.clientWidth - (sizerPaddingLeft + sizerPaddingRight);
    var sizerRatio = sizerWidth / sizerHeight;
    var elements = rec.querySelectorAll('.t544__blockimg, .t544__textwrapper');
    var elementStyle = getComputedStyle(elements[0], null);
    var elementPaddingLeft = parseInt(elementStyle.paddingLeft) || 0;
    var elementPaddingRight = parseInt(elementStyle.paddingRight) || 0;
    var elementWidth = elements[0].clientWidth - (elementPaddingLeft + elementPaddingRight);
    var maxHeight = elementWidth / sizerRatio;

    if (sizerHeight !== window.innerHeight) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = maxHeight + 'px';
        }
    }
} 
function t545_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t-container');
    if (!container) return;
    var cols = container.querySelectorAll('.t545__col');
    var elements = container.querySelectorAll('.t545__textwrapper, .t545__blockimg');
    var height = container.getAttribute('data-height');
    var maxHeight = 0;

    for (var i = 0; i < cols.length; i++) {
        var col = cols[i];
        var colStyle = getComputedStyle(col, null);
        var colPaddingTop = parseInt(col.paddingTop) || 0;
        var colPaddingBottom = parseInt(col.paddingBottom) || 0;
        var colHeight = col.clientHeight - (colPaddingTop + colPaddingBottom);

        if (colHeight > maxHeight) maxHeight = colHeight;
    }

    if (height > maxHeight) {
        maxHeight = height;
    }

    for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = maxHeight + 'px';
    }
} 
function t552_init(recid, ratio) {
	var rec = document.getElementById('rec' + recid);
	var recordBlock = rec ? rec.querySelector('.t552') : null;
	t552__setHeight(recid, ratio);
	
	window.addEventListener('resize', t_throttle(function() {
		t552__setHeight(recid, ratio);
	}));
	
	if (typeof jQuery !== 'undefined') {
		$(recordBlock).on('displayChanged', function () {
			t552__setHeight(recid, ratio);
		});
	} else {
		if (recordBlock) {
			recordBlock.addEventListener('displayChanged', function () {
				t552__setHeight(recid, ratio);
			});
		}
	}
}

function t552__setHeight(recid, ratio) {
	var rec = document.getElementById('rec' + recid);
	var firstIMG = rec.querySelector('.t552__blockimg');
	var images = rec.querySelectorAll('.t552__blockimg');
	Array.prototype.forEach.call(images, function(img) {
		var calculatedHeight = Math.floor(firstIMG.offsetWidth * ratio);
		img.style.height = calculatedHeight + 'px';
	});
} 
function t554__init(recid) {
    var el = $('#rec' + recid);
    var mapHeight = parseFloat(el.find('.t554_map').height());
    var cardHeight = parseFloat(el.find('.t554__card').outerHeight());
    var cardTop = parseFloat((el.find('.t554__card').css('top') || '').replace('px', ''));

    if (mapHeight < cardHeight + cardTop && $(window).width() > 960 && el.find('.t554__general-wrapper').hasClass('t554__general-wrapper_padding')) {
        var paddBottom = (cardHeight + cardTop) - mapHeight;
        el.find('.t554__general-wrapper').css('padding-bottom', paddBottom + 'px');
    }
} 
function t557_init(recid, snowtype) {
    $('<img/>').attr('src', 'https://static.tildacdn.com/img/snowflakes_1.png').load(function () {
        $(this).remove();
    });
    $('<img/>').attr('src', 'https://static.tildacdn.com/img/snowflakes_2.png').load(function () {
        $(this).remove();
    });
    $('<img/>').attr('src', 'https://static.tildacdn.com/img/snowflakes_3.png').load(function () {
        $(this).remove();
        t557__addSnow(recid, snowtype);
    });
}

function t557__addSnow(recid, snowtype) {
    var el = $('#rec' + recid),
        t557_ids = el.find('.t557__snow-recid-holder').attr('data-snow-rec-ids').split(',');
    if (t557_ids != "") {
        t557_ids.forEach(function (rec_id, i, arr) {
            var t557_zeroattr = $('#rec' + rec_id).attr('data-record-type');
            if (t557_zeroattr == 396) {
                var t557_wrappertype = " .t396__artboard";
            } else {
                var t557_wrappertype = " .t-cover";
            }
            var t557_cover = document.querySelector('#rec' + rec_id + t557_wrappertype);
            /* dv12 layer conflict */
            $(t557_cover).find('.t796__shape-border').css('z-index', 1);
            if (t557_cover != null) {
                var t557_snow = document.createElement('div');
                t557_snow.className = snowtype;
                t557_cover.appendChild(t557_snow);
            }
        });
    } else {
        t557_cover = $('.t-cover').first();
        var t557_snow = document.createElement('div');
        t557_snow.className = snowtype;
        t557_cover.append(t557_snow);
    }
    $('.' + snowtype).animate({
        "opacity": "1"
    }, 1000, function () {});
}
 
function t569_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t569');
    if (!container) return;
    var lines = rec.querySelectorAll('.t569__line');
    var blocksCount = container.getAttribute('data-blocks-count');
    var circleCount = 4;

    if (blocksCount !== '4') circleCount = 8;

    for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        var cirqles = line.querySelector('.t569__cirqle');

        for (var j = 0; j < circleCount; j++) {
            line.insertBefore(cirqles.cloneNode(true), cirqles.nextSibling);
        }
    }

    function t569_update() {
        var col = rec.querySelector('.t569__col');
        var colWidth = 0;
        var bgImg = rec.querySelector('.t569__bgimg');
        var bgWidth = 0;
        
        if (col) {
            var colStyle = getComputedStyle(col, null);
            var colPaddingLeft = parseInt(colStyle.paddingLeft) || 0;
            var colPaddingRight = parseInt(colStyle.paddingRight) || 0;
            
            colWidth = col.clientWidth - (colPaddingLeft + colPaddingRight);
        }

        if (bgImg) bgWidth = bgImg.offsetWidth;

        for (var i = 0; i < lines.length; i++) {
            lines[i].style.maxWidth = (colWidth - bgWidth) + 'px';
        }
    }

    if (window.isMobile) {
        /* TODO jq event */
        $(window).on('orientationchange', t_throttle(t569_update));

        /*window.addEventListener('orientationchange', t_throttle(t569_update));*/
    } else {
        window.addEventListener('resize', t_throttle(t569_update));
    }

    /* TODO jq event */
    $(container).on('displayChanged', t_throttle(t569_update));

    /*container.addEventListener('displayChanged', t_throttle(t569_update));*/

    t569_update();
} 
function t570_init(recid){
if($(window).width()>750){
  t570_setMapHeight(recid);

  $(window).on('load', function() {
      t570_setMapHeight(recid);
  });

  $(window).on('resize', function(){
    t570_setMapHeight(recid);
  });
}
}

function t570_setMapHeight(recid) {
  var t570__el=$('#rec'+recid),
  	  t570__map = t570__el.find('.t-map');
  var t570__textwrapper = t570__el.find('.t570__col_text').height();
  t570__map.css('height', t570__textwrapper).trigger('sizechange');
} 
function t576_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t576');
    if (!container) return;
    var items = rec.querySelectorAll('.t576__item');
    var firstItem = items[0];
    var lastItem = items[items.length - 1];

    for (var i = 0; i < items.length; i++) {
        var item = items[i];
        var circle = item.querySelector('.t576__circle');
        var img = item.querySelector('.t576__img');
        var imgHeight = 0;

        if (img) imgHeight = img.offsetHeight;
        if (circle) circle.style.top = (imgHeight + 15) + 'px';
    }

    if (firstItem) {
        var firstLine = firstItem.querySelector('.t576__line');
        var firstImg = firstItem.querySelector('.t576__img');
        var firstImgHeight = 0;

        if (firstImg) firstImgHeight = firstImg.offsetHeight;
        if (firstLine) firstLine.style.top = (firstImgHeight + 15) + 'px';
    }

    if (lastItem) {
        var lastLine = lastItem.querySelector('.t576__line');
        var lastImg = lastItem.querySelector('.t576__img');
        var lastImgHeight = 0;

        if (lastImg) lastImgHeight = lastImg.offsetHeight;
        if (lastLine) lastLine.style.height = (lastImgHeight + 20) + 'px';
    }
} 
function t577_equalHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t577');
    if (!container) return;

    container.style.visibility = 'visible';

    var rows = rec.querySelectorAll('.t577__row');
    var textWrappers = rec.querySelectorAll('.t577__textwrapper');
    var descriptions = rec.querySelectorAll('.t577__descr');

    for (var i = 0; i < textWrappers.length; i++) {
        textWrappers[i].style.height = 'auto';
    }

    for (var i = 0; i < descriptions.length; i++) {
        descriptions[i].style.height = 'auto';
    }

    for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var descrs = row.querySelectorAll('.t577__descr');
        var maxHeight = 0;

        for (var j = 0; j < descrs.length; j++) {
            var descr = descrs[j];
            var descrStyle = getComputedStyle(descr, null);
            var descrPaddingTop = parseInt(descrStyle.paddingTop) || 0;
            var descrPaddingBottom = parseInt(descrStyle.paddingBottom) || 0;
            var descrHeight = descr.clientHeight - (descrPaddingTop + descrPaddingBottom);

            if (descrHeight > maxHeight) maxHeight = descrHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < descrs.length; j++) {
                descrs[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < descrs.length; j++) {
                descrs[j].style.height = 'auto';
            }
        }

        var textWraps = row.querySelectorAll('.t577__textwrapper');

        maxHeight = 0;

        for (var j = 0; j < textWraps.length; j++) {
            var textWrap = textWraps[j];
            var textWrapStyle = getComputedStyle(textWrap, null);
            var textWrapPaddingTop = parseInt(textWrapStyle.paddingTop) || 0;
            var textWrapPaddingBottom = parseInt(textWrapStyle.paddingBottom) || 0;
            var textWrapHeight = textWrap.clientHeight - (textWrapPaddingTop + textWrapPaddingBottom);

            if (textWrapHeight > maxHeight) maxHeight = textWrapHeight;
        }

        if (window.innerWidth >= 960) {
            for (var j = 0; j < textWraps.length; j++) {
                textWraps[j].style.height = maxHeight + 'px';
            }
        } else {
            for (var j = 0; j < textWraps.length; j++) {
                textWraps[j].style.height = 'auto';
            }
        }
    }
} 
function t582_init(recid){
    $(document).ready(function() {
      var t582__showMenu;
      $(window).bind('scroll', t_throttle(function(){
        clearTimeout(t582__showMenu);
        t582__showMenu = setTimeout(function() {t582_appearMenu(recid);}, 50);
      }, 200));
      $('.t582').removeClass('t582__beforeready');
      t582_appearMenu(recid);
    });
}

function t582_appearMenu(recid) {
  $(".t582").each(function() {
    var el=$(this),
        appearoffset=el.attr("data-appearoffset"),
        window_width=$(window).width(),
				window_scrollTop=$(window).scrollTop(),
				window_height=$(window).height();
    if(window_width<=980 && appearoffset!=""){appearoffset="150";}
		if(appearoffset==""){appearoffset="0";}
    if(appearoffset.indexOf('vh') > -1){ appearoffset = Math.floor((window_height * (parseInt(appearoffset) / 100))); }
		appearoffset=parseInt(appearoffset, 10);

    if (window_scrollTop >= appearoffset && window_scrollTop+window_height+70 <= $(document).height()) {
      if(el.css('visibility') == 'hidden'){
          el.finish();
          el.css("bottom","-100px");
          el.css("visibility","visible");
          el.animate({"opacity": "1","bottom": "0"}, 400,function() {
          });
      }
    }else{
      el.stop();
      el.css("visibility","hidden");
        el.css("opacity","0");
    }
  });
}
 
function t585_init(recid) {
    var el = $('#rec' + recid);
    var toggler = el.find(".t585__header");

    var accordion = el.find('.t585__accordion');
    if (accordion) {
        accordion = accordion.attr('data-accordion');
    } else {
        accordion = "false";
    }
    
    var scrolltoExpand = el.find('.t585__accordion').attr('data-scroll-to-expanded');
    
    toggler.click(function () {
        if (accordion === "true") {
            toggler.not(this).removeClass("t585__opened").next().slideUp();
        }
        
        $(this).toggleClass("t585__opened");
        var _this = $(this);
        $(this).next().slideToggle(function() {
            if (scrolltoExpand === "true") {
                $('html, body').animate({
                    scrollTop: $(_this).offset().top || el.offset().top
                }, 300);
            }
        });
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    });
} 
function t590_init(recid,height){	
  t590__setHeight(recid,height);  

  var t590__doResize;
  $(window).resize(function(){
    clearTimeout(t590__doResize);
    t590__doResize = setTimeout(function() {
    	t590__setHeight(recid);
    }, 200);
  });
}

function t590__setHeight(recid,height) {      
  if (height=="" || typeof height=="undefined"){
  var t590__el=$("#rec"+recid),
      t590__div=t590__el.find("#youtubeiframe"+recid),
      t590__height=t590__div.width() * 0.5625;
  t590__div.height(t590__height);
  t590__div.parent().height(t590__height);         
  }  
} 
function t592_init(recId){
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t592');
    if (!container) return;

    var descriptions = rec.querySelectorAll('.t592__descr');
    var maxHeight = 0;

    for (var i = 0; i < descriptions.length; i++) {
        descriptions[i].style.height = '';
    }

    for (var i = 0; i < descriptions.length; i++) {
        var description = descriptions[i];
        var descriptionStyle = getComputedStyle(description, null);
        var descriptionPaddingTop = parseInt(descriptionStyle.paddingTop) || 0;
        var descriptionPaddingBottom = parseInt(descriptionStyle.paddingBottom) || 0;
        var descriptionHeight = description.clientHeight - (descriptionPaddingTop + descriptionPaddingBottom);

        if (descriptionHeight > maxHeight) maxHeight = descriptionHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < descriptions.length; i++) {
            descriptions[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < descriptions.length; i++) {
            descriptions[i].style.height = '';
        }
    }
} 
function t598_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t598');
    if (!container) return;

    t598_setEqualHeight(recId);

    window.addEventListener('resize', t_throttle(function() {
        t598_setEqualHeight(recId);
    }));

    /* TODO: jq event */
    $(container).on('displayChanged', function() {
        t598_setEqualHeight(recId);
    });

    /*container.addEventListener('displayChanged', function() {
        t598_setEqualHeight(recId);
    });*/
}

function t598_setEqualHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t598');
    if (!container) return;

    var titles = rec.querySelectorAll('.t598__title');
    var descriptions = rec.querySelectorAll('.t598__descr');
    var prices = rec.querySelectorAll('.t598__price');
    var imageWrappers = rec.querySelectorAll('.t598__imgwrapper');

    if (titles.length > 0) t598_updateHeight(titles);
    if (descriptions.length > 0) t598_updateHeight(descriptions);
    if (prices.length > 0) t598_updateHeight(prices);
    if (imageWrappers.length > 0) {
        t598_updateHeight(imageWrappers);

        window.onload = function() {
            t598_updateHeight(imageWrappers);
        };
    }
}

function t598_updateHeight(elements) {
    var maxHeight = 0;

    for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = '';
    }

    for (var i = 0; i < elements.length; i++) {
        var element = elements[i];
        var elementStyle = getComputedStyle(element, null);
        var elementPaddingTop = parseInt(elementStyle.paddingTop) || 0;
        var elementPaddingBottom = parseInt(elementStyle.paddingBottom) || 0;
        var elementHeight = element.clientHeight - (elementPaddingTop + elementPaddingBottom);

        if (elementHeight > maxHeight) maxHeight = elementHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = '';
        }
    }
} 
function t599_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t599');
    if (!container) return;

    var titles = rec.querySelectorAll('.t599__title');
    var descriptions = rec.querySelectorAll('.t599__descr');
    var prices = rec.querySelectorAll('.t599__price');
    var subtitles = rec.querySelectorAll('.t599__subtitle');

    if (titles.length > 0) t599_equalHeight(titles);
    if (descriptions.length > 0) t599_equalHeight(descriptions);
    if (prices.length > 0) t599_equalHeight(prices);
    if (subtitles.length > 0) t599_equalHeight(subtitles);
}
  
function t599_equalHeight(elements) {
    var maxHeight = 0;

    for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = '';
    }

    for (var i = 0; i < elements.length; i++) {
        var element = elements[i];
        var elementStyle = getComputedStyle(element, null);
        var elementPaddingTop = parseInt(elementStyle.paddingTop) || 0;
        var elementPaddingBottom = parseInt(elementStyle.paddingBottom) || 0;
        var elementHeight = element.clientHeight - (elementPaddingTop + elementPaddingBottom);

        if (elementHeight > maxHeight) maxHeight = elementHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = '';
        }
    }
} 
function t601_init(recid) {
  var el=$('#rec'+recid);
  var slide1=el.find('[data-slide-index=1]');
  var imagesSlide1=slide1.find('.t601__img');
  imagesSlide1.on('load',function() {
    if ($(this).parents('.t-slides__item[data-slide-index=1]').length==0){ return; }
    t_slides_setSliderHeight(recid);
  });
} 
function t602_init(recid) {
	$(window).on('scroll', t_throttle(function() {
        t602_setProgressBarWidth(recid);
    }, 100));
}

function t602_setProgressBarWidth(recid) {
	var t602_windowScrollTop = $(window).scrollTop(),
			t602_docHeight = $(document).height(),
			t602_winHeight = $(window).height();
			t602_scrollPercent = (t602_windowScrollTop / (t602_docHeight-t602_winHeight)) * 100;
	$(".t602__indicator").css('width', t602_scrollPercent + '%');
}
 
function t604_init(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	t604_imageHeight(recid);
	t604_arrowWidth(recid);
	t604_show(recid);
	t604_hide(recid);
	
	window.addEventListener('resize', t_throttle(function () {
		t_onFuncLoad('t_slds_updateSlider', function () {
			t_slds_updateSlider(recid);
		});
		t604_arrowWidth(recid);
	}));
	
	if (typeof jQuery !== 'undefined') {
		$(rec).find('.t604').bind('displayChanged', function () {
			t_onFuncLoad('t_slds_updateSlider', function () {
				t_slds_updateSlider(recid);
			});
			t604_arrowWidth(recid);
		});
	} else {
		var currentBlock = rec.querySelector('.t604');
		if (currentBlock) {
			currentBlock.addEventListener('displayChanged', function () {
				t_onFuncLoad('t_slds_updateSlider', function () {
					t_slds_updateSlider(recid);
				});
				t604_arrowWidth(recid);
			});
		}
	}
}

function t604_show(recid) {
	var rec = document.getElementById('rec' + recid);
	var playBtns = rec.querySelectorAll('.t604__play');
	Array.prototype.forEach.call(playBtns, function (play) {
		play.addEventListener('click', function () {
			var parent = play.parentElement;
			var videoBg = parent ? parent.querySelector('.t-slds__bgimg') : null;
			if (videoBg) videoBg.style.opacity = '0';
			var sliderVideo = play.getAttribute('data-slider-video-type');
			var url = play.getAttribute('data-slider-video-url');
			var nextEl = play.nextElementSibling;
			if (nextEl) nextEl.style.zIndex = '3';
			var iframe;
			switch (sliderVideo) {
				case 'youtube':
					iframe = document.createElement('iframe');
					iframe.classList.add('t604__iframe');
					iframe.width = '100%';
					iframe.height = '100%';
					iframe.src = 'https://www.youtube.com/embed/' + url + '?autoplay=1&enablejsapi=1';
					iframe.frameBorder = '0';
					iframe.setAttribute('webkitallowfullscreen', '');
					iframe.setAttribute('mozallowfullscreen', '');
					iframe.setAttribute('allowfullscreen', '');
					if (nextEl) nextEl.innerHTML = '';
					if (nextEl) nextEl.appendChild(iframe);
					break;
				case 'vimeo':
					var idMatch = /vimeo[^/]*\/(\d+)\/?(\w*)\/?/i.exec(url);
					var id = idMatch ? idMatch[1] : null;
					var hash = idMatch ? '?h=' + idMatch[2] : null;
					iframe = document.createElement('iframe');
					iframe.classList.add('t604__iframe');
					iframe.width = '100%';
					iframe.height = '100%';
					iframe.src = 'https://player.vimeo.com/video/' + id + hash + '?autoplay=1&amp;api=1';
					iframe.frameBorder = '0';
					iframe.setAttribute('webkitallowfullscreen', '');
					iframe.setAttribute('mozallowfullscreen', '');
					iframe.setAttribute('allowfullscreen', '');
					if (nextEl) nextEl.innerHTML = '';
					if (nextEl) nextEl.appendChild(iframe);
					break;
			}
		});
	});
}

function t604_hide(recid) {
	var rec = document.getElementById('rec' + recid);
	var frames = rec.querySelectorAll('.t604__frame');
	rec.addEventListener('updateSlider', function () {
		Array.prototype.forEach.call(frames, function (frame) {
			frame.innerHTML = '';
			frame.style.zIndex = '';
		});
	});
}

function t604_imageHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	var images = rec.querySelectorAll('.t604__separator');
	Array.prototype.forEach.call(images, function (image) {
		var imgHeight = image.getAttribute('data-slider-image-height');
		var imgWidth = image.getAttribute('data-slider-image-width');
		var imgRatio = imgHeight / imgWidth;
		var imgPadding = imgRatio * 100;
		image.style.paddingBottom = imgPadding + '%';
	});
}

function t604_arrowWidth(recid) {
	var rec = document.getElementById('rec' + recid);
	var arrows = rec.querySelectorAll('.t-slds__arrow_wrapper');
	var slide = rec.querySelector('.t-slds__wrapper');
	var slideWidth = slide ? slide.offsetWidth : 0;
	var arrowWidth = window.innerWidth - slideWidth;
	Array.prototype.forEach.call(arrows, function (arrow) {
		arrow.style.width = window.innerWidth > 960 ? (arrowWidth / 2) + 'px' : '';
	});
} 
function t607_init(recid) {
	t607_checkAnchorLinks(recid);
}


function t607_checkAnchorLinks(recid) {
	if($(window).width()>=960) {
	  var t607_navLinks = $("#rec"+recid+" .t607__list_item a:not(.tooltipstered)[href*='#']");
      if (t607_navLinks.length>0){
      	t607_catchScroll(t607_navLinks);
      };
	}
}


function t607_catchScroll(t607_navLinks) {
    var t607_clickedSectionId = null,
      t607_sections = new Array(),
      t607_sectionIdTonavigationLink = {},
      t607_interval = 100,
      t607_lastCall,
      t607_timeoutId;
	t607_navLinks = $(t607_navLinks.get().reverse());
	t607_navLinks.each(function(){
		var t607_cursection = t607_getSectionByHref($(this));
		if (typeof t607_cursection.attr("id") != "undefined") { t607_sections.push(t607_cursection); }
		t607_sectionIdTonavigationLink[t607_cursection.attr("id")] = $(this);
	});
	t607_highlightNavLinks(t607_navLinks,t607_sections,t607_sectionIdTonavigationLink,t607_clickedSectionId);
	setTimeout(function() { t607_highlightNavLinks(t607_navLinks,t607_sections,t607_sectionIdTonavigationLink,t607_clickedSectionId); }, 1000);

	$(document).keydown(function(e) {
		var t607_direction = "";
		switch(e.which) {
				case 38: t607_direction = "top"; break;
				case 40: t607_direction = "bottom"; break;
				case 33: t607_direction = "top"; break;
				case 34: t607_direction = "bottom"; break;
				default: return;
		}
		if (t607_direction!="") {
			var t607_curActiveSectionId = t607_getSectionByHref(t607_navLinks.filter(".t-active")).attr("id"),
			 		t607_newActiveSectionIndex = $.map(t607_sections, function(obj, index) {
			    if(obj.attr("id") == t607_curActiveSectionId && t607_direction == "top") { return index + 1; }
					if(obj.attr("id") == t607_curActiveSectionId && t607_direction == "bottom") { return index - 1; }
			});
			var t607_newActiveSection = t607_sections[t607_newActiveSectionIndex[0]];
			if (typeof t607_newActiveSection == "undefined") { return; }

			t607_navLinks.removeClass('t-active');
			var	$root = $('html, body'),
					t607_offsetTop = $(".t607").attr("data-offset-top");
			t607_sectionIdTonavigationLink[t607_newActiveSection.attr("id")].addClass('t-active');
			t607_clickedSectionId = t607_newActiveSection.attr("id");
			if (typeof t607_offsetTop!="undefined") { $root.animate({ scrollTop: t607_newActiveSection.offset().top - t607_offsetTop}, 500); }
			else { $root.animate({ scrollTop: t607_newActiveSection.offset().top}, 500); }
		}
	});

	t607_navLinks.click(function () {
	    if (!$(this).hasClass("tooltipstered")) {
	        t607_navLinks.removeClass('t-active');
	        var t607_clickedSection = t607_getSectionByHref($(this));
	        var $root = $('html, body');
	        var t607_offsetTop = $(".t607").attr("data-offset-top");

            if (t607_clickedSection.length === 0) return;

	        if (!$(this).hasClass("t-active")) {
	            t607_clickedSectionId = t607_clickedSection.attr("id");
	        }
	        t607_sectionIdTonavigationLink[t607_clickedSection.attr("id")].addClass('t-active');
	        if (typeof t607_offsetTop != "undefined") {
	            $root.animate({
	                scrollTop: t607_clickedSection.offset().top - t607_offsetTop
	            }, 500);
	        } else {
	            $root.animate({
	                scrollTop: t607_clickedSection.offset().top
	            }, 500);
	        }

	        return false;
	    }
	});

	$(window).scroll( function() {
		var t607_now = new Date().getTime();
		if (t607_lastCall && t607_now < (t607_lastCall + t607_interval) ) {
				clearTimeout(t607_timeoutId);
				t607_timeoutId = setTimeout(function () {
						t607_lastCall = t607_now;
						t607_clickedSectionId = t607_highlightNavLinks(t607_navLinks,t607_sections,t607_sectionIdTonavigationLink,t607_clickedSectionId);
				}, t607_interval - (t607_now - t607_lastCall) );
		} else {
				t607_lastCall = t607_now;
				t607_clickedSectionId = t607_highlightNavLinks(t607_navLinks,t607_sections,t607_sectionIdTonavigationLink,t607_clickedSectionId);
		}
	});
}


function t607_getSectionByHref (curlink) {
    var curLinkValue = (curlink.attr('href') || '').replace(/\s+/g, '').replace(/.*#/, '');
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + curLinkValue + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curLinkValue + "']");
    }
}


function t607_highlightNavLinks(t607_navLinks,t607_sections,t607_sectionIdTonavigationLink,t607_clickedSectionId) {
	var t607_scrollPosition = $(window).scrollTop(),
		t607_valueToReturn = t607_clickedSectionId;

	/*if the first section is too small*/
	if (typeof t607_sections[t607_sections.length-2]!="undefined" && t607_sections[t607_sections.length-2].offset().top <= $(window).height()/2 && t607_scrollPosition == 0) {
		t607_navLinks.removeClass('t-active');
		t607_navLink = t607_sectionIdTonavigationLink[t607_sections[t607_sections.length-1].attr("id")];
		t607_navLink.addClass('t-active');
		return null;
	}

	$(t607_sections).each(function(e) {
			var t607_curSection = $(this),
					t607_sectionTop = t607_curSection.offset().top,
					t607_id = t607_curSection.attr('id'),
					t607_navLink = t607_sectionIdTonavigationLink[t607_id];
			if ((t607_scrollPosition + $(window).height()/2) >= t607_sectionTop || (t607_sections[0].attr("id") == t607_id && $(window).scrollTop() >= $(document).height() - $(window).height())) {
				if (t607_clickedSectionId == null && !t607_navLink.hasClass('t-active')) {					
					t607_navLinks.removeClass('t-active');
					t607_navLink.addClass('t-active');
					t607_valueToReturn = null;
				} else {
					if (t607_clickedSectionId != null && t607_id == t607_clickedSectionId) {
						t607_valueToReturn = null;
					}
				}
				return false;
			}
	});
	return t607_valueToReturn;
}
 
function t608_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t608');
    if (!container) return;

    var bgImages = rec.querySelectorAll('.t608__bgimg');

    for (var i = 0; i < bgImages.length; i++) {
        var bgImage = bgImages[i];
        var bgImageWidth = bgImage.getAttribute('data-image-width');
        var bgImageHeight = bgImage.getAttribute('data-image-height');
        var ratio = bgImageHeight / bgImageWidth;
        var paddingBottom = ratio * 100;

        bgImage.style.paddingBottom = paddingBottom + '%';
    }
} 
function t609_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t609');
    if (!container) return;

    var descriptions = rec.querySelectorAll('.t609__descr');
    var maxHeight = 0;

    for (var i = 0; i < descriptions.length; i++) {
        descriptions[i].style.height = '';
    }

    for (var i = 0; i < descriptions.length; i++) {
        var description = descriptions[i];
        var descriptionStyle = getComputedStyle(description, null);
        var descriptionPaddingTop = parseInt(descriptionStyle.paddingTop) || 0;
        var descriptionPaddingBottom = parseInt(descriptionStyle.paddingBottom) || 0;
        var descriptionHeight = description.clientHeight - (descriptionPaddingTop + descriptionPaddingBottom);

        if (descriptionHeight > maxHeight) maxHeight = descriptionHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < descriptions.length; i++) {
            descriptions[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < descriptions.length; i++) {
            descriptions[i].style.height = '';
        }
    }
}

function t609_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t609');
    if (!container) return;

    var bgImages = rec.querySelectorAll('.t609__bgimg');

    for (var i = 0; i < bgImages.length; i++) {
        var bgImage = bgImages[i];
        var bgImageWidth = bgImage.getAttribute('data-image-width');
        var bgImageHeight = bgImage.getAttribute('data-image-height');
        var ratio = bgImageHeight / bgImageWidth;
        var paddingBottom = ratio * 100;
        
        bgImage.style.paddingBottom = paddingBottom + '%';
    }
} 
function t615_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t615');
    if (!container) return;

    var titles = rec.querySelectorAll('.t615__title');
    var descriptions = rec.querySelectorAll('.t615__descr');
    var prices = rec.querySelectorAll('.t615__price');
    var imageWrappers = rec.querySelectorAll('.t615__imgwrapper');

    if (titles.length > 0) t615_equalHeight(titles);
    if (descriptions.length > 0) t615_equalHeight(descriptions);
    if (prices.length > 0) t615_equalHeight(prices);
    if (imageWrappers.length > 0) {
        t615_equalHeight(imageWrappers);

        window.onload = function() {
            t615_equalHeight(imageWrappers);
        };
    }
}

function t615_equalHeight(elements) {
    var maxHeight = 0;

    for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = '';
    }

    for (var i = 0; i < elements.length; i++) {
        var element = elements[i];
        var elementStyle = getComputedStyle(element, null);
        var elementPaddingTop = parseInt(elementStyle.paddingTop) || 0;
        var elementPaddingBottom = parseInt(elementStyle.paddingBottom) || 0;
        var elementHeight = element.clientHeight - (elementPaddingTop + elementPaddingBottom);

        if (elementHeight > maxHeight) maxHeight = elementHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = '';
        }
    }
} 
function t616_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t616');
    if (!container) return;

    var titles = rec.querySelectorAll('.t616__title');
    var texts = rec.querySelectorAll('.t616__text');
    var prices = rec.querySelectorAll('.t616__price');
    var headers = rec.querySelectorAll('.t616__header');

    if (titles.length > 0) t616_equalHeight(titles);
    if (texts.length > 0) t616_equalHeight(texts);
    if (prices.length > 0) t616_equalHeight(prices);
    if (headers.length > 0) t616_equalHeight(headers);
}

function t616_equalHeight(elements) {
    var maxHeight = 0;

    for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = '';
    }

    for (var i = 0; i < elements.length; i++) {
        var element = elements[i];
        var elementStyle = getComputedStyle(element, null);
        var elementPaddingTop = parseInt(elementStyle.paddingTop) || 0;
        var elementPaddingBottom = parseInt(elementStyle.paddingBottom) || 0;
        var elementHeight = element.clientHeight - (elementPaddingTop + elementPaddingBottom);

        if (elementHeight > maxHeight) maxHeight = elementHeight;
    }

    if (window.innerWidth >= 960) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.height = '';
        }
    }
} 
function t635_init(recid) {
    var el = $("#rec" + recid);
    var data = el.find(".t635__textholder");
    var animRecId = data.attr("data-recid");
    var screenmin = parseInt($("#rec" + animRecId).attr("data-screen-min"), 10);
    var screenmax = parseInt($("#rec" + animRecId).attr("data-screen-max"), 10);

    if (isNaN(screenmax) && isNaN(screenmin)) {
        t635_startType(recid);
    } else if (!isNaN(screenmax) && !isNaN(screenmin)) {
        if ($(window).width() >= screenmin && $(window).width() <= screenmax) {
            t635_startType(recid);
        }
    } else if (!isNaN(screenmax)) {
        if ($(window).width() <= screenmax) {
            t635_startType(recid);
        }
    } else if (!isNaN(screenmin)) {
        if ($(window).width() >= screenmin) {
            t635_startType(recid);
        }
    }
}

function t635_startType(recid) {
    var t635_el = $('#rec' + recid),
        t635_data = t635_el.find(".t635__textholder"),
        t635_animRecId = t635_data.attr("data-recid"),
        t635_animText = t635_findAnimElem(t635_animRecId),
        t635_phrasesList = [],
        t635_phrase1 = t635_data.attr("data-text1"),
        t635_phrase2 = t635_data.attr("data-text2"),
        t635_phrase3 = t635_data.attr("data-text3"),
        t635_phrase4 = t635_data.attr("data-text4"),
        t635_phrase5 = t635_data.attr("data-text5"),
        t635_speed = t635_data.attr("data-speed"),
        t635_loop = t635_data.attr("data-loop"),
        t635_backspaceDelay = t635_data.attr("data-backspacing-delay");
    if (typeof t635_animText == "undefined") {
        return;
    }
    if (typeof t635_phrase1 != "undefined") {
        t635_phrasesList.push(t635_phrase1.slice(0, 80));
    }
    if (typeof t635_phrase2 != "undefined") {
        t635_phrasesList.push(t635_phrase2.slice(0, 80));
    }
    if (typeof t635_phrase3 != "undefined") {
        t635_phrasesList.push(t635_phrase3.slice(0, 80));
    }
    if (typeof t635_phrase4 != "undefined") {
        t635_phrasesList.push(t635_phrase4.slice(0, 80));
    }
    if (typeof t635_phrase5 != "undefined") {
        t635_phrasesList.push(t635_phrase5.slice(0, 80));
    }

    if (t635_animText.length !== 0 && t635_phrasesList.length !== 0) {
        var t635_animTextHtml = t635_animText.html(),
            t635_animTextSplitted = t635_animTextHtml.split("|"),
            t635_curWin = $(window);
        t635_animText.html(t635_animTextSplitted[0] + "<span class=\"t635__typing-text\"></span>" + t635_animTextSplitted[1]);

        t635_updateAnimTextLimits(t635_animRecId);
        t635_curWin.bind('resize', t_throttle(function () {
            t635_updateAnimTextLimits(t635_animRecId);
        }, 200));
        var intervalUpdate = setInterval(function () {
            t635_updateAnimTextLimits(t635_animRecId);
        }, 5000);

        var t635_animatedText = $("#rec" + t635_animRecId + " .t635__typing-text"),
            t635_animTextTop = t635_animatedText.attr("data-top-limit"),
            t635_animTextBottom = t635_animatedText.attr("data-bottom-limit"),
            t635_winTop = t635_curWin.scrollTop(),
            t635_winBottom = t635_winTop + t635_curWin.height();
        t635_animateText(t635_animRecId, t635_phrasesList, t635_speed, t635_loop, t635_backspaceDelay);
        if (t635_animTextBottom < t635_winTop || t635_animTextTop > t635_winBottom) {
            $("#rec" + t635_animRecId + " .t635__typing-text").data('typed').pauseTyping();
            $("#rec" + t635_animRecId + " .t635__typing-text").html("");
        }

        t635_curWin.bind('scroll', t_throttle(function () {
            t635_animTextTop = t635_animatedText.attr("data-top-limit");
            t635_animTextBottom = t635_animatedText.attr("data-bottom-limit");
            t635_winTop = t635_curWin.scrollTop();
            t635_winBottom = t635_winTop + t635_curWin.height();
            if (t635_animTextBottom < t635_winTop || t635_animTextTop > t635_winBottom) {
                $("#rec" + t635_animRecId + " .t635__typing-text").data('typed').pauseTyping();
                $("#rec" + t635_animRecId + " .t635__typing-text").html("");
            } else {
                $("#rec" + t635_animRecId + " .t635__typing-text").data('typed').continueTyping();
            }
        }, 200));
    }
}

function t635_findAnimElem(animRecId) {
    var animRec = $("#rec" + animRecId);
    var animH1 = animRec.find("h1:contains(\'|\')").last();
    var animH2 = animRec.find("h2:contains(\'|\')").last();
    var animH3 = animRec.find("h3:contains(\'|\')").last();
    var animDiv = animRec.find("div:contains(\'|\')").last();
    if (typeof animH1 != "undefined" && animH1.length > 0) {
        return animH1;
    }
    if (typeof animH2 != "undefined" && animH2.length > 0) {
        return animH2;
    }
    if (typeof animH3 != "undefined" && animH3.length > 0) {
        return animH3;
    }
    if (typeof animDiv != "undefined" && animDiv.length > 0) {
        return animDiv;
    }
}

function t635_updateAnimTextLimits(t635_animRecId) {
    var t635_animatedBlock = $("#rec" + t635_animRecId),
        t635_animatedText = t635_animatedBlock.find(".t635__typing-text");
    if (typeof t635_animatedText.offset() != 'undefined') {
        t635_animatedText.attr("data-top-limit", t635_animatedText.offset().top);
        t635_animatedText.attr("data-bottom-limit", (t635_animatedBlock.offset().top + t635_animatedBlock.height()));
    }
}

function t635_animateText(t635_animRecId, t635_phrasesList, t635_speed, t635_loop, t635_backspaceDelay) {
    if (typeof t635_speed == "undefined") {
        t635_speed = 40;
    }
    if (typeof t635_backspaceDelay == "undefined") {
        t635_backspaceDelay = 800;
    }
    if (typeof t635_loop == "undefined") {
        t635_loop = true;
    } else {
        t635_loop = false;
    }
    $("#rec" + t635_animRecId + " .t635__typing-text").typed({
        strings: t635_phrasesList,
        typeSpeed: t635_speed * 1,
        startDelay: 600,
        backSpeed: 10,
        backDelay: t635_backspaceDelay * 1,
        loop: t635_loop,
        contentType: 'text'
    });
} 
function t650_unifyHeights(recid) {
if($(window).width()>=960){
	$('#rec'+recid+' .t650 .t-container .t650__row').each(function() {
		var t650_highestBox = 0,
			t650_currow = $(this);
		$('.t650__inner-col', this).each(function(){
			var t650_curCol = $(this),
                t650_curText = t650_curCol.find(".t650__text"),
                t650_curBtn = t650_curCol.find(".t650__btn-container"),
                t650_curColHeight = t650_curText.outerHeight() + t650_curBtn.outerHeight();			
			if(t650_curColHeight > t650_highestBox){t650_highestBox = t650_curColHeight;}
		});
		$('.t650__inner-col',this).css('height', t650_highestBox);
	});
} else {
	$('.t650__inner-col').css('height', 'auto');
}
}
 
function t651_initPopup(recid){
  if(window.isMobile && !window.isTablet){
    if ($('#rec'+recid+' .t651__phone').length==0){ return; }  
    t651_phone = $('#rec'+recid+' .t651__phone').text().replace(/\s+/g, '');
    $('#rec'+recid+' .t651__btn').click(function(){
	  window.location.href="tel:"+t651_phone;	                             
      $('.t651__btn_wrapper').removeClass('t651__btn_animate');
      $('.t651__btn-text').css('display','none');	                             	
    });                         
  	return;
  }
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t651__popup'),
      analitics=el.attr('data-track-popup'),
      hook="TildaCallBackWidget"+recid,
      obj = $('#rec'+recid+' .t651__btn');
  obj.click(function(e){
    if (obj.hasClass("t651__btn_active")) {t651_closePopup(); return;}
    obj.addClass("t651__btn_active");
    t651_showPopup(recid);
    e.preventDefault();    
    if (analitics > '') {
        Tilda.sendEventToStatistics(analitics, hook);
    }
  });
}

function t651_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t651__popup');
                             
  $('.t651__btn_wrapper').removeClass('t651__btn_animate');
  $('.t651__btn-text').css('display','none');	

  popup.css('display', 'block');
  setTimeout(function() {
    popup.addClass('t651__popup_show');
  }, 50);

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t651_closePopup(); }
  });
}

function t651_closePopup(){
  $('.t651__btn').removeClass('t651__btn_active');
  $('.t651__popup').removeClass('t651__popup_show');
  setTimeout(function() {
    $('.t651__popup').not('.t651__popup_show').css('display', 'none');
  }, 300);
}

function t651_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }

  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {

   if(ga) {
     if (window.mainTracker != 'tilda') {
       ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
     }
   }

   if (window.mainMetrika > '' && window[window.mainMetrika]) {
     window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
   }

  }
}
 
function t652_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t652__popup'),
      analitics=el.attr('data-track-popup'),
      obj = $('#rec'+recid+' .t652__btn');
  obj.click(function(e){
    if (obj.hasClass("t652__btn_active")) {
		t652_closePopup();  
		return;
	}
    obj.addClass("t652__btn_active");
	$('#rec'+recid+' .t652').addClass("t652_active");
    t652_showPopup(recid);
    e.preventDefault();
    if (analitics == 'yes') {t652_sendPopupEventToStatistics(hook);}
  });
}

function t652_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t652__popup');

  $('.t652__btn_wrapper').removeClass('t652__btn_animate');
  $('.t652__btn-text').css('display','none');	

  popup.css('display', 'block');
  setTimeout(function() {
    popup.addClass('t652__popup_show');
  }, 50);

  el.find(".t652__mobile-icon-close").click(function(e){ t652_closePopup(); });	

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t652_closePopup(); }
  });
}

function t652_closePopup(){
  $('.t652').removeClass("t652_active");
  $('.t652__btn').removeClass('t652__btn_active');
  $('.t652__popup').removeClass('t652__popup_show');
  setTimeout(function() {
    $('.t652__popup').not('.t652__popup_show').css('display', 'none');
  }, 300);
}

function t652_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }

  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {

   if(ga) {
     if (window.mainTracker != 'tilda') {
       ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
     }
   }

   if (window.mainMetrika > '' && window[window.mainMetrika]) {
     window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
   }

  }
}
 
function t653_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t653__popup'),
      analitics=el.attr('data-track-popup'),
      hook="TildaSubscriptionWidget"+recid,
      obj = $('#rec'+recid+' .t653__btn');
  obj.click(function(e){
    if (obj.hasClass("t653__btn_active")) {t653_closePopup(); return;}
	$('#rec'+recid+' .t653').addClass("t653_active");
    obj.addClass("t653__btn_active");
    t653_showPopup(recid);
    e.preventDefault();
    if (analitics > '') {
        Tilda.sendEventToStatistics(analitics, hook);
    }
  });
}

function t653_lockScroll(){
  var body = $("body");
	if (!body.hasClass('t-body_scroll-locked')) {
		var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
		body.addClass('t-body_scroll-locked');
    console.log("class added");
		body.css("top","-"+bodyScrollTop+"px");
    body.attr("data-popup-scrolltop",bodyScrollTop);
	}
}

function t653_unlockScroll(){
  var body = $("body");
	if (body.hasClass('t-body_scroll-locked')) {
    var bodyScrollTop = $("body").attr("data-popup-scrolltop");
		body.removeClass('t-body_scroll-locked');
		body.css("top","");
    body.removeAttr("data-popup-scrolltop")
		window.scrollTo(0, bodyScrollTop);
	}
}

function t653_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t653__popup');

  $('.t653__btn_wrapper').removeClass('t653__btn_animate');
  $('.t653__btn-text').css('display','none');	
  /*fix IOS11 cursor bug + general IOS background scroll*/
  if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream && $(window).width()<960) {
    console.log("lock scroll");
    setTimeout(function() {
      t653_lockScroll();
    }, 500);
  }  

  popup.css('display', 'block');
  setTimeout(function() {
    popup.addClass('t653__popup_show');
  }, 50);

  el.find(".t653__mobile-icon-close").click(function(e){ t653_closePopup(); });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t653_closePopup(); }
  });
}

function t653_closePopup(){
  /*fix IOS11 cursor bug + general IOS background scroll*/
  if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
    t653_unlockScroll();
  }    
  $('.t653').removeClass("t653_active");
  $('.t653__btn').removeClass('t653__btn_active');
  $('.t653__popup').removeClass('t653__popup_show');
  setTimeout(function() {
    $('.t653__popup').not('.t653__popup_show').css('display', 'none');
  }, 300);
}

/* deprecated */
function t653_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }

  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {

   if(ga) {
     if (window.mainTracker != 'tilda') {
       ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
     }
   }

   if (window.mainMetrika > '' && window[window.mainMetrika]) {
     window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
   }

  }
}
 
function t654_showPanel(recid) {
    var el = $('#rec' + recid);
    var t654_block = el.find('.t654');
    var t654_closeBtn = el.find('.t654__icon-close');
    var t654_storageItem = t654_block.attr('data-storage-item');
    var t654_lastOpen = null;
    var t654_delta = t654_block.attr('data-storage-delta') * 86400;
    var t654_today = Math.floor(Date.now() / 1000);
    var t654_curDelta;

    if (typeof localStorage === 'object') {
        try {
            t654_lastOpen = localStorage.getItem(t654_storageItem);
            t654_curDelta = t654_today - t654_lastOpen;
        } catch (e) {
            console.log('Your web browser does not support localStorage.');
        }
    }

    if (t654_lastOpen == null || t654_curDelta >= t654_delta) {
        t654_block.removeClass('t654_closed');
    }
    t654_closeBtn.click(function (e) {
        t654_block.addClass('t654_closed');
        if (t654_delta) {
            if (typeof localStorage === 'object') {
                try {
                    localStorage.setItem(t654_storageItem, Math.floor(Date.now() / 1000));
                } catch (e) {
                    console.log('Your web browser does not support localStorage.');
                }
            }
        }
        e.preventDefault();
    });

    var window_width = $(window).width();
    if (window_width > 980) {
        $(window).bind('scroll', t_throttle(function () {
            if (t654_block.hasClass('t654_bottom') && $('#tildacopy').length && (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 70) {
                t654_block.css('visibility', 'hidden');
            } else {
                var appearoffset = t654_block.attr('data-appearoffset');
                if (appearoffset === '') {
                    t654_block.css('visibility', 'visible');
                }
            }
        }));
    }
}


function t654_setBg(recid) {
    var el = $('#rec' + recid);
    var window_width = $(window).width();
    if (window_width > 980) {
        el.find(".t654").each(function () {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color", bgcolor);
            }
        });
    } else {
        el.find(".t654").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color", bgcolor);
            el.attr("data-bgcolor-setbyscript", "yes");
        });
    }
}

function t654_appearMenu(recid) {
    var el = $('#rec' + recid);
    var window_width = $(window).width();
    if (window_width > 980) {
        el.find(".t654").each(function () {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset != "") {
                if (appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        if (el.hasClass('t654_top')) {
                            el.css("top", "-50px");
                            el.css("visibility", "visible");
                            el.animate({
                                "opacity": "1",
                                "top": "0px"
                            }, 200);
                        } else {
                            el.css("bottom", "-50px");
                            el.css("visibility", "visible");
                            el.animate({
                                "opacity": "1",
                                "bottom": "0px"
                            }, 200);
                        }
                    }
                } else {
                    el.stop();
                    el.css("visibility", "hidden");
                }
            }
        });
    }

}

function t654_changebgopacitymenu(recid) {
    var el = $('#rec' + recid);
    var window_width = $(window).width();
    if (window_width > 980) {
        el.find(".t654").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.' + menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if (bgopacitytwo == '0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            } else {
                el.css("background-color", bgcolor);
                if (bgopacityone == '0.0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            }
        });
    }
} 
function t657_init(recid) {
    var t657_el = $('#rec' + recid);
    var t657_block = t657_el.find('.t657');
    var t657_closeBtn = t657_el.find('.t657__btn');
    var t657_closeIcon = t657_el.find('.t657__icon-close');
    var t657_storageItem = t657_block.attr('data-storage-item');
    var t657_lastOpen = null;

    if (typeof localStorage === 'object') {
        try {
            t657_lastOpen = localStorage.getItem(t657_storageItem);
        } catch (e) {
            console.log('Your web browser does not support localStorage.');
        }
    }

    if (t657_lastOpen == null) {
        t657_block.removeClass('t657_closed');
    }

    t657_closeBtn.add(t657_closeIcon).click(function (e) {
        t657_block.addClass('t657_closed');
        if (typeof localStorage === 'object') {
            try {
                localStorage.setItem(t657_storageItem, Math.floor(Date.now() / 1000));
            } catch (e) {
                console.log('Your web browser does not support localStorage.');
            }
        }
        e.preventDefault();
    });
} 
function t658_init(recid) {
    $('#rec' + recid).attr('data-animationappear', 'off').removeClass('r_hidden').removeClass('r_anim');
    var t658_el = $('#rec' + recid);
    var t658_block = t658_el.find('.t658');
    var t658_confirmPopup = t658_el.find('.t658__popup_confirm');
    var t658_denyPopup = t658_el.find('.t658__popup_deny');
    var t658_yesBtn = t658_el.find('.t658__btn_yes');
    var t658_noBtn = t658_el.find('.t658__btn_no');
    var t658_storageItem = t658_block.attr('data-storage-item');
    var t658_lastOpen = null;

    if (typeof localStorage === 'object') {
        try {
            t658_lastOpen = localStorage.getItem(t658_storageItem);
        } catch (e) {
            console.log('Your web browser does not support localStorage.');
        }
    }

    if (t658_lastOpen == null || t658_block.attr('data-unpublish')) {
        t658_block.css('display', 'block');
        setTimeout(function () {
            t658_block.removeClass('t658_closed');
        }, 500);
        $('body').addClass('t658__body_popupshowed');
    }

    t658_yesBtn.click(function (e) {
        t658_block.addClass('t658_closed');
        setTimeout(function () {
            t658_block.css('display', 'none');
        }, 300);
        $('body').removeClass('t658__body_popupshowed');

        if (typeof localStorage === 'object') {
            try {
                localStorage.setItem(t658_storageItem, Math.floor(Date.now() / 1000));
            } catch (e) {
                console.log('Your web browser does not support localStorage.');
            }
        }
        e.preventDefault();
    });
    t658_noBtn.click(function (e) {
        setTimeout(function () {
            t658_confirmPopup.css('display', 'none');
            t658_denyPopup.css('display', 'block');
        }, 300);
        e.preventDefault();
    });
} 
function t668_init(recid) {
    var el = $('#rec' + recid);
    var toggler = el.find(".t668__header");
    var accordion = el.find('.t668__accordion');
    if (accordion) {
        accordion = accordion.attr('data-accordion');
    } else {
        accordion = "false";
    }

    toggler.click(function () {
        if (accordion === "true") {
            toggler.not(this).removeClass("t668__opened").next().slideUp();
        }

        $(this).toggleClass("t668__opened");
        $(this).next().slideToggle();
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    });
}
 
function t670_init(recid) {
	t670_imageHeight(recid);
	t670_show(recid);
	t670_hide(recid);
}

function t670_show(recid) {
	var rec = document.getElementById('rec' + recid);
	var playBtns = rec.querySelectorAll('.t670__play');
	Array.prototype.forEach.call(playBtns, function (play) {
		play.addEventListener('click', function () {
			var videoType = play.getAttribute('data-slider-video-type');
			var url;
			var nextEl;
			var prevEl;
			var iframe;
			switch (videoType) {
				case 'youtube':
					url = play.getAttribute('data-slider-video-url');
					nextEl = play.nextElementSibling;
					prevEl = play.previousElementSibling.previousElementSibling;
					if (nextEl) {
						iframe = document.createElement('iframe');
						iframe.classList.add('t670__iframe');
						iframe.width = '100%';
						iframe.height = '100%';
						iframe.src = 'https://www.youtube.com/embed/' + url + '?autoplay=1&enablejsapi=1';
						iframe.frameBorder = '0';
						iframe.setAttribute('webkitallowfullscreen', '');
						iframe.setAttribute('mozallowfullscreen', '');
						iframe.setAttribute('allowfullscreen', '');
						iframe.setAttribute('allow', 'autoplay');
						nextEl.innerHTML = '';
						nextEl.insertAdjacentElement('beforeend', iframe);
					}
					if (prevEl && prevEl.classList.contains('t-bgimg')) prevEl.style.opacity = '0';
					break;
				case 'vimeo':
					url = play.getAttribute('data-slider-video-url');
					nextEl = play.nextElementSibling;
					prevEl = play.previousElementSibling.previousElementSibling;
					var idMatch = /vimeo[^/]*\/(\d+)\/?(\w*)\/?/i.exec(url);
					var id = idMatch ? idMatch[1] : null;
					var hash = idMatch ? '?h=' + idMatch[2] : null;
					if (nextEl) {
						iframe = document.createElement('iframe');
						iframe.classList.add('t670__iframe');
						iframe.width = '100%';
						iframe.height = '100%';
						iframe.src = 'https://player.vimeo.com/video/' + id + hash + '&amp;api=1';
						iframe.frameBorder = '0';
						iframe.setAttribute('allowfullscreen', '');
						iframe.setAttribute('allow', 'autoplay; fullscreen');
						nextEl.innerHTML = '';
						nextEl.insertAdjacentElement('beforeend', iframe);
					}
					if (prevEl && prevEl.classList.contains('t-bgimg')) prevEl.style.opacity = '0';
					break;
			}
			if (nextEl) nextEl.style.zIndex = '3';
		});
	});
}

function t670_hide(recid) {
	var rec = document.getElementById('rec' + recid);
	var elBody = rec.querySelector('.t670__frame');
	rec.addEventListener('updateSlider', function () {
		if (elBody) elBody.innerHTML = '';
		if (elBody) elBody.style.zIndex = '';
	});
}

function t670_imageHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	var images = rec.querySelectorAll('.t670__separator');
	Array.prototype.forEach.call(images, function (img) {
		var width = img.getAttribute('data-slider-image-width') || 0;
		var height = img.getAttribute('data-slider-image-height') || 0;
		var ratio = height / width;
		var padding = ratio * 100;
		img.style.paddingBottom = padding + '%';
	});
} 
function t671_init(recid){
	
	var el = $('#rec'+recid);
	var c=Date.now();

	if(typeof window.t671_obj=='object'){
		var obj=window.t671_obj;
		t671_process(obj,el);
	}else{
      $.ajax({
        type: "GET",
        url: "/pages.json?c="+c,
        dataType : "text",
        success: function(data){
            if(data!=''){
                var obj = jQuery.parseJSON( data );
                if(typeof obj=='object'){
                  window.t671_obj=obj;
                  t671_process(obj,el);
                }
            }
        },
        error: function(){
        },
        timeout: 1000*10		  			  
      });	
	}
		
}
	
function t671_process(obj,el){

	var projectid=$('#allrecords').attr('data-tilda-project-id');
	var pageid=$('#allrecords').attr('data-tilda-page-id');
	var reverse=el.find('.t671__container').attr('data-reverse');
		
    if(reverse=='yes'){
		obj=obj.reverse();
	}

	var title_style=el.find('.t671').attr('data-title-style');
	var descr_style=el.find('.t671').attr('data-descr-style');
	var date_style=el.find('.t671').attr('data-date-style');
	var date_noshow=el.find('.t671').attr('data-date-noshow');
	var img_noshow=el.find('.t671').attr('data-img-noshow');

	$.each( obj, function( key, page ) {

		var str='';
		var url='/page'+page.pageid+'.html';
		if(page.alias!=''){
			url='/'+page.alias+'';
		}
		var date=page.date;
		if(date!=''){
			date=date.substring(0,10);
		}
		
		str += '<a href="'+url+'" style="font-family:Helvetica Neue, Helvetica, Arial, sans-serif; text-decoration:none; color:#000;">';
		str += '<div>';
		str += '<div style="border:1px solid #eee; width:100%; padding:20px; box-sizing:border-box; margin-bottom:40px;">';
		if(page.img!='' && img_noshow!='on'){
			str += '<div style="width:100%; margin-bottom:20px;"><img src="'+page.img+'" style="width:100%;"></div>';
		}
		str += '<div style="font-size:22px; margin-bottom:15px; '+title_style+'">'+page.title+'</div>';
		if(page.descr!=''){
			str += '<div style="font-size:16px; margin-bottom:20px; line-height:1.55; '+descr_style+'">'+page.descr+'</div>';
		}
		if(date!='' && date_noshow!='on'){
			str += '<div style="letter-spacing:2px; font-size:13px; opacity:0.4; margin-bottom:1px; '+date_style+'">'+date+'</div>';
		}
		str += '</div>';		
		str += '</div>';
		str += '</a>';		
		
		if(page.is_index!='y'){
	        el.find('.t671__container').append(str);
		}
			
	});
	
} 
function t674_init(recid) {
    var el = $("#rec" + recid);
    el.find('.t674__img-holder').on('load', function () {
        var delay = 0;
        if ($('#allrecords').attr('data-blocks-animationoff') !== 'yes') {
            delay = 600;
        }
        setTimeout(function () {
            $('body').addClass('t674__body_with-bg');
        }, delay);
    }).each(function () {
        if (this.complete) $(this).trigger('load');
    });
} 
function t675_init(recid) {
	var rec = document.getElementById('rec' + recid);
	var textWrapper = rec.querySelectorAll('.t675__textwrapper');
	var dot = rec.querySelector('.t-slds__bullet_wrapper');
	var dotsHeight = dot ? dot.offsetHeight : 0;
	Array.prototype.forEach.call(textWrapper, function(wrapper) {
		wrapper.style.marginBottom = (dotsHeight + 7) + 'px';
	});
} 
function t678_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');
    var inputsWrapperStyle = getComputedStyle(inputsWrapper, null);
    var inputsWrapperPaddingTop = parseInt(inputsWrapperStyle.paddingTop) || 0;
    var inputsWrapperPaddingBottom = parseInt(inputsWrapperStyle.paddingBottom) || 0;
    var inputsWrapperHeight = inputsWrapper.clientHeight - (inputsWrapperPaddingTop + inputsWrapperPaddingBottom);
    var inputsOffset = inputsWrapper.getBoundingClientRect().top + window.pageYOffset;
    var inputsBottom = inputsWrapperHeight + inputsOffset;
    var successBox = form.querySelector('.t-form__successbox');
    var successBoxOffset = successBox.getBoundingClientRect().top + window.pageYOffset;
    var target = 0;

    var windowHeight = window.innerHeight;
    var body = document.body;
    var html = document.documentElement;
    var documentHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );

    if (window.innerWidth > 960) {
        target = successBoxOffset - 200;
    } else {
        target = successBoxOffset - 100;
    }

    var tildaLabel = document.querySelector('.t-tildalabel');

    if (successBoxOffset > window.scrollY || (documentHeight - inputsBottom) < (windowHeight - 100)) {
        inputsWrapper.classList.add('t678__inputsbox_hidden');

        setTimeout(function() {
            if (windowHeight > documentHeight && tildaLabel) {
                t678__fadeOut(tildaLabel, 50);
            }
        }, 300);
    } else {
        t678__scroll(target);

        setTimeout(function() {
            inputsWrapper.classList.add('t678__inputsbox_hidden');
        }, 400);
    }

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t678__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity -= 0.1;

        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 50);
}

function t678__scroll(target) {
    var duration = 400;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = target - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t678__easeInOutCubic(currentTime, change) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t678__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t678__easeInOutCubic(currentTime, change));

        if (currentTime < duration) {
            setTimeout(t678__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t678__animateScroll();
} 
function t686_init(recid) {
    var el = $("#rec" + recid);

    setTimeout(function() {
       t686_setHeight(recid); 
    }, 100);

    $(window).on('resize', t_throttle(function () {
        t686_setHeight(recid);
    }));

    el.find('.t686').bind('displayChanged', function () {
        t686_setHeight(recid);
    });
}

function t686_setHeight(recid) {
    var el = $('#rec' + recid + ' .t686');
    var ratio = el.attr('data-tile-ratio');
    var ratioHeight = el.find('.t686__col').width() * ratio;

    var largestHeight = 0;
    el.find('.t686__row').each(function () {

        $('.t686__table', this).each(function () {
            var curCol = $(this);
            var curColHeight = curCol.find(".t686__textwrapper").outerHeight();
            if ($(this).find(".t686__cell").hasClass("t686__button-bottom")) {
                curColHeight += curCol.find(".t686__button-container").outerHeight();
            }
            if (curColHeight > largestHeight) {
                largestHeight = curColHeight;
            }
        });

        if ($(window).width() >= 960) {
            if (largestHeight > ratioHeight) {
                $('.t686__table', this).css('height', largestHeight);
            } else {
                $('.t686__table', this).css('height', ratioHeight);
            }
            $('.t686__table', this).css('min-height', 'auto');
        } else {
            $('.t686__table', this).css('min-height', ratioHeight);
            $('.t686__table', this).css('height', '');
        }

        if (t686_GetIEVersion() > 0) {
            var curRowHeight = $('.t686__table', this).css('height');
            $('.t686__bg', this).css('height', curRowHeight);
            $('.t686__overlay', this).css('height', curRowHeight);
        }
    });
}

function t686_GetIEVersion() {
    var sAgent = window.navigator.userAgent;
    var Idx = sAgent.indexOf("MSIE");
    if (Idx > 0) {
        return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf(".", Idx)));
    } else {
        if (!!navigator.userAgent.match(/Trident\/7\./)) {
            return 11;
        } else {
            return 0;
        }
    }
} 
function t688_unifyHeights(recid) {
    if ($(window).width() >= 960) {
        $('#rec' + recid + ' .t688 .t-container .t688__row').each(function () {
            var t688_highestBox = 0;
            $(':not(.t688__featured) .t688__inner-col', this).each(function () {
                var t688_curCol = $(this),
                    t688_curText = t688_curCol.find('.t688__textwrapper_inner'),
                    t688_curColHeight = t688_curText.outerHeight();
                if (t688_curColHeight > t688_highestBox) {
                    t688_highestBox = t688_curColHeight;
                }
            });
            $('.t688__textwrapper', this).css('height', t688_highestBox);
            $('.t688__featured', this).css('height', $('.t688__col', this).height() + 'px');
        });
    } else {
        $('#rec' + recid + ' .t688__textwrapper').css('height', 'auto');
        $('#rec' + recid).find('.t688__featured').css({
            'height': ($('#rec' + recid).find('.t688__col').height() + 'px')
        });
    }
} 
function t690_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');
    var inputsWrapperStyle = getComputedStyle(inputsWrapper, null);
    var inputsWrapperPaddingTop = parseInt(inputsWrapperStyle.paddingTop) || 0;
    var inputsWrapperPaddingBottom = parseInt(inputsWrapperStyle.paddingBottom) || 0;
    var inputsWrapperHeight = inputsWrapper.clientHeight - (inputsWrapperPaddingTop + inputsWrapperPaddingBottom);
    var inputsOffset = inputsWrapper.getBoundingClientRect().top + window.pageYOffset;
    var inputsBottom = inputsWrapperHeight + inputsOffset;
    var successBox = form.querySelector('.t-form__successbox');
    var successBoxOffset = successBox.getBoundingClientRect().top + window.pageYOffset;
    var target = 0;

    var windowHeight = window.innerHeight;
    var body = document.body;
    var html = document.documentElement;
    var documentHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );

    if (window.innerWidth > 960) {
        target = successBoxOffset - 200;
    } else {
        target = successBoxOffset - 100;
    }

    var tildaLabel = document.querySelector('.t-tildalabel');

    if (successBoxOffset > window.scrollY || (documentHeight - inputsBottom) < (windowHeight - 100)) {
        inputsWrapper.classList.add('t690__inputsbox_hidden');

        setTimeout(function() {
            if (windowHeight > documentHeight && tildaLabel) {
                t690__fadeOut(tildaLabel);
            }
        }, 300);
    } else {
        t690__scroll(target);

        setTimeout(function() {
            inputsWrapper.classList.add('t690__inputsbox_hidden');
        }, 400);
    }

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t690__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity -= 0.1;

        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 50);
}

function t690__scroll(target) {
    var duration = 400;
    var start = (window.pageYOffset || document.documentElement.scrollTop)  - (document.documentElement.clientTop || 0);
    var change = target - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t690__easeInOutCubic(currentTime, change) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t690__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t690__easeInOutCubic(currentTime, change));

        if (currentTime < duration) {
            setTimeout(t690__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t690__animateScroll();
} 
function t691_unifyHeights(recid) {
if($(window).width()>=960){
	$('#rec'+recid+' .t691 .t-container .t691__row').each(function() {
		var t691__highestBox = 0;
		var t691__currow = $(this);
		$('.t691__col', this).each(function(){
			var t691__curcol = $(this);
			var t691__curcolinfo=t691__curcol.find('.t691__sectioninfowrapper');
			var t691__curcolpers=t691__curcol.find('.t691__personwrapper');
			var t691__curcolinnerheight = t691__curcolinfo.outerHeight() + t691__curcolpers.outerHeight();
			if(t691__curcolinnerheight > t691__highestBox){t691__highestBox = t691__curcolinnerheight;}
		});
		$('.t691__col',this).css('height', t691__highestBox);
	});
}
};
 
function t694_init(recid) {
    var el = $('#rec' + recid);
    t694_setHeight(recid);

    $(window).resize(t_throttle(function () {
        t694_setHeight(recid);
    }));

    el.find('.t694').bind('displayChanged', t_throttle(function () {
        t694_setHeight(recid);
    }));

    setTimeout(function() {
        t694_setHeight(recid);
    }, 500);
}

function t694_setHeight(recid) {
    var el = $('#rec' + recid + ' .t694');
    var t694_ratio = el.attr('data-tile-ratio');
    var t694_ratioHeight = el.find('.t694__col').width() * t694_ratio;

    if ($(window).width() >= 768) {
        el.find('.t694__row').each(function () {
            var t694_largestHeight = 0;

            $(this).find('.t694__table').each(function () {
                var t694_curCol = $(this),
                    t694_curColHeight = t694_curCol.find(".t694__textwrapper").outerHeight();
                if ($(this).find(".t694__cell").hasClass("t694__button-bottom")) {
                    t694_curColHeight += t694_curCol.find(".t694__button-container").outerHeight();
                }
                if (t694_curColHeight > t694_largestHeight) {
                    t694_largestHeight = t694_curColHeight;
                }
            });

            if (t694_largestHeight > t694_ratioHeight) {
                $(this).find('.t694__table').css('height', t694_largestHeight);
            } else {
                if ($(this).find('.t694__table').css('height') != '') {
                    $(this).find('.t694__table').css('height', '');
                }
            }
        });
    } else {
        el.find('.t694__table').css('height', '');
    }
}
 
function t696_onSuccess(t696_form){
	var t696_inputsWrapper = t696_form.find('.t-form__inputsbox');
    var t696_inputsHeight = t696_inputsWrapper.height();
    var t696_inputsOffset = t696_inputsWrapper.offset().top;
    var t696_inputsBottom = t696_inputsHeight + t696_inputsOffset;
	var t696_targetOffset = t696_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t696_target = t696_targetOffset - 200;
    }	else {
        var t696_target = t696_targetOffset - 100;
    }

    if (t696_targetOffset > $(window).scrollTop() || ($(document).height() - t696_inputsBottom) < ($(window).height() - 100)) {
        t696_inputsWrapper.addClass('t696__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);		
    } else {
        $('html, body').animate({ scrollTop: t696_target}, 400);
        setTimeout(function(){t696_inputsWrapper.addClass('t696__inputsbox_hidden');}, 400);
    }

	var successurl = t696_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

} 
function t698_fixcontentheight(id){
        /* correct cover height if content more when cover height */
        var el = $("#rec" + id);
        var hcover=el.find(".t-cover").height();
        var hcontent=el.find("div[data-hook-content]").outerHeight();
        if(hcontent>300 && hcover<hcontent){
         var hcontent=hcontent+120;
         if(hcontent>1000){hcontent+=100;}
         console.log('auto correct cover height: '+hcontent);
         el.find(".t-cover").height(hcontent);
         el.find(".t-cover__filter").height(hcontent);
         el.find(".t-cover__carrier").height(hcontent);
         el.find(".t-cover__wrapper").height(hcontent);
         el.find(".t-cover__container").height(hcontent);
         if($isMobile == false){
          setTimeout(function() {
           var divvideo=el.find(".t-cover__carrier");
           if(divvideo.find('iframe').length>0){
            console.log('correct video from cover_fixcontentheight');
      setWidthHeightYoutubeVideo(divvideo, hcontent+'px');
     }
    }, 2000);
   }
        }
 }

function t698_onSuccess(t698_form){
	var t698_inputsWrapper = t698_form.find('.t-form__inputsbox');
    var t698_inputsHeight = t698_inputsWrapper.height();
    var t698_inputsOffset = t698_inputsWrapper.offset().top;
    var t698_inputsBottom = t698_inputsHeight + t698_inputsOffset;
	var t698_targetOffset = t698_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t698_target = t698_targetOffset - 200;
    }	else {
        var t698_target = t698_targetOffset - 100;
    }

    if (t698_targetOffset > $(window).scrollTop() || ($(document).height() - t698_inputsBottom) < ($(window).height() - 100)) {
        t698_inputsWrapper.addClass('t698__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);		
    } else {
        $('html, body').animate({ scrollTop: t698_target}, 400);
        setTimeout(function(){t698_inputsWrapper.addClass('t698__inputsbox_hidden');}, 400);
    }

	var successurl = t698_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

} 
function t700_init(recId, height) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t700');
    if (!container) return;

    var doResize;

    t700__setHeight(recId, height);

    window.addEventListener('resize', function() {
        clearTimeout(doResize);

        doResize = setTimeout(function() {
            t700__setHeight(recId);
        }, 200);
    });

    /* TODO: jq event*/
    $(container).bind('displayChanged', function() {
        t700__setHeight(recId);
    });

    /*container.addEventListener('displayChanged', function() {
        t700__setHeight(recId);
    });*/
}

function t700__setHeight(recId, height) {
    if (!height) {
        var rec = document.getElementById('rec' + recId);
        if (!rec) return;
        var youtube = rec.querySelector('#youtubeiframe' + recId);
        if (!youtube) return;

        var youtubeStyle = getComputedStyle(youtube, null);
        var youtubePaddingLeft = parseInt(youtubeStyle.paddingLeft) || 0;
        var youtubePaddingRight = parseInt(youtubeStyle.paddingRight) || 0;
        var youtubeWidth = youtube.clientWidth - (youtubePaddingLeft + youtubePaddingRight);
        var youtubeHeight = youtubeWidth * 0.5625;
        var main = youtube.parentNode;

        youtube.style.height = youtubeHeight + 'px';

        if (main) main.style.height = youtubeHeight + 'px';
    }
}

function t700_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');
    var inputsWrapperStyle = getComputedStyle(inputsWrapper, null);
    var inputsWrapperPaddingTop = parseInt(inputsWrapperStyle.paddingTop) || 0;
    var inputsWrapperPaddingBottom = parseInt(inputsWrapperStyle.paddingBottom) || 0;
    var inputsWrapperHeight = inputsWrapper.clientHeight - (inputsWrapperPaddingTop + inputsWrapperPaddingBottom);
    var inputsOffset = inputsWrapper.getBoundingClientRect().top + window.pageYOffset;
    var inputsBottom = inputsWrapperHeight + inputsOffset;
    var successBox = form.querySelector('.t-form__successbox');
    var successBoxOffset = successBox.getBoundingClientRect().top + window.pageYOffset;
    var target = 0;
    var windowHeight = window.innerHeight;
    var body = document.body;
    var html = document.documentElement;
    var documentHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );

    if (window.innerWidth > 960) {
        target = successBoxOffset - 200;
    } else {
        target = successBoxOffset - 100;
    }

    var tildaLabel = document.querySelector('.t-tildalabel');

    if (successBoxOffset > window.scrollY || (documentHeight - inputsBottom) < (windowHeight - 100)) {
        inputsWrapper.classList.add('t700__inputsbox_hidden');

        setTimeout(function() {
            if (windowHeight > documentHeight && tildaLabel) {
                t700__fadeOut(tildaLabel);
            }
        }, 300);
    } else {
        t700__scroll(target);

        setTimeout(function() {
            inputsWrapper.classList.add('t700__inputsbox_hidden');
        }, 400);
    }

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t700__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity -= 0.1;

        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 50);
}

function t700__scroll(target) {
    var duration = 400;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = target - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t700__easeInOutCubic(currentTime) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t700__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t700__easeInOutCubic(currentTime));

        if (currentTime < duration) {
            setTimeout(t700__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t700__animateScroll();
} 
function t702_initPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t702');
    if (!container) return;

    rec.setAttribute('data-animationappear', 'off');
    rec.setAttribute('data-popup-subscribe-inited', 'y');
    rec.style.opacity = 1;

    var documentBody = document.body;
    var popup = rec.querySelector('.t-popup');
    var popupTooltipHook = popup.getAttribute('data-tooltip-hook');
    var analitics = popup.getAttribute('data-track-popup');
    var popupCloseBtn = popup.querySelector('.t-popup__close');
    var hrefs = rec.querySelectorAll('a[href*="#"]');
    var submitHref = rec.querySelector('.t-submit[href*="#"]');

    if (popupTooltipHook) {
        var recBlocks = document.querySelectorAll('.r');

        for (var i = 0; i < recBlocks.length; i++) {
            recBlocks[i].addEventListener('click', function(event) {
                var target = event.target;
                var href = target.closest('a[href="' + popupTooltipHook + '"]') ? target : false;

                if (!href) return;

                event.preventDefault();
                t702_showPopup(recId);
                t702_resizePopup(recId);
                t702__lazyLoad();

                if (analitics) {
                    Tilda.sendEventToStatistics(analitics, popupTooltipHook);
                }
            });
        }
    }

    popup.addEventListener('scroll', t_throttle(function () {
        t702__lazyLoad();
    }));

    popup.addEventListener('click', function(event) {
        var windowWithoutScrollBar = window.innerWidth - 17;

        if (event.clientX > windowWithoutScrollBar) return;
        if (event.target === this) t702_closePopup();
    });

    popupCloseBtn.addEventListener('click', t702_closePopup);

    if (submitHref) {
        submitHref.addEventListener('click', function() {
            if (documentBody.classList.contains('t-body_scroll-locked')) {
                documentBody.classList.remove('t-body_scroll-locked');
            }
        });
    }

    for (var i = 0; i < hrefs.length; i++) {
        hrefs[i].addEventListener('click', function() {
            var url = this.getAttribute('href');

            if (!url || url.substring(0, 7) != '#price:') {
                t702_closePopup();

                if (!url || url.substring(0, 7) == '#popup:') {
                    setTimeout(function() {
                        documentBody.classList.add('t-body_popupshowed');
                    }, 300);
                }
            }
        });
    }
}

function t702_lockScroll() {
    var documentBody = document.body;

    if (!documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || documentBody.parentNode || documentBody).scrollTop;

        documentBody.classList.add('t-body_scroll-locked');
        documentBody.style.top = '-' + bodyScrollTop + 'px';
        documentBody.setAttribute('data-popup-scrolltop', bodyScrollTop);
    }
}

function t702_unlockScroll() {
    var documentBody = document.body;

    if (documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = documentBody.getAttribute('data-popup-scrolltop');

        documentBody.classList.remove('t-body_scroll-locked');
        documentBody.style.top = null;
        documentBody.removeAttribute('data-popup-scrolltop');
        document.documentElement.scrollTop = parseInt(bodyScrollTop);
    }
}

function t702_showPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t702');
    if (!container) return;

    var popup = rec.querySelector('.t-popup');
    var popupContainer = popup.querySelector('.t-popup__container');
    var range = rec.querySelector('.t-range');
    var documentBody = document.body;

    popup.style.display = 'block';

    if (range) t702__triggerEvent(range, 'popupOpened');

    setTimeout(function() {
        popupContainer.classList.add('t-popup__container-animated');
        popup.classList.add('t-popup_show');
    }, 50);

    documentBody.classList.add('t-body_popupshowed');
    documentBody.classList.add('t702__body_popupshowed');

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        setTimeout(function() {
            t702_lockScroll();
        }, 500);
    }

    document.addEventListener('keydown', t702_escClosePopup);

    t702__lazyLoad();
}

function t702_escClosePopup(event) {
    if (event.key === 'Escape') t702_closePopup();
}

function t702_closePopup() {
    var popupAll = document.querySelectorAll('.t-popup');

    document.body.classList.remove('t-body_popupshowed');
    document.body.classList.remove('t702__body_popupshowed');

    for (var i = 0; i < popupAll.length; i++) {
        popupAll[i].classList.remove('t-popup_show');
    }

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        t702_unlockScroll();
    }

    setTimeout(function() {
        var popupHide = document.querySelectorAll('.t-popup:not(.t-popup_show)');

        for (var i = 0; i < popupHide.length; i++) {
            popupHide[i].style.display = 'none';
        }
    }, 300);

    document.removeEventListener('keydown', t702_escClosePopup);
}

function t702_resizePopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var popupContainer = rec.querySelector('.t-popup__container');
    if (!popupContainer) return;
    var popupStyle = getComputedStyle(popupContainer, null);
    var popupPaddingTop = parseInt(popupStyle.paddingTop) || 0;
    var popupPaddingBottom = parseInt(popupStyle.paddingBottom) || 0;
    var popupHeight = popupContainer.clientHeight - (popupPaddingTop + popupPaddingBottom);

    if (popupHeight > (window.innerHeight - 120)) {
        popupContainer.classList.add('t-popup__container-static');
    } else {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t702_sendPopupEventToStatistics(popupName) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';

    if (popupName.substring(0,7) == '#popup:') {
        popupName = popupName.substring(7);
    }

    virtPage += popupName;
    virtTitle += popupName;

    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {'hitType': 'pageview', 'page': virtPage, 'title': virtTitle});
            }
        }

        if (window.mainMetrika && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t702_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');
    var inputsWrapperStyle = getComputedStyle(inputsWrapper, null);
    var inputsWrapperPaddingTop = parseInt(inputsWrapperStyle.paddingTop) || 0;
    var inputsWrapperPaddingBottom = parseInt(inputsWrapperStyle.paddingBottom) || 0;
    var inputsWrapperHeight = inputsWrapper.clientHeight - (inputsWrapperPaddingTop + inputsWrapperPaddingBottom);
    var inputsOffset = inputsWrapper.getBoundingClientRect().top + window.pageYOffset;
    var inputsBottom = inputsWrapperHeight + inputsOffset;
    var successBox = form.querySelector('.t-form__successbox');
    var successBoxOffset = successBox.getBoundingClientRect().top + window.pageYOffset;
    var target = 0;
    var windowHeight = window.innerHeight;
    var body = document.body;
    var html = document.documentElement;
    var documentHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );

    if (window.innerWidth > 960) {
        target = successBoxOffset - 200;
    } else {
        target = successBoxOffset - 100;
    }

    var tildaLabel = document.querySelector('.t-tildalabel');

    if (successBoxOffset > window.scrollY || (documentHeight - inputsBottom) < (windowHeight - 100)) {
        inputsWrapper.classList.add('t702__inputsbox_hidden');

        setTimeout(function() {
            if (windowHeight > documentHeight && tildaLabel) {
                t702__fadeOut(tildaLabel);
            }
        }, 300);
    } else {
        t702__scroll(target);

        setTimeout(function() {
            inputsWrapper.classList.add('t702__inputsbox_hidden');
        }, 400);
    }

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t702__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity -= 0.1;

        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 50);
}

function t702__scroll(target) {
    var duration = 400;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = target - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t702__easeInOutCubic(currentTime) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t702__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t702__easeInOutCubic(currentTime));

        if (currentTime < duration) {
            setTimeout(t702__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t702__animateScroll();
}

function t702__lazyLoad() {
    if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}

function t702__triggerEvent(el, eventName) {
    var event;
    if (typeof window.CustomEvent === 'function') {
        event = new CustomEvent(eventName);
    } else if (document.createEvent) {
        event = document.createEvent('HTMLEvents');
        event.initEvent(eventName, true, false);
    } else if (document.createEventObject) {
        event = document.createEventObject();
        event.eventType = eventName;
    }

    event.eventName = eventName;

    if (el.dispatchEvent) {
        el.dispatchEvent(event);
    } else if (el.fireEvent) {
        el.fireEvent('on' + event.eventType, event);
    } else if (el[eventName]) {
        el[eventName]();
    } else if (el['on' + eventName]) {
        el['on' + eventName]();
    }

    if (t702__checkJqueryEvent(el, eventName)) {
        $(el).trigger(eventName);
    }
}

function t702__checkJqueryEvent(element, eventName) {
    var events = $._data(element, 'events') || false;
    var isEvent = false;

    if (events) {
        for (var key in events) {
            if (key === eventName) {
                isEvent = true;
                break;
            }
        }
    }

    return isEvent;
} 
function t704_onSuccess(t704_form){
	var t704_inputsWrapper = t704_form.find('.t-form__inputsbox');
    var t704_inputsHeight = t704_inputsWrapper.height();
    var t704_inputsOffset = t704_inputsWrapper.offset().top;
    var t704_inputsBottom = t704_inputsHeight + t704_inputsOffset;
	var t704_targetOffset = t704_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t704_target = t704_targetOffset - 200;
    }	else {
        var t704_target = t704_targetOffset - 100;
    }

    if (t704_targetOffset > $(window).scrollTop() || ($(document).height() - t704_inputsBottom) < ($(window).height() - 100)) {
        t704_inputsWrapper.addClass('t704__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);
    } else {
        $('html, body').animate({ scrollTop: t704_target}, 400);
        setTimeout(function(){t704_inputsWrapper.addClass('t704__inputsbox_hidden');}, 400);
    }

	var successurl = t704_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

}
 
function t706_onSuccessCallback(t706_form) {
    $(".t706__cartwin-products").slideUp(10, function () {});
    $(".t706__cartwin-bottom").slideUp(10, function () {});
    $(".t706 .t-form__inputsbox").slideUp(700, function () {});
    try {
        /*fix IOS11 cursor bug + general IOS background scroll*/
        tcart__unlockScroll();
    } catch (e) {}
} 
function t708_initPopup(recid) {
    $('#rec' + recid).attr('data-animationappear', 'off');
    $('#rec' + recid).css('opacity', '1');
    var el = $('#rec' + recid).find('.t708__popup'),
        analitics = el.attr('data-track-popup'),
        hook = "TildaSendMessageWidget" + recid,
        obj = $('#rec' + recid + ' .t708__btn');
    obj.click(function (e) {
        if (obj.hasClass("t708__btn_active")) {
            t708_closePopup();
            return;
        }
        obj.addClass("t708__btn_active");
        $('#rec' + recid + ' .t708').addClass("t708_active");
        t708_showPopup(recid);
        e.preventDefault();
        if (analitics > '') {
            Tilda.sendEventToStatistics(analitics, hook);
        }
    });
}

function t708_lockScroll() {
    var body = $("body");
    if (!body.hasClass('t-body_scroll-locked')) {
        var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
        body.addClass('t-body_scroll-locked');
        body.css("top", "-" + bodyScrollTop + "px");
        body.attr("data-popup-scrolltop", bodyScrollTop);
    }
}

function t708_unlockScroll() {
    var body = $("body");
    if (body.hasClass('t-body_scroll-locked')) {
        var bodyScrollTop = $("body").attr("data-popup-scrolltop");
        body.removeClass('t-body_scroll-locked');
        body.css("top", "");
        body.removeAttr("data-popup-scrolltop")
        window.scrollTo(0, bodyScrollTop);
    }
}

function t708_showPopup(recid) {
    var el = $('#rec' + recid),
        popup = el.find('.t708__popup');

    $('.t708__btn_wrapper').removeClass('t708__btn_animate');
    $('.t708__btn-text').css('display', 'none');
    if ($(window).width() < 960) {
        $('body').addClass('t708__body_popupshowed');
    }
    /*fix IOS11 cursor bug + general IOS background scroll*/
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream && $(window).width() < 960) {
        setTimeout(function () {
            t708_lockScroll();
        }, 500);
    }

    popup.css('display', 'block');
    el.find('.t-range').trigger('popupOpened');
    setTimeout(function () {
        popup.addClass('t708__popup_show');
    }, 50);

    el.find(".t708__mobile-icon-close").click(function (e) {
        t708_closePopup();
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            t708_closePopup();
        }
    });
}

function t708_closePopup() {
    if ($(window).width() < 960) {
        $('body').removeClass('t708__body_popupshowed');
    }
    /*fix IOS11 cursor bug + general IOS background scroll*/
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        t708_unlockScroll();
    }
    $('.t708').removeClass("t708_active");
    $('.t708__btn').removeClass('t708__btn_active');
    $('.t708__popup').removeClass('t708__popup_show');
    setTimeout(function () {
        $('.t708__popup').not('.t708__popup_show').css('display', 'none');
    }, 300);
}

function t708_sendPopupEventToStatistics(popupname) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';
    if (popupname.substring(0, 7) == '#popup:') {
        popupname = popupname.substring(7);
    }

    virtPage += popupname;
    virtTitle += popupname;
    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {

        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': virtPage,
                    'title': virtTitle
                });
            }
        }

        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {
                title: virtTitle,
                referer: window.location.href
            });
        }

    }
}


function t708_onSuccess(t708_form) {
    var t708_inputsWrapper = t708_form.find('.t-form__inputsbox');
    var t708_inputsHeight = t708_inputsWrapper.height();
    var t708_inputsOffset = t708_inputsWrapper.offset().top;
    var t708_inputsBottom = t708_inputsHeight + t708_inputsOffset;
    var t708_targetOffset = t708_form.find('.t-form__successbox').offset().top;

    if ($(window).width() > 960) {
        var t708_target = t708_targetOffset - 200;
    } else {
        var t708_target = t708_targetOffset - 100;
    }

    if (t708_targetOffset > $(window).scrollTop() || ($(document).height() - t708_inputsBottom) < ($(window).height() - 100)) {
        t708_inputsWrapper.addClass('t708__inputsbox_hidden');
        setTimeout(function () {
            if ($(window).height() > $('.t-body').height()) {
                $('.t-tildalabel').animate({
                    opacity: 0
                }, 50);
            }
        }, 300);
    } else {
        $('html, body').animate({
            scrollTop: t708_target
        }, 400);
        setTimeout(function () {
            t708_inputsWrapper.addClass('t708__inputsbox_hidden');
        }, 400);
    }

    var successurl = t708_form.data('success-url');
    if (successurl && successurl.length > 0) {
        setTimeout(function () {
            window.location.href = successurl;
        }, 500);
    }
}
 
function t712_onSuccess(originalForm) {
	var form = originalForm;
	if (originalForm instanceof jQuery && originalForm.length) {
		form = originalForm.get(0);
	}
	var inputsWrapper = form.querySelector('.t-form__inputsbox');
	var successBox = form.querySelector('.t-form__successbox');
	var inputsWrapperHeight = inputsWrapper ? inputsWrapper.offsetHeight : 0;
	var inputsWrapperOffsetTop = inputsWrapper ? inputsWrapper.getBoundingClientRect().top + window.pageYOffset : 0;
	var inputsBottom = inputsWrapperHeight + inputsWrapperOffsetTop;
	var targetOffset = successBox ? successBox.getBoundingClientRect().top + window.pageYOffset : 0;
	var targetYoutubeRecommendationsArea = window.innerWidth > 960 ? 200 : 100;
	var target = targetOffset - targetYoutubeRecommendationsArea;
	var documentHeight = Math.max(
		document.body.scrollHeight, document.documentElement.scrollHeight,
		document.body.offsetHeight, document.documentElement.offsetHeight,
		document.body.clientHeight, document.documentElement.clientHeight
	);
	
	if (targetOffset > window.pageYOffset || ((documentHeight - inputsBottom) < (window.innerHeight - 100))) {
		if (inputsWrapper) inputsWrapper.classList.add('t712__inputsbox_hidden');
		setTimeout(function () {
			var tBody = document.querySelector('.t-body');
			if (tBody && window.innerHeight > tBody.offsetHeight) {
				var tLabel = document.querySelector('.t-tildalabel');
				if (tLabel) {
					t712_fadeOut(tLabel, 50);
				}
			}
		}, 300);
	} else {
		t712_scrollToNextSection(target, 400);
		setTimeout(function () {
			if (inputsWrapper) inputsWrapper.classList.add('t712__inputsbox_hidden');
		}, 400);
	}
	
	var successurl = form.getAttribute('data-success-url');
	if (successurl) {
		setTimeout(function () {
			window.location.href = successurl;
		}, 500);
	}
	
}

function t712_fixcontentheight(id) {
	/* correct cover height if content more when cover height */
	var rec = document.getElementById('rec' + id);
	if (!rec) return;
	var cover = rec.querySelector('.t-cover');
	var filter = rec.querySelector('.t-cover__filter');
	var carrier = rec.querySelector('.t-cover__carrier');
	var wrapper = rec.querySelector('.t-cover__wrapper');
	var container = rec.querySelector('.t-cover__container');
	var coverHeight = cover ? cover.offsetHeight : 0;
	var content = rec.querySelector('div[data-hook-content]');
	var contentHeight = content ? content.offsetHeight : 0;
	
	if (contentHeight > 300 && coverHeight < contentHeight) {
		var youTubeRecommendationsSpace = 120;
		if (contentHeight > 1000) youTubeRecommendationsSpace += 100;
		contentHeight += youTubeRecommendationsSpace;
		
		console.log('auto correct cover height: ' + contentHeight);
		
		if (cover) cover.style.height = contentHeight + 'px';
		if (filter) filter.style.height = contentHeight + 'px';
		if (carrier) carrier.style.height = contentHeight + 'px';
		if (wrapper) wrapper.style.height = contentHeight + 'px';
		if (container) container.style.height = contentHeight + 'px';
		
		if (!window.isMobile) {
			setTimeout(function () {
				var videoBlock = rec.querySelector('.t-cover__carrier');
				if (videoBlock && videoBlock.querySelector('iframe')) {
					console.log('correct video from cover_fixcontentheight');
					window.setWidthAndHeightVideo(videoBlock, contentHeight + 'px', 'youtube');
				}
			}, 2000);
		}
	}
}

function t712_fadeOut(el, duration) {
	var opacity = 1;
	duration = parseInt(duration);
	var speed = duration > 0 ? duration / 10 : 40; /*default duration = 400*/
	var timer = setInterval(function () {
		el.style.opacity = opacity;
		opacity -= 0.1;
		if (opacity <= 0.1) {
			clearInterval(timer);
		}
	}, speed);
}

function t712_scrollToNextSection(to, duration) {
	if (duration <= 0) return;
	var difference = to - window.pageYOffset;
	var perTick = difference / duration * 10;
	setTimeout(function () {
		window.scrollTo(0, window.pageYOffset + perTick);
		document.body.setAttribute('data-scrollable', 'true');
		if (window.pageYOffset === to) {
			document.body.removeAttribute('data-scrollable');
			return;
		}
		t712_scrollToNextSection(to, duration - 10);
	}, 10);
	setTimeout(function () {
		if (document.body.getAttribute('data-scrollable') === 'true') {
			document.body.removeAttribute('data-scrollable');
		}
	}, duration * 2);
} 
function t716_onSuccess(originalForm) {
	var form = originalForm;
	if (originalForm instanceof jQuery && originalForm.length) {
		form = originalForm.get(0);
	}
	var inputWrapper = form.querySelector('.t-form__inputsbox');
	var inputHeight = inputWrapper ? inputWrapper.offsetHeight : 0;
	var inputOffset = inputWrapper ? inputWrapper.getBoundingClientRect().top + window.pageYOffset : 0;
	var inputBottom = inputHeight + inputOffset;
	var successBox = form.querySelector('.t-form__successbox');
	var targetOffset = successBox ? successBox.getBoundingClientRect().top + window.pageYOffset : 0;
	var documentHeight = Math.max(
		document.body.scrollHeight, document.documentElement.scrollHeight,
		document.body.offsetHeight, document.documentElement.offsetHeight,
		document.body.clientHeight, document.documentElement.clientHeight
	);
	
	var target;
	if (window.innerWidth > 960) {
		target = targetOffset - 200;
	} else {
		target = targetOffset - 100;
	}
	
	if (targetOffset > window.pageYOffset || ((documentHeight - inputBottom) < window.innerHeight - 100)) {
		inputWrapper.classList.add('t716__inputsbox_hidden');
		setTimeout(function () {
			var tBody = document.querySelector('.t-body');
			if (tBody && window.innerHeight > tBody.offsetHeight) {
				var tLabel = document.querySelector('.t-tildalabel');
				if (tLabel) {
					t716_fadeOut(tLabel, 50);
				}
			}
		}, 300);
	} else {
		t716_scrollToNextSection(target, 400);
		setTimeout(function () {
			if (inputWrapper) inputWrapper.classList.add('t716__inputsbox_hidden');
		}, 400);
	}
	
	var successURL = form.getAttribute('data-success-url');
	if (successURL) {
		setTimeout(function () {
			window.location.href = successURL;
		}, 500);
	}
	
}


function t716_fixcontentheight(recid) {
	/* correct cover height if content more when cover height */
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var cover = rec.querySelector('.t-cover');
	var filter = rec.querySelector('.t-cover__filter');
	var carrier = rec.querySelector('.t-cover__carrier');
	var wrapper = rec.querySelector('.t-cover__wrapper');
	var container = rec.querySelector('.t-cover__container');
	var content = rec.querySelector('div[data-hook-content]');
	var coverHeight = cover ? cover.offsetHeight : 0;
	var contentHeight = content ? content.offsetHeight : 0;
	if (contentHeight > 300 && coverHeight < contentHeight) {
		var youTubeRecommendationsSpace = 120;
		if (contentHeight > 1000) youTubeRecommendationsSpace += 100;
		contentHeight += youTubeRecommendationsSpace;
		console.log('auto correct cover height: ' + contentHeight);
		if (cover) cover.style.height = contentHeight + 'px';
		if (filter) filter.style.height = contentHeight + 'px';
		if (carrier) carrier.style.height = contentHeight + 'px';
		if (wrapper) wrapper.style.height = contentHeight + 'px';
		if (container) container.style.height = contentHeight + 'px';
		if (!window.isMobile) {
			setTimeout(function () {
				var videoBlock = rec.querySelector('.t-cover__carrier');
				if (videoBlock && videoBlock.querySelector('iframe')) {
					console.log('correct video from cover_fixcontentheight');
					window.setWidthAndHeightVideo(videoBlock, contentHeight + 'px', 'youtube');
				}
			}, 2000);
		}
	}
}

function t716_fadeOut(el, duration) {
	var opacity = 1;
	duration = parseInt(duration);
	var speed = duration > 0 ? duration / 10 : 40; /*default duration = 400*/
	var timer = setInterval(function () {
		el.style.opacity = opacity;
		opacity -= 0.1;
		if (opacity <= 0.1) {
			clearInterval(timer);
		}
	}, speed);
}

function t716_scrollToNextSection(to, duration) {
	if (duration <= 0) return;
	var difference = to - window.pageYOffset;
	var perTick = difference / duration * 10;
	setTimeout(function () {
		window.scrollTo(0, window.pageYOffset + perTick);
		document.body.setAttribute('data-scrollable', 'true');
		if (window.pageYOffset === to) {
			document.body.removeAttribute('data-scrollable');
			return;
		}
		t716_scrollToNextSection(to, duration - 10);
	}, 10);
	setTimeout(function () {
		if (document.body.getAttribute('data-scrollable') === 'true') {
			document.body.removeAttribute('data-scrollable');
		}
	}, duration * 2);
} 
function t718_onSuccess(t718_form){
	var t718_inputsWrapper = t718_form.find('.t-form__inputsbox');
    var t718_inputsHeight = t718_inputsWrapper.height();
    var t718_inputsOffset = t718_inputsWrapper.offset().top;
    var t718_inputsBottom = t718_inputsHeight + t718_inputsOffset;
	var t718_targetOffset = t718_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t718_target = t718_targetOffset - 200;
    }	else {
        var t718_target = t718_targetOffset - 100;
    }

    if (t718_targetOffset > $(window).scrollTop() || ($(document).height() - t718_inputsBottom) < ($(window).height() - 100)) {
        t718_inputsWrapper.addClass('t718__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);
    } else {
        $('html, body').animate({ scrollTop: t718_target}, 400);
        setTimeout(function(){t718_inputsWrapper.addClass('t718__inputsbox_hidden');}, 400);
    }

	var successurl = t718_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

}
 
function t720_onSuccess(t720_form){
	var t720_inputsWrapper = t720_form.find('.t-form__inputsbox');
    var t720_inputsHeight = t720_inputsWrapper.height();
    var t720_inputsOffset = t720_inputsWrapper.offset().top;
    var t720_inputsBottom = t720_inputsHeight + t720_inputsOffset;
	var t720_targetOffset = t720_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t720_target = t720_targetOffset - 200;
    }	else {
        var t720_target = t720_targetOffset - 100;
    }

    if (t720_targetOffset > $(window).scrollTop() || ($(document).height() - t720_inputsBottom) < ($(window).height() - 100)) {
        t720_inputsWrapper.addClass('t720__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);
    } else {
        $('html, body').animate({ scrollTop: t720_target}, 400);
        setTimeout(function(){t720_inputsWrapper.addClass('t720__inputsbox_hidden');}, 400);
    }

	var successurl = t720_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

}


function t720_fixcontentheight(id){
        /* correct cover height if content more when cover height */
        var el = $("#rec" + id);
        var hcover=el.find(".t-cover").height();
        var hcontent=el.find("div[data-hook-content]").outerHeight();
        if(hcontent>300 && hcover<hcontent){
         var hcontent=hcontent+120;
         if(hcontent>1000){hcontent+=100;}
         console.log('auto correct cover height: '+hcontent);
         el.find(".t-cover").height(hcontent);
         el.find(".t-cover__filter").height(hcontent);
         el.find(".t-cover__carrier").height(hcontent);
         el.find(".t-cover__wrapper").height(hcontent);
         el.find(".t-cover__container").height(hcontent);
         if($isMobile == false){
          setTimeout(function() {
           var divvideo=el.find(".t-cover__carrier");
           if(divvideo.find('iframe').length>0){
            console.log('correct video from cover_fixcontentheight');
      setWidthHeightYoutubeVideo(divvideo, hcontent+'px');
     }
    }, 2000);
   }
        }
 }
 
function t722_onSuccess(t722_form){
	var t722_inputsWrapper = t722_form.find('.t-form__inputsbox');
    var t722_inputsHeight = t722_inputsWrapper.height();
    var t722_inputsOffset = t722_inputsWrapper.offset().top;
    var t722_inputsBottom = t722_inputsHeight + t722_inputsOffset;
	var t722_targetOffset = t722_form.find('.t-form__successbox').offset().top;

    if ($(window).width()>960) {
        var t722_target = t722_targetOffset - 200;
    }	else {
        var t722_target = t722_targetOffset - 100;
    }

    if (t722_targetOffset > $(window).scrollTop() || ($(document).height() - t722_inputsBottom) < ($(window).height() - 100)) {
        t722_inputsWrapper.addClass('t722__inputsbox_hidden');
		setTimeout(function(){
			if ($(window).height() > $('.t-body').height()) {$('.t-tildalabel').animate({ opacity:0 }, 50);}
		}, 300);
    } else {
        $('html, body').animate({ scrollTop: t722_target}, 400);
        setTimeout(function(){t722_inputsWrapper.addClass('t722__inputsbox_hidden');}, 400);
    }

	var successurl = t722_form.data('success-url');
    if(successurl && successurl.length > 0) {
        setTimeout(function(){
            window.location.href= successurl;
        },500);
    }

}


function t722_fixcontentheight(id){
        /* correct cover height if content more when cover height */
        var el = $("#rec" + id);
        var hcover=el.find(".t-cover").height();
        var hcontent=el.find("div[data-hook-content]").outerHeight();
        if(hcontent>300 && hcover<hcontent){
         var hcontent=hcontent+120;
         if(hcontent>1000){hcontent+=100;}
         console.log('auto correct cover height: '+hcontent);
         el.find(".t-cover").height(hcontent);
         el.find(".t-cover__filter").height(hcontent);
         el.find(".t-cover__carrier").height(hcontent);
         el.find(".t-cover__wrapper").height(hcontent);
         el.find(".t-cover__container").height(hcontent);
         if($isMobile == false){
          setTimeout(function() {
           var divvideo=el.find(".t-cover__carrier");
           if(divvideo.find('iframe').length>0){
            console.log('correct video from cover_fixcontentheight');
      setWidthHeightYoutubeVideo(divvideo, hcontent+'px');
     }
    }, 2000);
   }
        }
 }
 
function t724_init(recid) {
    if (typeof localStorage === 'object' && !window.isMobile) {
        var el = $('#rec' + recid).find('.t724__opener');
        var name = el.attr('data-cookie-name');
        var time = el.attr('data-cookie-time') * 24 * 60 * 60 * 1000;
        var lstorage = sessionStorage.getItem(name);
        var timeout = parseInt(el.attr('data-timeout'), 10);

        setTimeout(function() {
            $('html').on('mouseleave', function(e) {
                if (e.clientY > 10) { return; }
                var curDate = Math.floor(Date.now());
    
                if (time == 0) {
                    lstorage = sessionStorage.getItem(name);
                } else {
                    lstorage = localStorage.getItem(name);
                }
    
                if (((lstorage == null || typeof lstorage == 'undefined') && !el.hasClass('t724__opener_activated')) || (lstorage < (curDate - time) && time > 0)) {
                    el.trigger('click');
                    if (el.get(0)) {
                        el.get(0).click();
                    }
                    el.addClass('t724__opener_activated');
                    if (time == 0) {
                        sessionStorage.setItem(name, curDate);
                    }
                    if (time > 0) {
                        localStorage.setItem(name, curDate);
                    }
                }
            });
        }, isNaN(timeout) ? 0 : timeout * 1000);
    }
}
 
function t734_init(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var coverBlock = document.querySelector('.t830');
	if (coverBlock) {
		var slidesWrapper = rec.querySelector('.t-slds__items-wrapper');
		if (slidesWrapper && slidesWrapper.classList.contains('t-slds_animated-none')) {
			t_onFuncLoad('t_sldsInit', function () {
				t_sldsInit(recid);
			});
		} else {
			setTimeout(function() {
				t_onFuncLoad('t_sldsInit', function () {
					t_sldsInit(recid);
				});
			}, 500);
		}
	} else {
		t_onFuncLoad('t_sldsInit', function () {
			t_sldsInit(recid);
		});
	}
	
	var currentCoverBlock = rec.querySelector('.t734');
	if (currentCoverBlock) {
		if (typeof jQuery !== 'undefined') {
			$(currentCoverBlock).on('displayChanged', function () {
				t_onFuncLoad('t_slds_updateSlider', function () {
					t_slds_updateSlider(recid);
				});
			});
		} else {
			currentCoverBlock.addEventListener('displayChanged', function () {
				t_onFuncLoad('t_slds_updateSlider', function () {
					t_slds_updateSlider(recid);
				});
			});
		}
	}
} 
function t744_init(recid) {
    t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid);
    });

    setTimeout(function () {
        t_onFuncLoad('t_prod__init', function () {
            t_prod__init(recid);
        });
        t744__hoverZoom_init(recid);
    }, 500);

    $('#rec' + recid).find('.t744').bind('displayChanged', function () {
        t744_updateSlider(recid);
    });
    $('body').trigger('twishlist_addbtn');
}

function t744__hoverZoom_init(recid) {
    if (window.isMobile) {
        return;
    }
    var rec = $('#rec' + recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function (url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function (script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function () {
                        t_hoverZoom_init(recid, '.t-slds__container');
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    }
}

function t744_updateSlider(recid) {
    var el = $('#rec' + recid);
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    var sliderWrapper = el.find('.t-slds__items-wrapper');
    var sliderWidth = el.find('.t-slds__container').width();
    var pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });

    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
} 
function t746_initPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	rec.setAttribute('data-animationappear', 'off');
	rec.style.opacity = '1';
	var popup = rec.querySelector('.t-popup');
	var iframeBody = rec.querySelectorAll('.t746__frame');
	var hook = popup ? popup.getAttribute('data-tooltip-hook') : '';
	var analitics = popup ? popup.getAttribute('data-track-popup') : '';
	
	t746_imageHeight(recid);
	t746_arrowWidth(recid);
	t746_show(recid);
	t746_hide(recid);
	
	window.addEventListener('resize', t_throttle(function () {
		t746_arrowWidth(recid);
	}, 200));
	
	window.addEventListener('orientationchange', function () {
		setTimeout(function () {
			t_onFuncLoad('t_slds_updateSlider', function () {
				t_slds_updateSlider(recid);
			});
		}, 500);
	});
	
	if (hook) {
		t_onFuncLoad('t_sldsInit', function () {
			t_sldsInit(recid);
		});
		
		if (popup) {
			popup.addEventListener('click', function (e) {
				if (e.target === popup) {
					Array.prototype.forEach.call(iframeBody, function (iframeB) {
						iframeB.innerHTML = '';
						iframeB.style.zIndex = '';
					});
					t746_closePopup(recid);
				}
			});
		}
		
		var popupClose = rec.querySelector('.t-popup__close');
		
		if (popupClose) {
			popupClose.addEventListener('click', function () {
				Array.prototype.forEach.call(iframeBody, function (iframeB) {
					iframeB.innerHTML = '';
					iframeB.style.zIndex = '';
				});
				t746_closePopup(recid);
			});
		}
		
		document.addEventListener('keydown', function (e) {
			if (e.keyCode === 27) {
				Array.prototype.forEach.call(iframeBody, function (iframeB) {
					iframeB.innerHTML = '';
					iframeB.style.zIndex = '';
				});
				t746_closePopup(recid);
			}
		});
		
		var allRec = document.getElementById('allrecords');
		var lazyMode = allRec ? allRec.getAttribute('data-tilda-lazy') : '';
		
		document.addEventListener('click', function (e) {
			if (e.target.closest('a[href="' + hook + '"]')) {
				e.preventDefault();
				t746_showPopup(recid);
				
				t_onFuncLoad('t_slds_updateSlider', function () {
					t_slds_updateSlider(recid);
				});
				
				t746_arrowWidth(recid);
				t746_resizePopup(recid);
				
				if (window.lazy === 'y' || lazyMode === 'yes') {
					t_onFuncLoad('t_lazyload_update', function () {
						t_lazyload_update();
					});
				}
				if (analitics > '') {
					var virtTitle = hook;
					if (virtTitle.substring(0, 7) === '#popup:') {
						virtTitle = virtTitle.substring(7);
					}
					Tilda.sendEventToStatistics(analitics, virtTitle);
				}
			}
		});
	}
}

function t746_showPopup(recid) {
	var rec = document.getElementById('rec' + recid);
	var popup = rec ? rec.querySelector('.t-popup') : null;
	var popupContainer = popup ? popup.querySelector('.t-popup__container') : null;
	
	if (popup) popup.style.display = 'block';
	
	setTimeout(function () {
		if (popupContainer) popupContainer.classList.add('t-popup__container-animated');
		if (popup) popup.classList.add('t-popup_show');
	}, 50);
	
	document.body.classList.add('t-body_popupshowed');
}

function t746_closePopup(recid) {
	document.body.classList.remove('t-body_popupshowed');
	
	var rec = document.getElementById('rec' + recid);
	var popup = rec ? rec.querySelector('.t-popup') : null;
	
	if (popup) popup.classList.remove('t-popup_show');
	
	var allCovers = rec.querySelectorAll('.t-bgimg');
	Array.prototype.forEach.call(allCovers, function (cover) {
		if (cover.style.opacity === '0') {
			cover.style.opacity = '';
		}
	});
	
	setTimeout(function () {
		var allPopups = document.querySelectorAll('.t-popup');
		Array.prototype.forEach.call(allPopups, function (popup) {
			if (!popup.classList.contains('.t-popup_show')) {
				popup.style.display = 'none';
			}
		});
	}, 300);
}

function t746_resizePopup(recid) {
	var rec = document.getElementById('rec' + recid);
	var popupContainer = rec ? rec.querySelector('.t-popup__container') : null;
	var popupHeight = popupContainer ? popupContainer.offsetHeight : 0;
	
	if (popupHeight > window.innerHeight) {
		if (popupContainer) popupContainer.classList.add('t-popup__container-static');
	} else {
		if (popupContainer) popupContainer.classList.remove('t-popup__container-static');
	}
}

/* deprecated */
function t746_sendPopupEventToStatistics(popupname) {
	var virtPage = '/tilda/popup/';
	var virtTitle = 'Popup: ';
	if (popupname.substring(0, 7) === '#popup:') {
		popupname = popupname.substring(7);
	}
	
	virtPage += popupname;
	virtTitle += popupname;
	
	if (ga) {
		if (window.mainTracker !== 'tilda') {
			ga('send', {
				'hitType': 'pageview',
				'page': virtPage,
				'title': virtTitle,
			});
		}
	}
	
	if (window.mainMetrika > '' && window[window.mainMetrika]) {
		window[window.mainMetrika].hit(virtPage, {
			title: virtTitle,
			referer: window.location.href,
		});
	}
}

function t746_show(recid) {
	var rec = document.getElementById('rec' + recid);
	var playBtns = rec ? rec.querySelectorAll('.t746__play') : [];
	
	Array.prototype.forEach.call(playBtns, function (play) {
		play.addEventListener('click', function () {
			var videoType = play.getAttribute('data-slider-video-type');
			var url;
			var nextEl;
			var prevEl;
			var iframe;
			switch (videoType) {
				case 'youtube':
					url = play.getAttribute('data-slider-video-url');
					nextEl = play.nextElementSibling;
					prevEl = play.previousElementSibling.previousElementSibling;
					if (nextEl) {
						iframe = document.createElement('iframe');
						iframe.classList.add('t746__iframe');
						iframe.width = '100%';
						iframe.height = '100%';
						iframe.src = 'https://www.youtube.com/embed/' + url + '?autoplay=1&enablejsapi=1';
						iframe.frameBorder = '0';
						iframe.setAttribute('webkitallowfullscreen', '');
						iframe.setAttribute('mozallowfullscreen', '');
						iframe.setAttribute('allowfullscreen', '');
						iframe.setAttribute('allow', 'autoplay');
						if (nextEl) nextEl.innerHTML = '';
						if (nextEl) nextEl.appendChild(iframe);
					}
					if (prevEl && prevEl.classList.contains('t-bgimg')) prevEl.style.opacity = '0';
					break;
				case 'vimeo':
					url = play.getAttribute('data-slider-video-url');
					nextEl = play.nextElementSibling;
					prevEl = play.previousElementSibling.previousElementSibling;
					var idMatch = /vimeo[^/]*\/(\d+)\/?(\w*)\/?/i.exec(url);
					var id = idMatch ? idMatch[1] : null;
					var hash = idMatch ? '?h=' + idMatch[2] : null;
					if (nextEl) {
						iframe = document.createElement('iframe');
						iframe.classList.add('t746__iframe');
						iframe.width = '100%';
						iframe.height = '100%';
						iframe.src = 'https://player.vimeo.com/video/' + id + hash + '?autoplay=1&amp;api=1';
						iframe.frameBorder = '0';
						iframe.setAttribute('allowfullscreen', '');
						iframe.setAttribute('allow', 'autoplay; fullscreen');
						if (nextEl) nextEl.innerHTML = '';
						if (nextEl) nextEl.appendChild(iframe);
					}
					if (prevEl && prevEl.classList.contains('t-bgimg')) prevEl.style.opacity = '0';
					break;
			}
			if (nextEl) nextEl.style.zIndex = '3';
		});
	});
}

function t746_hide(recid) {
	var rec = document.getElementById('rec' + recid);
	var popupBody = rec ? rec.querySelector('.t746__frame') : null;
	
	rec.addEventListener('updateSlider', function () {
		popupBody.innerHTML = '';
		popupBody.style.zIndex = '';
	});
}

function t746_imageHeight(recid) {
	var rec = document.getElementById('rec' + recid);
	var images = rec.querySelectorAll('.t746__separator');
	Array.prototype.forEach.call(images, function (img) {
		var width = img.getAttribute('data-slider-image-width') || 0;
		var height = img.getAttribute('data-slider-image-height') || 0;
		var ratio = height / width;
		var padding = ratio * 100;
		img.style.paddingBottom = padding + '%';
	});
}

function t746_arrowWidth(recid) {
	var rec = document.getElementById('rec' + recid);
	var arrows = rec ? rec.querySelectorAll('.t-slds__arrow_wrapper') : [];
	
	var slide = rec ? rec.querySelector('.t-slds__wrapper') : null;
	var slideWidth = slide ? slide.offsetWidth : 0;
	var arrowWidth = window.innerWidth - slideWidth;
	
	Array.prototype.forEach.call(arrows, function (arrow) {
		var arrowContainer = arrow ? arrow.closest('.t-slds__arrow_container') : null;
		var isArrowNearPic = arrowContainer ? arrowContainer.classList.contains('t-slds__arrow-nearpic') : false;
		if (window.innerWidth > 960 && isArrowNearPic) {
			arrow.style.width = (arrowWidth / 2) + 'px';
		} else {
			arrow.style.width = '';
		}
	});
}

if (!Element.prototype.matches) {
	Element.prototype.matches =
		Element.prototype.matchesSelector ||
		Element.prototype.msMatchesSelector ||
		Element.prototype.mozMatchesSelector ||
		Element.prototype.webkitMatchesSelector ||
		Element.prototype.oMatchesSelector;
}

// Polyfill: Element.closest
if (!Element.prototype.closest) {
	Element.prototype.closest = function (s) {
		var el = this;
		
		while (el && el.nodeType === 1) {
			if (Element.prototype.matches.call(el, s)) {
				return el;
			}
			el = el.parentElement || el.parentNode;
		}
		
		return null;
	};
} 
function t750_init(recid){
    t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid);
    });

  setTimeout(function(){
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
    t750_initPopup(recid);
    $('body').trigger('twishlist_addbtn');
  }, 500);
}

function t750_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    $('.r').on('click', 'a[href="' + hook + '"]', function(e) {
      t750_showPopup(recid);
      e.preventDefault();
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
            virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }
    });
  }
}

function t750_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup'),
      sliderWrapper = el.find('.t-slds__items-wrapper'),
      sliderWidth = el.find('.t-slds__container').width(),
      pos = parseFloat(sliderWrapper.attr('data-slider-pos'));

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    sliderWrapper = el.find('.t-slds__items-wrapper');
    sliderWidth = el.find('.t-slds__container').width();
    pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
    var windowWidth = $(window).width();
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
    if(e.clientX > windowWithoutScrollBar) {
        return;
    }
    if (e.target == this) {
      t750_closePopup();
    }
  });

  el.find('.t-popup__close, .t750__close-text').click(function(e){
    t750_closePopup();
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) {
      t750_closePopup();
    }
  });
  
  /* Ugly fix preventing Safari from rendering fixed elements like our popup cross icon at wrong position
    Ticket is 81421402487 */
  if (window.isSafari) {
    setTimeout(function() {
      el.find('.t-popup').scrollTop(1);
    })
  }
}

function t750_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');
  $('.t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}
/*deprecated*/
function t750_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }

  virtPage += popupname;
  virtTitle += popupname;

  if(ga) {
    if (window.mainTracker != 'tilda') {
      ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
    }
  }

  if (window.mainMetrika > '' && window[window.mainMetrika]) {
    window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
  }
} 
function t754__init(recid) {
    setTimeout(function() {
        t_onFuncLoad('t_prod__init', function () {
            t_prod__init(recid);
        });
        t754__hoverZoom_init(recid);
        t754_initPopup(recid);
        t754__updateLazyLoad(recid);
        t754__alignButtons_init(recid);
        if (typeof t_store_addProductQuantityEvents !== 'undefined') {
            t754_initProductQuantity(recid);
        }
        $('body').trigger('twishlist_addbtn');
    }, 500);
}

function t754_initProductQuantity(recid) {
    var el = $('#rec' + recid);
    var productList = el.find(".t754__col, .t754__product-full");
    productList.each(function(i, product) {
        t_store_addProductQuantityEvents($(product));
    });
}

function t754__showMore(recid) {
    var el = $('#rec' + recid).find(".t754");
    var showmore = el.find('.t754__showmore');
    var cards_count = parseInt(el.attr('data-show-count'), 10);
    
    if (cards_count > 0) {
        if (showmore.text() === '') {
            showmore.find('td').text(t754__dict('loadmore'));
        }
        
        showmore.show();
        el.find('.t754__col').hide();
    
        var cards_size = el.find('.t754__col').size();
        var cards_count = parseInt(el.attr('data-show-count'), 10);
        var x = cards_count;
        var y = cards_count;
        
        t754__showSeparator(el, x);
    
        el.find('.t754__col:lt(' + x + ')').show();
    
        showmore.click(function () {
            x = (x + y <= cards_size) ? x + y : cards_size;
            el.find('.t754__col:lt(' + x + ')').show();
            if (x == cards_size) {
                showmore.hide();
            }
            if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
                if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
            }
            t754__showSeparator(el, x);
            if ($('#rec' + recid).find('[data-buttons-v-align]')[0]) {
                t754__alignButtons(recid);
            }
        });
    }
}

function t754__showSeparator(el, x) {
    el.find('.t754__separator_number').addClass('t754__separator_hide');
    el.find('.t754__separator_hide').each(function() {
        if ($(this).attr('data-product-separator-number') <= x) {
            $(this).removeClass('t754__separator_hide');
        }
    });
}

function t754__dict(msg) {
    var dict = [];

    dict['loadmore'] = {
        EN: 'Load more',
        RU: 'Загрузить еще',
        FR: 'Charger plus',
        DE: 'Mehr laden',
        ES: 'Carga más',
        PT: 'Carregue mais',
        UK: 'Завантажити ще',
        JA: 'もっと読み込む',
        ZH: '裝載更多',
    };

    var lang = window.browserLang;

    if (typeof dict[msg] !== 'undefined') {
        if (typeof dict[msg][lang] !== 'undefined' && dict[msg][lang] != '') {
            return dict[msg][lang];
        } else {
            return dict[msg]['EN'];
        }
    }

    return 'Text not found "' + msg + '"';
}

function t754__alignButtons_init(recid) {
    var el = $('#rec' + recid);
    if (el.find('[data-buttons-v-align]')[0]) {
        try {
            t754__alignButtons(recid);
            $(window).bind(
                'resize',
                t_throttle(function() {
                    if (
                        typeof window.noAdaptive !== 'undefined' &&
                        window.noAdaptive === true &&
                        $isMobile
                    ) {
                        return;
                    }
                    t754__alignButtons(recid);
                }, 200)
            );

            el.find('.t754').bind('displayChanged', function() {
                t754__alignButtons(recid);
            });

            if ($isMobile) {
                $(window).on('orientationchange', function() {
                    t754__alignButtons(recid);
                });
            }
        } catch (e) {
            console.log('buttons-v-align error: ' + e.message);
        }
    }
}

function t754__alignButtons(recid) {
    var rec = $('#rec' + recid);
    var wrappers = rec.find('.t754__textwrapper');
    var maxHeight = 0;
    var itemsInRow = rec.find('.t-container').attr('data-blocks-per-row') * 1;

    var mobileView = $(window).width() <= 480;
    var tableView = $(window).width() <= 960 && $(window).width() > 480;
    var mobileOneRow =
        $(window).width() <= 960 && rec.find('.t754__container_mobile-flex')[0]
            ? true
            : false;
    var mobileTwoItemsInRow =
        $(window).width() <= 480 && rec.find('.t754 .mobile-two-columns')[0]
            ? true
            : false;

    if (mobileView) {
        itemsInRow = 1;
    }

    if (tableView) {
        itemsInRow = 2;
    }

    if (mobileTwoItemsInRow) {
        itemsInRow = 2;
    }

    if (mobileOneRow) {
        itemsInRow = 999999;
    }

    var i = 1;
    var wrappersInRow = [];

    $.each(wrappers, function(key, element) {
        element.style.height = 'auto';
        if (itemsInRow === 1) {
            element.style.height = 'auto';
        } else {
            
            wrappersInRow.push(element);
            if (element.offsetHeight > maxHeight) {
                maxHeight = element.offsetHeight;
            }

            $.each(wrappersInRow, function(key, wrapper) {
                wrapper.style.height = maxHeight + 'px';
            });

            if (i === itemsInRow) {
                i = 0;
                maxHeight = 0;
                wrappersInRow = [];
            }

            i++;
        }
    });
}


function t754__hoverZoom_init(recid) {
    if(isMobile) {
        return;
    }
    var rec = $('#rec'+recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function(url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function(script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function() {
                        t_hoverZoom_init(recid, ".t-slds__container");
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    } 
}

function t754__updateLazyLoad(recid) {
  var scrollContainer = $("#rec"+recid+" .t754__container_mobile-flex");
  var curMode = $(".t-records").attr("data-tilda-mode");
  if (scrollContainer.length && curMode!="edit" && curMode!="preview") {
    scrollContainer.bind('scroll', t_throttle(function() {
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    }));
  }
}

function t754_initPopup(recid){
  var rec=$('#rec'+recid); 
  rec.find('[href^="#prodpopup"]').one( "click", function(e) {
      e.preventDefault();	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
      var lid_prod=el_prod.attr('data-product-lid');
      t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid+' #t754__product-' + lid_prod + '');
      });
  });
  rec.find('[href^="#prodpopup"]').click(function(e){	
      e.preventDefault();
      if ($(e.target).hasClass('t1002__addBtn') || $(e.target).parents().hasClass('t1002__addBtn')) {
		return
	  }
      t754_showPopup(recid);	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
	  var lid_prod=el_prod.attr('data-product-lid');
	  el_popup.find('.js-product').css('display','none');
	  var el_fullprod=el_popup.find('.js-product[data-product-lid="'+lid_prod+'"]');
	  el_fullprod.css('display','block');
    
    var analitics=el_popup.attr('data-track-popup');
    if (analitics > '') {
        var virtTitle = el_fullprod.find('.js-product-name').text();
        if (! virtTitle) {
            virtTitle = 'prod'+lid_prod;
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
    }

	  var curUrl = window.location.href;
      if (curUrl.indexOf('#!/tproduct/')<0 && curUrl.indexOf('%23!/tproduct/')<0 && curUrl.indexOf('#%21%2Ftproduct%2F') < 0) {
        if (typeof history.replaceState!='undefined'){
          window.history.replaceState('','',window.location.href+'#!/tproduct/'+recid+'-'+lid_prod);
        }
      }	
      t754_updateSlider(recid+' #t754__product-' + lid_prod + '');
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
  });
  if ($('#record'+recid).length==0){ t754_checkUrl(recid); }
  t754_copyTypography(recid);
}

function t754_checkUrl(recid){
  var curUrl = window.location.href;
  var tprodIndex = curUrl.indexOf('#!/tproduct/');
  if(tprodIndex<0){ 
      tprodIndex = curUrl.indexOf('%23!/tproduct/'); 
      if(tprodIndex<0){tprodIndex = curUrl.indexOf('#%21%2Ftproduct%2F')};
  }
  if (tprodIndex>=0){
    var curUrl = curUrl.substring(tprodIndex,curUrl.length);
    var curProdLid = curUrl.substring(curUrl.indexOf('-')+1,curUrl.length);
    var rec=$('#rec'+recid);
    if (curUrl.indexOf(recid)>=0 && rec.find('[data-product-lid='+curProdLid+']').length) {
  	  rec.find('[data-product-lid='+curProdLid+'] [href^="#prodpopup"]').triggerHandler('click');
    }
  }
}

function t754_updateSlider(recid) {
    var el=$('#rec'+recid);
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    var sliderWrapper = el.find('.t-slds__items-wrapper');
    var sliderWidth = el.find('.t-slds__container').width();
    var pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
}

function t754_showPopup(recid){
  var el=$('#rec'+recid);
  var popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
    var windowWidth = $(window).width();
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
    if(e.clientX > windowWithoutScrollBar) {
        return;
    }
    if (e.target == this) {
      t754_closePopup();
    }
  });

  el.find('.t-popup__close, .t754__close-text').click(function(e){
    t754_closePopup();
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) {
      t754_closePopup();
    }
  });
}

function t754_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('.t-popup').removeClass('t-popup_show');
  $('body').trigger('twishlist_addbtn');
  var curUrl=window.location.href;
  var indexToRemove=curUrl.indexOf('#!/tproduct/');
  if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove<0){ 
  indexToRemove=curUrl.indexOf('%23!/tproduct/'); 
  if(indexToRemove<0){indexToRemove = curUrl.indexOf('#%21%2Ftproduct%2F')};
  }
  curUrl=curUrl.substring(0,indexToRemove);
  setTimeout(function() {
    $(".t-popup").scrollTop(0);  
    $('.t-popup').not('.t-popup_show').css('display', 'none');
	if (typeof history.replaceState!='undefined'){
      window.history.replaceState('','',curUrl);
    }                                                                        	
  }, 300);
}

function t754_removeSizeStyles(styleStr){
	if(typeof styleStr!="undefined" && (styleStr.indexOf('font-size')>=0 || styleStr.indexOf('padding-top')>=0 || styleStr.indexOf('padding-bottom')>=0)){
		var styleStrSplitted = styleStr.split(';');
		styleStr = "";
		for (var i=0;i<styleStrSplitted.length;i++){
			if(styleStrSplitted[i].indexOf('font-size')>=0 || styleStrSplitted[i].indexOf('padding-top')>=0 || styleStrSplitted[i].indexOf('padding-bottom')>=0){
				styleStrSplitted.splice(i,1); i--; continue;
			}			
			if(styleStrSplitted[i]==""){continue;}
			styleStr+=styleStrSplitted[i]+";";
		}
	}
	return styleStr;
}

function t754_copyTypography(recid){
  var rec=$('#rec'+recid);
  var titleStyle=rec.find('.t754__title').attr('style');
	var descrStyle=rec.find('.t754__descr').attr('style');
	rec.find('.t-popup .t754__title').attr("style",t754_removeSizeStyles(titleStyle));
	rec.find('.t-popup .t754__descr, .t-popup .t754__text').attr("style",t754_removeSizeStyles(descrStyle));
} 
function t756_init(recid){
    t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid);
    });

  setTimeout(function(){
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
    t756_initPopup(recid);
    $('body').trigger('twishlist_addbtn');
  }, 500);
}

function t756_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
  if(hook!==''){
    $('.r').on('click', 'a[href="' + hook + '"]', function(e) {
      t756_showPopup(recid);
      e.preventDefault();

      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
            virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }
    });
  }
}

function t756_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup'),
      sliderWrapper = el.find('.t-slds__items-wrapper'),
      sliderWidth = el.find('.t-slds__container').width(),
      pos = parseFloat(sliderWrapper.attr('data-slider-pos'));

  popup.css('display', 'block');

  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    sliderWrapper = el.find('.t-slds__items-wrapper');
    sliderWidth = el.find('.t-slds__container').width();
    pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
        var windowWidth = $(window).width();
        var maxScrollBarWidth = 17;
        var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
        if (e.clientX > windowWithoutScrollBar) {
            return;
        }
        if (e.target == this) {
            t756_closePopup(recid);
        }
    });

  el.find('.t-popup__close, .t756__close-text').click(function(e){
    t756_closePopup(recid);
  });

  el.find('a[href*="#"]').click(function(e){
    var url = $(this).attr('href');
    if (!url || (url.substring(0,7) != '#price:' && url.substring(0,15) != '#addtofavorites')) {
      t756_closePopup(recid);
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t756_closePopup(recid); }
  });
}

function t756_closePopup(recid){
  $('body').removeClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');
  $('#rec' + recid + ' .t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}
/* deprecated */
function t756_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {
    if(ga) {
      if (window.mainTracker != 'tilda') {
        ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
      }
    }
  
    if (window.mainMetrika > '' && window[window.mainMetrika]) {
      window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
    }
  }
} 
function t760_init(recid) {
    setTimeout(function () {
        t_onFuncLoad('t_prod__init', function () {
            t_prod__init(recid);
        });
    }, 500);

    t760_floating(recid);
    $(window).on('resize', t_throttle(function () {
        t760_floating(recid);
    }, 300));

    $('#rec' + recid).find('.t760').on('displayChanged', function () {
        t760_floating(recid);
    });
    $('body').trigger('twishlist_addbtn');
}

function t760_floating(recid) {
    var element = $('#rec' + recid);
    if (!window.isMobile) {
        element.find(".t760__floatable[data-floating='yes']").each(function () {
            var div = $(this);
            t760_floating_init(div);
        });
    }
}

function t760_floating_init(el){
  var wnd=$(window);
  var col=el.parent();

  el.css('max-width', '');
  el.css('max-width',el.width());
  el.css('width','100%');
  col.css('min-height', '');
  col.css('min-height',el.height());
  $(window).on('load', function(){
    col.css('min-height',el.height());
  });

  wnd.bind('scroll', t_throttle(function(){
     t760_floating_scroll(el,wnd,col);
  }, 20));      

  wnd.resize(function() {
       wnd.scroll();
  });

  wnd.scroll();
}

function t760_floating_scroll(el,wnd,col){
  var wnd_height = wnd.height();
  var wnd_width = wnd.width();

  if(wnd_width<=1024){
    el.removeClass('t760__fixedTop');
    el.removeClass('t760__fixedBottom');
    el.removeClass('t760__floating');
    return('');
  }

  el.css('max-width',col.width());

  if(col.height()<el.height() && col.height()>0){
    col.height(el.height());
  }

  var el_height = el.height();
  var col_top = col.offset().top;
  var col_width = col.width();
  var col_height = col.height();
  var col_bottom = col_top + col_height;

  var wnd_top = wnd.scrollTop();
  var wnd_bottom = wnd_top + wnd_height;

  var offset = parseFloat(el.attr('data-offset-top'));

  if(wnd_top+el_height+offset >= col_bottom){
    el.css('top', '');
    el.addClass('t760__fixedBottom');
    el.removeClass('t760__fixedTop');
    el.removeClass('t760__floating');
  }else if(wnd_top+offset > col_top){
    el.css('top', offset);
    el.addClass('t760__floating');
    el.removeClass('t760__fixedBottom');
    el.removeClass('t760__fixedTop');
  }else{
    el.css('top', '');
    el.addClass('t760__fixedTop');
    el.removeClass('t760__fixedBottom');  
    el.removeClass('t760__floating');
  }
} 
function t762_init(recid){
    t_onFuncLoad('t_sldsInit', function () {
      setTimeout(function() {
        t_sldsInit(recid);
      }, 200);
    });

  setTimeout(function(){
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
    t762__hoverZoom_init(recid);
  }, 500);
  
  $('#rec'+recid).find('.t762').bind('displayChanged',function(){
      t_onFuncLoad('t_slds_updateSlider', function () {
        t_slds_updateSlider(recid);
      });
  });
  $('body').trigger('twishlist_addbtn');
}

function t762__hoverZoom_init(recid) {
    if(isMobile) {
        return;
    }
    var rec = $('#rec'+recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function(url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function(script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function() {
                        t_hoverZoom_init(recid, ".t-slds__container");
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    } 
} 
function t764_init(recid) {
	var rec = document.getElementById('rec' + recid);
	
	t_onFuncLoad('t_sldsInit', function () {
		t_sldsInit(recid);
	});
	t_onFuncLoad('t_slds_SliderWidth', function () {
		t_slds_SliderWidth(recid);
	});
	var sliderWrapper = rec.querySelector('.t-slds__items-wrapper');
	var sliderContainer = rec.querySelector('.t-slds__container');
	var sliderWidth = sliderContainer ? sliderContainer.offsetWidth : 0;
	var sliderPos = sliderWrapper ? sliderWrapper.getAttribute('data-slider-pos') : '0';
	var pos = parseFloat(sliderPos);
	if (sliderWrapper) sliderWrapper.style.transform = 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)';
	
	t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
		t_slds_UpdateSliderHeight(recid);
	});
	t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
		t_slds_UpdateSliderArrowsHeight(recid);
	});
	
	var currentBlock = rec.querySelector('.t764');
	if (currentBlock) {
		currentBlock.addEventListener('displayChanged', function() {
			t_onFuncLoad('t_slds_updateSlider', function () {
				t_slds_updateSlider(recid);
			});
		});
	}
}
 
function t766_init(recid){
    t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid);
    });

  setTimeout(function(){
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
    t766_initPopup(recid);
    $('body').trigger('twishlist_addbtn');
  }, 500);
}

function t766_initPopup(recid){
  $('#rec'+recid).attr('data-animationappear','off');
  $('#rec'+recid).css('opacity','1');
  var el=$('#rec'+recid).find('.t-popup'),
      hook=el.attr('data-tooltip-hook'),
      analitics=el.attr('data-track-popup');
    t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid);
    });
  if(hook!==''){
    $('.r').on('click', 'a[href="' + hook + '"]', function(e) {
      t766_showPopup(recid);
      e.preventDefault();

      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
            virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }
    });
  }
}

function t766_showPopup(recid){
  var el=$('#rec'+recid),
      popup = el.find('.t-popup'),
      sliderWrapper = el.find('.t-slds__items-wrapper'),
      sliderWidth = el.find('.t-slds__container').width(),
      pos = parseFloat(sliderWrapper.attr('data-slider-pos'));

  popup.css('display', 'block');

  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    sliderWrapper = el.find('.t-slds__items-wrapper');
    sliderWidth = el.find('.t-slds__container').width();
    pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
    var windowWidth = $(window).width();
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
    if(e.clientX > windowWithoutScrollBar) {
        return;
    }
    if (e.target == this) {
      t766_closePopup(recid);
    }
  });

  el.find('.t-popup__close, .t766__close-text').click(function(e){
    t766_closePopup(recid);
  });

  el.find('a[href*="#"]').click(function(e){
    var url = $(this).attr('href');
    if (!url || (url.substring(0,7) != '#price:' && url.substring(0,15) != '#addtofavorites')) {
      t766_closePopup(recid);
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t766_closePopup(recid); }
  });
}

function t766_closePopup(recid){
  $('body').removeClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');
  $('#rec' + recid + ' .t-popup').removeClass('t-popup_show');
  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}
/* deprecated */
function t766_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
      popupname = popupname.substring(7);
  }
    
  virtPage += popupname;
  virtTitle += popupname;
  if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
    Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
  } else {
    if(ga) {
      if (window.mainTracker != 'tilda') {
        ga('send', {'hitType':'pageview', 'page':virtPage,'title':virtTitle});
      }
    }
  
    if (window.mainMetrika > '' && window[window.mainMetrika]) {
      window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
    }
  }
}
 
function t770_init(recid){
  var rec=$('#rec'+recid);
  var navElem=rec.find('.t770');
  var isFixed=(navElem.css('position')=='fixed');
  var redactorMode=navElem.hasClass('t770_redactor-mode');

  if(!redactorMode){
  	t770_highlight();
  	navElem.removeClass('t770__beforeready');
  	if(isFixed){
        t770_checkAnchorLinks(recid);
  	}
  	if(isFixed && navElem.attr('data-bgopacity-two')){
        t770_changebgopacitymenu(recid);
        $(window).bind('scroll', t_throttle(function(){t770_changebgopacitymenu(recid)}, 200));
  	}
    if(isFixed && navElem.attr('data-appearoffset')){
        navElem.removeClass('t770__beforeready');
        t770_appearMenu(recid);
        $(window).bind('scroll', t_throttle(function(){t770_appearMenu(recid)}, 200));
    }
  }
  if(rec.find('.t770__imglogo').attr('data-img-width')){
  	t770_setLogoPadding(recid);
  }
  if(rec.find('.t770__mobile_burger').length){
	  t770_createMobileMenu(recid);
  }

  t770_setBg(recid);
  $(window).bind('resize', t_throttle(function(){t770_setBg(recid);}, 200));
}


function t770_setLogoPadding(recid){
	if($(window).width()>980){			  
        var t770__menu = $('#rec'+recid+' .t770');
        var t770__logo=t770__menu.find('.t770__logowrapper');	  
        var t770__leftpart=t770__menu.find('.t770__leftwrapper');
        var t770__rightpart=t770__menu.find('.t770__rightwrapper');
        t770__leftpart.css("padding-right",t770__logo.width()/2+50);
        t770__rightpart.css("padding-left",t770__logo.width()/2+50);			        
	}
}

function t770_highlight(){
  var url=window.location.href;
  var pathname=window.location.pathname;
  if(url.substr(url.length - 1) == "/"){ url = url.slice(0,-1); }
  if(pathname.substr(pathname.length - 1) == "/"){ pathname = pathname.slice(0,-1); }
  if(pathname.charAt(0) == "/"){ pathname = pathname.slice(1); }
  if(pathname == ""){ pathname = "/"; }
  $(".t770__list_item a[href='"+url+"']").addClass("t-active");
  $(".t770__list_item a[href='"+url+"/']").addClass("t-active");
  $(".t770__list_item a[href='"+pathname+"']").addClass("t-active");
  $(".t770__list_item a[href='/"+pathname+"']").addClass("t-active");
  $(".t770__list_item a[href='"+pathname+"/']").addClass("t-active");
  $(".t770__list_item a[href='/"+pathname+"/']").addClass("t-active");
}

function t770_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var t770_navLinks = $("#rec" + recid + " .t770__desktoplist .t770__list_item a:not(.tooltipstered)[href*='#']");
        if (t770_navLinks.length > 0) {
            t770_catchScroll(t770_navLinks);
        }
    }
}

function t770_catchScroll(t770_navLinks) {
    var t770_clickedSectionId = null,
        t770_sections = new Array(),
        t770_sectionIdTonavigationLink = [],
        t770_interval = 100,
        t770_lastCall, t770_timeoutId;
    t770_navLinks = $(t770_navLinks.get().reverse());
    t770_navLinks.each(function() {
        var t770_cursection = t770_getSectionByHref($(this));
        if (typeof t770_cursection.attr("id") != "undefined") {
            t770_sections.push(t770_cursection);
        }
        t770_sectionIdTonavigationLink[t770_cursection.attr("id")] = $(this);
    });
		t770_updateSectionsOffsets(t770_sections);
    t770_sections.sort(function(a, b) {
      return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
		$(window).bind('resize', t_throttle(function(){t770_updateSectionsOffsets(t770_sections);}, 200));
		$('.t770').bind('displayChanged',function(){t770_updateSectionsOffsets(t770_sections);});
		setInterval(function(){t770_updateSectionsOffsets(t770_sections);},5000);
    t770_highlightNavLinks(t770_navLinks, t770_sections, t770_sectionIdTonavigationLink, t770_clickedSectionId);

    t770_navLinks.click(function() {
        var t770_clickedSection = t770_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof t770_clickedSection.attr("id") != "undefined") {
            t770_navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            t770_clickedSectionId = t770_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function() {
        var t770_now = new Date().getTime();
        if (t770_lastCall && t770_now < (t770_lastCall + t770_interval)) {
            clearTimeout(t770_timeoutId);
            t770_timeoutId = setTimeout(function() {
                t770_lastCall = t770_now;
                t770_clickedSectionId = t770_highlightNavLinks(t770_navLinks, t770_sections, t770_sectionIdTonavigationLink, t770_clickedSectionId);
            }, t770_interval - (t770_now - t770_lastCall));
        } else {
            t770_lastCall = t770_now;
            t770_clickedSectionId = t770_highlightNavLinks(t770_navLinks, t770_sections, t770_sectionIdTonavigationLink, t770_clickedSectionId);
        }
    });
}


function t770_updateSectionsOffsets(sections){
	$(sections).each(function(){
		var t770_curSection = $(this);
		t770_curSection.attr("data-offset-top",t770_curSection.offset().top);
	});
}


function t770_getSectionByHref(curlink) {
    var t770_curLinkValue = curlink.attr("href").replace(/\s+/g, '');
    if (t770_curLinkValue[0]=='/') { t770_curLinkValue = t770_curLinkValue.substring(1); }
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + t770_curLinkValue.substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + t770_curLinkValue.substring(1) + "']");
    }
}

function t770_highlightNavLinks(t770_navLinks, t770_sections, t770_sectionIdTonavigationLink, t770_clickedSectionId) {
    var t770_scrollPosition = $(window).scrollTop(),
        t770_valueToReturn = t770_clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (t770_sections.length != 0 && t770_clickedSectionId == null && t770_sections[t770_sections.length-1].attr("data-offset-top") > (t770_scrollPosition + 300)){
      t770_navLinks.removeClass('t-active');
      return null;
    }

    $(t770_sections).each(function(e) {
        var t770_curSection = $(this),
            t770_sectionTop = t770_curSection.attr("data-offset-top"),
            t770_id = t770_curSection.attr('id'),
            t770_navLink = t770_sectionIdTonavigationLink[t770_id];
        if (((t770_scrollPosition + 300) >= t770_sectionTop) || (t770_sections[0].attr("id") == t770_id && t770_scrollPosition >= $(document).height() - $(window).height())) {
            if (t770_clickedSectionId == null && !t770_navLink.hasClass('t-active')) {
                t770_navLinks.removeClass('t-active');
                t770_navLink.addClass('t-active');
                t770_valueToReturn = null;
            } else {
                if (t770_clickedSectionId != null && t770_id == t770_clickedSectionId) {
                    t770_valueToReturn = null;
                }
            }
            return false;
        }
    });
    return t770_valueToReturn;
}

function t770_setPath(){
}

function t770_setBg(recid){
  var window_width=$(window).width();
  if(window_width>980){
    $(".t770").each(function() {
      var el=$(this);
      if(el.attr('data-bgcolor-setbyscript')=="yes"){
        var bgcolor=el.attr("data-bgcolor-rgba");
        el.css("background-color",bgcolor);
      }
      });
      }else{
        $(".t770").each(function() {
          var el=$(this);
          var bgcolor=el.attr("data-bgcolor-hex");
          el.css("background-color",bgcolor);
          el.attr("data-bgcolor-setbyscript","yes");
      });
  }
}

function t770_appearMenu(recid) {
      var window_width=$(window).width();
      if(window_width>980){
           $(".t770").each(function() {
                  var el=$(this);
                  var appearoffset=el.attr("data-appearoffset");
                  if(appearoffset!=""){
                          if(appearoffset.indexOf('vh') > -1){
                              appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                          }

                          appearoffset=parseInt(appearoffset, 10);

                          if ($(window).scrollTop() >= appearoffset) {
                            if(el.css('visibility') == 'hidden'){
                                el.finish();
                                el.css("top","-50px");
                                el.css("visibility","visible");
                                el.animate({"opacity": "1","top": "0px"}, 200,function() {
                                });
                            }
                          }else{
                            el.stop();
                            el.css("visibility","hidden");
                          }
                  }
           });
      }

}

function t770_changebgopacitymenu(recid) {
  var window_width=$(window).width();
  if(window_width>980){
    $(".t770").each(function() {
      var el=$(this);
      var bgcolor=el.attr("data-bgcolor-rgba");
      var bgcolor_afterscroll=el.attr("data-bgcolor-rgba-afterscroll");
      var bgopacityone=el.attr("data-bgopacity");
      var bgopacitytwo=el.attr("data-bgopacity-two");
      var menushadow=el.attr("data-menushadow");
      if(menushadow=='100'){
        var menushadowvalue=menushadow;
      }else{
        var menushadowvalue='0.'+menushadow;
      }
      if ($(window).scrollTop() > 20) {
        el.css("background-color",bgcolor_afterscroll);
        if(bgopacitytwo=='0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }else{
        el.css("background-color",bgcolor);
        if(bgopacityone=='0.0' || menushadow==' '){
          el.css("box-shadow","none");
        }else{
          el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
        }
      }
    });
  }
}

function t770_createMobileMenu(recid){
  var window_width=$(window).width(),
      el=$("#rec"+recid),
      menu=el.find(".t770"),
      burger=el.find(".t770__mobile");
  burger.click(function(e){
    menu.fadeToggle(300);
    $(this).toggleClass("t770_opened")
  })
  $(window).bind('resize', t_throttle(function(){
    window_width=$(window).width();
    if(window_width>980){
      menu.fadeIn(0);
    }
  }, 200));
} 
function t772_init(recid) {
    $('.t772__container_mobile-flex').bind('touchstart', function() {
        $('.t772__col').bind('touchmove', function() {
            if (typeof $(".t-records").attr('data-tilda-mode') == 'undefined') {
                if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
            }
        });
    }).mouseup(function() {
        $('.t772__col').unbind('touchend');
    });
}
 
function t774_init(recid) {
    t774_unifyHeights(recid);

    $(window).on('resize', t_throttle(function () {
        t774_unifyHeights(recid)
    }, 200));

    $(".t774").on("displayChanged", function () {
        t774_unifyHeights(recid);
    });

    $(window).on('load', function () {
        t774_unifyHeights(recid);
    });

    setTimeout(function () {
        t774__updateLazyLoad(recid);
    }, 500);
}


function t774__updateLazyLoad(recid) {
    var scrollContainer = $("#rec" + recid + " .t774__container_mobile-flex");
    var curMode = $(".t-records").attr("data-tilda-mode");
    if (scrollContainer.length && curMode != "edit" && curMode != "preview" && window.lazy === "y") {
        scrollContainer.bind('scroll', t_throttle(function () {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }, 500));
    }
}


function t774_unifyHeights(recid) {
    var t774_el = $('#rec' + recid),
        t774_blocksPerRow = t774_el.find(".t774__container").attr("data-blocks-per-row"),
        t774_cols = t774_el.find(".t774__content"),
        t774_mobScroll = t774_el.find(".t774__scroll-icon-wrapper").length;

    if ($(window).width() <= 480 && t774_mobScroll == 0) {
        t774_cols.css("height", "auto");
        return;
    }

    var t774_perRow = +t774_blocksPerRow;
    if ($(window).width() <= 960 && t774_mobScroll > 0) {
        var t774_perRow = t774_cols.length;
    } else {
        if ($(window).width() <= 960) {
            var t774_perRow = 2;
        }
    }

    for (var i = 0; i < t774_cols.length; i += t774_perRow) {
        var t774_maxHeight = 0,
            t774_row = t774_cols.slice(i, i + t774_perRow);
        t774_row.each(function () {
            var t774_curText = $(this).find(".t774__textwrapper"),
                t774_curBtns = $(this).find(".t774__btn-wrapper, .t774__btntext-wrapper"),
                t774_itemHeight = t774_curText.outerHeight() + t774_curBtns.outerHeight();
            if (t774_itemHeight > t774_maxHeight) {
                t774_maxHeight = t774_itemHeight;
            }
        });
        t774_row.css("height", t774_maxHeight);
    }
} 
function t776__init(recid) {
    setTimeout(function() {
        t_onFuncLoad('t_prod__init', function () {
            t_prod__init(recid);
        });
        t776_initPopup(recid);
        t776__hoverZoom_init(recid);
        t776__updateLazyLoad(recid);
        t776__alignButtons_init(recid);
        if (typeof t_store_addProductQuantityEvents !== 'undefined') {
            t776_initProductQuantity(recid);
        }
        $('body').trigger('twishlist_addbtn');
    }, 500);
}

function t776_initProductQuantity(recid) {
    var el = $('#rec' + recid);
    var productList = el.find(".t776__col, .t776__product-full");
    productList.each(function(i, product) {
        t_store_addProductQuantityEvents($(product));
    });
}

function t776__showMore(recid) {
    var el = $('#rec' + recid).find(".t776");
    var showmore = el.find('.t776__showmore');
    var cards_count = parseInt(el.attr('data-show-count'), 10);
    
    if (cards_count > 0) {
        if (showmore.text() === '') {
            showmore.find('td').text(t776__dict('loadmore'));
        }
        
        showmore.show();
        el.find('.t776__col').hide();
    
        var cards_size = el.find('.t776__col').size();
        var x = cards_count;
        var y = cards_count;
        
        t776__showSeparator(el, x);
        
        /*el.find('.t776__col:lt(' + x + ')').css('display', 'inline-block');*/
    
        el.find('.t776__col:lt(' + x + ')').show();
        
        var currentColDisplayProp = el.find('.t776__col:lt(' + x + ')').css('display');
        
        window.addEventListener('resize', function() {
            var col = el.find('.t776__col:lt(' + x + ')');
            col.each(function() {
                this.style.display = '';
            });
            currentColDisplayProp = el.find('.t776__col:lt(' + x + ')').css('display');
            col.css('display', currentColDisplayProp === 'none' ? 'inline-block' : currentColDisplayProp);
        });
    
        showmore.click(function () {
            x = (x + y <= cards_size) ? x + y : cards_size;
            el.find('.t776__col:lt(' + x + ')').css('display', currentColDisplayProp === 'none' ? 'inline-block' : currentColDisplayProp);
            if (x == cards_size) {
                showmore.hide();
            }
            t776__showSeparator(el, x);
            if ($('#rec' + recid).find('[data-buttons-v-align]')[0]) {
                t776__alignButtons(recid);
            }
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t776__showSeparator(el, x) {
    el.find('.t776__separator_number').addClass('t776__separator_hide');
    el.find('.t776__separator_hide').each(function() {
        if ($(this).attr('data-product-separator-number') <= x) {
            $(this).removeClass('t776__separator_hide');
        }
    });
}

function t776__dict(msg) {
    var dict = [];

    dict['loadmore'] = {
        EN: 'Load more',
        RU: 'Загрузить еще',
        FR: 'Charger plus',
        DE: 'Mehr laden',
        ES: 'Carga más',
        PT: 'Carregue mais',
        UK: 'Завантажити ще',
        JA: 'もっと読み込む',
        ZH: '裝載更多',
    };

    var lang = window.browserLang;

    if (typeof dict[msg] !== 'undefined') {
        if (typeof dict[msg][lang] !== 'undefined' && dict[msg][lang] != '') {
            return dict[msg][lang];
        } else {
            return dict[msg]['EN'];
        }
    }

    return 'Text not found "' + msg + '"';
}

function t776__alignButtons_init(recid) {
    var el = $('#rec' + recid);
    if (el.find('[data-buttons-v-align]')[0]) {
        try {
            t776__alignButtons(recid);
            $(window).bind('resize', t_throttle(function() {
                    if (
                        typeof window.noAdaptive !== 'undefined' &&
                        window.noAdaptive === true &&
                        $isMobile
                    ) {
                        return;
                    }
                    t776__alignButtons(recid);
                })
            );

            el.find('.t776').bind('displayChanged', function() {
                t776__alignButtons(recid);
            });

            if ($isMobile) {
                $(window).on('orientationchange', function() {
                    t776__alignButtons(recid);
                });
            }
        } catch (e) {
            console.log('buttons-v-align error: ' + e.message);
        }
    }
}

function t776__alignButtons(recid) {
    var rec = $('#rec' + recid);
    var wrappers = rec.find('.t776__textwrapper');
    var maxHeight = 0;
    var itemsInRow = rec.find('.t-container').attr('data-blocks-per-row') * 1;
    
    var mobileView = $(window).width() <= 480;
    var tableView = $(window).width() <= 960 && $(window).width() > 480;
    var mobileOneRow = $(window).width() <= 960 && rec.find('.t776__container_mobile-flex')[0] ? true: false;
    var mobileTwoItemsInRow = $(window).width() <= 480 && rec.find('.t776 .mobile-two-columns')[0] ? true: false;

    if (mobileView) {
        itemsInRow = 1;
    }

    if (tableView) {
        itemsInRow = 2;
    }
    
    if (mobileTwoItemsInRow) {
        itemsInRow = 2;
    }

    if (mobileOneRow) {
        itemsInRow = 999999;
    }

    var i = 1;
    var wrappersInRow = [];
    
    $.each(wrappers, function(key, element) {
        element.style.height = 'auto';
        if (itemsInRow === 1) {
            element.style.height = 'auto';
        } else {
            wrappersInRow.push(element);
            if (element.offsetHeight > maxHeight) {
                maxHeight = element.offsetHeight;
            }

            $.each(wrappersInRow, function(key, wrapper) {
                wrapper.style.height = maxHeight + 'px';
            });
            
            if (i === itemsInRow) {
                i = 0;
                maxHeight = 0;
                wrappersInRow = [];
            }

            i++;
        }
    });
}

function t776__hoverZoom_init(recid) {
    if(isMobile) {
        return;
    }
    var rec = $('#rec'+recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function(url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function(script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function() {
                        t_hoverZoom_init(recid);
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    } 
}

function t776__updateLazyLoad(recid) {
    var scrollContainer = $("#rec"+recid+" .t776__container_mobile-flex");
    var curMode = $(".t-records").attr("data-tilda-mode");
    if (scrollContainer.length && curMode!="edit" && curMode!="preview") {
        scrollContainer.bind('scroll', t_throttle(function() {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }));
    }
}

function t776_initPopup(recid){
    var rec=$('#rec' + recid);

    rec.find('[href^="#prodpopup"]').each(function(e) {
        var el_popup=rec.find('.t-popup');
        var el_prod=$(this).closest('.js-product');
        var lid_prod=el_prod.attr('data-product-lid');
        $(".r").find('a[href$="#!/tproduct/' + recid + '-' + lid_prod + '"]').click(function(e) {
            if (rec.find('[data-product-lid=' + lid_prod + ']').length) {
                rec.find('[data-product-lid=' + lid_prod + '] [href^="#prodpopup"]').triggerHandler('click');
            }
        });
    });

  rec.find('[href^="#prodpopup"]').one( "click", function(e) {
      e.preventDefault();	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
      var lid_prod=el_prod.attr('data-product-lid');
      t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid+' #t776__product-' + lid_prod + '');
      });
  });
  rec.find('[href^="#prodpopup"]').click(function(e){	
      e.preventDefault();
      if ($(e.target).hasClass('t1002__addBtn') || $(e.target).parents().hasClass('t1002__addBtn')) {
		return
	  }
      t776_showPopup(recid);	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
	  var lid_prod=el_prod.attr('data-product-lid');
	  el_popup.find('.js-product').css('display','none');
	  var el_fullprod=el_popup.find('.js-product[data-product-lid="'+lid_prod+'"]');
	  el_fullprod.css('display','block');

    var analitics=el_popup.attr('data-track-popup');
    if (analitics > '') {
        var virtTitle = el_fullprod.find('.js-product-name').text();
        if (! virtTitle) {
            virtTitle = 'prod'+lid_prod;
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
    }

      var curUrl = window.location.href;
      if (curUrl.indexOf('#!/tproduct/')<0 && curUrl.indexOf('%23!/tproduct/')<0) {
        if (typeof history.replaceState!='undefined'){
          window.history.replaceState('','',window.location.href+'#!/tproduct/'+recid+'-'+lid_prod);
        }
      }
      t776_updateSlider(recid+' #t776__product-' + lid_prod + '');
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
  });
  if ($('#record'+recid).length==0){ t776_checkUrl(recid); }
  t776_copyTypography(recid);
}

function t776_checkUrl(recid){
  var curUrl = window.location.href;
  var tprodIndex = curUrl.indexOf('#!/tproduct/');
  if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && tprodIndex<0){ tprodIndex = curUrl.indexOf('%23!/tproduct/'); }
  if (tprodIndex>=0){
    var curUrl = curUrl.substring(tprodIndex,curUrl.length);
    var curProdLid = curUrl.substring(curUrl.indexOf('-')+1,curUrl.length);
    var rec=$('#rec'+recid);
    if (curUrl.indexOf(recid)>=0 && rec.find('[data-product-lid='+curProdLid+']').length) {
  	  rec.find('[data-product-lid='+curProdLid+'] [href^="#prodpopup"]').triggerHandler('click');
    }
  }
}

function t776_updateSlider(recid) {
    var el=$('#rec'+recid);
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    var sliderWrapper = el.find('.t-slds__items-wrapper');
    var sliderWidth = el.find('.t-slds__container').width();
    var pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
}

function t776_showPopup(recid){
  var el=$('#rec'+recid);
  var popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
    var windowWidth = $(window).width();
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
    if(e.clientX > windowWithoutScrollBar) {
        return;
    }
    if (e.target == this) {
      t776_closePopup();
    }
  });

  el.find('.t-popup__close, .t776__close-text').click(function(e){
    t776_closePopup();
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) {
      t776_closePopup();
    }
  });
    
  /* Ugly fix preventing Safari from rendering fixed elements like our popup cross icon at wrong position */
  if (window.isSafari) {
    setTimeout(function() {
      el.find('.t-popup').scrollTop(1);
    })
  }
}

function t776_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');
  $('.t-popup').removeClass('t-popup_show');
  var curUrl=window.location.href;
  var indexToRemove=curUrl.indexOf('#!/tproduct/');
  if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove<0){ indexToRemove=curUrl.indexOf('%23!/tproduct/'); }
  curUrl=curUrl.substring(0,indexToRemove);
  setTimeout(function() {
    $(".t-popup").scrollTop(0);  
    $('.t-popup').not('.t-popup_show').css('display', 'none');
	if (typeof history.replaceState!='undefined'){
      window.history.replaceState('','',curUrl);
    }                                                                        	
  }, 300);
}

function t776_removeSizeStyles(styleStr){
	if(typeof styleStr!="undefined" && (styleStr.indexOf('font-size')>=0 || styleStr.indexOf('padding-top')>=0 || styleStr.indexOf('padding-bottom')>=0)){
		var styleStrSplitted = styleStr.split(';');
		styleStr = "";
		for (var i=0;i<styleStrSplitted.length;i++){
			if(styleStrSplitted[i].indexOf('font-size')>=0 || styleStrSplitted[i].indexOf('padding-top')>=0 || styleStrSplitted[i].indexOf('padding-bottom')>=0){
				styleStrSplitted.splice(i,1); i--; continue;
			}			
			if(styleStrSplitted[i]==""){continue;}
			styleStr+=styleStrSplitted[i]+";";
		}
	}
	return styleStr;
}

function t776_copyTypography(recid){
  var rec=$('#rec'+recid);
  var titleStyle=rec.find('.t776__title').attr('style');
	var descrStyle=rec.find('.t776__descr').attr('style');
	rec.find('.t-popup .t776__title').attr("style",t776_removeSizeStyles(titleStyle));
	rec.find('.t-popup .t776__descr, .t-popup .t776__text').attr("style",t776_removeSizeStyles(descrStyle));
} 
function t778__init(recid) {
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
    t778_initPopup(recid);
    t778__hoverZoom_init(recid);
    t778__updateLazyLoad(recid);
    t778__alignButtons_init(recid);
    t778__showMore(recid);
    if (typeof t_store_addProductQuantityEvents !== 'undefined') {
        t778_initProductQuantity(recid);
    }
    $('body').trigger('twishlist_addbtn');
}

function t778_initProductQuantity(recid) {
    var el = $('#rec' + recid);
    var productList = el.find(".t778__col, .t778__product-full");
    productList.each(function(i, product) {
        t_store_addProductQuantityEvents($(product));
    });
}

function t778__showMore(recid) {
    var el = $('#rec' + recid).find(".t778");
    var showmore = el.find('.t778__showmore');
    var cards_count = parseInt(el.attr('data-show-count'), 10);
    
    if (cards_count > 0) {
        if (showmore.text() === '') {
            showmore.find('td').text(t778__dict('loadmore'));
        }
        
        showmore.show();
        el.find('.t778__col').hide();
    
        var cards_size = el.find('.t778__col').size();
        var x = cards_count;
        var y = cards_count;
        
        t778__showSeparator(el, x);
    
        el.find('.t778__col:lt(' + x + ')').show();
    
        showmore.click(function () {
            x = (x + y <= cards_size) ? x + y : cards_size;
            el.find('.t778__col:lt(' + x + ')').show();
            el.trigger('displayChanged');
            if (x == cards_size) {
                showmore.hide();
            }
            t778__showSeparator(el, x);
            
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t778__dict(msg) {
    var dict = [];

    dict['loadmore'] = {
        EN: 'Load more',
        RU: 'Загрузить еще',
        FR: 'Charger plus',
        DE: 'Mehr laden',
        ES: 'Carga más',
        PT: 'Carregue mais',
        UK: 'Завантажити ще',
        JA: 'もっと読み込む',
        ZH: '裝載更多',
    };

    var lang = window.browserLang;

    if (typeof dict[msg] !== 'undefined') {
        if (typeof dict[msg][lang] !== 'undefined' && dict[msg][lang] != '') {
            return dict[msg][lang];
        } else {
            return dict[msg]['EN'];
        }
    }

    return 'Text not found "' + msg + '"';
}

function t778__showSeparator(el, x) {
    el.find('.t778__separator_number').addClass('t778__separator_hide');
    el.find('.t778__separator_hide').each(function() {
        if ($(this).attr('data-product-separator-number') <= x) {
            $(this).removeClass('t778__separator_hide');
        }
    });
}

function t778__hoverZoom_init(recid) {
    if (isMobile) {
        return;
    }
    var rec = $('#rec' + recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function (url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function (script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function () {
                        t_hoverZoom_init(recid, ".t-slds__container");
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    }
}

function t778__updateLazyLoad(recid) {
    var scrollContainer = $("#rec" + recid + " .t778__container_mobile-flex");
    var curMode = $(".t-records").attr("data-tilda-mode");
    if (scrollContainer.length && curMode != "edit" && curMode != "preview") {
        scrollContainer.bind('scroll', t_throttle(function () {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }));
    }
}

function t778__alignButtons_init(recid) {
    var el = $('#rec' + recid);
    if (el.find('[data-buttons-v-align]')[0]) {
        try {
            t778__alignButtons(recid);
            $(window).bind('resize', t_throttle(function () {
                if (
                    typeof window.noAdaptive !== 'undefined' &&
                    window.noAdaptive === true &&
                    $isMobile
                ) {
                    return;
                }
                t778__alignButtons(recid);
            }));

            el.find('.t778').bind('displayChanged', function () {
                t778__alignButtons(recid);
            });

            if ($isMobile) {
                $(window).on('orientationchange', function () {
                    t778__alignButtons(recid);
                });
            }
        } catch (e) {
            console.log('buttons-v-align error: ' + e.message);
        }
    }
}

function t778__alignButtons(recid) {
    var rec = $('#rec' + recid);
    var contents = rec.find('.t778__content');
    var maxHeight = 0;
    var maxHeightBtns = 0;
    var itemsInRow = rec.find('.t-container').attr('data-blocks-per-row') * 1;

    var mobileView = $(window).width() <= 480;
    var tableView = $(window).width() <= 960 && $(window).width() > 480;
    var mobileOneRow = $(window).width() <= 960 && rec.find('.t778__container_mobile-flex')[0] ? true : false;
    var mobileTwoItemsInRow = $(window).width() <= 480 && rec.find('.t778 .mobile-two-columns')[0] ? true : false;

    if (mobileView) {
        itemsInRow = 1;
    }

    if (tableView) {
        itemsInRow = 2;
    }

    if (mobileTwoItemsInRow) {
        itemsInRow = 2;
    }

    if (mobileOneRow) {
        itemsInRow = 999999;
    }

    var i = 1;
    var textWrappersInRow = [];
    var btnWrappersInRow = [];

    $.each(contents, function (key, content) {
        var textWrapper = $(content).find('.t778__textwrapper');
        if (textWrapper.length > 0) {
            textWrapper = textWrapper[0];
            textWrapper.style.height = 'auto';
            if (itemsInRow === 1) {
                textWrapper.style.height = 'auto';
            } else {
                textWrappersInRow.push(textWrapper);
                if (textWrapper.offsetHeight > maxHeight) {
                    maxHeight = textWrapper.offsetHeight;
                }

                if (maxHeight > 0) {
                    $(textWrappersInRow).css('height', maxHeight);
                }
            }
        }

        var btnWrapper = $(content).find('.t778__btn-wrapper');
        if (btnWrapper.length > 0) {
            btnWrapper = btnWrapper[0];
            btnWrapper.style.marginTop = '';
            if (itemsInRow === 1) {
                btnWrapper.style.marginTop = '';
            } else {
                btnWrappersInRow.push(btnWrapper);
                if (btnWrapper.offsetHeight > maxHeightBtns) {
                    maxHeightBtns = btnWrapper.offsetHeight;
                }
    
                $.each(btnWrappersInRow, function (key, btn) {
                    if (maxHeightBtns > btn.offsetHeight) {
                        btn.style.marginTop = (maxHeightBtns - btn.offsetHeight) + 'px';
                    }
                });
            }
        }

        if (i === itemsInRow) {
            i = 0;
            maxHeight = 0;
            textWrappersInRow = [];
            maxHeightBtns = 0;
            btnWrappersInRow = [];
        }

        i++;
    });
}

function t778_initPopup(recid) {
    var rec = $('#rec' + recid);

    rec.find('[href^="#prodpopup"]').each(function (e) {
        var el_popup = rec.find('.t-popup');
        var el_prod = $(this).closest('.js-product');
        var lid_prod = el_prod.attr('data-product-lid');
        $(".r").find('a[href$="#!/tproduct/' + recid + '-' + lid_prod + '"]').click(function (e) {
            if (rec.find('[data-product-lid=' + lid_prod + ']').length) {
                rec.find('[data-product-lid=' + lid_prod + '] [href^="#prodpopup"]').triggerHandler('click');
            }
        });
    });

    rec.find('[href^="#prodpopup"]').one("click", function (e) {
        e.preventDefault();
        var el_popup = rec.find('.t-popup');
        var el_prod = $(this).closest('.js-product');
        var lid_prod = el_prod.attr('data-product-lid');
        t_onFuncLoad('t_sldsInit', function () {
            t_sldsInit(recid + ' #t778__product-' + lid_prod + '');
        });
    });
    rec.find('[href^="#prodpopup"]').click(function (e) {
        e.preventDefault();
        if ($(e.target).hasClass('t1002__addBtn') || $(e.target).parents().hasClass('t1002__addBtn')) {
		  return;
	    }
        t778_showPopup(recid);
        var el_popup = rec.find('.t-popup');
        var el_prod = $(this).closest('.js-product');
        var lid_prod = el_prod.attr('data-product-lid');
        el_popup.find('.js-product').css('display', 'none');
        var el_fullprod = el_popup.find('.js-product[data-product-lid="' + lid_prod + '"]');
        el_fullprod.css('display', 'block');

        var analitics = el_popup.attr('data-track-popup');
        if (analitics > '') {
            var virtTitle = el_fullprod.find('.js-product-name').text();
            if (!virtTitle) {
                virtTitle = 'prod' + lid_prod;
            }
            Tilda.sendEventToStatistics(analitics, virtTitle);
        }

        var curUrl = window.location.href;
        if (curUrl.indexOf('#!/tproduct/') < 0 && curUrl.indexOf('%23!/tproduct/') < 0) {
            if (typeof history.replaceState != 'undefined') {
                window.history.replaceState('', '', window.location.href + '#!/tproduct/' + recid + '-' + lid_prod);
            }
        }
        t778_updateSlider(recid + ' #t778__product-' + lid_prod + '');
        setTimeout(function () {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }, 500);
    });
    if ($('#record' + recid).length == 0) {
        t778_checkUrl(recid);
    }
    t778_copyTypography(recid);
}

function t778_checkUrl(recid) {
    var curUrl = window.location.href;
    var tprodIndex = curUrl.indexOf('#!/tproduct/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && tprodIndex < 0) {
        tprodIndex = curUrl.indexOf('%23!/tproduct/');
    }
    if (tprodIndex >= 0) {
        var curUrl = curUrl.substring(tprodIndex, curUrl.length);
        var curProdLid = curUrl.substring(curUrl.indexOf('-') + 1, curUrl.length);
        var rec = $('#rec' + recid);
        if (curUrl.indexOf(recid) >= 0 && rec.find('[data-product-lid=' + curProdLid + ']').length) {
            rec.find('[data-product-lid=' + curProdLid + '] [href^="#prodpopup"]').triggerHandler('click');
        }
    }
}

function t778_updateSlider(recid) {
    var el = $('#rec' + recid);
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    var sliderWrapper = el.find('.t-slds__items-wrapper');
    var sliderWidth = el.find('.t-slds__container').width();
    var pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
}

function t778_showPopup(recid) {
    var el = $('#rec' + recid);
    var popup = el.find('.t-popup');

    popup.css('display', 'block');
    setTimeout(function () {
        popup.find('.t-popup__container').addClass('t-popup__container-animated');
        popup.addClass('t-popup_show');
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    }, 50);

    $('body').addClass('t-body_popupshowed');
    $('body').trigger('twishlist_addbtn');

    el.find('.t-popup').mousedown(function (e) {
        var windowWidth = $(window).width();
        var maxScrollBarWidth = 17;
        var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
        if (e.clientX > windowWithoutScrollBar) {
            return;
        }
        if (e.target == this) {
            t778_closePopup();
        }
    });

    el.find('.t-popup__close, .t778__close-text').click(function (e) {
        t778_closePopup();
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            t778_closePopup();
        }
    });
}

function t778_closePopup() {
    $('body').removeClass('t-body_popupshowed');
    $('body').trigger('twishlist_addbtn');
    $('.t-popup').removeClass('t-popup_show');
    var curUrl = window.location.href;
    var indexToRemove = curUrl.indexOf('#!/tproduct/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
        indexToRemove = curUrl.indexOf('%23!/tproduct/');
    }
    curUrl = curUrl.substring(0, indexToRemove);
    setTimeout(function () {
        $(".t-popup").scrollTop(0);
        $('.t-popup').not('.t-popup_show').css('display', 'none');
        if (typeof history.replaceState != 'undefined') {
            window.history.replaceState('', '', curUrl);
        }
    }, 300);
}

function t778_removeSizeStyles(styleStr) {
    if (typeof styleStr != "undefined" && (styleStr.indexOf('font-size') >= 0 || styleStr.indexOf('padding-top') >= 0 || styleStr.indexOf('padding-bottom') >= 0)) {
        var styleStrSplitted = styleStr.split(';');
        styleStr = "";
        for (var i = 0; i < styleStrSplitted.length; i++) {
            if (styleStrSplitted[i].indexOf('font-size') >= 0 || styleStrSplitted[i].indexOf('padding-top') >= 0 || styleStrSplitted[i].indexOf('padding-bottom') >= 0) {
                styleStrSplitted.splice(i, 1);
                i--;
                continue;
            }
            if (styleStrSplitted[i] == "") {
                continue;
            }
            styleStr += styleStrSplitted[i] + ";";
        }
    }
    return styleStr;
}

function t778_copyTypography(recid) {
    var rec = $('#rec' + recid);
    var titleStyle = rec.find('.t778__title').attr('style');
    var descrStyle = rec.find('.t778__descr').attr('style');
    rec.find('.t-popup .t778__title').attr("style", t778_removeSizeStyles(titleStyle));
    rec.find('.t-popup .t778__descr, .t-popup .t778__text').attr("style", t778_removeSizeStyles(descrStyle));
}

/* compability */
function t778_unifyHeights(recid) {
    var t778_el = $('#rec' + recid),
        t778_blocksPerRow = t778_el.find(".t778__container").attr("data-blocks-per-row"),
        t778_cols = t778_el.find(".t778__textwrapper"),
        t778_mobScroll = t778_el.find(".t778__scroll-icon-wrapper").length;

    if ($(window).width() <= 480 && t778_mobScroll == 0) {
        t778_cols.css("height", "auto");
        return;
    }

    var t778_perRow = +t778_blocksPerRow;
    if ($(window).width() <= 960 && t778_mobScroll > 0) {
        var t778_perRow = t778_cols.length;
    } else {
        if ($(window).width() <= 960) {
            var t778_perRow = 2;
        }
    }

    for (var i = 0; i < t778_cols.length; i += t778_perRow) {
        var t778_maxHeight = 0,
            t778_row = t778_cols.slice(i, i + t778_perRow);
        t778_row.each(function () {
            var t778_curText = $(this).find(".t778__textwrapper"),
                t778_curBtns = $(this).find(".t778__btn-wrapper_absolute"),
                t778_itemHeight = t778_curText.outerHeight() + t778_curBtns.outerHeight();
            if (t778_itemHeight > t778_maxHeight) {
                t778_maxHeight = t778_itemHeight;
            }
        });
        t778_row.css("height", t778_maxHeight);
    }
} 
function t780_init(recid){
    if($("#rec"+recid+" .t-slds").length){
        t_onFuncLoad('t_sldsInit', function () {
            t_sldsInit(recid);
        });
    }    

  setTimeout(function(){
      t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
      });
      $('body').trigger('twishlist_addbtn');
  }, 500);
  
    $('#rec'+recid).find('.t780').bind('displayChanged',function(){
        t_onFuncLoad('t_slds_updateSlider', function () {
            t_slds_updateSlider(recid);
        });
  });  
} 
$btnpaysubmit = false;

/* new block */
$(document).ready(function() {
    window.tildaGetPaymentForm = function (price, product, paysystem, blockid, lid, uid) {
        var $allrecords = $('#allrecords');
        var formnexturl = 'htt'+'ps://forms.tildacdn'+'.com/payment/next/';
        var virtPage = '/tilda/'+blockid+'/payment/';
        var virtTitle = 'Go to payment from '+blockid;

        if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
            Tilda.sendEventToStatistics(virtPage, virtTitle, product, price);
        }

        $.ajax ({
            type: "POST",
            url: formnexturl /*$(this).attr('action')*/,
            data: {
                projectid: $allrecords.data('tilda-project-id'),
                pageid: $allrecords.data('tilda-page-id'),
                formskey: $allrecords.data('tilda-formskey'),
                price: price,
                product: product,
                system: paysystem,
                recid: blockid,
                lid: lid ? lid : '',
                uid: uid ? uid : ''
            },
            dataType : "json",
            success: function(json){
                $btnpaysubmit.removeClass('t-btn_sending');
                tildaBtnPaySubmit = '0';

                /* если нужно переслать данные дальше, в платежную систему */
                if (json && json.next && json.next.type > '') {
                    var res = window.tildaForm.payment($('#'+blockid), json.next);
                    successurl = '';
                    return false;
                }
                
                /* error */
                if (json && json.error) {
                    alert(json.error);
                }
            },
            fail: function(error){
                var txt;
                $btnpaysubmit.removeClass('t-btn_sending');
                tildaBtnPaySubmit = '0';

                if (error && error.responseText>'') {
                    txt = error.responseText+'. Please, try again later.';
                } else {
                    if (error && error.statusText) {
                        txt = 'Error ['+error.statusText+']. Please, try again later.';
                    }else {
                        txt = 'Unknown error. Please, try again later.';
                    }
                }
                alert(txt);
            },
            timeout: 10*1000
        });
        
    };
    
    if (typeof tcart__cleanPrice == 'undefined') {
        function tcart__cleanPrice (price) {
            if (typeof price=='undefined' || price=='' || price==0) {
                price=0;
            } else {
                price = price.replace(',','.');
                price = price.replace(/[^0-9\.]/g,'');
                price = parseFloat(price).toFixed(2);
                if(isNaN(price)) { price=0; }
                price = parseFloat(price);
                price = price*1;
                if (price<0) { price=0; }
            }
            return price;
        }
    }

    if (typeof tcart__escapeHtml == 'undefined') {
        function tcart__escapeHtml(text) {
            var map = {
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[<>"']/g, function(m) { return map[m]; });
        }
    }

    if ($('.js-payment-systembox').length > 0) {
        var tildaBtnPaySubmit = '0';
        $('a[href^="#order"]').off('dblclick');
        $('a[href^="#order"]').off('click');
        $('a[href^="#order"]').click(function(e){
            e.preventDefault();

            /* защита от повторной отправки */
            if (tildaBtnPaySubmit == '1') {
                return false;
            }

            if ($('.t706').length > 0) {
                var text = 'Conflict error: there are two incompatible blocks on the page: ST100 and ST105. Please go to Tilda Editor and delete one of these blocks.';
                if (window.browserLang === 'RU') {
                    text = 'Ошибка: на странице есть два несовместимых блока: ST100 и ST105. Пожалуйста, перейдите в редактор Тильды и удалите один из этих блоков.';
                }

                console.error(text);

                return false;
            }

            $btnpaysubmit = $(this);
            $btnpaysubmit.addClass('t-btn_sending');
            tildaBtnPaySubmit = '1';

            var tmp = $(this).attr('href');
            var arParam, price=0, product='', lid='', uid='';
            if (tmp.substring(0,7) == '#order:') {
                /* format:  #order:Product name=Cost */
                tmp = tmp.split(':');
                arParam = tmp[1].split('=');
                price = tcart__cleanPrice(arParam[1]);
                product = tcart__escapeHtml(arParam[0]);
            } else {
                var pel=$(this).closest('.js-product');
                if(typeof pel!='undefined') {
                    if(product==''){
                            product=pel.find('.js-product-name').text();
                            if (typeof product=='undefined') { product='' };
                    }
                    if(price=='' || price==0){
                        price = pel.find('.js-product-price').text();
                        price = tcart__cleanPrice(price);
                    }
                    lid = pel.data('product-lid') || '';
                    uid = pel.data('product-uid') || pel.data('product-gen-uid') || '';

                    var optprice = 0;
                    var options=[];
                    pel.find('.js-product-option').each(function() {
                        var el_opt=$(this);
                        var op_option=el_opt.find('.js-product-option-name').text();
                        var op_variant=el_opt.find('option:selected').val();
                        var op_price=el_opt.find('option:selected').attr('data-product-variant-price');
                        op_price = tcart__cleanPrice(op_price);
                        
                        if(typeof op_option!='undefined' && typeof op_variant!='undefined'){
                            var obj={};
                            if(op_option!=''){
                                op_option = tcart__escapeHtml(op_option);
                            }
                            if(op_variant!=''){
                                op_variant = tcart__escapeHtml(op_variant);
                                op_variant = op_variant.replace(/(?:\r\n|\r|\n)/g, '');
                            }
                            if(op_option.length>1 && op_option.charAt(op_option.length-1)==':'){
                                op_option=op_option.substring(0,op_option.length-1);
                            }
                            
                            optprice = optprice + parseFloat(op_price);
                            options.push(op_option + '=' + op_variant);
                        }
                    });			

                    if (options.length > 0) {
                        product = product + ': '+options.join(', ');
                        /* price = parseFloat(optprice); */
                    }
                }
            }
            var $parent = $(this).parent();
            var blockid = $(this).closest('.r').attr('id');
            var $paysystems= $('.js-dropdown-paysystem .js-payment-system');
            
            if (!product) {
                var tmp=$(this).closest('.r').find('.title');
                if (tmp.length > 0) {
                    product = tmp.text();
                } else {
                    product = $(this).text();
                }
            }

            if ($paysystems.length == 0) {
                alert('Error: payment system is not assigned. Add payment system in the Site Settings.');
                $btnpaysubmit.removeClass('t-btn_sending');
                tildaBtnPaySubmit = '0';
                return false;
            }
            if ($paysystems.length == 1) {
                tildaGetPaymentForm(price, product, $paysystems.data('payment-system'), blockid, lid, uid);
            } else {
                var $jspaybox = $('.js-payment-systembox');
                if ( $jspaybox.length > 0) {
                    var $linkelem = $(this);
                    var offset = $linkelem.offset();
                    var itemOffsetRight = offset.left + $jspaybox.width();
                    $jspaybox.css('top',offset.top+'px');
                    
                    setItemRightCoord();
                    
                    $jspaybox.css('margin-top','-45px');
                    
                    $jspaybox.css('position','absolute');
                    $jspaybox.css('z-index','9999999');
                    
                    $jspaybox.appendTo($('body'));
                    $(window).resize(function(){
                        if ($jspaybox.css('display')=='block' && $linkelem) {
                            offset = $linkelem.offset();
                            $jspaybox.css('top',offset.top+'px');
                            setItemRightCoord();
                        }
                    });
                    /*
                    $jspaybox.css('margin-top','-45px');
                    $($parent).css('position','relative');
                    $jspaybox.appendTo($parent);
                    */
                    $jspaybox.show();
                    /*
                    var parentoffset = $(this).offset();
                    var payboxoffset = $jspaybox.offset();
                    if (parentoffset.top > parseInt(payboxoffset.top) + parseInt($jspaybox.height())) {
                        var margintop = parseInt(parentoffset.top)+parseInt($(this).height())-parseInt(payboxoffset.top)-parseInt( $jspaybox.height());
                        $jspaybox.css('margin-top', margintop+'px');
                    }
                    */
                    
                    function hideList() {
                        $btnpaysubmit.removeClass('t-btn_sending');
                        tildaBtnPaySubmit = '0';

                        $jspaybox.hide(); 
                        $('.r').off('click', hideList); 
                        return false; 
                    }
                    
                    function setItemRightCoord() {
                        if ($(window).width() < 375) {
                            $jspaybox.css('left', '50%');
                            $jspaybox.css('margin-left', -$jspaybox.width()/2);
                        } else if (itemOffsetRight > $(window).width()) {
                            $jspaybox.css('left', offset.left - (itemOffsetRight - $(window).width()));
                            $jspaybox.css('margin-left','-25px');
                        } else {
                            $jspaybox.css('left',offset.left+'px');
                            $jspaybox.css('margin-left','-25px');
                        }
                    }
                    
                    $('.r').click(hideList);

                    $('.js-payment-systembox a').off('dblclick');
                    $('.js-payment-systembox a').off('click');
                    $('.js-payment-systembox a').click(function(e){
                        e.preventDefault();
                        $jspaybox.hide();
                        $linkelem = false;
                        tildaGetPaymentForm(price, product, $(this).data('payment-system'), blockid, lid, uid);
                        return false;
                    });
                }
            }

            return false;
        });
    }
}); 
function t786__init(recid){
    setTimeout(function(){
        t_onFuncLoad('t_prod__init', function () {
            t_prod__init(recid);
        });
        t786_initPopup(recid);
        t786__hoverZoom_init(recid);
        t786__updateLazyLoad(recid);
        t786__alignButtons_init(recid);
        if (typeof t_store_addProductQuantityEvents !== 'undefined') {
            t786_initProductQuantity(recid);
        }
        $('body').trigger('twishlist_addbtn');
    }, 500);
}

function t786_initProductQuantity(recid) {
    var el = $('#rec' + recid);
    var productList = el.find(".t786__col, .t786__product-full");
    productList.each(function(i, product) {
        t_store_addProductQuantityEvents($(product));
    });
}

function t786__alignButtons_init(recid) {
    var el = $('#rec' + recid);
    if (el.find('[data-buttons-v-align]')[0]) {
        try {
            t786__alignButtons(recid);
            $(window).bind('resize', t_throttle(function() {
                if (typeof window.noAdaptive !== 'undefined' && window.noAdaptive === true && $isMobile ) { return; }
                t786__alignButtons(recid);
            }));

            el.find('.t786').bind('displayChanged', function() {
                t786__alignButtons(recid);
            });

            if ($isMobile) {
                $(window).on('orientationchange', function() {
                    t786__alignButtons(recid);
                });
            }
        } catch (e) {
            console.log('buttons-v-align error: ' + e.message);
        }
    }
}

function t786__showMore(recid) {
    var el = $('#rec' + recid).find(".t786");
    var showmore = el.find('.t786__showmore');
    var cards_count = parseInt(el.attr('data-show-count'), 10);
    
    if (cards_count > 0) {
        if (showmore.text() === '') {
            showmore.find('td').text(t786__dict('loadmore'));
        }
        
        showmore.show();
        el.find('.t786__col').hide();
    
        var cards_size = el.find('.t786__col').size();
        var x = cards_count;
        var y = cards_count;
        
        t786__showSeparator(el, x);
    
        el.find('.t786__col:lt(' + x + ')').show();
    
        showmore.click(function () {
            x = (x + y <= cards_size) ? x + y : cards_size;
            el.find('.t786__col:lt(' + x + ')').show();
            if (x == cards_size) {
                showmore.hide();
            }
            t786__showSeparator(el, x);
            if ($('#rec' + recid).find('[data-buttons-v-align]')[0]) {
                t786__alignButtons(recid);
            }
            
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });
    }
}

function t786__dict(msg) {
    var dict = [];

    dict['loadmore'] = {
        EN: 'Load more',
        RU: 'Загрузить еще',
        FR: 'Charger plus',
        DE: 'Mehr laden',
        ES: 'Carga más',
        PT: 'Carregue mais',
        UK: 'Завантажити ще',
        JA: 'もっと読み込む',
        ZH: '裝載更多',
    };

    var lang = window.browserLang;

    if (typeof dict[msg] !== 'undefined') {
        if (typeof dict[msg][lang] !== 'undefined' && dict[msg][lang] != '') {
            return dict[msg][lang];
        } else {
            return dict[msg]['EN'];
        }
    }

    return 'Text not found "' + msg + '"';
}

function t786__showSeparator(el, x) {
    el.find('.t786__separator_number').addClass('t786__separator_hide');
    el.find('.t786__separator_hide').each(function() {
        if ($(this).attr('data-product-separator-number') <= x) {
            $(this).removeClass('t786__separator_hide');
        }
    });
}


function t786__alignButtons(recid) {
    var rec = $('#rec' + recid);
    var wrappers = rec.find('.t786__textwrapper');
    var maxHeight = 0;
    var itemsInRow = rec.find('.t-container').attr('data-blocks-per-row') * 1;

    var mobileView = $(window).width() <= 480;
    var tableView = $(window).width() <= 960 && $(window).width() > 480;
    var mobileOneRow = $(window).width() <= 960 && rec.find('.t786__container_mobile-flex')[0] ? true : false;
    var mobileTwoItemsInRow = $(window).width() <= 480 && rec.find('.t786 .mobile-two-columns')[0] ? true : false;

    if (mobileView) {
        itemsInRow = 1;
    }

    if (tableView) {
        itemsInRow = 2;
    }

    if (mobileTwoItemsInRow) {
        itemsInRow = 2;
    }

    if (mobileOneRow) {
        itemsInRow = 999999;
    }

    var i = 1;
    var wrappersInRow = [];

    $.each(wrappers, function(key, element) {
        element.style.height = 'auto';
        if (itemsInRow === 1) {
            element.style.height = 'auto';
        } else {
            wrappersInRow.push(element);
            if (element.offsetHeight > maxHeight) {
                maxHeight = element.offsetHeight;
            }

            $.each(wrappersInRow, function(key, wrapper) {
                wrapper.style.height = maxHeight + 'px';
            });

            if (i === itemsInRow) {
                i = 0;
                maxHeight = 0;
                wrappersInRow = [];
            }

            i++;
        }
    });
}


function t786__hoverZoom_init(recid) {
    if(isMobile) {
        return;
    }
    var rec = $('#rec'+recid);
    try {
        if (rec.find('[data-hover-zoom]')[0]) {
            if (!jQuery.cachedZoomScript) {
                jQuery.cachedZoomScript = function(url) {
                    var options = {
                        dataType: 'script',
                        cache: true,
                        url: url
                    };
                    return jQuery.ajax(options);
                };
            }
            $.cachedZoomScript(
                'https://static.tildacdn.com/js/tilda-hover-zoom-1.0.min.js'
            ).done(function(script, textStatus) {
                if (textStatus == 'success') {
                    setTimeout(function() {
                        t_hoverZoom_init(recid, ".t-slds__container");
                    }, 500);
                } else {
                    console.log('Upload script error: ' + textStatus);
                }
            });
        }
    } catch (e) {
        console.log('Zoom image init error: ' + e.message);
    } 
}

function t786__updateLazyLoad(recid) {
    var scrollContainer = $("#rec"+recid+" .t786__container_mobile-flex");
    var curMode = $(".t-records").attr("data-tilda-mode");
    if (scrollContainer.length && curMode!="edit" && curMode!="preview") {
        scrollContainer.bind('scroll', t_throttle(function() {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }));
    }
}

function t786_initPopup(recid){
  var rec=$('#rec'+recid); 
  rec.find('[href^="#prodpopup"]').one( "click", function(e) {
      e.preventDefault();	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
      var lid_prod=el_prod.attr('data-product-lid');
      t_onFuncLoad('t_sldsInit', function () {
        t_sldsInit(recid+' #t786__product-' + lid_prod + '');
      });
  });
  rec.find('[href^="#prodpopup"]').click(function(e){	
      e.preventDefault();
      if ($(e.target).hasClass('t1002__addBtn') || $(e.target).parents().hasClass('t1002__addBtn')) {
		  return;
	  }
      t786_showPopup(recid);	  
	  var el_popup=rec.find('.t-popup');
	  var el_prod=$(this).closest('.js-product');
	  var lid_prod=el_prod.attr('data-product-lid');
	  el_popup.find('.js-product').css('display','none');
	  var el_fullprod=el_popup.find('.js-product[data-product-lid="'+lid_prod+'"]');
	  el_fullprod.css('display','block');
	  
    var analitics=el_popup.attr('data-track-popup');
    if (analitics > '') {
        var virtTitle = el_fullprod.find('.js-product-name').text();
        if (! virtTitle) {
            virtTitle = 'prod'+lid_prod;
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
    }

	  var curUrl = window.location.href;
      if (curUrl.indexOf('#!/tproduct/')<0 && curUrl.indexOf('%23!/tproduct/')<0) {
		if (typeof history.replaceState!='undefined'){
		  window.history.replaceState('','',window.location.href+'#!/tproduct/'+recid+'-'+lid_prod);	
		}        
      }	
      t786_updateSlider(recid+' #t786__product-' + lid_prod + '');
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
  });
  if ($('#record'+recid).length==0){ t786_checkUrl(recid); }
  t786_copyTypography(recid);
}

function t786_checkUrl(recid){
  var curUrl = window.location.href;
  var tprodIndex = curUrl.indexOf('#!/tproduct/');
  if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && tprodIndex<0){ tprodIndex = curUrl.indexOf('%23!/tproduct/'); }
  if (tprodIndex>=0){
    var curUrl = curUrl.substring(tprodIndex,curUrl.length);
    var curProdLid = curUrl.substring(curUrl.indexOf('-')+1,curUrl.length);
    var rec=$('#rec'+recid);
    if (curUrl.indexOf(recid)>=0 && rec.find('[data-product-lid='+curProdLid+']').length) {
  	  rec.find('[data-product-lid='+curProdLid+'] [href^="#prodpopup"]').triggerHandler('click');
    }
  }
}

function t786_updateSlider(recid) {
    var el=$('#rec'+recid);
    t_onFuncLoad('t_slds_SliderWidth', function () {
        t_slds_SliderWidth(recid);
    });
    var sliderWrapper = el.find('.t-slds__items-wrapper');
    var sliderWidth = el.find('.t-slds__container').width();
    var pos = parseFloat(sliderWrapper.attr('data-slider-pos'));
    sliderWrapper.css({
        transform: 'translate3d(-' + (sliderWidth * pos) + 'px, 0, 0)'
    });
    t_onFuncLoad('t_slds_UpdateSliderHeight', function () {
        t_slds_UpdateSliderHeight(recid);
    });
    t_onFuncLoad('t_slds_UpdateSliderArrowsHeight', function () {
        t_slds_UpdateSliderArrowsHeight(recid);
    });
}

function t786_showPopup(recid){
  var el=$('#rec'+recid);
  var popup = el.find('.t-popup');

  popup.css('display', 'block');
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
  }, 50);

  $('body').addClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');

  el.find('.t-popup').mousedown(function(e){
    var windowWidth = $(window).width();
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
    if(e.clientX > windowWithoutScrollBar) {
        return;
    }
    if (e.target == this) {
      t786_closePopup();
    }
  });

  el.find('.t-popup__close, .t786__close-text').click(function(e){
    t786_closePopup();
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) {
      t786_closePopup();
    }
  });
}

function t786_closePopup(){
  $('body').removeClass('t-body_popupshowed');
  $('body').trigger('twishlist_addbtn');
  $('.t-popup').removeClass('t-popup_show');
  var curUrl=window.location.href;
  var indexToRemove=curUrl.indexOf('#!/tproduct/');
  if(/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove<0){ indexToRemove=curUrl.indexOf('%23!/tproduct/'); }
  curUrl=curUrl.substring(0,indexToRemove);
  setTimeout(function() {
    $(".t-popup").scrollTop(0);  
    $('.t-popup').not('.t-popup_show').css('display', 'none');
    if (typeof history.replaceState!='undefined'){
      window.history.replaceState('','',curUrl);                                                                  
    }                                                                    	                                                                        	
  }, 300);
}

function t786_removeSizeStyles(styleStr){
	if(typeof styleStr!="undefined" && (styleStr.indexOf('font-size')>=0 || styleStr.indexOf('padding-top')>=0 || styleStr.indexOf('padding-bottom')>=0)){
		var styleStrSplitted = styleStr.split(';');
		styleStr = "";
		for (var i=0;i<styleStrSplitted.length;i++){
			if(styleStrSplitted[i].indexOf('font-size')>=0 || styleStrSplitted[i].indexOf('padding-top')>=0 || styleStrSplitted[i].indexOf('padding-bottom')>=0){
				styleStrSplitted.splice(i,1); i--; continue;
			}			
			if(styleStrSplitted[i]==""){continue;}
			styleStr+=styleStrSplitted[i]+";";
		}
	}
	return styleStr;
}

function t786_copyTypography(recid){
  var rec=$('#rec'+recid);
  var titleStyle=rec.find('.t786__title').attr('style');
	var descrStyle=rec.find('.t786__descr').attr('style');
	rec.find('.t-popup .t786__title').attr("style",t786_removeSizeStyles(titleStyle));
	rec.find('.t-popup .t786__descr, .t-popup .t786__text').attr("style",t786_removeSizeStyles(descrStyle));
} 
function t788_init(recid){
  setTimeout(function(){
    $('#rec'+recid+' .t788').addClass('js-product');
    $('#rec'+recid+' .t-cover__carrier').addClass('js-product-img');      
    t_prod__init(recid);
  }, 500);
} 
function t790_init(recid) {
  $(".yButton .yButtonText").addClass("t790__yclients-btn-text");
} 
function t794_init(recid) {
    var hook = $('#rec' + recid + ' .t794').attr('data-tooltip-hook');
    if (typeof hook === "undefined" || hook === "") {
        return;
    }
    var hookLinks = $('a[href="' + hook + '"][data-submenu-disallowed!="yes"]');
    hookLinks.addClass('t794__tm-link');
    hookLinks.attr('data-tooltip-menu-id', recid);
    
    t794_addArrow(recid, hookLinks);
    t794_setUpMenu(recid, hookLinks);
    t794_highlight();
}


function t794_setUpMenu(recid, hookLinks) {
    var submenu = $('#rec' + recid + ' .t794__tooltip-menu');
    var content = submenu.find('t794__content');
    if (window.isMobile) {
        t794_setUpMenu_mobile(recid, hookLinks, submenu);
    } else {
        t794_setUpMenu_desktop(recid, hookLinks, submenu);
    }
    $(window).bind('scroll', t_throttle(function () {
        content.hover(function () {
            /* to do nothing */
        }, function () {
            if (submenu.hasClass('t794__tooltip-menu_show')) {
                t794_hideSubmenu(submenu);
            }
        });
    }, 300));
    $('.t794__tooltip-menu a[href*="#"]').click(function () {
        t794_hideSubmenu(submenu);
        $('.t450, .t199__mmenu, .t280, .t282, .t204__burger, .t451, .t466').trigger('clickedAnchorInTooltipMenu');

        $('.t794__tooltip-menu a[href*="#"]').removeClass('t-active');
        $(this).addClass('t-active');
    });
}


function t794_setUpMenu_mobile(recid, hookLinks, submenu) {
    var vIndent = $('#rec' + recid + ' .t794').attr('data-tooltip-margin');
    hookLinks.on('click', function (e) {
        if (submenu.hasClass('t794__tooltip-menu_show')) {
            t794_hideSubmenu(submenu);
        } else {
            var curAnchor = $(this);
            t794_showSubmenu(curAnchor, submenu, vIndent);
        }
        e.preventDefault();
    });
    $(document).click(function (e) {
        var isInsideSubmenu = ($(e.target).hasClass('t794__tooltip-menu') || $(e.target).parents('.t794__tooltip-menu').length > 0);
        var isAnchor = ($(e.target).hasClass('t794__tm-link') || $(e.target).parents('.t794__tm-link').length > 0);
        if (isAnchor) {
            var curAnchor;
            if ($(e.target).hasClass('t794__tm-link')) {
                curAnchor = $(e.target);
            } else {
                curAnchor = $(e.target).parents('.t794__tm-link');
            }
            if (curAnchor.attr('data-tooltip-menu-id') != recid && submenu.hasClass('t794__tooltip-menu_show')) {
                t794_hideSubmenu(submenu);
            }
        }
        if (!isInsideSubmenu && !isAnchor && submenu.hasClass('t794__tooltip-menu_show')) {
            t794_hideSubmenu(submenu);
        }
    });
}


function t794_setUpMenu_desktop(recid, hookLinks, submenu) {
    var vIndent = $('#rec' + recid + ' .t794').attr('data-tooltip-margin');
    var timer;
    hookLinks.add(submenu).on('mouseover', function () {
        /*if submenu is hovered while disappearing*/
        if ($(this).hasClass('t794__tooltip-menu') && !$(this).hasClass('t794__tooltip-menu_show')) {
            return;
        }
        clearTimeout(timer);
        /*if link is already hoverd and now hover is on submenu element*/
        if ($(this).hasClass('t794__tooltip-menu') && submenu.hasClass('t794__tooltip-menu_show')) {
            return;
        }
        var curAnchor = $(this);
        t794_showSubmenu(curAnchor, submenu, vIndent);
    });
    hookLinks.add(submenu).on('mouseout', function () {
        timer = setTimeout(function () {
             t794_hideSubmenu(submenu);
         }, 300);
    });
    hookLinks.on('click', function (e) {
        e.preventDefault();
    });
}


function t794_showSubmenu(curAnchor, submenu, vIndent) {
    var isFirefox = navigator.userAgent.search("Firefox") !== -1;
    var submenuHeight = submenu.outerHeight();
    var submenuWidth = submenu.outerWidth();
    var anchorHeight = curAnchor.height();
    var anchorWidth = curAnchor.width();
    if (curAnchor.hasClass('t-btn')) {
        anchorWidth = curAnchor.outerWidth();
    }
    var winHeight = $(window).height();
    var winWidth = $(window).width();
    var scrollTop = $(window).scrollTop();
    var anchorLeft = curAnchor.offset().left;
    var anchorTop = curAnchor.offset().top;
    submenu.attr('data-pos-fixed', 'no');

    var parentMenu = curAnchor.closest('[data-menu="yes"]');
    var parentZeroMenu = curAnchor.closest('.t396__artboard');
    
    if (parentMenu.length && parentMenu.css('position') === 'fixed') {
        submenu.attr('data-pos-fixed', 'yes');
    }
    var menuFixed = submenu.attr('data-pos-fixed');
    var submenuContent = submenu.find('.t794__content');
    
    if (typeof vIndent != 'undefined' && vIndent != '') {
        vIndent = vIndent.replace('px', '') * 1;
        /*add arrow*/
        vIndent = vIndent + 10;
    }
    
    var posy;
    if (menuFixed == 'yes') {
        posy = (anchorTop - scrollTop) + anchorHeight + vIndent;
        submenu.css('position', 'fixed');
        submenu.removeClass('t794__tooltip-menu_top').addClass('t794__tooltip-menu_bottom');
        submenuContent.css('max-height', 'calc(100vh - ' + posy + 'px)');
    } else {
        posy = anchorTop + anchorHeight + vIndent;
        submenu.css('position', 'absolute');
        /*detect posy, show on the top or bottom?*/
       
        var topSpace = anchorTop - scrollTop,
            bottomSpace = winHeight - topSpace;
    
        if (posy + submenuHeight > scrollTop + winHeight && topSpace > bottomSpace) {
            posy = posy - submenuHeight - anchorHeight - vIndent * 2;
            submenu.removeClass('t794__tooltip-menu_bottom').addClass('t794__tooltip-menu_top');
        } else {
            submenu.removeClass('t794__tooltip-menu_top').addClass('t794__tooltip-menu_bottom');
        }
    }
    
    var posx = anchorLeft;
    
    if (parentZeroMenu.hasClass('t396__artboard_scale') && window.tn_scale_factor) {
        posx = isFirefox ? posx : posx * window.tn_scale_factor;
        anchorWidth = anchorWidth * window.tn_scale_factor;
    }
    if (posx + submenuWidth / 2 < winWidth) {
        /*show in the center of anchor*/
        posx = posx + (anchorWidth - submenuWidth) / 2;
        /*show near left window border*/
        if (posx < 0) {
            posx = 10;
        }
    } else {
        /*show near right window border*/
        posx = winWidth - submenuWidth - 10;
    }
    submenu.css({
        'display': 'block',
        'left': posx,
        'top': posy
    });
    submenu[0].offsetHeight;
    submenu.addClass('t794__tooltip-menu_show');
    curAnchor.addClass('t794__tm-link_active');
}


function t794_hideSubmenu(submenu) {
    submenu.css({
        'display': '',
        'left': '',
        'top': ''
    });
    submenu.removeClass('t794__tooltip-menu_show');
    $('.t794__tm-link_active').removeClass('t794__tm-link_active');
}


function t794_addArrow(recid, hookLinks) {
    var arrow = $('#rec' + recid + ' .t794').attr('data-add-arrow');
    if (typeof arrow === 'undefined' || arrow === '') {
        return;
    }
    hookLinks.each(function (i, el) {
        $(el).append('<div class="t794__arrow"></div>');
    });
}


function t794_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash = window.location.hash;
    if (url.substr(url.length - 1) == '/') {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == '/') {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == '/') {
        pathname = pathname.slice(1);
    }
    if (pathname == '') {
        pathname = '/';
    }
    $('.t794__list_item a[href="' + url + '"]').addClass('t-active');
    $('.t794__list_item a[href="' + url + '/"]').addClass('t-active');
    $('.t794__list_item a[href="' + pathname + '"]').addClass('t-active');
    $('.t794__list_item a[href="/' + pathname + '"]').addClass('t-active');
    $('.t794__list_item a[href="' + pathname + '/"]').addClass('t-active');
    $('.t794__list_item a[href="/' + pathname + '/"]').addClass('t-active');
    if (hash) {
        $('.t794__list_item a[href="' + hash + '"]').addClass('t-active');
    }
} 
function t796_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t796');
    if (!container) return;

    var windowWidth = window.innerWidth;
    var screenMin = rec.getAttribute('data-screen-min');
    var screenMax = rec.getAttribute('data-screen-max');

    if (screenMin && windowWidth < parseInt(screenMin, 10)) return false;
    if (screenMax && windowWidth > parseInt(screenMax, 10)) return false;

    var shapeBorder = rec.querySelector('.t796__shape-border');
    var shapeRecId = container.getAttribute('data-shape-rec-ids');

    if (shapeRecId) {
        shapeRecId = shapeRecId.split(',');

        for (var i = 0; i < shapeRecId.length; i++) {
            var shapeId = shapeRecId[i];
            var currentRec = document.querySelector('#rec' + shapeId);
            var currentShape = shapeBorder.cloneNode(true);

            t796_setColor(rec, currentShape);
            t796_addDivider(currentRec, currentShape);
        }
    } else {
        var excludesBlocks = [215, 316, 390, 651, 702, 706, 708, 750, 756, 766, 825, 862, 868, 943];
        var excludes = '';

        for (var i = 0; i < excludesBlocks.length; i++) {
            excludes += '[data-record-type=\'' + excludesBlocks[i] + '\'],';
        }

        /* "[data-record-type='708']," */
        if (excludes.slice(-1) === ',') {
            excludes = excludes.slice(0, -1);
        }

        var recs = [];

        if (shapeBorder.classList.contains('t796__shape-border_top') || shapeBorder.classList.contains('t796__shape-border_top-flip')) {
            recs = t796__nextAll(rec, excludes);
        }

        if (shapeBorder.classList.contains('t796__shape-border_bottom') || shapeBorder.classList.contains('t796__shape-border_bottom-flip')) {
            recs = t796__prevAll(rec, excludes);
        }

        if (recs.length !== 0) {
            var currentShape = shapeBorder.cloneNode(true);

            t796_setColor(rec, currentShape);
            t796_addDivider(recs[0], currentShape);
        }
    }
}

function t796_setColor(rec, shape) {
    /* get color from nearest block, if it is not set for shape */
    if (shape.getAttribute('data-fill-color')) return;

    var nearestBlock;

    if (shape.classList.contains('t796__shape-border_bottom') || shape.classList.contains('t796__shape-border_bottom-flip')) {
        var nextBlock = rec.nextElementSibling;

        if (nextBlock) {
            nearestBlock = nextBlock.matches('.r') ? nextBlock : false;
        }
    } else {
        var prevBlock = rec.previousElementSibling;

        if (prevBlock) {
            nearestBlock = prevBlock.matches('.r') ? prevBlock : false;
        }
    }

    if (!nearestBlock) return;

    var fillColor = nearestBlock.getAttribute('data-bg-color');

    if (!fillColor) return;

    shape.querySelector('.t796__svg').style.fill = fillColor;
}

function t796_addDivider(rec, shape) {
    if (!rec) return;
    
    rec.setAttribute('data-animationappear', 'off');
    rec.classList.remove('r_hidden');

    var cover = rec.querySelector('.t-cover');
    var zeroBlock = rec.querySelector('.t396');

    if (cover || zeroBlock) {
        /* if cover or zero */
        if (cover) {
            var showLayers = cover.querySelectorAll('.t557__snow-layer');

            if (showLayers.length > 0) shape.style.zIndex = 1;
            
            var coverFilter = cover.querySelector('.t-cover__filter');

            if (coverFilter) coverFilter.insertAdjacentElement('afterend', shape);
        }

        if (zeroBlock) {
            zeroBlock.insertAdjacentElement('afterend', shape);
            rec.style.position = 'relative';

            var zeroFilter = zeroBlock.querySelector('.t396__filter');

            if (zeroFilter) {
                var zIndex = 1;
                var zeroArtboard = zeroBlock.querySelector('.t396__artboard');
                var isVisible = zeroArtboard.style.overflow === 'visible';

                if (!isVisible) zIndex = 99;

                shape.style.zIndex = zIndex;
            }
        }

        shape.style.display = 'block';
    } else {
        /* if any block */
        var wrapper = rec;
        var recordType = parseInt(rec.getAttribute('data-record-type'));

        if (!wrapper) return true;

        wrapper.appendChild(shape);
        wrapper.style.position = 'relative';

        /* dont make changes z-index for blocks */
        var excludesBlocks = [125, 331, 554, 746, 754, 776, 778, 786, 858, 896, 897, 924, 915, 943, 951];

        if (excludesBlocks.indexOf(recordType) === -1) {
            var firstDiv = wrapper.querySelector('div');

            firstDiv.style.cssText = 'position: relative; z-index: 1;';
            firstDiv.classList.add('t796_cont-near-shape-divider');
        }

        /* changing z-index for divider in blocks below */
        var blocks = [195, 279, 675, 694, 734, 823, 938];

        if (blocks.indexOf(recordType) !== -1) {
            shape.style.zIndex = 1;
        }

        shape.style.display = 'block';
    }
}

function t796__nextAll(element, selector) {
    var nextElements = [];
    var nextElement = element;

    while (nextElement.nextElementSibling) {
        nextElement = nextElement.nextElementSibling;

        if (nextElement.matches(':not(' + selector + ')')) {
            nextElements.push(nextElement);
        }
    }

    return nextElements;
}

function t796__prevAll(element, selector) {
    var prevElements = [];
    var prevElement = element;

    while (prevElement.previousElementSibling) {
        prevElement = prevElement.previousElementSibling;

        if (prevElement.matches(':not(' + selector + ')')) {
            prevElements.push(prevElement);
        }
    }

    return prevElements;
} 
function t797_init(recid) {
    if (window.isMobile) {
        $("#rec" + recid + " .t797__txt-wrapper").css("display", "none");
    }
    t_onFuncLoad('tvote__init', function () {
        tvote__init(recid);
    });
} 
function t802_insta_init(recid, instauser) {
    var projectid = $('#allrecords').attr('data-tilda-project-id');
    t802_insta_loadflow(recid, projectid, instauser);
}

function t802_insta_loadflow(recid, projectid, instauser) {
    if (instauser == '') {
        var url = "https://insta.tildacdn.com/fish/0.json";
    } else {
        var url = "https://insta.tildacdn.com/json/project" + projectid + "_" + instauser + ".json";
    }

    $.ajax({
        type: "GET",
        url: url,
        dataType: "json",
        success: function (data) {
            if (typeof data == 'object') {
                t802_insta_draw(recid, data);
            } else {
                console.log('error. insta flow json not object');
                console.log(data);
            }
        },
        error: function () {
            console.log('error load instgram flow');
        },
        timeout: 1000 * 90
    });
}

function t802_insta_draw(recid, obj) {
    if (typeof obj.photos == 'undefined') {
        return;
    }
    $.each(obj.photos, function (index, item) {
        t802_insta_drawItem(recid, obj.username, item);
    });

    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}

function t802_insta_drawItem(recid, username, item) {
    var emptyEl = $("#rec" + recid).find(".t802__imgwrapper_empty").first();
    if (emptyEl.length > 0) {
        emptyEl.removeClass("t802__imgwrapper_empty");
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            emptyEl.append('<div class="t802__bgimg t-bgimg" data-original="' + item.url + '"></div>');
        } else {
            emptyEl.append('<div class="t802__bgimg" style="background-image:url(' + item.url + ')"></div>');
        }
        emptyEl.wrap('<a href="' + item.link + '" target="_blank"></a>');

        /*add text and filter for hover*/
        var hoverEl = emptyEl.find(".t802__hover-wrapper");
        if (hoverEl.length > 0 && isMobile == false) {
            var text = t802_insta_cropText(recid, '@' + username + ': ' + item.text);
            hoverEl.append('<div class="t802__hover-filter"></div>');
            hoverEl.append('<div class="t802__text t-text t-descr_xxs">' + text + '</div>');
        }
    }
}

function t802_insta_cropText(recid, text) {
    var colsInLine = $("#rec" + recid).find("[data-cols-in-line]").attr("data-cols-in-line");
    if (colsInLine == 6) {
        var maxLength = 90;
    } else {
        var maxLength = 130;
    }
    if (text.length > maxLength) {
        text = text.substring(0, maxLength);
        text = text.substring(0, Math.min(maxLength, text.lastIndexOf(" ")));
        text += ' ...';
    }
    return text;
} 
function t803_init(recid) {
    var el = $("#rec" + recid);
    var data = el.find('.t803__multi-datablock').children();
    var multidata = {};

    $.each(data, function () {
        var source = $(this).children('.t803__multi-source').html();
        var value = $(this).children('.t803__multi-key-values').html();
        var key = $(this).children('.t803__multi-key').html();
        var def = $(this).children('.t803__multi-default').html();
        var v = {};
        v[source] = value
        multidata[source] = {
            'default': def,
            'key': key,
            'values': v
        }
    });

    if (el.parent('#t-header').length || el.parent('#t-footer').length) {
        $('[field]').each(function () {
            var html = $(this).html();
            var replaced = html.replace(/(?!%%)[A-zА-яё0-9_-]*(?=%%)/ig, '<span data-replace-key="$&"></span>').replace(/%{2}/igm, '');
            if (replaced !== html) {
                $(this).html(replaced);
            }
        });
    }

    var params = window.location.search.replace('?', '').split('&').reduce(
        function (p, e) {
            var a = e.split('=');
            try {
                p[decodeURIComponent(a[0]) + '=' + decodeURIComponent(a[1])] = decodeURIComponent(a[0]) + '=' + decodeURIComponent(a[1]);
            } catch (e) {}
            return p;
        }, {}
    );
    var stop = 0;
    $.each(multidata, function (index, value) {
        var key = params[index];
        if (typeof key != 'undefined') {
            $('[data-replace-key="' + value.key + '"]').html(value.values[key]);
            stop = 1;
        }
        if (stop === 0) {
            $('[data-replace-key="' + value.key + '"]').html(value.default);
        }
    });
} 
function t804_init(recid) {
var el = $("#rec" + recid);
var geodata = [];
    var key = el.find('.t_804_geo-datablock').children('.t_804_geo-key').html();
    var def = el.find('.t_804_geo-datablock').children('.t_804_geo-default').html();
    var data = el.find('.t_804_geo-datablock').children('.t_804_geo-data').children();
    data.each(function() {
        var valuesArr = $(this).children('.t_804_geo-geoip').html().split(';');
        var geo = [];

        $.each(valuesArr, function(index, value){
            if(value === '') { return true }

            var re = /,/g;
            var strVal = value.replace(re, '-');
            geo.push(strVal);
        });
        
        var value = $(this).children('.t_804_geo-value').html();
        geodata.push( {'value': value, 'geo': geo});
    });

    if(el.parent('#t-header').length || el.parent('#t-footer').length) {
        $('.t-rec').each(function() {
            var html = $(this).html();
            var replaced = html.replace(/(?!%%)[A-zА-яё0-9_-]*(?=%%)/ig, '<span data-replace-key="$&"></span>').replace(/%{2}/igm,'');
            if (replaced !== html) {
                $(this).html(replaced);
            }
        });
    }

    $.ajax({
        type: "GET",
        url: "https://geo.tildacdn.com/geo/full/",
        crossDomain: true,
        dataType : "json",
        success: function(data) {
            replaceGeo(data,key,geodata,def);
        },
        error: function(data) {
            replaceGeo(data,key,geodata,def);
        },
        timeout: 1000*15
    });

    function replaceGeo(data,key,geodata,def) {
        var city = data.city.name_en;
        var region = data.region.name_en;
        var country = data.country.iso;
        
        var fullMatch = country + '-' + region + '-' + city;
        var partMatch = country + '-' + region;
        
        var val = def;
        $.each(geodata, function(index, value) {
            if($.inArray(country, value.geo) != -1) {
                val = value.value;
            }
            if($.inArray(partMatch, value.geo) != -1) {
                val = value.value;
            }
            if($.inArray(fullMatch, value.geo) != -1) {
                val = value.value;
            }
        });
        $('[data-replace-key='+key+']').html(val);
    }
} 
function t806__init(recid) {
    t_onFuncLoad('tvote__init', function () {
	    tvote__init(recid);
    });
	var testWrap = $('#rec' + recid);
	var testContainer = testWrap.find('.t806');
	var rightAnswersCount;
	var testAnswers = testWrap.find('.t806__answers');
	var testBlock = testWrap.find('.t806__test');
	var testResultWrap = testWrap.find('.t806__result-wrap');
	var shareVK = testWrap.find('.t806__social-btn-vk');
	var shareFB = testWrap.find('.t806__social-btn-fb');
	var shareTwitter = testWrap.find('.t806__social-btn-twitter');
	var rightTestAnswers = [];
	var testImgSrc = [];
	var startTitle = testWrap.find('.t806__start-title').text();
	var startText = testWrap.find('.t806__start-text').text();
	var siteLocation = window.location.href;

	testBlock.addClass('t806__counter');
	testBlock.attr('data-count', 0);

	testResultWrap.each(function (i) {
		if ($(testResultWrap[i]).find('img').attr('src') !== '') {
			testImgSrc.push($(testResultWrap[i]).find('img').attr('src'));
		}
	});

	if (testImgSrc.length == 1) {
		testResultWrap.each(function (i) {
			$(testResultWrap[i]).find('img').attr('src', testImgSrc[0]);
			$(testResultWrap[i]).find('.t806__result-desc').removeClass('t806__result-desc_withoutimg');
			$(testResultWrap[i]).find('.t806__result-count, .t806__result-variant').css('color', '#ffffff');
		});
	}

	testAnswers.each(function () {
	    var answer = $(this).attr('data-right-answer') || '';
		rightTestAnswers.push(answer.trim());

		$(this).removeAttr('data-right-answer');
	});

	t806__changeRadio(recid, rightTestAnswers);
	t806__changeTestInput(recid);
	t806__startClickBtn(recid);
	t806__checkClickBtn(recid, rightTestAnswers);
	t806__nextClickBtn(recid);
	t806__resultClickBtn(recid);
	t806__restartClickBtn(recid, rightTestAnswers);

	shareVK.click(function () {
		t806_shareVK(recid, startTitle, siteLocation)
	});
	shareFB.click(function () {
		t806_shareFB(recid, startTitle, startText, siteLocation)
	});
	shareTwitter.click(function () {
		t806_shareTwitter(recid, startTitle, siteLocation)
	});

	t806__clearFormOnBackClick(testWrap);
}


function t806_scrollToTop(testBlock) {
	var topCoordinate = testBlock.offset().top;
	$('html, body').animate({
		scrollTop: topCoordinate
	}, 0);
}


function t806__clearFormOnBackClick(testWrap) {
	window.addEventListener('pagehide', function () {
		testWrap.find('.t806__input').prop('checked', false);
	});
}


function t806__startClickBtn(test) {
	var testWrap = $('#rec' + test);
	var questionFirst = 1;
	var testBtnStart = testWrap.find('.t806__start-btn');

	testBtnStart.on('click', function (e) {
		var testStart = $(this).parents('.t806__start');

		testStart.hide();
		testStart.next().show();
		t806__showNumber(test, questionFirst);

		t806_fixcontentheight(test);
		t806_scrollToTop(testWrap);

		if (typeof $(".t-records").attr("data-tilda-mode") == "undefined") {
			if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
		}

		e.preventDefault();
	});
}


function t806__changeRadio(test, rightansw) {
	var testBlock = $('#rec' + test);
	var testInput = testBlock.find('.t806__input[type="radio"]');
	var lastQuestion = testBlock.find('.t806__question').last();

	lastQuestion.addClass('t806__lastquestion');

	testInput.change(function () {
		var rightAnswersCount = testBlock.find('.t806__counter').attr('data-count');
		var testItem = $(this).parents('#rec' + test + ' .t806__question');
		var testAnswers = $(this).parents('#rec' + test + ' .t806__answers');
		var answerVote = $(this).parents('#rec' + test + ' .t806__answers').find('.t806__answer .t-vote__btn-res');
		var currentRightAnswer = rightansw[testItem.attr('data-question-num') - 1];

		if ($(this).attr('type') === 'radio') {
			var checkedRadio = $(this).val();

			testAnswers.addClass('t806__answers_answered');

			if (testItem.hasClass('t806__lastquestion')) {
				testAnswers.siblings('.t806__btn-wrapper').find('.t806__btn_result').addClass('t806__btn_show');
			} else {
				testAnswers.siblings('.t806__btn-wrapper').find('.t806__btn_next').addClass('t806__btn_show');
			}

			testItem.find('.t806__input').attr('disabled', true);

			if (+checkedRadio === +currentRightAnswer) {
				rightAnswersCount++;
				testBlock.find('.t806__counter').attr('data-count', rightAnswersCount);
			}

			if (+testItem.find('.t806__input:checked').val() !== +currentRightAnswer) {
				testItem.find('.t806__input:checked').parents('.t806__answer').addClass('t806__answer_wrong');
			}
			testItem.find('.t806__input:checked').parent().siblings('.t806__details').show();

			testItem.find('.t806__input[value="' + currentRightAnswer + '"]').parents('.t806__answer').addClass('t806__answer_correct');

			answerVote.addClass('t806__answer-vote_show');

			testItem.find('.t806__input:checked').parents('.t806__answer_correct').addClass('t806__answer_withoutopacity');
			testItem.find('.t806__input[type="radio"]').parents('.t806__answer_correct').addClass('t806__answer_withoutopacity');
		}

		t806_fixcontentheight(test);
	});
}


function t806__changeTestInput(test) {
	var testBlock = $('#rec' + test);
	var testInput = testBlock.find('.t806__input[type="checkbox"]');
	var lastQuestion = testBlock.find('.t806__question').last();
	var checkedAnswerCheck = [];

	testBlock.find('.t806__answers').attr('data-test-checked', '');

	lastQuestion.addClass('t806__lastquestion');

	testInput.change(function () {
		var testAnswers = $(this).parents('#rec' + test + ' .t806__answers');

		if ($(this).attr('type') === 'checkbox') {
			testAnswers.siblings('.t806__btn-wrapper').find('.t806__btn_check').addClass('t806__btn_show');
		}

		if ($(this).attr('type') === 'checkbox' && $(this).is(':checked') && checkedAnswerCheck.indexOf($(this).val()) === -1) {
			checkedAnswerCheck.push($(this).val());
		}

		if ($(this).attr('type') === 'checkbox' && !$(this).is(":checked")) {
			checkedAnswerCheck.splice(checkedAnswerCheck.indexOf($(this).val()), 1);
		}

		testAnswers.attr('data-test-checked', checkedAnswerCheck.join(','));

		t806_fixcontentheight(test);
	});

	return checkedAnswerCheck;
}


function t806__checkClickBtn(test, rightansw) {
	var rightChecked = false;
	var testBlock = $('#rec' + test);
	var testBtnCheck = testBlock.find('.t806__btn_check');
	var testInput = testBlock.find('.t806__input');
	var checkedAnswersTruth = [];

	testBtnCheck.on('click', function (e) {
		var rightAnswersCount = testBlock.find('.t806__counter').attr('data-count');
		var testItem = $(this).parents('#rec' + test + ' .t806__question');
		var testAnswers = $(this).parents('#rec' + test + ' .t806__question').find('.t806__answers');
		var answerVote = $(this).parents('.t806__btn-wrapper').siblings('#rec' + test + ' .t806__answers').find('.t806__answer .t-vote__btn-res');
		var checkboxAnswersArr = [];
		var checkboxAnswers = rightansw[testItem.attr('data-question-num') - 1].split(',');
		var checkedAnswers = testAnswers.attr('data-test-checked').split(',');

		for (var i = 0; i < checkboxAnswers.length; i++) {
			checkboxAnswersArr.push(checkboxAnswers[i]);
		}

		testItem.find(testInput).attr('disabled', true);

		answerVote.addClass('t806__answer-vote_show');

		checkedAnswers.forEach(function (item, i) {
			var checkedCheckboxSort = checkedAnswers.sort();
			var checkboxAnswersArrSort = checkboxAnswersArr.sort();

			if (+checkedCheckboxSort[i] === +checkboxAnswersArrSort[i] && checkedCheckboxSort.length === checkboxAnswersArrSort.length) {
				checkedAnswersTruth.push(1);
			} else {
				checkedAnswersTruth.push(0);
			}
		});

		var rightChecked = checkedAnswersTruth.every(function (item) {
			return item == 1;
		});

		if (testItem.find(testInput).attr('type') === 'checkbox') {
			checkboxAnswersArr.forEach(function (item) {
				testItem.find('.t806__input[value="' + +item + '"]').parents('.t806__answer').addClass('t806__answer_correct');
			});

			checkedAnswers.forEach(function (item) {
				if (checkboxAnswersArr.indexOf(item) === -1) {
					testItem.find('.t806__input[value="' + +item + '"]:checked').parents('.t806__answer').addClass('t806__answer_wrong');
					testItem.find('.t806__input[value="' + +item + '"]').parent().siblings().show();
				}
			});
		}

		testItem.find('.t806__input:checked').parents('.t806__answer_correct').addClass('t806__answer_withoutopacity');

		if (rightChecked) {
			rightAnswersCount++;
			testBlock.find('.t806__counter').attr('data-count', rightAnswersCount);
		}

		checkedAnswersTruth = [];

		$(this).removeClass('t806__btn_show');

		if (testItem.hasClass('t806__lastquestion')) {
			$(this).parents('.t806__question').find('.t806__btn_result').addClass('t806__btn_show');
		} else {
			$(this).parents('.t806__question').find('.t806__btn_next').addClass('t806__btn_show');
		}

		testAnswers.addClass('t806__answers_answered');

		t806_fixcontentheight(test);

		if (typeof $(".t-records").attr("data-tilda-mode") == "undefined") {
			if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
		}

		testItem.find('.t806__input:checked').parent().siblings('.t806__details').show();
		t806__changeTestInput(test);

		e.preventDefault();
	});
}


function t806__nextClickBtn(test) {
	var testBlock = $('#rec' + test);
	var testBtnNext = testBlock.find('.t806__btn_next');
	var questionNumber;

	testBtnNext.on('click', function (e) {
		var parentTop = $(this).parents('#rec' + test + ' .t806').offset().top;
		var testItem = $(this).parents('#rec' + test + ' .t806__question');
		questionNumber = testItem.next().attr('data-question-num');

		testItem.hide();
		testItem.next().show();
		t806__showNumber(test, questionNumber);

		t806_fixcontentheight(test);
		t806_scrollToTop(testBlock);

		if (typeof $(".t-records").attr("data-tilda-mode") == "undefined") {
			if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
		}

		e.preventDefault();
	});
}


function t806__resultClickBtn(test) {
	var testBtnResult = $('#rec' + test + ' .t806__btn_result');
	var testBlock = $('#rec' + test);

	testBtnResult.on('click', function (e) {
		var parentTop = $(this).parents('#rec' + test + ' .t806__test').offset().top;
		var testItem = $(this).parents('#rec' + test + ' .t806__question');

		testItem.hide();
		t806_scrollToTop(testBlock);
		t806__showResult(test);

		t806_fixcontentheight(test);

		if (typeof $(".t-records").attr("data-tilda-mode") == "undefined") {
			if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
		}

		e.preventDefault();
	});
}


function t806__restartClickBtn(test, rightansw) {
	var testBlock = $('#rec' + test);
	var testContainer = testBlock.find('.t806');
	var testRestart = testBlock.find('.t806__btn_restart');
	var testItemAll = testBlock.find('.t806__question');

	testRestart.on('click', function (e) {
		testBlock.find('.t806__start').show();
		testBlock.find('.t806__result').hide();
		testBlock.find('.t806__btn_next').removeClass('t806__btn_show');
		testBlock.find('.t806__btn_result').removeClass('t806__btn_show');
		testBlock.find('.t806__btn_check').removeClass('t806__btn_show');
		testBlock.find('.t806__details').hide();
		testBlock.find('.t806__answers').removeClass('t806__answers_answered');
		testBlock.find('.t806__answers').attr('data-test-checked', '');
		testBlock.find('.t806__answer').removeClass('t806__answer_correct');
		testBlock.find('.t806__answer').removeClass('t806__answer_wrong');
		testBlock.find('.t806__input').parents('.t806__answer').removeClass('t806__answer_withoutopacity');
		testBlock.find('.t806__input').prop('checked', false);
		testBlock.find('.t806__input').removeAttr('disabled');
		testBlock.find('.t806__answer .t-vote__btn-res').removeClass('t806__answer-vote_show');
		$('#rec' + test + ' .t806__counter').attr('data-count', 0);
		testBlock.find('.t806__number').text(1 + '/' + testItemAll.length);

		t806_fixcontentheight(test);

		if (testContainer.hasClass('t806__test-reload')) {
			document.location.reload(true);
		}

		e.preventDefault();
	});
}


function t806__showResult(test) {
	var testBlock = $('#rec' + test);
	var testContainer = testBlock.find('.t806');
	var fullResult = testBlock.find('.t806__result');
	var startImg = testBlock.find('.t806__start-img img');
	var fullResultLength = fullResult.length;
	var allResult;
	var resultLength = testBlock.find('.t806__result').length;
	var rightAnswersCount = $('#rec' + test).find('.t806__counter').attr('data-count');
	var testItemAll = $('#rec' + test + ' .t806__question');
	var resultCount = $('#rec' + test + ' .t806__result .t806__result-count');
	var resultPercent = rightAnswersCount != 0 ? rightAnswersCount / testItemAll.length * 100 : 0;

	if (testContainer.hasClass('t806__result-new-calc')) {
		if (Math.floor(resultPercent) !== resultPercent) {
			resultPercent = resultPercent.toFixed(3);
		}
	}


	resultCount.text(rightAnswersCount + '/' + testItemAll.length);


	t806__openResultWrapper(testContainer, resultPercent, testBlock, fullResultLength);

	var resultData = [];

	fullResult.each(function (i) {
		if ($(fullResult[i]).css('display') == 'block') {
			resultData[0] = $(fullResult[i]).find('.t806__result-variant').text()
			resultData[1] = $(fullResult[i]).find('.t806__result-count').text();

			resultData[2] = '';
			var img = $(fullResult[i]).find('.t806__result-wrap img');

			if (testContainer.hasClass('t806__test-reload')) {
				if (img.length != 0) {
					if (typeof window.lazy !== 'undefined') {
						resultData[2] = img.attr('data-original') || img.attr('src');
					} else {
						resultData[2] = img.attr('src');
					}
				}

				if (img.length == 0 && startImg.length != 0) {
					if (typeof window.lazy !== 'undefined') {
						resultData[2] = startImg.attr('data-original') || img.attr('src');
					} else {
						resultData[2] = startImg.attr('src');
					}
				}
			}

			if (!testContainer.hasClass('t806__test-reload')) {
				if (img.length != 0) {
					resultData[2] = img.attr('src');
				}

				if (img.length == 0 && startImg.length != 0) {
					resultData[2] = startImg.attr('src');
				}
			}

			resultData[3] = $(fullResult[i]).attr('data-quiz-result-number');
		}
	});

	return resultData;
}


function t806__openResultWrapper(testContainer, resultPercent, testBlock, fullResultLength) {
	if (testContainer.hasClass('t806__result-new-calc')) {
		if (resultPercent <= 100 * 1 / fullResultLength) {
			testBlock.find('.t806__result_1').show();
			return;
		}

		for (var i = 0; i < fullResultLength; i++) {
			var minResult = 100 * (i + 1) / fullResultLength;
			var maxResult = 100 * (i + 2) / fullResultLength;
			minResult = Math.floor(minResult) == minResult ? minResult : minResult.toFixed(3);
			maxResult = Math.floor(maxResult) == maxResult ? maxResult : maxResult.toFixed(3);

			if (resultPercent >= minResult && resultPercent <= maxResult) {
				testBlock.find('.t806__result_' + (i + 2)).show();
				return;
			}
		}

		if (resultPercent > 100 * (fullResultLength - 1) / fullResultLength) {
			testBlock.find('.t806__result_' + fullResultLength).show();
			return;
		}
	} else {
		if (resultPercent <= 100 * 1 / fullResultLength) {
			testBlock.find('.t806__result_1').show();
		}

		for (var i = 0; i < fullResultLength; i++) {
			if (resultPercent > 100 * (i + 1) / fullResultLength && resultPercent <= 100 * (i + 2) / fullResultLength) {
				testBlock.find('.t806__result_' + (i + 2)).show();
			}
		}

		if (resultPercent > 100 * (fullResultLength - 1) / fullResultLength) {
			testBlock.find('.t806__result_' + fullResultLength).show();
		}
	}
}


function t806__showNumber(test, number) {
	var testItemNumber = $('#rec' + test + ' .t806__number');
	var testItemAll = $('#rec' + test + ' .t806__question');
	testItemNumber.html('<span>' + number + '</span>' + '<span>/</span>' + '<span>' + testItemAll.length + '</span>');
}


function t806_fixcontentheight(id) {
	/* correct cover height if content more when cover height */
	var el = $("#rec" + id);
	var hcover = el.find(".t-cover").height();
	var hcontent = el.find("div[data-hook-content]").outerHeight();
	if (hcontent > 300 && hcover < hcontent) {
		var hcontent = hcontent + 120;
		if (hcontent > 1000) {
			hcontent += 100;
		}
		el.find(".t-cover").height(hcontent);
		el.find(".t-cover__filter").height(hcontent);
		el.find(".t-cover__carrier").height(hcontent);
		el.find(".t-cover__wrapper").height(hcontent);
		if ($isMobile == false) {
			setTimeout(function () {
				var divvideo = el.find(".t-cover__carrier");
				if (divvideo.find('iframe').length > 0) {
					setWidthHeightYoutubeVideo(divvideo, hcontent + 'px');
				}
			}, 2000);
		}
	}
}


function t806_changeShareFBUrl(siteLocation, searchUrl) {
	var url = siteLocation.split('?')[0] + '?';
	var searchParametrs = decodeURIComponent(searchUrl.substring(1));
	var params = searchParametrs.split('&');

	params.forEach(function (item) {
		if (item.indexOf('fb_action_ids') == -1 && item.indexOf('fb_action_types') == -1 && item.indexOf('result') == -1) {
			url = url + item + '&';
		}
	});

	url = url.substring(0, url.length - 1);
	return url;
}


function t806_shareVK(recid, ptitle, purl) {
	var dataForShare = t806__showResult(recid);
	var text = dataForShare[0];
	var count = dataForShare[1];
	var slash = (dataForShare[2] || "").indexOf('/') == 0 ? '' : '/';
	var urlPathname = window.location.pathname.length > 1 ? window.location.pathname : '';
	var img = (dataForShare[2] || "").indexOf('://') != -1 ? dataForShare[2] : window.location.protocol + '//' + window.location.host + urlPathname + slash + dataForShare[2];
	var resultNumber = dataForShare[3];
	var idUrl = recid + resultNumber + 'vk';

	var urlValueImg = 'https://vote.tildacdn.com/vote/2/share/index.php?text=' + text;
	urlValueImg += '&result=' + count;
	if ((dataForShare[2] || "").length > 0) {
		urlValueImg += '&url=' + img;
	}
	urlValueImg += '&id=' + idUrl;
	urlValueImg += '&social=vk' + '&name=' + ptitle;

	var value = $.ajax({
		url: urlValueImg,
		type: 'GET',
		async: false,
		data: {
			format: 'json'
		},
		error: function (e) {
			console.log('t806 error: ' + e);
		},
		complete: function (data) {
			var urlImg = (data.responseJSON.url || '').replace(/\?.*/, '');
			var shareUrl = window.location.href.indexOf('#') != -1 ? purl.split('#')[0] : purl;
			url = 'http://vkontakte.ru/share.php?url=' + shareUrl + '&title=' + ptitle + '&description=' + ptitle + '&image=' + urlImg + '&noparse=true';
			t806__openPopup(url);
		}
	});
}


function t806_shareFB(recid, ptitle, pdescr, purl) {
	var dataForShare = t806__showResult(recid);
	var text = dataForShare[0];
	var count = dataForShare[1];
	var slash = (dataForShare[2] || "").indexOf('/') == 0 ? '' : '/';
	var urlPathname = window.location.pathname.length > 1 ? window.location.pathname : '';
	var img = (dataForShare[2] || "").indexOf('://') != -1 ? dataForShare[2] : window.location.protocol + '//' + window.location.host + urlPathname + slash + dataForShare[2];
	var resultNumber = dataForShare[3];
	var idUrl = recid + resultNumber + 'fb';
	var param = count.substring(0, count.indexOf('/')) + count.substring(count.indexOf('/') + 1);

	var urlValueImg = 'https://vote.tildacdn.com/vote/2/share/index.php?text=' + text;
	urlValueImg += '&result=' + count;
	if ((dataForShare[2] || "").length > 0) {
		urlValueImg += '&url=' + img;
	}
	urlValueImg += '&id=' + idUrl;
	urlValueImg += '&social=fb' + '&name=' + ptitle;

	var value = $.ajax({
		url: urlValueImg,
		type: 'GET',
		async: false,
		data: {
			format: 'json'
		},
		error: function (e) {
			console.log('t806 error: ' + e);
		},
		complete: function (data) {
			var urlImg = data.responseJSON.url;
			var searchUrl = window.location.search;
			purl = (searchUrl !== '' ? t806_changeShareFBUrl(purl, searchUrl) : purl) + '?result=' + param;

			FB.ui({
				method: 'share_open_graph',
				action_type: 'og.shares',
				action_properties: JSON.stringify({
					object: {
						'og:url': purl
					}
				})
			});
		}
	});
}


function t806_shareTwitter(recid, ptitle, purl) {
	var dataForShare = t806__showResult(recid);
	var testWrap = $('#rec' + recid);
	var testContainer = testWrap.find('.t806');
	var text = dataForShare[0];
	var count = dataForShare[1];
	var img = dataForShare[2];

	var resultCount = count.substring(0, count.indexOf('/'));
	var allCount = count.substring(count.indexOf('/') + 1)

	var result;

	if (testContainer.hasClass('t806__ru')) {
		result = 'Мой результат: ' + resultCount + ' из ' + allCount + '. ' + text;
	}
	if (testContainer.hasClass('t806__en')) {
		result = 'My result: ' + resultCount + ' out of ' + allCount + '. ' + text;
	}

	purl = purl.replace(/&/g, '%26');

	url = 'https://twitter.com/share?url=' + purl + '&text=' + result;
	url = encodeURI(url);

	t806__openPopup(url);
}


function t806__openPopup(url) {
	window.open(url, '', 'toolbar=0,status=0,width=626,height=436');
} 
function t807__init(recid) {
    t_onFuncLoad('tvote__init', function () {
        tvote__init(recid);
    });
    var testWrap = $('#rec' + recid);

  $('#rec'+recid).find('.t-vote').bind('tildavote:numberschanged',function(){
    $(".js-vote-item").each(function() {
        var percentage = $(this).find(".t-vote__btn-res__percent");
        if (typeof percentage != "undefined") {
            var bar = $(this).find(".t807__answer-progressbar");
            bar.css("width",percentage.html());
        }
    })
  });

  $('#rec'+recid).find('.t-vote').bind('tildavote:resultsended',function(){
    if (!$(this).hasClass('t-vote_sended') || $(this).hasClass('t807__hidden')) {
      return;
    }
    
    $(this).addClass('t807__hidden');

    if (!$(this).attr('data-vote-visibility') && $(this).hasClass('t807__test')) {
      t807__onSuccess(recid);
    }

  });

  t807__replyClickBtn(recid);
}

function t807__replyClickBtn(test) {
    var testBlock = $('#rec' + test);
    var replyBtn = testBlock.find('.t807__btn_reply');

    replyBtn.on('click', function (e) {
        e.preventDefault();
    });
}


function t807__onSuccess(test) {
  var testBlock = $('#rec' + test).find('.t807__test');
  var t807_targetOffset = testBlock.offset().top;

  if ($(window).width()>960) {
    var t807_target = t807_targetOffset - 200;
  } else {
    var t807_target = t807_targetOffset - 100;
  }

  $('html, body').animate({ scrollTop: t807_target}, 400);
}
 
function t808_geoRedirect(geo, data) {
    if(!window.isSearchBot) {
        var city = geo.city.name_en;
        var region = geo.region.name_en;
        var country = geo.country.iso;
        $.each(data, function(i, value) {
            if($.inArray(country, value.geo) != -1 || $.inArray(region, value.geo) != -1 || $.inArray(city, value.geo) != -1) {
                window.location.href = value.link + window.location.search;
            }
        });
    }
}
 
function t813_init(recid, height) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var coverBlock = rec ? rec.querySelector('.t813') : null;
	
	t813_setYoutubeUrl(recid);
	t813__setHeight(recid, height);
	
	window.addEventListener('resize', t_throttle(function () {
		t813__setHeight(recid);
	}));
	
	if (coverBlock) {
		coverBlock.addEventListener('displayChanged', function () {
			t813__setHeight(recid);
		});
	}
}

function t813_setYoutubeUrl(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var youTubeFrame = rec ? rec.querySelector('.t813__iframe') : null;
	
	if (youTubeFrame && youTubeFrame.classList.contains('t813__iframe-youtube')) {
		var youTubeLink = youTubeFrame.getAttribute('data-youtube-id');
		var link = 'https://www.youtube.com/embed/' + youTubeLink + '?rel=0&fmt=18&html5=1&showinfo=0';
		youTubeFrame.setAttribute('src', link);
	}
}

function t813__setHeight(recid, height) {
	if (!height) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var div = rec ? rec.querySelector('.t813__contentwrapper') : null;
		if (!div) return;
		height = div.offsetWidth * 0.5625;
		div.style.height = height + 'px';
		if (div.parentElement) div.parentElement.style.height = height + 'px';
	}
}

function t813_onSuccess(originalForm) {
	var form = originalForm;
	if (originalForm instanceof jQuery && originalForm.length) {
		form = originalForm.get(0);
	}
	var inputsWrapper = form.querySelector('.t-form__inputsbox');
	var inputsHeight = inputsWrapper ? inputsWrapper.offsetHeight : 0;
	var inputsOffset = inputsWrapper ? inputsWrapper.getBoundingClientRect().top + window.pageYOffset : 0;
	var inputsBottom = inputsHeight + inputsOffset;
	var successBox = form.querySelector('.t-form__successbox');
	var targetOffset = successBox ? successBox.getBoundingClientRect().top + window.pageYOffset : 0;
	var targetYoutubeRecommendationsArea = window.innerWidth > 960 ? 200 : 100;
	var target = targetOffset - targetYoutubeRecommendationsArea;
	var documentHeight = Math.max(
		document.body.scrollHeight, document.documentElement.scrollHeight,
		document.body.offsetHeight, document.documentElement.offsetHeight,
		document.body.clientHeight, document.documentElement.clientHeight
	);
	
	if (targetOffset > window.pageYOffset || ((documentHeight - inputsBottom) < (window.innerHeight - 100))) {
		if (inputsWrapper) inputsWrapper.classList.add('t813__inputsbox_hidden');
		setTimeout(function () {
			var tBody = document.querySelector('.t-body');
			if (tBody && window.innerHeight > tBody.offsetHeight) {
				var tLabel = document.querySelector('.t-tildalabel');
				if (tLabel) {
					t813_fadeOut(tLabel, 50);
				}
			}
		}, 300);
	} else {
		t813_scrollToNextSection(target, 400);
		setTimeout(function () {
			if (inputsWrapper) inputsWrapper.classList.add('t813__inputsbox_hidden');
		}, 400);
	}
	
	var successurl = form.getAttribute('data-success-url');
	if (successurl) {
		setTimeout(function () {
			window.location.href = successurl;
		}, 500);
	}
}

function t813_fadeOut(el, duration) {
	var opacity = 1;
	duration = parseInt(duration);
	var speed = duration > 0 ? duration / 10 : 40; /*default duration = 400*/
	var timer = setInterval(function () {
		el.style.opacity = opacity;
		opacity -= 0.1;
		if (opacity <= 0.1) {
			clearInterval(timer);
		}
	}, speed);
}

function t813_scrollToNextSection(to, duration) {
	if (duration <= 0) return;
	var difference = to - window.pageYOffset;
	var perTick = difference / duration * 10;
	setTimeout(function () {
		window.scrollTo(0, window.pageYOffset + perTick);
		document.body.setAttribute('data-scrollable', 'true');
		if (window.pageYOffset === to) {
			document.body.removeAttribute('data-scrollable');
			return;
		}
		t813_scrollToNextSection(to, duration - 10);
	}, 10);
	setTimeout(function () {
		if (document.body.getAttribute('data-scrollable') === 'true') {
			document.body.removeAttribute('data-scrollable');
		}
	}, duration * 2);
} 
function t814_init(recId) {
    var rec = document.getElementById('rec' + recId);
    var container = rec.querySelector('.t814');

    t814_setHeight(recId);

    window.addEventListener('resize', t_throttle(function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        t814_setHeight(recId);
    }));

    /* TODO: jq event */
    $(container).on('displayChanged', function () {
        t814_setHeight(recId);
    });

    /* container.addEventListener('displayChanged', function () {
        t814_setHeight(recId);
    }); */
}

function t814_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t814');
    if (!container) return;
    var blockTextWrap = rec.querySelector('.t814__blocktext-wrapper');
    var textWrapper = rec.querySelector('.t814__blocktext');
    var image = rec.querySelector('.t814__blockimg');
    var imageStyle = getComputedStyle(image, null);
    var imagePaddingTop = parseInt(imageStyle.paddingTop) || 0;
    var imagePaddingBottom = parseInt(imageStyle.paddingBottom) || 0;
    var imageHeight = image.clientHeight - (imagePaddingTop + imagePaddingBottom);

    if (window.innerWidth > 960) {
        textWrapper.style.height = imageHeight + 'px';
        blockTextWrap.style.height = t814_outerHeight(textWrapper) + 'px';
    } else {
        blockTextWrap.style.height = 'auto';
    }
}

function t814_outerHeight(element) {
    var height = element.offsetHeight;
    var style = getComputedStyle(element);
  
    height += parseInt(style.marginTop) + parseInt(style.marginBottom);
    return height;
} 
function t815_init(recid){
    var rec = $('#rec'+recid);
    var el = rec.find('.t815');
    var isFixed = (el.css('position') == 'fixed');
    var redactorMode = el.hasClass('t815_redactor-mode');

    if (!redactorMode) {
      	el.removeClass('t815__beforeready');

      	if (isFixed && el.attr('data-bgopacity-two')) {
            t815_changebgopacitymenu(recid);
            $(window).bind('scroll', t_throttle(function(){t815_changebgopacitymenu(recid)}, 200));
      	}

        if (isFixed && el.attr('data-appearoffset')) {
            el.removeClass('t815__beforeready');
            t815_appearMenu(recid);
            $(window).bind('scroll', t_throttle(function(){t815_appearMenu(recid)}, 200));
        }
    }

    t815_setBg(recid);
    $(window).bind('resize', t_throttle(function(){t815_setBg(recid);}, 200));
}


function t815_setBg(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t815").each(function() {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color",bgcolor);
            }
        });
    } else {
        $(".t815").each(function() {
            var el=$(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color",bgcolor);
            el.attr("data-bgcolor-setbyscript","yes");
        });
    }
}

function t815_appearMenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980){
        $(".t815").each(function() {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset!="") {
                if(appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        el.css("top","-50px");
                        el.css("visibility","visible");
                        el.animate({"opacity": "1","top": "0px"}, 200, function() {});
                    }
                } else {
                    el.stop();
                    el.css("visibility","hidden");
                }
            }
        });
    }
}

function t815_changebgopacitymenu(recid) {
    var window_width = $(window).width();
    if(window_width > 980){
        $(".t815").each(function() {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.'+menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if(bgopacitytwo == '0' || menushadow == ' '){
                  el.css("box-shadow", "none");
                } else {
                  el.css("box-shadow", "0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
                }
            } else {
                el.css("background-color",bgcolor);
                if (bgopacityone == '0.0' || menushadow == ' '){
                  el.css("box-shadow","none");
                } else {
                  el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
                }
            }
        });
    }
}
 
function t816_init(recid, padding) {
	var rec = document.getElementById('rec' + recid);
	t816_setHeight(rec, padding);
	
	window.addEventListener('resize', t_throttle(function () {
		if (window.noAdaptive && window.isMobile) return;
		t816_setHeight(rec, padding);
	}, 200));
	
	var curBlocks = document.querySelectorAll('.t816');
	Array.prototype.forEach.call(curBlocks, function (block) {
		block.addEventListener('displayChanged', function () {
			t816_setHeight(rec, padding);
		});
	});
}

function t816_setHeight(rec, padding) {
	var galleryContainer = rec.querySelector('.t816__container');
	var colOffset = rec.querySelector('.t816__tile_offset');
	if (!colOffset) return;
	var containerOffset = colOffset.offsetTop - Number(padding);
	
	if (window.innerWidth >= 960) {
		galleryContainer.style.paddingBottom = containerOffset + 'px';
	}
}
 
function t817_init(recid) {
    var rec = $('#rec' + recid);
    var curMode = $('.t-records').attr('data-tilda-mode');
    var tab = rec.find('.t817__tab');
    var select = rec.find('.t817__select');
    var content = rec.find('.t817__content');

    if (curMode != 'edit' && curMode != 'preview') {
        t817_scrollToTabs(recid);
    }

    t817_showTabByUrl(recid, tab, content, select);
    t817_showTab(tab, content, recid);
    t817_showTabMobile(select, content, recid);
}

function t817_showTab(tab, content, recid) {
    var tabNumber;
    var curUrl = window.location.href;
    var curMode = $('.t-records').attr('data-tilda-mode');
    tab.on('click', function (e) {
        tabNumber = $(this).attr('data-tab-number');
        tab.removeClass('t817__tab_active');
        content.removeClass('t817__content_active');
        $(this).addClass('t817__tab_active');

        t817_removeUrl();

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabNumber) {
                $(content[i]).addClass('t817__content_active');
            }
        });

        if (curMode != 'edit' && curMode != 'preview') {
            if (typeof history.replaceState != 'undefined') {
                window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumber);
            }
        }


        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        e.preventDefault();
    });
}

function t817_showTabMobile(select, content, recid) {
    var tabNumberMobile;
    var curUrl = window.location.href;
    var curMode = $('.t-records').attr('data-tilda-mode');
    select.change(function (e) {
        tabNumberMobile = $(this).val();
        content.removeClass('t817__content_active');

        t817_removeUrl();

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabNumberMobile) {
                $(content[i]).addClass('t817__content_active');
            }
        });

        if (curMode != 'edit' && curMode != 'preview') {
            if (typeof history.replaceState != 'undefined') {
                window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumberMobile);
            }
        }

        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        e.preventDefault();
    })
}

function t817_showTabByUrl(recid, tab, content, select) {
    var curUrl = window.location.href;
    var tabIndexNumber = curUrl.indexOf(recid + '-');
    var tabIndex = curUrl.substring(tabIndexNumber + recid.length + 1);

    if (tabIndexNumber != -1) {
        tab.each(function (i) {
            if ($(tab[i]).attr('data-tab-number') == tabIndex) {
                $(tab[i]).addClass('t817__tab_active');
            }
        });

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabIndex) {
                $(content[i]).addClass('t817__content_active');
            }
        });

        select.val(tabIndex);

    } else {
        tab.first().addClass('t817__tab_active');
        content.first().addClass('t817__content_active');
    }

}

function t817_scrollToTabs(recid) {
    var curUrl = window.location.href;
    var tabIndexNumber = curUrl.indexOf('#!/tab/');
    var tabIndexNumberStart = curUrl.indexOf('tab/');

    if (tabIndexNumber != -1) {
        var tabRec = curUrl.substring(tabIndexNumberStart + 4, tabIndexNumberStart + 4 + recid.length)

        if (+tabRec == +recid) {
            var tabBlock = $('#rec' + tabRec).find('.t817');
            var targetOffset = tabBlock.offset().top;

            if ($(window).width() > 960) {
                var target = targetOffset - 200;
            } else {
                var target = targetOffset - 100;
            }

            $('html, body').animate({
                scrollTop: target
            }, 300);
        }
    }
}

function t817_removeUrl() {
    var curUrl = window.location.href;
    var indexToRemove = curUrl.indexOf('#!/tab/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
        indexToRemove = curUrl.indexOf('%23!/tab/');
    }
    curUrl = curUrl.substring(0, indexToRemove);
    if (indexToRemove != -1) {
        if (typeof history.replaceState != 'undefined') {
            window.history.replaceState('', '', curUrl);
        }
    }
} 
function t819_init(recid) {
    var rec = $('#rec' + recid);
    var curMode = $('.t-records').attr('data-tilda-mode');
    var tab = rec.find('.t819__tab');
    var select = rec.find('.t819__select');
    var content = rec.find('.t819__content');

    if (curMode != 'edit' && curMode != 'preview') {
        t819_scrollToTabs(recid);
    }

    t819_showTabByUrl(recid, tab, content, select);
    t819_showTab(tab, content, recid);
    t819_showTabMobile(select, content, recid);
}

function t819_showTab(tab, content, recid) {
    var tabNumber;
    var curUrl = window.location.href;
    var curMode = $('.t-records').attr('data-tilda-mode');
    tab.on('click', function (e) {
        tabNumber = $(this).attr('data-tab-number');
        tab.removeClass('t819__tab_active');
        content.removeClass('t819__content_active');
        $(this).addClass('t819__tab_active');

        t819_removeUrl();

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabNumber) {
                $(content[i]).addClass('t819__content_active');
            }
        });

        if (curMode != 'edit' && curMode != 'preview') {
            if (typeof history.replaceState != 'undefined') {
                window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumber);
            }
        }


        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        e.preventDefault();
    })
}

function t819_showTabMobile(select, content, recid) {
    var tabNumberMobile;
    var curUrl = window.location.href;
    var curMode = $('.t-records').attr('data-tilda-mode');
    select.change(function (e) {
        tabNumberMobile = $(this).val();
        content.removeClass('t819__content_active');

        t819_removeUrl();

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabNumberMobile) {
                $(content[i]).addClass('t819__content_active');
            }
        });

        if (curMode != 'edit' && curMode != 'preview') {
            if (typeof history.replaceState != 'undefined') {
                window.history.replaceState('', '', window.location.href + '#!/tab/' + recid + '-' + tabNumberMobile);
            }
        }

        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        e.preventDefault();
    })
}

function t819_showTabByUrl(recid, tab, content, select) {
    var curUrl = window.location.href;
    var tabIndexNumber = curUrl.indexOf(recid + '-');
    var tabIndex = curUrl.substring(tabIndexNumber + recid.length + 1);

    if (tabIndexNumber != -1) {
        tab.each(function (i) {
            if ($(tab[i]).attr('data-tab-number') == tabIndex) {
                $(tab[i]).addClass('t819__tab_active');
            }
        });

        content.each(function (i) {
            if ($(content[i]).attr('data-tab-content-number') == tabIndex) {
                $(content[i]).addClass('t819__content_active');
            }
        });

        select.val(tabIndex);

    } else {
        tab.first().addClass('t819__tab_active');
        content.first().addClass('t819__content_active');
    }

}

function t819_scrollToTabs(recid) {
    var curUrl = window.location.href;
    var tabIndexNumber = curUrl.indexOf('#!/tab/');
    var tabIndexNumberStart = curUrl.indexOf('tab/');

    if (tabIndexNumber != -1) {
        var tabRec = curUrl.substring(tabIndexNumberStart + 4, tabIndexNumberStart + 4 + recid.length)

        if (+tabRec == +recid) {
            var tabBlock = $('#rec' + tabRec).find('.t819');
            var targetOffset = tabBlock.offset().top;

            if ($(window).width() > 960) {
                var target = targetOffset - 200;
            } else {
                var target = targetOffset - 100;
            }

            $('html, body').animate({
                scrollTop: target
            }, 400);
        }
    }
}

function t819_removeUrl() {
    var curUrl = window.location.href;
    var indexToRemove = curUrl.indexOf('#!/tab/');
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && indexToRemove < 0) {
        indexToRemove = curUrl.indexOf('%23!/tab/');
    }
    curUrl = curUrl.substring(0, indexToRemove);
    if (indexToRemove != -1) {
        if (typeof history.replaceState != 'undefined') {
            window.history.replaceState('', '', curUrl);
        }
    }
} 
function t821_init(recid){
    var rec = $('#rec'+recid);
    var el = rec.find('.t821');
    var isFixed = (el.css('position') == 'fixed');
    var redactorMode = el.hasClass('t821_redactor-mode');

    if (!redactorMode) {
      	el.removeClass('t821__beforeready');

      	if (isFixed && el.attr('data-bgopacity-two')) {
            t821_changebgopacitymenu(recid);
            $(window).bind('scroll', t_throttle(function(){t821_changebgopacitymenu(recid)}, 200));
      	}

        if (isFixed && el.attr('data-appearoffset')) {
            el.removeClass('t821__beforeready');
            t821_appearMenu(recid);
            $(window).bind('scroll', t_throttle(function(){t821_appearMenu(recid)}, 200));
        }
    }

    t821_setBg(recid);
    $(window).bind('resize', t_throttle(function(){t821_setBg(recid);}, 200));
}


function t821_setBg(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t821").each(function() {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color",bgcolor);
            }
        });
    } else {
        $(".t821").each(function() {
            var el=$(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color",bgcolor);
            el.attr("data-bgcolor-setbyscript","yes");
        });
    }
}

function t821_appearMenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980){
        $(".t821").each(function() {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset!="") {
                if(appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        el.css("top","-50px");
                        el.css("visibility","visible");
                        el.animate({"opacity": "1","top": "0px"}, 200, function() {});
                    }
                } else {
                    el.stop();
                    el.css("visibility","hidden");
                }
            }
        });
    }
}

function t821_changebgopacitymenu(recid) {
    var window_width = $(window).width();
    if(window_width > 980){
        $(".t821").each(function() {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.'+menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if(bgopacitytwo == '0' || menushadow == ' '){
                  el.css("box-shadow", "none");
                } else {
                  el.css("box-shadow", "0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
                }
            } else {
                el.css("background-color",bgcolor);
                if (bgopacityone == '0.0' || menushadow == ' '){
                  el.css("box-shadow","none");
                } else {
                  el.css("box-shadow","0px 1px 3px rgba(0,0,0,"+ menushadowvalue +")");
                }
            }
        });
    }
}


function t821_createMobileMenu(recid){
  var window_width=$(window).width(),
      el=$("#rec"+recid),
      menu=el.find(".t821"),
      burger=el.find(".t821__mobile");
  burger.click(function(e){
    menu.fadeToggle(300);
    $(this).toggleClass("t821_opened")
  })
  $(window).bind('resize', t_throttle(function(){
    window_width=$(window).width();
    if(window_width>980){
      menu.fadeIn(0);
    }
  }, 200));
}
 
function t822_init(recid) {

  t822_setHeight(recid);

  $(window).on('load', function() {
    t822_setHeight(recid);
  });

  $(window).on('resize', t_throttle(function() {
    if (typeof window.noAdaptive!="undefined" && window.noAdaptive==true && $isMobile){return;}
    t822_setHeight(recid);
  }, 200));

  $('.t822').on('displayChanged',function(){
    t822_setHeight(recid);
  });

}

function t822_setHeight(recid) {
    $('#rec'+recid+' .t822 .t-container').each(function() {
        var t822__highestBox = 0;
        $('.t822__col', this).each(function(){
			var t822__curcol=$(this);
			var t822__curcolchild=t822__curcol.find('.t822__col-wrapper');
			if(t822__curcol.height() < t822__curcolchild.height())t822__curcol.height(t822__curcolchild.height());
            if(t822__curcol.height() > t822__highestBox)t822__highestBox = t822__curcol.height();
        });
        if($(window).width()>=960){
        	$('.t822__col',this).css('height', t822__highestBox);
        }else{
	        $('.t822__col',this).css('height', "auto");
        }
    });
};
 
function t823_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');
    var inputsWrapperStyle = getComputedStyle(inputsWrapper, null);
    var inputsWrapperPaddingTop = parseInt(inputsWrapperStyle.paddingTop) || 0;
    var inputsWrapperPaddingBottom = parseInt(inputsWrapperStyle.paddingBottom) || 0;
    var inputsWrapperHeight = inputsWrapper.clientHeight - (inputsWrapperPaddingTop + inputsWrapperPaddingBottom);
    var inputsOffset = inputsWrapper.getBoundingClientRect().top + window.pageYOffset;
    var inputsBottom = inputsWrapperHeight + inputsOffset;
    var successBox = form.querySelector('.t-form__successbox');
    var successBoxOffset = successBox.getBoundingClientRect().top + window.pageYOffset;
    var target = 0;
    var windowHeight = window.innerHeight;
    var body = document.body;
    var html = document.documentElement;
    var documentHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );

    if (window.innerWidth > 960) {
        target = successBoxOffset - 200;
    } else {
        target = successBoxOffset - 100;
    }

    var tildaLabel = document.querySelector('.t-tildalabel');

    if (successBoxOffset > window.scrollY || (documentHeight - inputsBottom) < (windowHeight - 100)) {
        inputsWrapper.classList.add('t823__inputsbox_hidden');

        setTimeout(function() {
            if (windowHeight > documentHeight && tildaLabel) {
                t823__fadeOut(tildaLabel);
            }
        }, 300);
    } else {
        t823__scroll(target);

        setTimeout(function() {
            inputsWrapper.classList.add('t823__inputsbox_hidden');
        }, 400);
    }

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t823__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function() {
        el.style.opacity = opacity;
        opacity -= 0.1;

        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 50);
}

function t823__scroll(target) {
    var duration = 400;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = target - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t823__easeInOutCubic(currentTime) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t823__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t823__easeInOutCubic(currentTime));

        if (currentTime < duration) {
            setTimeout(t823__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t823__animateScroll();
} 
function t824_init(recid) {
    $('#rec' + recid).attr('data-animationappear', 'off');
    $('#rec' + recid).css('opacity', '1');

    var rec = $('#rec' + recid);
    var block = $('#rec' + recid).find('.t824');
    var el = $('#rec' + recid).find('.t824__popup');
    var analitics = el.attr('data-track-popup');
    var hook = "TildaSendMessageWidget" + recid;
    var widgetBtn = $('#rec' + recid + ' .t824__btn');
    var closeBtn = $('#rec' + recid + ' .t824__popup-icon-close');
    var popupContainer = $('#rec' + recid + ' .t824__popup-container');

    t824_appearPopup(recid);
    $(window).bind('scroll', t_throttle(function () {
        t824_appearPopup(recid)
    }, 200));

    widgetBtn.click(function (e) {
        $('#rec' + recid + ' .t824').addClass('t824_active');
        t824_showPopup(recid);
        popupContainer.css('visibility', 'visible');
        popupContainer.animate({
            'opacity': '1'
        }, 200, function () {});
        widgetBtn.css('visibility', 'hidden');
        widgetBtn.animate({
            'opacity': '0'
        }, 200, function () {});

        if (analitics > '') {
            Tilda.sendEventToStatistics(analitics, hook);
        }

        e.preventDefault();
    });

    closeBtn.click(function (e) {
        t824_closePopup(rec);
        widgetBtn.css('visibility', 'visible');
        widgetBtn.animate({
            'opacity': '1'
        }, 200, function () {});
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
        e.preventDefault();
    });

    widgetBtn.click(function (e) {
        t824_showPopup(recid);
        $(this).css('visibility', 'hidden');
        e.preventDefault();
    });

    rec.find('.t824__mobile-icon-close').click(function (e) {
        t824_closePopup(rec);
    });

    t824_checkPhoneNumber(recid);
}

function t824_showPopup(recid) {
    var el = $('#rec' + recid);
    var popup = el.find('.t824__popup');

    el.find('.t824__btn_wrapper').removeClass('t824__btn_animate');
    el.find('.t824__btn-text').css('display', 'none');
    if ($(window).width() < 960) {
        $('body').addClass('t824__body_popupshowed');
    }

    popup.css('display', 'block');

    setTimeout(function () {
        popup.addClass('t824__popup_show');
    }, 50);

    el.find('.t824__mobile-icon-close').click(function (e) {
        t824_closePopup(el);
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            t824_closePopup(el);
        }
    });

    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}

function t824_closePopup(rec) {
    if ($(window).width() < 960) {
        $('body').removeClass('t824__body_popupshowed');
    }
    rec.find('.t824').removeClass('t824_active');
    rec.find('.t824__popup').removeClass('t824__popup_show');

    setTimeout(function () {
        rec.find('.t824__popup').not('.t824__popup_show').css('display', 'none');
    }, 300);
}

function t824_checkPhoneNumber(recid) {
    var el = $('#rec' + recid);
    var phone = el.find('.t824__phone').html();

    if (typeof phone != 'undefined') {
        var phoneArr = phone.split('');
        var phoneWithoutSpaceArr = [];

        for (var i = 0; i < phoneArr.length; i++) {
            if (phoneArr[i] !== ' ') {
                phoneWithoutSpaceArr.push(phoneArr[i]);
            }
        }

        var phoneWithoutSpace = phoneWithoutSpaceArr.join('');

        el.find('.t824__phone').attr('href', 'tel:' + phoneWithoutSpace);
    }
}

function t824_sendPopupEventToStatistics(popupname) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';

    if (popupname.substring(0, 7) == '#popup:') {
        popupname = popupname.substring(7);
    }

    virtPage += popupname;
    virtTitle += popupname;
    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {

        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': virtPage,
                    'title': virtTitle
                });
            }
        }

        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {
                title: virtTitle,
                referer: window.location.href
            });
        }
    }
}

function t824_appearPopup(recid) {
    var window_width = $(window).width();

    if (window_width > 980) {
        var el = $('#rec' + recid + ' .t824__popup-container');
        var widgetBtn = $('#rec' + recid + ' .t824__btn');
        var appearoffset = el.attr('data-appearoffset') || '';

        if (appearoffset != '') {
            if (appearoffset.indexOf('vh') > -1) {
                appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
            }

            appearoffset = parseInt(appearoffset, 10);

            if ($(window).scrollTop() >= appearoffset) {
                if (el.css('visibility') == 'hidden' && widgetBtn.css('visibility') == 'hidden') {
                    el.finish();

                    el.parents('.t824__popup').css('display', 'block');
                    setTimeout(function () {
                        el.parents('.t824__popup').addClass('t824__popup_show');
                    }, 50);

                    el.css('visibility', 'visible');
                    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                        t_onFuncLoad('t_lazyload_update', function () {
                            t_lazyload_update();
                        });
                    }
                    el.animate({
                        'opacity': '1'
                    }, 200, function () {});
                }
            }
        }

        if (appearoffset == '') {
            if (el.css('visibility') == 'hidden' && widgetBtn.css('visibility') == 'hidden') {

                el.parents('.t824__popup').css('display', 'block');
                setTimeout(function () {
                    el.parents('.t824__popup').addClass('t824__popup_show');
                }, 50);

                el.css('visibility', 'visible');
                if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
                el.animate({
                    'opacity': '1'
                }, 200, function () {});
            }
        }
    }
} 
function t825_initPopup(recid) {
    var rec = $('#rec' + recid);
    $('#rec' + recid).attr('data-animationappear', 'off');
    $('#rec' + recid).css('opacity', '1');
    var el = $('#rec' + recid).find('.t825__popup');
    var analitics = el.attr('data-track-popup');
    var hook = "TildaSendMessageWidget" + recid;
    var obj = $('#rec' + recid + ' .t825__btn');

    obj.click(function (e) {
        if (obj.hasClass('t825__btn_active')) {
            t825_closePopup(rec);
            return;
        }
        obj.addClass('t825__btn_active');
        $('#rec' + recid + ' .t825').addClass('t825_active');
        t825_showPopup(recid);
        e.preventDefault();
        if (analitics > '') {
            Tilda.sendEventToStatistics(analitics, hook);
        }
    });
    
    var whatsAppElement = rec.find('.t825__whatsapp');
    var whatsAppHref = whatsAppElement.attr('href');
    if (typeof whatsAppHref !== 'undefined') {
        t825_removeExtraSymbolsFromWhatsApp(rec, whatsAppElement, whatsAppHref);   
    }

    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}


function t825_removeExtraSymbolsFromWhatsApp(rec, whatsAppElement, whatsAppHref) {
    if (whatsAppHref && whatsAppHref.indexOf('?text=') !== -1) {
        var whatsAppHrefArr = whatsAppHref.split('?text=');
        whatsAppHrefArr[0] = whatsAppHrefArr[0].replace(/[\(\)+-]/g, '');
        whatsAppHref = whatsAppHrefArr[0] + '?text=' + whatsAppHrefArr[1];
    } else {
        whatsAppHref = whatsAppHref.replace(/[\(\)+-]/, '');
    }
    
    whatsAppElement.attr('href', whatsAppHref);
}


function t825_showPopup(recid) {
    var el = $('#rec' + recid);
    var popup = el.find('.t825__popup');

    el.find('.t825__btn_wrapper').removeClass('t825__btn_animate');
    el.find('.t825__btn-text').css('display', 'none');
    if ($(window).width() < 960) {
        $('body').addClass('t825__body_popupshowed');
    }

    popup.css('display', 'block');
    setTimeout(function () {
        popup.addClass('t825__popup_show');
    }, 50);

    el.find('.t825__mobile-icon-close').click(function (e) {
        t825_closePopup(el);
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            t825_closePopup(el);
        }
    });

    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}

function t825_closePopup(rec) {
    if ($(window).width() < 960) {
        $('body').removeClass('t825__body_popupshowed');
    }
    rec.find('.t825').removeClass('t825_active');
    rec.find('.t825__btn').removeClass('t825__btn_active');
    rec.find('.t825__popup').removeClass('t825__popup_show');
    setTimeout(function () {
        rec.find('.t825__popup').not('.t825__popup_show').css('display', 'none');
    }, 300);
}

function t825_sendPopupEventToStatistics(popupname) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';
    if (popupname.substring(0, 7) == '#popup:') {
        popupname = popupname.substring(7);
    }

    virtPage += popupname;
    virtTitle += popupname;
    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': virtPage,
                    'title': virtTitle
                });
            }
        }
        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {
                title: virtTitle,
                referer: window.location.href
            });
        }
    }
} 
function t826_init(recid) {
    var el = $('#rec' + recid);

    t826_startAnimation(recid);

    if (!window.isMobile) {
        $(window).bind('resize', t_throttle(function () {
            $("div:not(.t826__animation) > div[data-galaxy-id=" + recid + "]").remove();
            t826_startAnimation(recid);
        }));
    }

    if (window.isMobile) {
        $(window).on("orientationchange", function () {
            $("div:not(.t826__animation) > div[data-galaxy-id=" + recid + "]").remove();
            t826_startAnimation(recid);
        });
    }
    
    el.find('.t826').bind('displayChanged', function() {
        $("div:not(.t826__animation) > div[data-galaxy-id=" + recid + "]").remove();
        t826_startAnimation(recid);
    });
}

function t826_startAnimation(recid) {
    var el = $('#rec' + recid);
    var GalaxyEl = el.find(".t826__galaxy");
    var wr = el.find(".t826");
    var recs = wr.attr("data-galaxy-rec-ids");
    var wholepage = wr.attr("data-galaxy-whole-page");
    var vertFlip = wr.attr("data-galaxy-vflip");
    var color = wr.attr("data-element-color");
    var opacity = wr.attr("data-element-opacity");
    var options = {
        'color': (!color ? "#fff" : color),
        'opacity': (!opacity ? 1 : opacity.replace(/^0?.([0-9])0?$/g, ".$1"))
    };
    
    if(options.color.indexOf('#') !== -1) {
        var color = options.color;
        if (color[1] === color[2] && color[3] === color[4] && color[5] === color[6]) {
            options.color = "#" + color[1] + color[3] + color[5];
        }
    }

    if (vertFlip === "yes") {
        GalaxyEl.addClass("t826__galaxy_flip");
    }

    if ($("#allrecords").attr("data-tilda-mode") === "edit") {
        t826_addAnimation(el.find(".t826__demo"), GalaxyEl, options);
        return;
    }

    if (typeof recs !== "undefined") {
        recs = recs.split(",");
        /* append to certain blocks */
        recs.forEach(function (rec, index, array) {
            var curRec = $("#rec" + rec);
            var curGalaxyEl = GalaxyEl.clone().css("position", "absolute");
            t826_addAnimation(curRec, curGalaxyEl, options);
        });
    } else {
        var nextBlock = el.next(":has(.t-cover)");
        var prevBlock = el.prev(":has(.t-cover)");
        var curGalaxyEl = GalaxyEl.clone().css("position", "absolute");
        if (nextBlock.length !== 0) {
            t826_addAnimation(nextBlock, curGalaxyEl, options);
        } else if (prevBlock.length !== 0) {
            t826_addAnimation(prevBlock, curGalaxyEl, options);
        }
    }

    if (wholepage === "yes") {
        el.find(".t826__animation").css("display", "block");
        t826_addAnimation($("#allrecords"), GalaxyEl.css("position", "fixed"), options);
    }
}

function t826_addAnimation(curRec, GalaxyEl, options) {
    curRec.attr("data-animationappear", "off").removeClass('r_hidden');

    var curRecType = curRec.attr("data-record-type");
    var curRecId = curRec.attr("id");

    /* if zero block */
    if (curRecType === "396") {
        curRec.find(".t396__filter").after(GalaxyEl);
        GalaxyEl.css("z-index", "0");
    } else if (curRecId === "allrecords") {
        GalaxyEl.css("z-index", "-1");
    } else {
        var coverWrapper = curRec.find(".t-cover");
        /* if cover */
        if (coverWrapper.length > 0) {
            coverWrapper.find(".t-cover__filter").after(GalaxyEl);
            GalaxyEl.css("z-index", "0");
        } else {
            /* if any block */
            var wrapper = curRec;
            if (wrapper.length === 0) {
                return true;
            }

            wrapper.append(GalaxyEl);
            wrapper.css("position", "relative");
            wrapper.children("div").first().css({
                "position": "relative",
                "z-index": "1"
            });

            /* nothing for CR30N, GL19 */
            if (curRecType == '734' || curRecType == '675' || curRecType == '215') {
                return;
            }

            /* remove z-index for block below & set z-index -1 for galaxy */
            var excludesBlocks = [754, 776, 778, 786, 770];
            if (excludesBlocks.indexOf(parseInt(curRecType, 10)) !== -1) {
                wrapper.children("div").first().css('z-index', '');
                GalaxyEl.css("z-index", "-1");
            } else {
                /* set z-index 0 for other blocks */
                GalaxyEl.css("z-index", "0");
            }
        }
    }

    t826_runningAnimation(curRec, options);
}

function t826_runningAnimation(curRec, options) {
    var starsSetting;

    if(window.isMobile) {
        starsSetting = [{
            name: "near",
            count: 25,
            speed: 50
        }, {
            name: "mid",
            count: 50,
            speed: 100
        }, {
            name: "far",
            count: 175,
            speed: 150
        }];
    } else {
        starsSetting = [{
            name: "near",
            count: 100,
            speed: 50
        }, {
            name: "mid",
            count: 200,
            speed: 100
        }, {
            name: "far",
            count: 700,
            speed: 150
        }];
    }

    var curRecId = curRec.attr("id");
    var maxHeight = curRec.outerHeight();
    var maxWidth = curRec.outerWidth();

    if (typeof curRecId === "undefined") {
        curRecId = "demo";
    } else if (curRecId === "allrecords") {
        maxHeight = $(window).height();
        maxWidth = $(window).width();
    }

    var animationName = "t826__galaxy-" + curRecId;
    curRec.find("#" + animationName).remove();

    var newStyle = document.createElement("style");
    newStyle.id = animationName;
    newStyle.innerHTML = "@keyframes " + animationName + "{" +
        "to{" +
            "transform:translateY(" + (-maxHeight) + "px)" +
        "}" +
    "}";

    starsSetting.forEach(function (value, index, array) {
        var x = Math.round(Math.random() * maxHeight);
        var y = Math.round(Math.random() * maxWidth);
        var dot = "";

        if(options.color.indexOf('#') !== -1) {
            dot = x + "px " + y + "px";
        } else {
            if (options.opacity < 1) {
                dot = x + "px " + y + "px rgba(" + options.color + "," + options.opacity + ")";
            } else {
                dot = x + "px " + y + "px rgb(" + options.color + ")";
            }
        }

        var countDots = Math.round(array[index].count * maxHeight / 2000);

        for (var i = 0; i < countDots; i++) {
            var x = Math.round(Math.random() * maxWidth);
            var y = Math.round(Math.random() * maxHeight);
            
            if(options.color.indexOf('#') !== -1) {
                dot += ", " + x + "px " + y + "px";
                dot += ", " + x + "px " + (y + maxHeight) + "px";
            } else {
                if (options.opacity < 1) {
                    dot += ", " + x + "px " + y + "px rgba(" + options.color + "," + options.opacity + ")";
                    dot += ", " + x + "px " + (y + maxHeight) + "px rgba(" + options.color + "," + options.opacity + ")";
                } else {
                    dot += ", " + x + "px " + y + "px rgb(" + options.color + ")";
                    dot += ", " + x + "px " + (y + maxHeight) + "px rgb(" + options.color + ")";
                }
            }
        }

        var animationDuration = Math.round(array[index].speed * maxHeight / 2000);
        className = "t826__galaxy-" + array[index].name + "-" + curRecId;

        newStyle.innerHTML += "." + className + ":after, ." + className + "{" +
                "box-shadow:" + dot + ";" +
                "animation-duration:" + animationDuration + "s;" +
                "animation-name:" + animationName + ";" +
                (options.color.indexOf('#') !== -1 ? "color:" + options.color + ";" : "" ) +
                (options.color.indexOf('#') !== -1 && options.opacity < 1 ? "opacity:" + options.opacity : "") +
            "}" +
            "." + className + ":after{" +
                "content:' ';" +
                "position:absolute;" +
                "top:" + maxHeight + "px" +
            "}";

        curRec.find(".t826__galaxy > .t826__galaxy-wrapper > .t826__galaxy-" + array[index].name).addClass(className);
    });

    curRec.prepend(newStyle);

    curRec.find(".t826__galaxy > .t826__galaxy-wrapper").css("animation-name", "t826__galaxy-fadeIn");
}
 
function t827_init(recid) {
	var rec = document.getElementById('rec' + recid);
	var grid = rec.querySelector('.t827__grid');
	var sizer = rec.querySelector('.t827__grid-sizer');
	var items = rec.querySelectorAll('.t827__grid-item');
	var images = rec.querySelectorAll('.t827__grid img');
	var overlayList = rec.querySelectorAll('.t827__overlay');
	var sizerWidth = sizer ? sizer.offsetWidth || parseInt(window.getComputedStyle(sizer).width, 10) : 0;
	
	t827_reverse(grid);
	
	Array.prototype.forEach.call(images, function (img) {
		var parent = img.closest('.r');
		if (parent && window.getComputedStyle(parent).display === 'none') {
			img.setAttribute('data-hidden-gallery-img', 'y');
		}
		img.addEventListener('load', function () {
			t827_initMasonry(rec, recid, grid);
			setTimeout(function () {
				t827_showOverlay(overlayList, items);
			}, 500);
		});
	});
	
	Array.prototype.forEach.call(overlayList, function (overlay) {
		if (overlay.classList.contains('t827__overlay_preview')) {
			setTimeout(function () {
				t827_showOverlay([overlay], items);
			}, 1000);
		}
	});
	
	t827_initMasonry(rec, recid, grid);
	
	window.addEventListener('resize', t_throttle(function () {
		if (typeof window.noAdaptive !== 'undefined' && window.noAdaptive === true && window.isMobile) {
			return;
		}
		t827_calcColumnWidth(rec, sizerWidth, grid, sizer, items);
	}));
	
	/*TODO jQuery*/
	$(rec).find('.t827').bind('displayChanged', function (e) {
		t827_initMasonry(rec, recid, grid);
		t827_calcColumnWidth(rec, sizerWidth, grid, sizer, items, images, e.type);
	});
	
	setTimeout(function () {
		t827_calcColumnWidth(rec, sizerWidth, grid, sizer, items);
	});
}


function t827_reverse(grid) {
	if (grid && grid.classList.contains('t827__grid_reverse')) {
		for (var i = grid.childElementCount - 2; i >= 0; i--) {
			grid.appendChild(grid.children[i]);
		}
	}
}

function t827_initMasonry(rec, recid, grid) {
	var gutterElement = rec.querySelector('.t827__gutter-sizer');
	var gutterWidth;
	if (gutterElement && gutterElement.offsetWidth === 40) {
		gutterWidth = 39;
	} else {
		gutterWidth = '#rec' + recid + ' .t827__gutter-sizer';
	}
	t_onFuncLoad('imagesLoaded', function () {
		imagesLoaded(grid, function () {
			new Masonry(grid, {
				columnWidth: '#rec' + recid + ' .t827__grid-sizer',
				itemSelector: '#rec' + recid + ' .t827__grid-item',
				gutter: gutterWidth,
				isFitWidth: true,
				transitionDuration: 0,
			});
		});
	});
}

function t827_showOverlay(overlayList, items) {
	if (window.innerWidth >= 1024) {
		Array.prototype.forEach.call(overlayList, function (overlay) {
			overlay.style.display = 'block';
		});
	} else {
		Array.prototype.forEach.call(items, function (item) {
			item.addEventListener('click', function () {
				var currentOverlay = item.querySelector('.t827__overlay');
				if (currentOverlay && currentOverlay.style.opacity === '0') {
					Array.prototype.forEach.call(overlayList, function (overlay) {
						if (overlay === currentOverlay) {
							overlay.style.opacity = '1';
						} else {
							overlay.style.opacity = '0';
						}
					});
				} else {
					currentOverlay.style.opacity = '0';
				}
			});
		});
	}
}

function t827_calcColumnWidth(rec, sizerWidth, grid, sizer, items, images, eventType) {
	var container = rec.querySelector('.t827__container');
	var firstItem = rec.querySelector('.t827__grid-item');
	var gutterElement = rec.querySelector('.t827__gutter-sizer');
	var containerWidthViaPadding = container ? container.offsetWidth || parseInt(window.getComputedStyle(container).width, 10) : 0;
	var containerPaddingLeft = container ? window.getComputedStyle(container).getPropertyValue('padding-left') : '0';
	var containerPaddingLeftValue = parseInt(containerPaddingLeft, 10) || 0;
	var containerPaddingRight = container ? window.getComputedStyle(container).getPropertyValue('padding-right') : '0';
	var containerPaddingRightValue = parseInt(containerPaddingRight, 10) || 0;
	var containerWidth = containerWidthViaPadding - (containerPaddingLeftValue + containerPaddingRightValue);
	var itemWidth = firstItem ? firstItem.offsetWidth || parseInt(window.getComputedStyle(firstItem).width, 10) : 0;
	var gutterSizerWidth = gutterElement ? gutterElement.offsetWidth || parseInt(window.getComputedStyle(gutterElement).width, 10) :
		0;
	if (gutterElement && gutterSizerWidth === 40) gutterSizerWidth = 39;
	
	var columnAmount = Math.round(containerWidth / sizerWidth);
	var newSizerWidth = ((containerWidth - gutterSizerWidth * (columnAmount - 1)) / columnAmount);
	
	if (eventType === 'displayChanged' && container && images.length) {
		var counter = 0;
		Array.prototype.forEach.call(images, function (img) {
			if (img.getAttribute('data-hidden-gallery-img') === 'y') {
				container.style.opacity = '0';
				img.removeAttribute('data-hidden-gallery-img');
				img.addEventListener('load', function () {
					counter++;
					if (counter === images.length) {
						container.style.opacity = '';
					}
				});
			}
		});
	}
	
	if (containerWidth >= itemWidth) {
		if (sizer) sizer.style.width = newSizerWidth + 'px';
		Array.prototype.forEach.call(items, function (item) {
			item.style.width = newSizerWidth + 'px';
		});
	} else {
		if (grid) grid.style.width = '100%';
		if (sizer) sizer.style.width = '100%';
		Array.prototype.forEach.call(items, function (item) {
			item.style.width = newSizerWidth + 'px';
		});
	}
} 
function t829_init(recid) {
    var rec = $('#rec' + recid);
    var grid = rec.find('.t829__grid');
    var sizer = rec.find('.t829__grid-sizer');
    var item = rec.find('.t829__grid-item');
    var images = rec.find('.t829__grid img');
    var startContainerWidth = rec.find('.t829__grid-sizer').width();

    images.load(function () {
        if (!(grid.hasClass('t829__container_mobile-flex') && $(window).width() < 768) && rec.is(':visible')) {
            t829_initMasonry(rec, recid, grid);
        }
    });

    if (!(grid.hasClass('t829__container_mobile-flex') && $(window).width() < 768) && rec.is(':visible')) {
        t829_initMasonry(rec, recid, grid);
        t829_calcColumnWidth(rec, startContainerWidth, grid, sizer, item);
    }

    grid.bind('touchmove scroll', function () {
        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }
    });

    $(window).bind('resize', t_throttle(function () {
        if (typeof window.noAdaptive !== 'undefined' && window.noAdaptive === true && window.isMobile) { return; }

        if (!(grid.hasClass('t829__container_mobile-flex'))) {
            t829_initMasonry(rec, recid, grid);
        }

        if (grid.hasClass('t829__container_mobile-flex') && $(window).width() >= 768) {
            t829_initMasonry(rec, recid, grid);
        }

        if (!(grid.hasClass('t829__container_mobile-flex') && $(window).width() < 768)) {
            t829_calcColumnWidth(rec, startContainerWidth, grid, sizer, item);
        }
    }));

    rec.find('.t829').bind('displayChanged', function () {
        if (!(grid.hasClass('t829__container_mobile-flex'))) {
            t829_initMasonry(rec, recid, grid);
        }

        if (grid.hasClass('t829__container_mobile-flex') && $(window).width() >= 768) {
            t829_initMasonry(rec, recid, grid);
        }

        if (!(grid.hasClass('t829__container_mobile-flex') && $(window).width() < 768)) {
            t829_calcColumnWidth(rec, startContainerWidth, grid, sizer, item);
        }
    });
}


function t829_initMasonry(rec, recid, grid) {
    var $grid = grid;
    var gutterSizerWidth = rec.find('.t829__gutter-sizer').width();
    var gutterElement = rec.find('.t829__gutter-sizer').width() == 40 ? 39 : '#rec' + recid + ' .t829__gutter-sizer';

    t_onFuncLoad('imagesLoaded', function () {
        $grid.imagesLoaded(function () {
            $grid.masonry({
                itemSelector: '#rec' + recid + ' .t829__grid-item',
                columnWidth: '#rec' + recid + ' .t829__grid-sizer',
                gutter: gutterElement,
                isFitWidth: true,
                transitionDuration: 0
            });
        });
    });
}

function t829_calcColumnWidth(rec, startcontainerwidth, grid, sizer, item) {
    var containerWidth = rec.find('.t829__container').width();
    var sizerWidth = rec.find('.t829__grid-sizer').width();
    var itemWidth = rec.find('.t829__grid-item').width();
    var gutterSizerWidth = rec.find('.t829__gutter-sizer').width() == 40 ? 39 : rec.find('.t829__gutter-sizer').width();
    var columnAmount = Math.round(containerWidth / startcontainerwidth);
    var newSizerWidth = ((containerWidth - gutterSizerWidth * (columnAmount - 1)) / columnAmount);
    newSizerWidth = Math.floor(newSizerWidth);
    if (containerWidth >= itemWidth) {
        sizer.css('width', newSizerWidth);
        item.css('width', newSizerWidth);
    } else {
        grid.css('width', '100%');
        sizer.css('width', '100%');
        item.css('width', '100%');
    }
}
 
function t830_init(recid) {
	var rec = $('#rec' + recid);
	var allrecords = $('#allrecords');
	var el = rec.find('.t830');
	var panel = rec.find('.t830__panel');
	var overlay = rec.find('.t830m__overlay');
	var menu = rec.find('.t830m');
	var submenu = rec.find('.t830m__submenu');
	var burger = rec.find('.t830__side .t830__burger');
	var menuItem = rec.find('.t830m__list-title a');
	var submenuItem = rec.find('.t830m__submenu-item a');


	t830_initMenu(rec, menu, burger);
	t830_removePadding(rec, allrecords);
	t830_calcCol(rec, menu, allrecords);
	t830_menuHighlight();
	t830_submenuHighlight();
	t830_openSubmenu(rec);
	t830_hoverShowMenu(rec, menu, panel, overlay, burger);

	$(window).resize(function () {
		t830_calcCol(rec, menu, allrecords);
		t830_removePadding(rec, allrecords);

		if (menu.hasClass('t830m_close') && $(window).width() > 1499) {
			overlay.removeClass('t830m__menu_show');
		}
	});

	if (submenu.hasClass('t830m__submenu_close')) {
		t830_toggleMenu(rec, submenu);
	}

	if ($(window).width() > 1199) {
		t830_scrollSideMenu(rec);
	}

	menuItem.click(function () {
		if (window.location.hash.length != 0) {
			menuItem.removeClass('t-active');
			$(this).addClass('t-active');
		}
	});

	submenuItem.click(function () {
		if (window.location.hash.length != 0) {
			submenuItem.removeClass('t-active');
			$(this).addClass('t-active');
		}
	});

	t830_checkAnchorLinks(recid);
}

function t830_calcCol(rec, menu, allrecords) {
	if ($(window).width() > 1199 && !menu.hasClass('t830m_open')) {
		allrecords.addClass('t830__allrecords_padd');
		$('.t-tildalabel').addClass('t830__t-tildalabel_padd');
	}

	if ($(window).width() > 1199 && menu.hasClass('t830m_open')) {
		allrecords.addClass('t830__allrecords_padd-small');
		$('.t-tildalabel').addClass('t830__t-tildalabel_padd-small');
	}
}

function t830_toggleMenu(rec, submenu) {
	var listTitle = rec.find('.t830m__list-title_toggle');
	var submenu;
	var textTitle;

	listTitle.click(function () {
		submenu = $(this).next();
		textTitle = $(this).find('.t830m__list-title-text');
		submenu.slideToggle('slow');

		textTitle.toggleClass('t830m__list-title-text_opacity');
		textTitle.toggleClass('t-menu__link-item');
	});
}

function t830_openSubmenu(rec) {
	var submenuItem = rec.find('.t830m__submenu-item a.t-active');
	submenuItem.parents('.t830m__submenu').css('display', 'block');
}

function t830_hoverShowMenu(rec, menu, panel, overlay, burger) {
	if ($(window).width() > 1199 && panel.hasClass('t830__panel_hover')) {
		panel.mouseenter(function (e) {
			menu.addClass('t830m__menu_show');
			burger.addClass('t830__burger_open');
			overlay.addClass('t830m__overlay_hover');
		});

		menu.mouseleave(function () {
			menu.removeClass('t830m__menu_show');
			burger.removeClass('t830__burger_open');
		});

		overlay.mouseenter(function () {
			menu.removeClass('t830m__menu_show');
			burger.removeClass('t830__burger_open');
			overlay.removeClass('t830m__overlay_hover');
		});

		menu.find('a').on('click', function () {
			menu.removeClass('t830m__menu_show');
			burger.removeClass('t830__burger_open');
		});

		burger.click(function () {
			if (burger.hasClass('t830__burger_open')) {
				t830_closeMenu(rec, menu);
				burger.removeClass('t830__burger_open');
			} else {
				menu.addClass('t830m__menu_show');
				burger.addClass('t830__burger_open');
				overlay.addClass('t830m__overlay_hover');
			}
		});
	}
}

function t830_showMenu(rec, menu, burger) {
	var panel = rec.find('.t830__panel');

	$('body').addClass('t830__body_menushowed');
	rec.find('.t830m').addClass('t830m__menu_show');
	rec.find('.t830m__overlay').addClass('t830m__menu_show');

	rec.find('.t830m__overlay, .t830m__close, a[href*="#"]').click(function () {
		if (
			$(this).is(
				'.tooltipstered, .t794__tm-link, .t978__tm-link, .t966__tm-link'
			)
		) {
			return;
		}
		t830_closeMenu(rec, menu);
		burger.removeClass('t830__burger_open');
	});

	panel.addClass('t830__panel_close');

	$(document).keydown(function (e) {
		if (e.keyCode == 27) {
			if ($('.t-site-search-popup__background').length === 0) {
				$('body').removeClass('t830__body_menushowed');
				$('.t830m').removeClass('t830m__menu_show');
				burger.removeClass('t830__burger_open');
				$('.t830m__overlay').removeClass('t830m__menu_show');
			}
		}
	});
}

function t830_closeMenu(rec, menu) {
	var panel = rec.find('.t830__panel');

	if (menu.hasClass('t830m_open') && $(window).width() < 1500) {
		panel.removeClass('t830__panel_close');
	}

	$('body').removeClass('t830__body_menushowed');
	$('.t830m').removeClass('t830m__menu_show');
	$('.t830m__overlay').removeClass('t830m__menu_show');
}

function t830_initMenu(rec, menu, burger) {
	var obj = rec.find('.t830__menu__content');
	var panel = rec.find('.t830__panel');
	var menu = rec.find('.t830m');

	if (
		panel.hasClass('t830__panel_click') ||
		(panel.hasClass('t830__panel_hover') && $(window).width() <= 1199)
	) {
		obj.click(function (e) {
			if (menu.hasClass('t830m__menu_show')) {
				burger.removeClass('t830__burger_open');
				t830_closeMenu(rec, menu);
			} else {
				burger.addClass('t830__burger_open');
				t830_showMenu(rec, menu, burger);
			}

			e.preventDefault();
		});
	}

	$('.t830').bind('clickedAnchorInTooltipMenu', function () {
		t830_closeMenu(rec, menu);
	});
}

function t830_menuHighlight() {
	var url = window.location.href;
	var pathname = window.location.pathname;
	if (url.substr(url.length - 1) == '/') {
		url = url.slice(0, -1);
	}
	if (pathname.substr(pathname.length - 1) == '/') {
		pathname = pathname.slice(0, -1);
	}
	if (pathname.charAt(0) == '/') {
		pathname = pathname.slice(1);
	}
	if (pathname == '') {
		pathname = '/';
	}
	$(".t830m__list-title a[href='" + url + "']").addClass('t-active');
	$(".t830m__list-title a[href='" + url + "/']").addClass('t-active');
	$(".t830m__list-title a[href='" + pathname + "']").addClass('t-active');
	$(".t830m__list-title a[href='/" + pathname + "']").addClass('t-active');
	$(".t830m__list-title a[href='" + pathname + "/']").addClass('t-active');
	$(".t830m__list-title a[href='/" + pathname + "/']").addClass('t-active');
}

function t830_submenuHighlight() {
	var url = window.location.href;
	var pathname = window.location.pathname;
	if (url.substr(url.length - 1) == '/') {
		url = url.slice(0, -1);
	}
	if (pathname.substr(pathname.length - 1) == '/') {
		pathname = pathname.slice(0, -1);
	}
	if (pathname.charAt(0) == '/') {
		pathname = pathname.slice(1);
	}
	if (pathname == '') {
		pathname = '/';
	}
	$(".t830m__submenu-item a[href='" + url + "']").addClass('t-active');
	$(".t830m__submenu-item a[href='" + url + "/']").addClass('t-active');
	$(".t830m__submenu-item a[href='" + pathname + "']").addClass('t-active');
	$(".t830m__submenu-item a[href='/" + pathname + "']").addClass('t-active');
	$(".t830m__submenu-item a[href='" + pathname + "/']").addClass('t-active');
	$(".t830m__submenu-item a[href='/" + pathname + "/']").addClass('t-active');
}

function t830_scrollSideMenu(rec) {
	var container = rec.find('.t830m__container');

	container.on('scroll wheel DOMMouseScroll mousewheel', function (e) {
		var searchResultContainer = rec.find('.t-site-search-dm');

		if (searchResultContainer.length == 0) {
			t830_stopScroll(this, e);
		}
	});
}

function t830_stopScroll(block, eventScroll) {
	var $this = $(block);
	var scrollTop = block.scrollTop;
	var scrollHeight = block.scrollHeight;
	var height = $this.height();
	var delta =
		eventScroll.type == 'DOMMouseScroll'
			? eventScroll.originalEvent.detail * -40
			: eventScroll.originalEvent.wheelDelta;
	var up = delta > 0;

	var prevent = function () {
		eventScroll.stopPropagation();
		eventScroll.preventDefault();
		eventScroll.returnValue = false;
		return false;
	};
	if (!up && -delta > scrollHeight - height - scrollTop) {
		$this.scrollTop(scrollHeight);
		return prevent();
	} else if (up && delta > scrollTop) {
		$this.scrollTop(0);
		return prevent();
	}
}

function t830_removePadding(rec, allrecords) {
	if (rec.css('display') == 'none') {
		allrecords.css('padding-left', 0);
		$('.t-tildalabel').css('padding-left', 0);
	}
}

function t830_checkAnchorLinks(recid) {
	if ($(window).width() >= 960) {
		var submenuNavLinks = $(
			'#rec' + recid + " .t830m__list a:not(.tooltipstered)[href*='#']"
		);

		if (submenuNavLinks.length > 0) {
			setTimeout(function () {
				t830_catchScroll(submenuNavLinks, recid);
			}, 500);
		}
	}
}

function t830_catchScroll(navLinks, recid) {
	var rec = $('#rec' + recid);
	var clickedSectionId = null;
	var sections = new Array();
	var sectionIdTonavigationLink = [];
	var interval = 100;
	var lastCall;
	var timeoutId;
	var navLinks = $(navLinks.get().reverse());

	navLinks.each(function () {
		var cursection = t830_getSectionByHref($(this));
		if (typeof cursection.attr('id') != 'undefined') {
			sections.push(cursection);
		}
		sectionIdTonavigationLink[cursection.attr('id')] = $(this);
	});
	t830_updateSectionsOffsets(sections);

	sections.sort(function (a, b) {
		return b.attr('data-offset-top') - a.attr('data-offset-top');
	});

	$(window).bind(
		'resize',
		t_throttle(function () {
			t830_updateSectionsOffsets(sections);
		}, 200)
	);
	$('.t830').bind('displayChanged', function () {
		t830_updateSectionsOffsets(sections);
	});
	setInterval(function () {
		t830_updateSectionsOffsets(sections);
	}, 5000);
	t830_highlightNavLinks(
		navLinks,
		sections,
		sectionIdTonavigationLink,
		clickedSectionId
	);

	navLinks.click(function () {
		var clickedSection = t830_getSectionByHref($(this));
		if (
			!$(this).hasClass('tooltipstered') &&
			typeof clickedSection.attr('id') != 'undefined'
		) {
			navLinks.removeClass('t-active');
			$(this).addClass('t-active');
			clickedSectionId = t830_getSectionByHref($(this)).attr('id');
		}
	});

	$(window).scroll(function () {
		var now = new Date().getTime();
		if (lastCall && now < lastCall + interval) {
			clearTimeout(timeoutId);
			timeoutId = setTimeout(function () {
				lastCall = now;
				clickedSectionId = t830_highlightNavLinks(
					navLinks,
					sections,
					sectionIdTonavigationLink,
					clickedSectionId
				);
			}, interval - (now - lastCall));
		} else {
			lastCall = now;
			clickedSectionId = t830_highlightNavLinks(
				navLinks,
				sections,
				sectionIdTonavigationLink,
				clickedSectionId
			);
		}
	});
}

function t830_getSectionByHref(curlink) {
	var curLinkValue = curlink.attr('href').replace(/\s+/g, '');
	if (curLinkValue[0] == '/') {
		curLinkValue = curLinkValue.substring(1);
	}
	if (curlink.is('[href*="#rec"]')) {
		return $(".r[id='" + curLinkValue.substring(1) + "']");
	} else {
		return $(".r[data-record-type='215']").has(
			"a[name='" + curLinkValue.substring(1) + "']"
		);
	}
}

function t830_highlightNavLinks(
	navLinks,
	sections,
	sectionIdTonavigationLink,
	clickedSectionId
) {
	var scrollPosition = $(window).scrollTop();
	var valueToReturn = clickedSectionId;
	if (
		sections.length != 0 &&
		clickedSectionId == null &&
		sections[sections.length - 1].attr('data-offset-top') >
			scrollPosition + 300
	) {
		navLinks.removeClass('t-active');
		return null;
	}

	$(sections).each(function (e) {
		var curSection = $(this);
		var sectionTop = curSection.attr('data-offset-top');
		var id = curSection.attr('id');
		var navLink = sectionIdTonavigationLink[id];

		if (
			scrollPosition + 300 >= sectionTop ||
			(sections[0].attr('id') == id &&
				scrollPosition >= $(document).height() - $(window).height())
		) {
			if (clickedSectionId == null && !navLink.hasClass('t-active')) {
				navLinks.removeClass('t-active');
				navLink.addClass('t-active');
				valueToReturn = null;
			} else {
				if (clickedSectionId != null && id == clickedSectionId) {
					valueToReturn = null;
				}
			}
			return false;
		}
	});

	return valueToReturn;
}

function t830_updateSectionsOffsets(sections) {
	$(sections).each(function () {
		var curSection = $(this);
		curSection.attr('data-offset-top', curSection.offset().top);
	});
}
 
function t833_init(recid) {
    t833_startAnimation(recid);
}


function t833_showOnCertainWidth(el, wrapper) {
    el.attr('class').split(' ').forEach(function (item) {
        if (item.indexOf('t-screen') !== -1) {
            wrapper.addClass(item);
        }
    });
}


function t833_startAnimation(recid) {
    var el = $('#rec' + recid);
    var wrapper = el.find('.t833__sliderwrapper');
    var wr = el.find('.t833');
    var recs = wr.attr('data-coverslider-rec-ids');

    t833_showOnCertainWidth(el, wrapper);

    if ($('#allrecords').attr('data-tilda-mode') === 'edit') {
        t833_addAnimation(el.find('.t833__demo'), wrapper);
        return;
    }

    if (typeof recs !== 'undefined') {
        recs = recs.split(',');
        /* append to certain blocks */
        recs.forEach(function (rec) {
            var curRec = $('#rec' + rec);
            var curWrapper = wrapper.clone().css('position', 'absolute');
            t833_addAnimation(curRec, curWrapper);
        });
    } else {
        var nextBlock = el.next(':has(.t-cover)');
        var prevBlock = el.prev(':has(.t-cover)');
        var curWrapper = wrapper.clone().css('position', 'absolute');
        if (nextBlock.length !== 0) {
            t833_addAnimation(nextBlock, curWrapper);
        } else if (prevBlock.length !== 0) {
            t833_addAnimation(prevBlock, curWrapper);
        }
    }
}

function t833_addAnimation(curRec, wrapper) {
    curRec.attr('data-animationappear', 'off').removeClass('r_hidden');
    
    var curRecType = curRec.attr('data-record-type');
    /* CR43 */
    var isT941 = curRecType === '941';
    var isT996 = curRecType === '996';

    if (curRecType === '396') {
        /*if zero block*/
        curRec.find('.t396__filter').after(wrapper);
        wrapper.css('z-index', '0');
    }

    var coverWrapper;
    
    if (isT941) {
        coverWrapper = curRec.find('.t941__cover-wrap');
    } else if (isT996) {
        coverWrapper = curRec.find('.t996__cover-wrapper');
    } else {
        coverWrapper = curRec.find('.t-cover');
    } 

    if (coverWrapper.length > 0) {
        /*if cover*/
        if (isT941) {
            wrapper.addClass('t941__cover');
            coverWrapper.append(wrapper);
        } else if (isT996) {
            wrapper.addClass('t996__cover');
            coverWrapper.append(wrapper);
        } else {
            coverWrapper.find('.t-cover__filter').after(wrapper);
        }
        
        wrapper.css('z-index', '0');
    }
    
    var images = t833_createImageArr(wrapper);
    var imageCount = images.length;
    var imagesLoaded = 0;
    
    
    // earlier version with window.onload didn't work in FireFox
    for (var i = 0; i < imageCount; i++) {
        images[i].onload = function () {
            imagesLoaded++;
            if (imagesLoaded == imageCount && curRec.length !== 0) {
                setTimeout(function () {
                    t833_changeSlide(curRec);
                }, 3000);
            }
        };
    }

    var slider = curRec.find('.t833__slider');
    var slide = curRec.find('.t833__slide');
    var numberOfSlides = slide.length;

    if (numberOfSlides === 3 || numberOfSlides === 2) {
        slide.clone().appendTo(slider);
    }
}


function t833_createImageArr(wrapper) {
    var imagesSrc = [];
    wrapper.find('.t833__slide').each(function() {
        imagesSrc.push($(this).attr('data-original'));
    });
    
    var images = [];
    imagesSrc.forEach(function(image, i) {
        images[i] = new Image();
        images[i].src = image;
    });
    
    return images;
}


function t833_changeSlide(curRec) {
    var sliderWrapper = curRec.find('.t833__sliderwrapper');
    
    if (sliderWrapper.length) {
        sliderWrapper.each(function() {
            var isLoaded = $(this).attr('data-loaded') && $(this).attr('data-loaded') === 'yes' ? true : false;
            
            if (!isLoaded) {
                var slide = $(this).find('.t833__slide');
                var firstSlide = $(this).find('.t833__slide:first-child');
                var numberOfSlides = slide.length;
                
                firstSlide.addClass('t833__slide_fx1');
                setTimeout(t833_kenBurns(slide, numberOfSlides, 1), 5000);
                $(this).attr('data-loaded', 'yes');
            }
        });
    }
    
    function t833_kenBurns(slides, numberOfSlides, i) {
        if (i == numberOfSlides) {
            i = 0;
        }

        $(slides[i]).addClass('t833__slide_fx');

        if (i === 0) {
            $(slides[numberOfSlides - 2]).removeClass('t833__slide_fx t833__slide_fx1');
        }

        if (i === 1) {
            $(slides[numberOfSlides - 1]).removeClass('t833__slide_fx t833__slide_fx1');
            slides.removeClass('t833__slide_opacity');
        }

        if (i > 1) {
            $(slides[i - 2]).removeClass('t833__slide_fx t833__slide_fx1');
        }

        setTimeout(function() {
            t833_kenBurns(slides, numberOfSlides, i + 1);
        }, 5000);
    }
} 
function t835_init(recid) {
    var rec = $('#rec' + recid);
    var quizWrapper = rec.find('.t835__quiz-wrapper');
    var quizFormWrapper = rec.find('.t835__quiz-form-wrapper');
    var form = rec.find('.t835 .t-form');
    var quizQuestion = rec.find('.t835 .t-input-group');
    var prevBtn = rec.find('.t835__btn_prev');
    var nextBtn = rec.find('.t835__btn_next');
    var resultBtn = rec.find('.t835__btn_result');
    var errorBoxMiddle = rec.find('.t-form__errorbox-middle .t-form__errorbox-wrapper');
    var captureFormHTML = '<div class="t835__capture-form"></div>';
    rec.find('.t835 .t-form__errorbox-middle').before(captureFormHTML);
    var quizQuestionNumber = 0;
    form.removeClass('js-form-proccess');
    var specCommentInput = form.find('input.js-form-spec-comments[name="form-spec-comments"]');
    if (form.data('formactiontype') != 1 && !specCommentInput.length) {
		form.append('<div style="position: absolute; left: -5000px; bottom:0;"><input type="text" name="form-spec-comments" value="Its good" class="js-form-spec-comments"  tabindex="-1" /></div>');
	}
    $(quizQuestion[quizQuestionNumber]).show();
    $(quizQuestion[quizQuestionNumber]).addClass('t-input-group-step_active');

    t835_workWithAnswerCode(rec);

    quizQuestion.each(function (i) {
        $(quizQuestion[i]).attr('data-question-number', i);
    });

    t835_wrapCaptureForm(rec);

    t835_showCounter(rec, quizQuestionNumber);
    t835_disabledPrevBtn(rec, quizQuestionNumber);
    t835_checkLength(rec);

    prevBtn.click(function (e) {
        if (quizQuestionNumber > 0) {
            quizQuestionNumber--;
        }

        t835_setProgress(rec, -1);

        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        t835_awayFromResultScreen(rec);
        t835_showCounter(rec, quizQuestionNumber);
        t835_hideError(rec, quizQuestionNumber);
        t835_disabledPrevBtn(rec, quizQuestionNumber);
        t835_switchQuestion(rec, quizQuestionNumber);
        t835_scrollToTop(quizWrapper);

        e.preventDefault();
    });

    nextBtn.click(function (e) {
        if (quizWrapper.hasClass('t835__quiz-published')) {
            var showErrors = t835_setError(rec, quizQuestionNumber);
        }

        if (showErrors) {
            errorBoxMiddle.hide();
        }

        if (!showErrors) {
            quizQuestionNumber++;
            prevBtn.attr('disabled', false);
            t835_setProgress(rec, 1);
            t835_showCounter(rec, quizQuestionNumber);
            t835_switchQuestion(rec, quizQuestionNumber);
            t835_scrollToTop(quizWrapper);
        }

        if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }

        e.preventDefault();
    });

    quizQuestion.keypress(function (e) {
        var activeStep = form.find('.t-input-group-step_active');
        if (event.keyCode === 13 && !form.hasClass('js-form-proccess') && !activeStep.hasClass('t-input-group_ta')) {
            if (quizWrapper.hasClass('t835__quiz-published')) {
                var showErrors = t835_setError(rec, quizQuestionNumber);
            }
            var questionArr = t835_createQuestionArr(rec);

            if (showErrors) {
                errorBoxMiddle.hide();
            }

            prevBtn.attr('disabled', false);
            if (!showErrors) {
                quizQuestionNumber++;
                t835_setProgress(rec, 1);

                if (quizQuestionNumber < questionArr.length) {
                    t835_switchQuestion(rec, quizQuestionNumber);
                } else {
                    t835_switchResultScreen(rec);
                    form.addClass('js-form-proccess');
                }

                t835_scrollToTop(quizWrapper);
                t835_disabledPrevBtn(rec, quizQuestionNumber);
            }

            if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
                if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
            }

            e.preventDefault();
        }
    });

    resultBtn.click(function (e) {

        if (quizWrapper.hasClass('t835__quiz-published')) {
            var showErrors = t835_setError(rec, quizQuestionNumber);
        }

        if (showErrors) {
            errorBoxMiddle.hide();
        }

        if (!showErrors) {
            quizQuestionNumber++;
            t835_setProgress(rec, 1);
            t835_switchResultScreen(rec);
            t835_scrollToTop(quizWrapper);
            form.addClass('js-form-proccess');
            t835_disabledPrevBtn(rec, quizQuestionNumber);
        }

        e.preventDefault();
    });
}


function t835_workWithAnswerCode(rec) {
    rec.find('.t-input-group_ri').find('input').each(function () {
        var $this = $(this);
        if ($this.val().indexOf('value::') != -1) {
            t835_setAnswerCode($this);
            var label = $this.parent().find('.t-img-select__text');
            label.text(label.text().split('value::')[0].trim());
        }
    });

    rec.find('.t-input-group_rd').find('input').each(function () {
        var $this = $(this);
        if ($this.val().indexOf('value::') != -1) {
            t835_setAnswerCode($this);
            var label = $this.parent();

            label.html(function () {
                var html = $(this).html().split('value::')[0].trim();
                return html;
            });
        }
    });


    rec.find('.t-input-group_sb').find('option').each(function () {
        var $this = $(this);
        if ($this.val().indexOf('value::') != -1) {
            t835_setAnswerCode($this);
            $this.text($this.text().split('value::')[0].trim());
        }
    });
}


function t835_setAnswerCode($this) {
    var parameter = $this.val().split('value::')[1].trim();
    $this.val(parameter);
}


function t835_scrollToTop(quizFormWrapper) {
    var topCoordinateForm = quizFormWrapper.offset().top;
    var paddingTop = 0;
    var blockContainer = quizFormWrapper.parents('.t835');
    
    if (topCoordinateForm >= window.scrollY || blockContainer.hasClass('t835_scroll-disabled')) return;
    
    if ($('.t228__positionfixed').length > 0 && !window.isMobile) {
        paddingTop = paddingTop + $('.t228__positionfixed').height();
    }
    $('html, body').animate({
        scrollTop: topCoordinateForm - paddingTop
    }, 0);
}


function t835_checkLength(rec) {
    var nextBtn = rec.find('.t835__btn_next');
    var resultBtn = rec.find('.t835__btn_result');
    var questionArr = t835_createQuestionArr(rec);

    if (questionArr.length < 2) {
        nextBtn.hide();
        resultBtn.show();
    }
}


function t835_showCounter(rec, quizQuestionNumber) {
    var counter = rec.find('.t835__quiz-description-counter');
    var questionArr = t835_createQuestionArr(rec);
    counter.html(quizQuestionNumber + 1 + '/' + questionArr.length);
}


function t835_setError(rec, quizQuestionNumber) {
    var questionArr = t835_createQuestionArr(rec);
    var currentQuestion = $(questionArr[quizQuestionNumber]);
    var showErrors;
    if (typeof window.tildaForm !== 'object') return showErrors;
    var arErrors = window.tildaForm.validate(currentQuestion);
    currentQuestion.addClass('js-error-control-box');
    var errorsTypeObj = arErrors[0];

    if (errorsTypeObj != undefined) {
        var errorType = errorsTypeObj.type[0];
        var errorTextCustom = rec.find('.t835 .t-form').find('.t-form__errorbox-middle').find('.js-rule-error-' + errorType).text();
        var sError = '';
        if (errorTextCustom != '') {
            sError = errorTextCustom;
        } else {
            t_onFuncLoad('t_form_dict', function () {
                sError = t_form_dict(errorType);
            });
        }
        showErrors = errorType == 'emptyfill' ? false : window.tildaForm.showErrors(currentQuestion, arErrors);
        currentQuestion.find('.t-input-error').html(sError);
    }

    return showErrors;
}


function t835_hideError(rec, quizQuestionNumber) {
    var questionArr = t835_createQuestionArr(rec);
    var currentQuestion = $(questionArr[quizQuestionNumber]);
    currentQuestion.removeClass('js-error-control-box');
    currentQuestion.find('.t-input-error').html('');
}


function t835_setProgress(rec, index) {
    var progressbarWidth = rec.find('.t835__progressbar').width();
    var progress = rec.find('.t835__progress');
    var questionArr = t835_createQuestionArr(rec);
    var progressWidth = progress.width();
    var progressStep = progressbarWidth / (questionArr.length);
    var percentProgressWidth = (progressWidth + index * progressStep) / progressbarWidth * 100 + '%';

    progress.css('width', percentProgressWidth);
}


function t835_wrapCaptureForm(rec) {
    var captureForm = rec.find('.t835__capture-form');
    var quizQuestion = rec.find('.t835 .t-input-group');
    var quizFormWrapper = rec.find('.t835__quiz-form-wrapper');

    quizQuestion.each(function (i) {
        var currentQuizQuestion = $(quizQuestion[i]);
        var emailInputExist = $(currentQuizQuestion).hasClass('t-input-group_em');
        var nameInputExist = $(currentQuizQuestion).hasClass('t-input-group_nm');
        var phoneInputExist = $(currentQuizQuestion).hasClass('t-input-group_ph');
        var checkboxInputExist = $(currentQuizQuestion).hasClass('t-input-group_cb');
        var quizQuestionNumber = currentQuizQuestion.attr('data-question-number');
        var maxCountOfCaptureFields = quizFormWrapper.hasClass('t835__quiz-form-wrapper_withcheckbox') ? 4 : 3;

        if (quizQuestionNumber >= quizQuestion.length - maxCountOfCaptureFields) {
            var isCaptureGroup = true;
            
            if (quizFormWrapper.hasClass('t835__quiz-form-wrapper_newcapturecondition')) {
                var inputsGroup = currentQuizQuestion.nextAll('.t-input-group');
                inputsGroup.each(function() {
                    isCaptureGroup = $(this).hasClass('t-input-group_cb') || $(this).hasClass('t-input-group_em') || $(this).hasClass('t-input-group_nm') || $(this).hasClass('t-input-group_ph');
                });
            }
            
            if (isCaptureGroup) {
                if (quizFormWrapper.hasClass('t835__quiz-form-wrapper_withcheckbox')) {
                    if (emailInputExist || nameInputExist || phoneInputExist || checkboxInputExist) {
                        currentQuizQuestion.addClass('t835__t-input-group_capture');
                        captureForm.append(currentQuizQuestion);
                    }
                } else {
                    if (emailInputExist || nameInputExist || phoneInputExist) {
                        currentQuizQuestion.addClass('t835__t-input-group_capture');
                        captureForm.append(currentQuizQuestion);
                    }
                }
            }
        }
    });
}


function t835_createQuestionArr(rec) {
    var quizQuestion = rec.find('.t835 .t-input-group');
    var questionArr = [];

    quizQuestion.each(function (i) {
        var question = $(quizQuestion[i]);
        if (!question.hasClass('t835__t-input-group_capture')) {
            questionArr.push(quizQuestion[i]);
        }
    });

    return questionArr;
}


function t835_disabledPrevBtn(rec, quizQuestionNumber) {
    var prevBtn = rec.find('.t835__btn_prev');
    quizQuestionNumber == 0 ? prevBtn.attr('disabled', true) : prevBtn.attr('disabled', false);
}


function t835_switchQuestion(rec, quizQuestionNumber) {
    var nextBtn = rec.find('.t835__btn_next');
    var resultBtn = rec.find('.t835__btn_result');
    var questionArr = t835_createQuestionArr(rec);

    $(questionArr).hide();
    $(questionArr).removeClass('t-input-group-step_active');
    $(questionArr[quizQuestionNumber]).show();
    $(questionArr[quizQuestionNumber]).addClass('t-input-group-step_active');

    if (quizQuestionNumber === questionArr.length - 1) {
        nextBtn.hide();
        resultBtn.show();
    } else {
        nextBtn.show();
        resultBtn.hide();
    }
}


function t835_switchResultScreen(rec) {
    var captureForm = rec.find('.t835__capture-form');
    var quizDescription = rec.find('.t835__quiz-description');
    var resultTitle = rec.find('.t835__result-title');
    var resultBtn = rec.find('.t835__btn_result');
    var submitBtnWrapper = rec.find('.t835 .t-form__submit');
    var questionArr = t835_createQuestionArr(rec);

    $(questionArr).hide();
    $(captureForm).show();

    resultBtn.hide();
    quizDescription.hide();
    resultTitle.show();

    submitBtnWrapper.show();
}


function t835_awayFromResultScreen(rec) {
    var captureForm = rec.find('.t835__capture-form');
    var quizDescription = rec.find('.t835__quiz-description');
    var resultTitle = rec.find('.t835__result-title');
    var submitBtnWrapper = rec.find('.t835 .t-form__submit');

    submitBtnWrapper.hide();
    $(captureForm).hide();
    quizDescription.show();
    resultTitle.hide();
}


function t835_onSuccess(form) {
    var inputsWrapper = form.find('.t-form__inputsbox');
    var inputsHeight = inputsWrapper.height();
    var inputsOffset = inputsWrapper.offset().top;
    var inputsBottom = inputsHeight + inputsOffset;
    var targetOffset = form.find('.t-form__successbox').offset().top;
    var prevBtn = form.parents('.t835').find('.t835__btn_prev');
    var target;

    if ($(window).width() > 960) {
        target = targetOffset - 200;
    } else {
        target = targetOffset - 100;
    }

    if (targetOffset > $(window).scrollTop() || ($(document).height() - inputsBottom) < ($(window).height() - 100)) {
        inputsWrapper.addClass('t835__inputsbox_hidden');
        setTimeout(function () {
            if ($(window).height() > $('.t-body').height()) {
                $('.t-tildalabel').animate({
                    opacity: 0
                }, 50);
            }
        }, 300);
    } else {
        $('html, body').animate({
            scrollTop: target
        }, 400);
        setTimeout(function () {
            inputsWrapper.addClass('t835__inputsbox_hidden');
        }, 400);
    }

    var successurl = form.data('success-url');
    if (successurl && successurl.length > 0) {
        setTimeout(function () {
            window.location.href = successurl;
        }, 500);
    }

    prevBtn.hide();
}
 
function t842_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t842');
    if (!container) return;
    var doResize;

    t842_unifyHeights(recId);

    window.addEventListener('resize', function() {
        clearTimeout(doResize);
        doResize = setTimeout(function() {
            t842_unifyHeights(recId);
        }, 200);
    });

    window.addEventListener('load', function() {
        t842_unifyHeights(recId);
    });

    // TODO jq event
    $(container).on('displayChanged', function() {
        t842_unifyHeights(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //     t842_unifyHeights(recId);
    // });

    if (container.classList.contains('t842__previewmode')) {
        setInterval(function() {
            t842_unifyHeights(recId);
        }, 5000);
    }
}
  
  
function t842_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t842');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var rows = container.querySelectorAll('.t842__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var maxHeight = 0;
            var cols = row.querySelectorAll('.t842__inner-col');
            var bgImages = row.querySelectorAll('.t842__bgimg');

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var colWrap = col.querySelector('.t842__wrap');
                var colHeight = colWrap.offsetHeight;

                if (colHeight > maxHeight) maxHeight = colHeight;
            }

            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }

            for (var j = 0; j < bgImages.length; j++) {
                bgImages[j].style.height = maxHeight + 'px';
            }
        }
    } else {
        var cols = rec.querySelectorAll('.t842__inner-col');
        var bgImages = rec.querySelectorAll('.t842__bgimg');

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = 'auto';
        }

        for (var i = 0; i < bgImages.length; i++) {
            bgImages[i].style.height = 'auto';
        }
    }
} 
function t843_init(recId) {
    var rec = document.querySelector('#rec' + recId);
    var container = rec.querySelector('.t843');

    t843_setHeight(recId);

    window.addEventListener('resize', t_throttle(function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        t843_setHeight(recId);
    }));

    // TODO: jq event
    $(container).bind('displayChanged', function () {
        t843_setHeight(recId);
    });

    // container.addEventListener('displayChanged', function () {
    //     t843_setHeight(recId);
    // });

    if (container.classList.contains('t843__previewmode')) {
        setInterval(function () {
            t843_setHeight(recId);
        }, 5000);
    }
}

function t843_setHeight(recId) {
    var rec = document.querySelector('#rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t843');
    if (!container) return;
    var blockImages = rec.querySelectorAll('.t843__blockimg');
    var isLoaded = true;

    for (var i = 0; i < blockImages.length; i++) {
        var blockImage = blockImages[i];
        var width = blockImage.getAttribute('data-image-width');
        var height = blockImage.getAttribute('data-image-height');
        var ratio = height / width;
        var padding = ratio * 100;
        blockImage.style.paddingBottom = padding + '%';
        
        if (!blockImage.classList.contains('loaded')) {
            isLoaded = false;
        }
    }

    if (window.innerWidth > 960) {
        var textWraps = rec.querySelectorAll('.t843__textwrapper');
        var deskImages = rec.querySelectorAll('.t843__desktopimg');

        for (var i = 0; i < textWraps.length; i++) {
            textWraps[i].style.height = deskImages[i].clientHeight + 'px';
        }
    }

    if (!isLoaded) {
        if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
           t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
           });
        }
    }
} 
function t849_init(recId) {
    var rec = document.getElementById('rec' + recId);
    var accordion = rec.querySelectorAll('.t849__accordion')[0];
    var headers = rec.querySelectorAll('.t849__header');
    var isLazy = document.getElementById('allrecords').getAttribute('data-tilda-lazy');

    if (accordion) {
        accordion = accordion.getAttribute('data-accordion');
    } else {
        accordion = 'false';
    }

    for (var i = 0; i < headers.length; i++) {
        headers[i].addEventListener('click', function() {
            var element = this;
            var container = element.nextElementSibling;
            
            if (element.classList.contains('t849__opened')) {
                element.classList.remove('t849__opened');
                t849_accordionHide(container);
            } else {
                if (accordion === 'true') {
                    t849_accordionAllHide(headers);
                }
                
                element.classList.add('t849__opened');
                container.style.display = 'block';

                var height = container.scrollHeight;

                container.style.maxHeight = '0px';
                
                setTimeout(function() {
                    container.style.maxHeight = height + 'px';
                }, 0);
            }

            if (window.lazy === 'y' || isLazy === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        });
    }

    function t849_accordionAllHide(headers) {
        for (var i = 0; i < headers.length; i++) {
            var elementHide = headers[i];

            elementHide.classList.remove('t849__opened');
            t849_accordionHide(elementHide.nextElementSibling);
        }
    }

    function t849_accordionHide(container) {
        if (!container.style.maxHeight) container.style.maxHeight = container.scrollHeight + 'px';
        
        setTimeout(function() {
            container.style.maxHeight = '0px';
        }, 0);
    }
} 
function t850_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t850');
    if (!container) return;
    var doResize;

    t850_unifyHeights(recId);

    window.addEventListener('resize', function() {
        clearTimeout(doResize);
        doResize = setTimeout(function() {
            t850_unifyHeights(recId);
        }, 200);
    });

    window.addEventListener('load', function() {
        t850_unifyHeights(recId);
    });
    
    // TODO: jq event
    $(container).on('displayChanged', function() {
        t850_unifyHeights(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //     t850_unifyHeights(recId);
    // });

    if (container.classList.contains('t850__previewmode')) {
        setInterval(function() {
            t850_unifyHeights(recId);
        }, 5000);
    }
}

function t850_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t850');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var rows = container.querySelectorAll('.t850__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var maxHeight = 0;
            var cols = row.querySelectorAll('.t850__inner-col');

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var colWrap = col.querySelector('.t850__wrap');
                var colHeight = colWrap.offsetHeight;

                if (colHeight > maxHeight) maxHeight = colHeight;
            }
            
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        }
    } else {
        var cols = rec.querySelectorAll('.t850__inner-col');

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = 'auto';
        }
    }
} 
function t851_init(recId) {
    t851_updateLazyLoad(recId);
}

function t851_updateLazyLoad(recId) {
    var scrollContainer = document.querySelector('#rec' + recId + ' .t851__container_mobile-flex');
    var allRecords = document.getElementById('allrecords');
    var currentMode = allRecords.getAttribute('data-tilda-mode');

    if (scrollContainer && currentMode !== 'edit' && currentMode !== 'preview') {
        scrollContainer.addEventListener('scroll', t_throttle(function () {
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }, 500));
    }
} 
function t852_init(recId) {
    setTimeout(function () {
        t852_updateLazyLoad(recId);
    }, 500);
}

function t852_updateLazyLoad(recId) {
    var scrollContainer = document.querySelector('#rec' + recId + ' .t852__container_mobile-flex');
    var allRecords = document.getElementById('allrecords');
    var currentMode = allRecords.getAttribute('data-tilda-mode');

    if (scrollContainer && currentMode !== 'edit' && currentMode !== 'preview') {
        scrollContainer.addEventListener('scroll', t_throttle(function() {
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }, 500));
    }
} 
function t854_init(recid) {
  var rec = document.querySelector('#rec' + recid);
  var btnNews = rec.querySelector('.t854__news-btn');
  var newsContent = rec.querySelector('.t854__news-content');
  var attrKeyTelegram = newsContent.getAttribute('data-telegram-key');
  var keyTelegram = attrKeyTelegram.length !== 0 ? attrKeyTelegram : 'V1J5MnVkSWJ2UW5nN1JZM';
  var attrCountNews = newsContent.getAttribute('data-telegram-news-amount');
  var symbolsAttr = newsContent.getAttribute('data-telegram-symbols-preview');
  var countNews = attrCountNews.length !== 0 ? +attrCountNews : 5;
  var dateFormat = newsContent.getAttribute('data-telegram-date');
  var currentFromNews = 0;
  var currentShlop = 0;
  var symbolsAmount = 40;

  if (symbolsAttr === '') {
    symbolsAmount = 200;
  } else if (symbolsAttr < 40) {
    symbolsAmount = 40;
  } else if (symbolsAttr > 1000) {
    symbolsAmount = 1000;
  } else {
    symbolsAmount = symbolsAttr;
  }

  var totalNews = t854_showNews(rec, newsContent, keyTelegram, countNews, currentFromNews, currentShlop, dateFormat, symbolsAmount);
  newsContent.removeAttribute('data-telegram-key');
  newsContent.removeAttribute('data-telegram-news-amount');
  newsContent.removeAttribute('data-telegram-symbols-preview');
  newsContent.removeAttribute('data-telegram-date');

  t854_hideBtn(btnNews, totalNews, currentFromNews, countNews);

  btnNews.addEventListener('click', function (event) {
    event.preventDefault();
    currentFromNews = currentFromNews + countNews;
    currentShlop = event.target.closest('.t854__news-wrap').getAttribute('data-news-shlop');
    t854_hideBtn(btnNews, totalNews, currentFromNews, countNews);
    if (currentFromNews < totalNews) {
      t854_showNews(rec, newsContent, keyTelegram, countNews, currentFromNews, currentShlop, dateFormat, symbolsAmount);
    }
  });
}


function t854_hideBtn(btnNews, totalNews, currentFromNews, countNews) {
  if (totalNews - currentFromNews <= countNews) {
    btnNews.style.display = 'none';
  }
}


function t854_formatDate(date, dateFormat) {
  var dateParts = date.split('-');
  var newDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
  var newMonth = newDate.getMonth();
  var newDay = newDate.getDay();
  var dayOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  var month = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  switch (+dateFormat) {
    case 1:
      return dateParts[1] + '-' + dateParts[2] + '-' + dateParts[0];
    case 2:
      return dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
    case 3:
      return dateParts[2] + '/' + dateParts[1] + '/' + dateParts[0];
    case 4:
      return dateParts[2] + '.' + dateParts[1] + '.' + dateParts[0];
    case 5:
      return month[newMonth] + ' ' + dateParts[2] + ', ' + dateParts[0];
    default:
      return dayOfWeek[newDay] + ', ' + month[newMonth] + ' ' + dateParts[2];
  }
}


function t854_getNews(rec, keyTelegram, count, from, shlop, symbolsAmount) {
  var language = window.navigator ? window.navigator.language || window.navigator.systemLanguage || window.navigator.userLanguage : 'ru';
  language = language.substr(0, 2).toLowerCase();
  var btnNews = rec.querySelector('.t854__news-btn');
  var newsWrap = rec.querySelector('.t854__news-wrap');
  var newsContainer = rec.querySelector('.t854__news-wrap-container');
  var loader = rec.querySelector('.t854__news-loader');
  var urlNews = 'https://news.tildacdn.com/feed/' + keyTelegram + '/' + count + '/' + (parseInt(from) + parseInt(shlop)) + '/' + symbolsAmount;
  var dataJSON = '';
  loader.classList.add('t854__news-btn-loader_show');
  var request = new XMLHttpRequest();
  request.open('GET', urlNews, false);
  request.onload = function () {
    var data = request.response;
    if (this.status >= 200 && this.status < 400) {
      dataJSON = JSON.parse(data);
      newsWrap.setAttribute('data-news-shlop', dataJSON.shlop);
      if (dataJSON.status == 'fail') {
        console.log('You entered an ' + dataJSON.error);
        btnNews.style.display = 'none';
        if (language == 'ru') {
          newsWrap.innerHTML = '<div style="font-family:Georgia,serif;font-size:20px;color:red;">Вы ввели неправильный ключ</div>';
        } else {
          newsWrap.innerHTML = '<div style="font-family:Georgia,serif;font-size:20px;color:red;">You entered an ' + dataJSON.error + '</div>';
        }
      }
      if (dataJSON.total == 0) {
        console.log('You haven\'t a publication');
      }
      loader.classList.remove('t854__news-btn-loader_show');
      newsContainer.style.opacity = 1;
      loader.style.display = 'none';
    }
  };
  request.onerror = function () {
    console.log('Error!');
  };
  request.send();
  return dataJSON;
}


function t854_showNews(rec, newsContent, keyTelegram, count, from, shlop, dateFormat, symbolsAmount) {
  var news = t854_getNews(rec, keyTelegram, count, from, shlop, symbolsAmount);
  var newsMessages = news.messages;
  var totalNews = news.total;

  if (newsMessages) {
    for (var i = 0; i < newsMessages.length; i++) {
      var dateNews = newsMessages[i].date.split(' ');
      var dayNews = dateNews[0];
      var textNews = newsMessages[i].text;
      var shortTextNews = newsMessages[i].short_text;
      var imageIdNews = newsMessages[i].files;
      var timeHTML = '<div class="t854__news-time t-descr t-descr_xxs">' + t854_formatDate(dayNews, dateFormat) + '</div>';
      var blockImageArr = [];
      var imagesHTML = t854_addImage(newsMessages[i], imageIdNews, blockImageArr);
      var textHTML = t854_addText(textNews, shortTextNews);
      if (shortTextNews) {
        if (imageIdNews.length !== 1) {
          newsContent.innerHTML +=
            '<div class="t854__news-message t854__news-message_popup t854__news-message_short">' +
              timeHTML + imagesHTML + textHTML +
            '</div>';
        } else {
          newsContent.innerHTML +=
            '<div class="t854__news-message t854__news-message_popup t854__news-message_short">' +
              timeHTML +
              '<div class="t854__news-message-flex">' +
                imagesHTML + textHTML +
              '</div>' +
            '</div>';
        }
      } else if (imageIdNews.length !== 1) {
        newsContent.innerHTML +=
          '<div class="t854__news-message">' + timeHTML +
            imagesHTML + textHTML +
          '</div>';
      } else {
        newsContent.innerHTML +=
          '<div class="t854__news-message">' +
            timeHTML +
            '<div class="t854__news-message-flex">' +
              imagesHTML + textHTML +
            '</div>' +
          '</div>';
      }
    }
    t854_addPopup(rec);
    t854_closePopup(rec);
  }
  return totalNews;
}


function t854_addText(textNews, shortTextNews) {
  var textHTML;

  if (textNews.length === 0) {
    textHTML = '';
  } else if (shortTextNews) {
    textHTML = '<div class="t854__news-text t-descr t-descr_xs">' + shortTextNews + '</div><div class="t854__news-text_short-hide t-descr t-descr_xs">' + textNews + '</div>';
  } else {
    textHTML = '<div class="t854__news-text t-descr t-descr_xs">' + textNews + '</div>';
  }

  return textHTML;
}


function t854_addImage(item, imageIdNews, blockImageArr) {
  var images = '';
  var imgHTML = '';
  var imageUrl;
  if (item.files[0]) {
    imageUrl = 'https://news.tildacdn.com/' + item.files[0];
  }

  for (var i = 0; i < imageIdNews.length; i++) {
    imageUrl = 'https://news.tildacdn.com/' + imageIdNews[i] + '/-/resize/x900/';
    var blockImage = '<div class="t854__news-image-wrap"><img src="' + imageUrl + '" class="t854__news-image"></div>';
    blockImageArr.push(blockImage);
  }

  if (blockImageArr.length !== 0) {
    for (var i = 0; i < blockImageArr.length; i++) {
      images += blockImageArr[i];
      if (blockImageArr.length > 2) {
        imgHTML = '<div class="t854__news-images t854__news-images_col3">' + images + '</div>';
      } else {
        imgHTML = '<div class="t854__news-images">' + images + '</div>';
      }
    }
  }

  return imgHTML;
}


function t854_addPopup(rec) {
  var popupBlock = rec.querySelectorAll('.t854__news_publish.t854__news_short .t854__news-message');
  var wrapTextPopup = rec.querySelector('.t854__news-popup-bg');
  var textPopup = rec.querySelector('.t854__news-popup');
  var messageWrap = rec.querySelector('.t854__news_publish .t854__news-popup-message-wrap');

  Array.prototype.forEach.call(popupBlock, function (popup) {
    var textShortLength = popup.querySelector('.t854__news-text_short-hide');
    popup.addEventListener('click', function (event) {
      document.querySelector('body').classList.add('t854__body_overflow');
      if (wrapTextPopup) wrapTextPopup.style.display = 'block';
      if (textPopup && textShortLength) {
        textPopup.classList.add('t854__news-popup_short');
      }
      var popupShortContent = popup.innerHTML;
      messageWrap.innerHTML = popupShortContent;
      event.preventDefault();
    });

    var link = popup.querySelector('a');
    if (link) {
      link.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }
  });
}


function t854_closePopup(rec) {
  var wrapTextPopup = rec.querySelector('.t854__news-popup-bg');
  var textPopup = rec.querySelector('.t854__news-popup');
  var contentTextPopup = rec.querySelector('.t854__news-popup-content');
  var close = rec.querySelector('.t854__news-popup-close');

  if (wrapTextPopup) {
    wrapTextPopup.addEventListener('click', function (event) {
      t854_closeContent(wrapTextPopup, contentTextPopup, textPopup);
      event.preventDefault();
    });
  }

  if (textPopup) {
    textPopup.onclick = function (event) {
      event.stopPropagation();
    };
  }

  if (close) {
    close.addEventListener('click', function (event) {
      t854_closeContent(wrapTextPopup, contentTextPopup, textPopup);
      event.preventDefault();
    });
  }
  document.querySelector('body').addEventListener('keyup', function (event) {
    if (event.keyCode == 27) {
      t854_closeContent(wrapTextPopup, contentTextPopup, textPopup);
      event.preventDefault();
    }
  });
}


function t854_closeContent(wrapTextPopup, contentTextPopup, textPopup) {
  document.querySelector('body').classList.remove('t854__body_overflow');
  if (wrapTextPopup) wrapTextPopup.style.display = 'none';
  textPopup.classList.remove('t854__news-popup_short');
  if (contentTextPopup) contentTextPopup.innerHTML = '';
}


/* Polyfill: Element.matches */
if (!Element.prototype.matches) {
  Element.prototype.matches =
    Element.prototype.matchesSelector ||
    Element.prototype.msMatchesSelector ||
    Element.prototype.mozMatchesSelector ||
    Element.prototype.webkitMatchesSelector ||
    Element.prototype.oMatchesSelector;
}

/* Polyfill: Element.closest */
if (!Element.prototype.closest) {
  Element.prototype.closest = function (s) {
    var el = this;
    while (el && el.nodeType === 1) {
      if (Element.prototype.matches.call(el, s)) {
        return el;
      }
      el = el.parentElement || el.parentNode;
    }
    return null;
  };
} 
function t856_init(recId) {
    var rec = document.getElementById('rec' + recId);
    var container = rec.querySelector('.t856');
    var doResize;
  
    setTimeout(function() {
        t856_setHeight(recId);
        t856_updateLazyLoad(recId);
    }, 500);

    window.addEventListener('resize', function() {
        clearTimeout(doResize);
        doResize = setTimeout(function() {
            t856_setHeight(recId);
        }, 200);
    });

    // TODO: jq event
    $(container).on('displayChanged', function() {
        t856_setHeight(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //     t856_setHeight(recId);
    // });

    if (rec.classList.contains('t856__previewmode')) {
        setInterval(function() {
            t856_setHeight(recId);
        }, 5000);
    }
}
  
function t856_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t856');
    if (!container) return;
    var ratio = container.getAttribute('data-tile-ratio');
    var ratioHeight = parseFloat(getComputedStyle(rec.querySelector('.t856__col'), null).width.replace('px', '')) * ratio;
    var rows = rec.querySelectorAll('.t856__row');
    
    for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var largestHeight = 0;
        var tables = row.querySelectorAll('.t856__table');

        for (var j = 0; j < tables.length; j++) {
            var table = tables[j];
            var textHeight = table.querySelector('.t856__textwrapper').offsetHeight;

            if (table.querySelector('.t856__cell').classList.contains('t856__button-bottom')) {
                textHeight += table.querySelector('.t856__button-container').offsetHeight;
            }

            if (textHeight > largestHeight) largestHeight = textHeight;
        }
        
        if (window.innerWidth >= 960) {
            if (largestHeight > ratioHeight) {
                for (var j = 0; j < tables.length; j++) {
                    tables[j].style.height = largestHeight + 'px';
                    tables[j].style.minHeight = 'auto';
                }
            } else {
                for (var j = 0; j < tables.length; j++) {
                    tables[j].style.height = ratioHeight + 'px';
                    tables[j].style.minHeight = 'auto';
                }
            }
        } else {
            for (var j = 0; j < tables.length; j++) {
                tables[j].style.minHeight = ratioHeight + 'px';
                tables[j].style.height = null;
            }
        }

        if (t856_GetIEVersion() > 0) {
            var currentRowHeight = getComputedStyle(row.querySelector('.t856__table')).height;

            row.querySelector('.t856__bg').style.height = currentRowHeight + 'px';
            row.querySelector('.t856__overlay').style.height = currentRowHeight + 'px';
        }
    }
}
  
function t856_GetIEVersion() {
    var userAgent = window.navigator.userAgent;
    var index = userAgent.indexOf('MSIE');
    
    if (index > 0) {
        return parseInt(userAgent.substring(index + 5, userAgent.indexOf('.', index)));
    } else {
        if (!!navigator.userAgent.match(/Trident\/7\./)) {
            return 11;
        } else {
            return 0;
        }
    }
}
  
function t856_updateLazyLoad(recId) {
    var scrollContainer = document.querySelector('#rec' + recId + ' .t856__container_mobile-flex');
    var allRecords = document.getElementById('allrecords');
    var currentMode = allRecords.getAttribute('data-tilda-mode');

    if (scrollContainer && currentMode !== 'edit' && currentMode !== 'preview') {
        scrollContainer.addEventListener('scroll', t_throttle(function() {
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }, 500));
    }
} 
function t857__init(recId) {
    var allRecords = document.getElementById('allrecords');
    var rec = document.getElementById('rec' + recId);
    var container = rec.querySelector('.t857__container_mobile-flex');
    if (!container) return;
    var cols = container.querySelectorAll('.t857__col');

    function t857__touchmoveEvent() {
        if (typeof allRecords.getAttribute('data-tilda-mode') === 'undefined') {
            if (window.lazy === 'y' || allRecords.getAttribute('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
        }
    }

    container.addEventListener('touchstart', function() {
        for (var i = 0; i < cols.length; i++) {
            var col = cols[i];
            
            col.removeEventListener('touchmove', t857__touchmoveEvent);
            col.addEventListener('touchmove', t857__touchmoveEvent);
        }
    });
} 
function t858_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t858');
    if (!container) return;
    var doResize;

    t858_unifyHeights(recId);

    window.addEventListener('resize', function() {
        clearTimeout(doResize);
        doResize = setTimeout(function() {
            t858_unifyHeights(recId);
        }, 200);
    });

    window.addEventListener('load', function() {
        t858_unifyHeights(recId);
    });
    
    // TODO: js event
    $(container).on('displayChanged', function() {
      t858_unifyHeights(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //      t858_unifyHeights(recId);
    // });

    if (container.classList.contains('t858__previewmode')) {
        setInterval(function() {
            t858_unifyHeights(recId);
        }, 5000);
    }
}

function t858_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t858');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var rows = container.querySelectorAll('.t858__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var maxHeight = 0;
            var cols = row.querySelectorAll('.t858__inner-col');

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var colWrap = col.querySelector('.t858__wrap');
                var colHeight = colWrap.offsetHeight;

                if (colHeight > maxHeight) maxHeight = colHeight;
            }
            
            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        }
    } else {
        var cols = rec.querySelectorAll('.t858__inner-col');

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = 'auto';
        }
    }
} 
function t859_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t859');
    if (!container) return;

    t859_unifyHeights(recId);

    window.addEventListener('resize', function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        
        t859_unifyHeights(recId);
    });

    window.addEventListener('load', function() {
        t859_unifyHeights(recId);
    });
    
    // TODO: jq event
    $(container).on('displayChanged', function() {
        t859_unifyHeights(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //     t859_unifyHeights(recId);
    // });

    if (container.classList.contains('t859__previewmode')) {
        setInterval(function() {
            t859_unifyHeights(recId);
        }, 5000);
    }
}

function t859_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t859');
    if (!container) return;
    
    if (window.innerWidth >= 960) {
        var rows = container.querySelectorAll('.t859__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var maxHeight = 0;
            var cols = row.querySelectorAll('.t859__inner-col');

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var colWrap = col.querySelector('.t859__wrap');
                var colHeight = colWrap.offsetHeight;

                if (colHeight > maxHeight) maxHeight = colHeight;
            }

            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        }
    } else {
        var cols = rec.querySelectorAll('.t859__inner-col');

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = 'auto';
        }
    }
} 
function t860_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t860');
    if (!container) return;
  
    t860_unifyHeights(recId);
    t860_translateBlock(recId);

    window.addEventListener('resize', function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        t860_unifyHeights(recId);
        t860_translateBlock(recId);
    });

    window.addEventListener('load', function() {
        t860_unifyHeights(recId);
        t860_translateBlock(recId);
    });

    // TODO: jq event
    $(container).on('displayChanged', function() {
        t860_unifyHeights(recId);
        t860_translateBlock(recId);
    });

    // container.addEventListener('displayChanged', function() {
    //     t860_unifyHeights(recId);
    //     t860_translateBlock(recId);
    // });

    if (rec.classList.contains('t860__previewmode')) {
        setInterval(function() {
            t860_unifyHeights(recId);
            t860_translateBlock(recId);
        }, 5000);
    }
}

function t860_translateBlock(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t860');
    if (!container) return;
    var blockHover = rec.querySelectorAll('.t860__block_hover');
    var wrapMarginBottom = 30;

    if (window.innerWidth > 1024) {
        for (var i = 0; i < blockHover.length; i++) {
            var element = blockHover[i];
            var colWraps = t_getParents(element, 't860__inner-col');
            var colWrapHeight = parseFloat(getComputedStyle(colWraps[0], null).height.replace('px', ''));
            var showHeight = element.querySelector('.t860__show').offsetHeight;
            var diff = colWrapHeight - 2 * showHeight - wrapMarginBottom / 2;
            element.style.transform = 'translateY(' + diff + 'px)';
        }
    }
}

function t860_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t860');
    if (!container) return;

    if (window.innerWidth >= 960) {
        var rows = container.querySelectorAll('.t860__row');

        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var maxHeight = 0;
            var cols = row.querySelectorAll('.t860__inner-col');

            for (var j = 0; j < cols.length; j++) {
                var col = cols[j];
                var colWrap = col.querySelector('.t860__wrap');
                var colHeight = colWrap.offsetHeight;

                if (colHeight > maxHeight) maxHeight = colHeight;
            }

            for (var j = 0; j < cols.length; j++) {
                cols[j].style.height = maxHeight + 'px';
            }
        }
    } else {
        var cols = rec.querySelectorAll('.t860__inner-col');

        for (var i = 0; i < cols.length; i++) {
            cols[i].style.height = 'auto';
        }
    }
}

function t_getParents(element, className) {
    var result = [];
    for (var p = element && element.parentElement; p; p = p.parentElement) {
        if (p.classList.contains(className)) {
            result.push(p);
        }
    }
    return result;
} 
function t862_init(recid) {
    var rec = $('#rec' + recid);
    var quizWrapper = rec.find('.t862__quiz-wrapper');
    var form = rec.find('.t862 .t-form');
    var quizQuestion = rec.find('.t862 .t-input-group');
    var prevBtn = rec.find('.t862__btn_prev');
    var nextBtn = rec.find('.t862__btn_next');
    var resultBtn = rec.find('.t862__btn_result');
    var errorBoxMiddle = rec.find('.t-form__errorbox-middle .t-form__errorbox-wrapper');
    var captureFormHTML = '<div class="t862__capture-form"></div>';
    rec.find('.t862 .t-form__errorbox-middle').before(captureFormHTML);
    var quizQuestionNumber = 0;
    form.removeClass('js-form-proccess');
    $(quizQuestion[quizQuestionNumber]).show();
    $(quizQuestion[quizQuestionNumber]).addClass('t-input-group-step_active');
    rec.attr('data-animationappear', 'off');
    rec.css('opacity', '1');

    t862_workWithAnswerCode(rec);

    quizQuestion.each(function (i) {
        $(quizQuestion[i]).attr('data-question-number', i);
    });

    t862_wrapCaptureForm(rec);
    var captureForm = rec.find('.t862__capture-form');
    var resultText = rec.find('.t862__result-title').text();

    t862_showCounter(rec, quizQuestionNumber);
    t862_disabledPrevBtn(rec, quizQuestionNumber);
    t862_checkLength(rec);

    t862_openToHook(rec, form, quizQuestion, captureForm);

    prevBtn.click(function (e) {
        if (quizQuestionNumber > 0) {
            quizQuestionNumber--;
        }

        t862_setProgress(rec, -1);
        t862_lazyLoad();
        t862_awayFromResultScreen(rec);
        t862_showCounter(rec, quizQuestionNumber);
        t862_hideError(rec, quizQuestionNumber);
        t862_disabledPrevBtn(rec, quizQuestionNumber);
        t862_switchQuestion(rec, quizQuestionNumber);
        t862_resizePopup(rec);

        e.preventDefault();
    });

    nextBtn.click(function (e) {
        var showErrors = t862_showError(rec, quizWrapper, quizQuestionNumber);

        if (showErrors) {
            errorBoxMiddle.hide();
        }

        if (!showErrors) {
            quizQuestionNumber++;
            prevBtn.attr('disabled', false);
            t862_setProgress(rec, 1);
            t862_showCounter(rec, quizQuestionNumber);
            t862_switchQuestion(rec, quizQuestionNumber);
            t862_resizePopup(rec);
        }

        t862_lazyLoad();

        e.preventDefault();
    });

    quizQuestion.keypress(function (e) {
        var activeStep = form.find('.t-input-group-step_active');
        if (event.keyCode === 13 && !form.hasClass('js-form-proccess') && !activeStep.hasClass('t-input-group_ta')) {
            var showErrors = t862_showError(rec, quizWrapper, quizQuestionNumber);
            var questionArr = t862_createQuestionArr(rec);

            if (showErrors) {
                errorBoxMiddle.hide();
            }

            prevBtn.attr('disabled', false);
            if (!showErrors) {
                quizQuestionNumber++;
                t862_setProgress(rec, 1);
                t862_showCounter(rec, quizQuestionNumber);

                if (quizQuestionNumber < questionArr.length) {
                    t862_switchQuestion(rec, quizQuestionNumber);
                } else {
                    t862_switchResultScreen(rec);
                    form.addClass('js-form-proccess');
                }

                t862_disabledPrevBtn(rec, quizQuestionNumber);
            }

            t862_lazyLoad();

            e.preventDefault();
        }
    });

    resultBtn.click(function (e) {
        var showErrors = t862_showError(rec, quizWrapper, quizQuestionNumber);

        if (showErrors) {
            errorBoxMiddle.hide();
        }

        if (!showErrors) {
            quizQuestionNumber++;
            t862_setProgress(rec, 1);
            form.addClass('js-form-proccess');
            t862_disabledPrevBtn(rec, quizQuestionNumber);
            if (captureForm.html() === '' && resultText === '') {
                t862_showCounter(rec, quizQuestionNumber);
                t862_switchQuestion(rec, quizQuestionNumber);
            } else {
                t862_switchResultScreen(rec);
            }
        }

        e.preventDefault();
    });
}

function t862_workWithAnswerCode(rec) {
    rec.find('.t-input-group_ri')
        .find('input')
        .each(function () {
            var $this = $(this);
            if ($this.val().indexOf('value::') != -1) {
                t862_setAnswerCode($this);
                var label = $this.parent().find('.t-img-select__text');
                label.text(label.text().split('value::')[0].trim());
            }
        });

    rec.find('.t-input-group_rd')
        .find('input')
        .each(function () {
            var $this = $(this);
            if ($this.val().indexOf('value::') != -1) {
                t862_setAnswerCode($this);
                var label = $this.parent();

                label.html(function () {
                    var html = $(this).html().split('value::')[0].trim();
                    return html;
                });
            }
        });

    rec.find('.t-input-group_sb')
        .find('option')
        .each(function () {
            var $this = $(this);
            if ($this.val().indexOf('value::') != -1) {
                t862_setAnswerCode($this);
                $this.text($this.text().split('value::')[0].trim());
            }
        });
}

function t862_setAnswerCode($this) {
    var parameter = $this.val().split('value::')[1].trim();
    $this.val(parameter);
}

function t862_openToHook(rec, form, quizQuestion, captureForm) {
    var popup = rec.find('.t-popup');
    var hook = popup.attr('data-tooltip-hook');
    var analitics = popup.attr('data-track-popup');

    if (hook !== '') {
        $('.r').on('click', 'a[href="' + hook + '"]', function (e) {
            t862_showPopup(rec, form, quizQuestion, captureForm);
            setTimeout(function () {
                t862_resizePopup(rec);
            }, 50);
            e.preventDefault();
            if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
                t_onFuncLoad('t_lazyload_update', function () {
                    t_lazyload_update();
                });
            }
            if (analitics > '') {
                var virtTitle = hook;
                if (virtTitle.substring(0, 7) == '#popup:') {
                    virtTitle = virtTitle.substring(7);
                }
                Tilda.sendEventToStatistics(analitics, virtTitle);
            }
        });
    }
}

function t862_showError(rec, quizWrapper, quizQuestionNumber) {
    if (quizWrapper.hasClass('t862__quiz-published')) {
        var errors = t862_setError(rec, quizQuestionNumber);

        return errors;
    }
}

function t862_lazyLoad() {
    if (typeof $('.t-records').attr('data-tilda-mode') == 'undefined') {
        if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function () {
                t_lazyload_update();
            });
        }
    }
}

function t862_setHeight(rec, form, quizQuestion, captureForm) {
    var questions = [];
    var questionsHeight = [];

    var descrHeight = rec.find('.t862__quiz-description').outerHeight();
    var titleHeight = rec.find('.t862__result-title').outerHeight();

    quizQuestion.each(function () {
        var $this = $(this);
        if (!$this.hasClass('t862__t-input-group_capture')) {
            questions.push($this);
        }
    });

    questions.forEach(function (item) {
        questionsHeight.push(item.outerHeight());
    });

    var maxHeightQuestion = Math.max.apply(null, questionsHeight);

    var captureFormHeight = captureForm.outerHeight();
    var height = maxHeightQuestion > captureFormHeight ? maxHeightQuestion : captureFormHeight;

    questions.forEach(function (item) {
        item.css('min-height', height);
    });

    captureForm.css('min-height', height);
    rec.find('.t862__quiz-form-wrapper').css('min-height', height);

    var headerHeight = titleHeight > descrHeight ? titleHeight : descrHeight;
    var quizWrapperHeight = rec.find('.t862__quiz-form-wrapper').outerHeight();
    var btnHeight = rec.find('.t862__btn-wrapper').outerHeight();

    rec.find('.t862__wrapper').css('min-height', headerHeight + quizWrapperHeight + btnHeight);
}

function t862_setMobileHeight() {
    t862_calcVH();
    window.addEventListener('resize', function () {
        t862_calcVH();
    });
}

function t862_calcVH() {
    var vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', vh + 'px');
}

function t862_checkLength(rec) {
    var nextBtn = rec.find('.t862__btn_next');
    var resultBtn = rec.find('.t862__btn_result');
    var questionArr = t862_createQuestionArr(rec);
    var submitBtnWrapper = rec.find('.t862 .t-form__submit');
    var captureForm = rec.find('.t862__capture-form');
    var resultText = rec.find('.t862__result-title').text();

    if (captureForm.html() === '' && resultText === '' && questionArr.length < 2) {
        nextBtn.hide();
        resultBtn.hide();
        submitBtnWrapper.show();
    } else if (questionArr.length < 2) {
        nextBtn.hide();
        resultBtn.show();
    }
}

function t862_showCounter(rec, quizQuestionNumber) {
    var counter = rec.find('.t862__quiz-description-counter');
    var questionArr = t862_createQuestionArr(rec);
    counter.html(quizQuestionNumber + 1 + '/' + questionArr.length);
}

function t862_setError(rec, quizQuestionNumber) {
    var questionArr = t862_createQuestionArr(rec);
    var currentQuestion = $(questionArr[quizQuestionNumber]);
    var showErrors;
    if (typeof window.tildaForm !== 'object') return showErrors;
    var arErrors = window.tildaForm.validate(currentQuestion);
    currentQuestion.addClass('js-error-control-box');
    var errorsTypeObj = arErrors[0];

    if (errorsTypeObj != undefined) {
        var errorType = errorsTypeObj.type[0];
        var errorTextCustom = rec
            .find('.t862 .t-form')
            .find('.t-form__errorbox-middle')
            .find('.js-rule-error-' + errorType)
            .text();
        var sError = '';
        if (errorTextCustom != '') {
            sError = errorTextCustom;
        } else {
            t_onFuncLoad('t_form_dict', function () {
                sError = t_form_dict(errorType);
            });
        }
        showErrors = errorType == 'emptyfill' ? false : window.tildaForm.showErrors(currentQuestion, arErrors);
        currentQuestion.find('.t-input-error').html(sError);
    }

    return showErrors;
}

function t862_hideError(rec, quizQuestionNumber) {
    var questionArr = t862_createQuestionArr(rec);
    var currentQuestion = $(questionArr[quizQuestionNumber]);
    currentQuestion.removeClass('js-error-control-box');
    currentQuestion.find('.t-input-error').html('');
}

function t862_setProgress(rec, index) {
    var progress = rec.find('.t862__progress');
    var progressbarWidth = rec.find('.t862__progressbar').width();
    var questionCount = t862_createQuestionArr(rec).length;
    var captureForm = rec.find('.t862__capture-form');
    var resultText = rec.find('.t862__result-title').text();

    if (captureForm.html() === '' && resultText === '' && questionCount > 0) {
        questionCount--;
    }

    var progressWidth = progress.attr('data-progress-bar');
    if (progressWidth === undefined) {
        progressWidth = 0;
        progress.attr('data-progress-bar', '0');
    }
    var progressStep = progressbarWidth / questionCount;
    var percentProgress = (parseFloat(progressWidth) + (index * progressStep)) / progressbarWidth * 100;
    
    if (isNaN(percentProgress) || percentProgress === -Infinity) {
        percentProgress = 0;
        progress.attr('data-progress-bar', percentProgress);
    } else if (percentProgress === Infinity) {
        percentProgress = progressbarWidth;
        progress.attr('data-progress-bar', percentProgress);
    } else {
        progress.attr('data-progress-bar', progressbarWidth / 100 * percentProgress);
    }

    if (percentProgress > 100) {
        percentProgress = 100;
    } else if (percentProgress < 0) {
        percentProgress = 0;
    }

    var percentProgressWidth = percentProgress + '%';

    progress.css('width', percentProgressWidth);
}

function t862_wrapCaptureForm(rec) {
    var captureForm = rec.find('.t862__capture-form');
    var quizQuestion = rec.find('.t862 .t-input-group');
    var quizFormWrapper = rec.find('.t862__quiz-form-wrapper');

    quizQuestion.each(function (i) {
        var currentQuizQuestion = $(quizQuestion[i]);
        var emailInputExist = $(currentQuizQuestion).hasClass('t-input-group_em');
        var nameInputExist = $(currentQuizQuestion).hasClass('t-input-group_nm');
        var phoneInputExist = $(currentQuizQuestion).hasClass('t-input-group_ph');
        var checkboxInputExist = $(currentQuizQuestion).hasClass('t-input-group_cb');
        var quizQuestionNumber = currentQuizQuestion.attr('data-question-number');
        var maxCountOfCaptureFields = 4;

        if (quizQuestionNumber >= quizQuestion.length - maxCountOfCaptureFields) {
            var isCaptureGroup = true;

            if (quizFormWrapper.hasClass('t862__quiz-form-wrapper_newcapturecondition')) {
                var inputsGroup = currentQuizQuestion.nextAll('.t-input-group');
                inputsGroup.each(function () {
                    isCaptureGroup =
                        $(this).hasClass('t-input-group_cb') ||
                        $(this).hasClass('t-input-group_em') ||
                        $(this).hasClass('t-input-group_nm') ||
                        $(this).hasClass('t-input-group_ph');
                });
            }

            if (isCaptureGroup) {
                if (emailInputExist || nameInputExist || phoneInputExist || checkboxInputExist) {
                    currentQuizQuestion.addClass('t862__t-input-group_capture');
                    captureForm.append(currentQuizQuestion);
                }
            }
        }
    });
}

function t862_createQuestionArr(rec) {
    var quizQuestion = rec.find('.t862 .t-input-group');
    var questionArr = [];

    quizQuestion.each(function (i) {
        var question = $(quizQuestion[i]);
        if (!question.hasClass('t862__t-input-group_capture')) {
            questionArr.push(quizQuestion[i]);
        }
    });

    return questionArr;
}

function t862_disabledPrevBtn(rec, quizQuestionNumber) {
    var prevBtn = rec.find('.t862__btn_prev');
    quizQuestionNumber == 0 ? prevBtn.attr('disabled', true) : prevBtn.attr('disabled', false);
}

function t862_switchQuestion(rec, quizQuestionNumber) {
    var nextBtn = rec.find('.t862__btn_next');
    var resultBtn = rec.find('.t862__btn_result');
    var questionArr = t862_createQuestionArr(rec);
    var submitBtnWrapper = rec.find('.t862 .t-form__submit');
    var captureForm = rec.find('.t862__capture-form');
    var resultText = rec.find('.t862__result-title').text();

    $(questionArr).hide();
    $(questionArr).removeClass('t-input-group-step_active');
    $(questionArr[quizQuestionNumber]).show();
    $(questionArr[quizQuestionNumber]).addClass('t-input-group-step_active');

    var $range = $(questionArr[quizQuestionNumber]).find('.t-range');
    $range.trigger('displayChanged');
    var range = $range.get(0);
    if (range) {
        var triggerChangeEvent;
        if (/msie|trident/i.test(navigator.userAgent)) {
            triggerChangeEvent = document.createEvent('Event');
            triggerChangeEvent.initEvent('displayChanged', true, false);
        } else {
            triggerChangeEvent = new Event('displayChanged');
        }
        range.dispatchEvent(triggerChangeEvent);
    }

    if (captureForm.html() === '' && resultText === '' && quizQuestionNumber === questionArr.length - 2) {
        nextBtn.hide();
        resultBtn.show();
        submitBtnWrapper.hide();
    } else if (captureForm.html() === '' && resultText === '' && quizQuestionNumber === questionArr.length - 1) {
        nextBtn.hide();
        resultBtn.hide();
        submitBtnWrapper.show();
    } else if (quizQuestionNumber === questionArr.length - 1) {
        nextBtn.hide();
        resultBtn.show();
        submitBtnWrapper.hide();
    } else {
        nextBtn.show();
        resultBtn.hide();
        submitBtnWrapper.hide();
    }
}

function t862_switchResultScreen(rec) {
    var resultBtn = rec.find('.t862__btn_result');
    var submitBtnWrapper = rec.find('.t862 .t-form__submit');
    var captureForm = rec.find('.t862__capture-form');
    var resultTitle = rec.find('.t862__result-title');

    if (captureForm.html() !== '' || resultTitle.text() !== '') {
        var quizDescription = rec.find('.t862__quiz-description');
        var questionArr = t862_createQuestionArr(rec);

        $(questionArr).hide();
        $(captureForm).show();

        quizDescription.hide();
        resultTitle.show();
    }

    resultBtn.hide();
    submitBtnWrapper.show();
}

function t862_awayFromResultScreen(rec) {
    var captureForm = rec.find('.t862__capture-form');
    var quizDescription = rec.find('.t862__quiz-description');
    var resultTitle = rec.find('.t862__result-title');
    var submitBtnWrapper = rec.find('.t862 .t-form__submit');

    submitBtnWrapper.hide();
    $(captureForm).hide();
    quizDescription.show();
    resultTitle.hide();
}

function t862_onSuccess(form) {
    var inputsWrapper = form.find('.t-form__inputsbox');
    var inputsHeight = inputsWrapper.height();
    var inputsOffset = inputsWrapper.offset().top;
    var inputsBottom = inputsHeight + inputsOffset;
    var targetOffset = form.find('.t-form__successbox').offset().top;
    var prevBtn = form.parents('.t862').find('.t862__btn_prev');
    var target;

    if ($(window).width() > 960) {
        target = targetOffset - 200;
    } else {
        target = targetOffset - 100;
    }

    if (targetOffset > $(window).scrollTop() || $(document).height() - inputsBottom < $(window).height() - 100) {
        inputsWrapper.addClass('t862__inputsbox_hidden');
        setTimeout(function () {
            if ($(window).height() > $('.t-body').height()) {
                $('.t-tildalabel').animate({
                        opacity: 0,
                    },
                    50
                );
            }
        }, 300);
    } else {
        $('html, body').animate({
                scrollTop: target,
            },
            400
        );
        setTimeout(function () {
            inputsWrapper.addClass('t862__inputsbox_hidden');
        }, 400);
    }

    var successurl = form.data('success-url');
    if (successurl && successurl.length > 0) {
        setTimeout(function () {
            window.location.href = successurl;
        }, 500);
    }

    prevBtn.hide();
}

function t862_lockScroll() {
    var body = $('body');
    if (!body.hasClass('t-body_scroll-locked')) {
        var bodyScrollTop =
            typeof window.pageYOffset !== 'undefined' ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
        body.addClass('t-body_scroll-locked');
        body.css('top', '-' + bodyScrollTop + 'px');
        body.attr('data-popup-scrolltop', bodyScrollTop);
    }
}

function t862_unlockScroll() {
    var body = $('body');
    if (body.hasClass('t-body_scroll-locked')) {
        var bodyScrollTop = $('body').attr('data-popup-scrolltop');
        body.removeClass('t-body_scroll-locked');
        body.css('top', '');
        body.removeAttr('data-popup-scrolltop');
        window.scrollTo(0, bodyScrollTop);
    }
}

function t862_showPopup(rec, form, quizQuestion, captureForm) {
    var popup = rec.find('.t-popup');
    var quiz = rec.find('.t862__quiz');
    popup.css('display', 'block');

    var $range = rec.find('.t-range');
    $range.trigger('popupOpened');
    var range = $range.get(0);
    if (range) {
        var triggerChangeEvent;
        if (/msie|trident/i.test(navigator.userAgent)) {
            triggerChangeEvent = document.createEvent('Event');
            triggerChangeEvent.initEvent('popupOpened', true, false);
        } else {
            triggerChangeEvent = new Event('popupOpened');
        }
        range.dispatchEvent(triggerChangeEvent);
    }
    
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
    setTimeout(function () {
        popup.find('.t-popup__container').addClass('t-popup__container-animated');
        popup.addClass('t-popup_show');
        if ($(window).width() > 640 && quiz.hasClass('t862__quiz_fixedheight')) {
            t862_setHeight(rec, form, quizQuestion, captureForm);
        }

        if ($(window).width() <= 640) {
            t862_setMobileHeight();
        }

        t862__showJivo(popup, '1', '1');
    }, 50);

    $('body').addClass('t-body_popupshowed t862__body_popupshowed');
    /*fix IOS11 cursor bug + general IOS background scroll*/
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        setTimeout(function () {
            t862_lockScroll();
        }, 500);
    }

    rec.find('.t-popup').click(function (e) {
        var windowWidth = $(window).width();
        var maxScrollBarWidth = 17;
        var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;
        if (e.clientX > windowWithoutScrollBar) {
            return;
        }
        if (e.target == this) {
            t862_closePopup(rec);
        }
    });

    rec.find('.t-popup__close').click(function () {
        t862_closePopup(rec);
    });

    rec.find('a[href*="#"]').click(function () {
        var url = $(this).attr('href');
        if (!url || url.substring(0, 7) != '#price:') {
            t862_closePopup(rec);
            if (!url || url.substring(0, 7) == '#popup:') {
                setTimeout(function () {
                    $('body').addClass('t-body_popupshowed');
                }, 300);
            }
        }
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 27) {
            t862_closePopup(rec);
        }
    });
}

function t862_closePopup(rec) {
    $('body').removeClass('t-body_popupshowed t862__body_popupshowed');
    /*fix IOS11 cursor bug + general IOS background scroll*/
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        t862_unlockScroll();
    }
    rec.find('.t-popup').removeClass('t-popup_show');
    t862__showJivo($('.t-popup'), '2147483647', '2147483648');
    setTimeout(function () {
        $('.t-popup').not('.t-popup_show').css('display', 'none');
    }, 300);
}

function t862_resizePopup(rec) {
    var div = rec.find('.t-popup__container').height();
    var win = $(window).height() - 120;
    var popup = rec.find('.t-popup__container');
    if (div > win) {
        popup.addClass('t-popup__container-static');
    } else {
        popup.removeClass('t-popup__container-static');
    }
}

function t862__showJivo(popup, indexMobile, indexDesktop) {
    if ($('._show_1e.wrap_mW.__jivoMobileButton').length != 0) {
        $('._show_1e.wrap_mW.__jivoMobileButton').css('z-index', indexMobile);
    }

    if ($('.label_39#jvlabelWrap').length != 0) {
        $('.label_39#jvlabelWrap').css('z-index', indexDesktop);
    }
}

/* deprecated */
function t862_sendPopupEventToStatistics(popupname) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';
    if (popupname.substring(0, 7) == '#popup:') {
        popupname = popupname.substring(7);
    }

    virtPage += popupname;
    virtTitle += popupname;

    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {
                    hitType: 'pageview',
                    page: virtPage,
                    title: virtTitle,
                });
            }
        }

        if (window.mainMetrika > '' && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {
                title: virtTitle,
                referer: window.location.href,
            });
        }
    }
} 
function t865_init(recid) {
	var rec = $('#rec' + recid);

	t865__initFB(rec);
	t865_setFBWidth(rec);
	
	if (window.VK) {
	    t865__initVK(rec, recid);
	}

	$(window).bind('resize', t_throttle(function() {
		if (typeof window.noAdaptive !== 'undefined' && window.noAdaptive === true && window.isMobile) { return; }
		t865_setFBWidth(rec);
	}));

	rec.find('.t865').bind('displayChanged',function(){
		t865_setFBWidth(rec);
	});
}


function t865_setFBWidth(rec) {
	setTimeout(function() {
		var fb = rec.find('.fb-comments');
		var colFB = fb.parents('.t865__fb');
		var width = colFB.width();
		fb.find('.fb_ltr').css('width', width);
		fb.find('span').css('width', width);
	}, 500);
}


function t865__initFB(rec) {
	var FBWidgetId = rec.find('.t865__fb').attr('data-comments-fb');
	var pageurl;
	rec.find('.t865__fb').removeAttr('data-comments-fb');
	try {
	    pageurl = "" + window.location;
	    pageurl = pageurl.split('?')[0];
	    pageurl = pageurl.split('#')[0];
	} catch (e) {
	    pageurl = window.location;
	}
	rec.find('.t865__fb .fb-comments').attr('data-href', pageurl);

	if (rec.find('.t865').hasClass('t865__publish') && FBWidgetId !== undefined) {
		(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = 'https://connect.facebook.net/' + t865_setLanguage(rec) + '/sdk.js#xfbml=1&version=v3.1&appId=' + FBWidgetId + '&autoLogAppEvents=1';
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	}
}


function t865__initVK(rec, recid) {
	var VKWidgetId = rec.find('.t865__vk').attr('data-comments-vk');
	rec.find('.t865__vk').removeAttr('data-comments-vk');

	if (rec.find('.t865').hasClass('t865__publish') && VKWidgetId !== undefined) {
			VK.init({apiId: VKWidgetId, onlyWidgets: true});
			if (rec.find('.t865__vk').hasClass('t865__vk-comments')) {
			    VK.Widgets.Comments("vk_comments" + recid, {limit: 10, attach: "*"});
			} else {
			    VK.Widgets.Comments("vk_comments", {limit: 10, attach: "*"});   
			}
	}
}


function t865_setLanguage(rec) {
    var lang = rec.find('.t865__fb').attr('data-fb-comments-local');
    var langs = {
        en: 'en_US',
        ru: 'ru_RU',
        az: 'az_AZ',
        ca: 'ca_ES',
        es: 'es_ES',
        cs: 'cs_CZ',
        da: 'da_DK',
        de: 'de_DE',
        et: 'et_EE',
        fr: 'fr_FR',
        he: 'he_IL',
        it: 'it_IT',
        ja: 'ja_JP',
        lv: 'lv_LV',
        nb: 'nb_NO',
        nl: 'nl_NL',
        pl: 'pl_PL',
        pt: 'pt_PT',
        sv: 'sv_SE',
        tr: 'tr_TR',
        zh: 'zh_CN',
        zhTW: 'zh_TW',
    }

    return langs[lang || 'ru'] || 'ru_RU';
}
 
function t868_setHeight(recid) {
  var rec = $('#rec' + recid);
  var div = rec.find('.t868__video-carier');
  var height = div.width() * 0.5625;
  div.height(height);
  div.parent().height(height);
}


function t868_initPopup(recid) {
  var rec = $('#rec' + recid);
  $('#rec' + recid).attr('data-animationappear', 'off');
  $('#rec' + recid).css('opacity', '1');
  var el = $('#rec' + recid).find('.t-popup');
  var hook = el.attr('data-tooltip-hook');
  var analitics = el.attr('data-track-popup');
  var customCodeHTML = t868__readCustomCode(rec);

  if (hook !== '') {
    $('.r').on('click', 'a[href="' + hook + '"]', function(e) {
      t868_showPopup(recid, customCodeHTML);
      t868_resizePopup(recid);
      e.preventDefault();
      if (analitics > '') {
        var virtTitle = hook;
        if (virtTitle.substring(0,7) == '#popup:') {
          virtTitle = virtTitle.substring(7);
        }
        Tilda.sendEventToStatistics(analitics, virtTitle);
      }
    });
  }
}


function t868__readCustomCode(rec) {
  var customCode = rec.find('.t868 .t868__code-wrap').html();
  rec.find('.t868 .t868__code-wrap').remove();
  return customCode;
}


function t868_showPopup(recid, customCodeHTML) {
  var rec = $('#rec' + recid);
  var popup = rec.find('.t-popup');
  var popupContainer = rec.find('.t-popup__container');
  popupContainer.append(customCodeHTML);

  popup.css('display', 'block');
  t868_setHeight(recid);
  setTimeout(function() {
    popup.find('.t-popup__container').addClass('t-popup__container-animated');
    popup.addClass('t-popup_show');
  }, 50);

  $('body').addClass('t-body_popupshowed');
  
  rec.find('.t-popup').click(function (e) {
      var container;
      if (e.target) {
          container = e.target.closest('.t-popup__container');
      }
      if (!container) {
          t868_closePopup(recid);
      }
  });

  rec.find('.t-popup__close').click(function(e) {
    t868_closePopup(recid);
  });

  rec.find('a[href*="#"]').click(function(e) {
    var url = $(this).attr('href');
    if (url.indexOf('#order') != -1) {
        var popupContainer = rec.find('.t-popup__container');
        setTimeout(function() {
            popupContainer.empty();
        }, 600);
    }
    if (!url || url.substring(0,7) != '#price:') {
      t868_closePopup();
      if (!url || url.substring(0,7) == '#popup:') {
        setTimeout(function() {
          $('body').addClass('t-body_popupshowed');
        }, 300);
      }
    }
  });

  $(document).keydown(function(e) {
    if (e.keyCode == 27) { t868_closePopup(recid); }
  });
}


function t868_closePopup(recid) {
  var rec = $('#rec' + recid);
  var popup = rec.find('.t-popup');
  var popupContainer = rec.find('.t-popup__container');

  $('body').removeClass('t-body_popupshowed');
  $('#rec' + recid + ' .t-popup').removeClass('t-popup_show');

  popupContainer.empty();

  setTimeout(function() {
    $('.t-popup').not('.t-popup_show').css('display', 'none');
  }, 300);
}


function t868_resizePopup(recid) {
  var rec = $('#rec' + recid);
  var div = rec.find('.t-popup__container').height();
  var win = $(window).height();
  var popup = rec.find('.t-popup__container');
  if (div > win ) {
    popup.addClass('t-popup__container-static');
  } else {
    popup.removeClass('t-popup__container-static');
  }
}


/* deprecated */
function t868_sendPopupEventToStatistics(popupname) {
  var virtPage = '/tilda/popup/';
  var virtTitle = 'Popup: ';
  if (popupname.substring(0,7) == '#popup:') {
    popupname = popupname.substring(7);
  }

  virtPage += popupname;
  virtTitle += popupname;

  if(ga) {
    if (window.mainTracker != 'tilda') {
      ga('send', {'hitType':'pageview', 'page':virtPage, 'title':virtTitle});
    }
  }

  if (window.mainMetrika > '' && window[window.mainMetrika]) {
    window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
  }
}
 
function t875_init(recid) {
    if (document.layers) {document.captureEvents(Event.MOUSEDOWN);}
    document.onmousedown = t875_click;
    document.oncontextmenu = function(event) {
        var event = event || window.event;
        var sender = event.target || event.srcElement;
        if (sender && (sender.tagName.match(/INPUT|TEXTAREA/i) || sender.hasAttribute('contenteditable') || (sender.parentElement && sender.parentElement.hasAttribute('contenteditable')))) { return; } else { return false; }
    };
    t875_preventSelection(document);
    t875_preventUserSelect();
}


function t875_preventUserSelect() {
    $('body').css({
        '-ms-user-select': 'none',
        '-moz-user-select': 'none',
        '-webkit-user-select': 'none',
        'user-select': 'none',
        '-webkit-touch-callout': 'none'
    });
}

function t875_click(event) {
    t875_returnPrevent(event);

    if (document.all) {
        if (event.button == 2) {
            return false;
        }
    }
    if (document.layers) {
        if (event.which == 3) {
            return false;
        }
    }
}


function t875_preventSelection(element) {
    var preventSelection = false;

    t875_addHandler(element, 'mousemove', function () {
        if (preventSelection) {
            t875_removeSelection();
        }
    });

    t875_addHandler(element, 'mousedown', function (event) {
        var event = event || window.event;
        var sender = event.target || event.srcElement;
        preventSelection = sender && !sender.tagName.match(/INPUT|TEXTAREA/i) && !sender.hasAttribute('contenteditable') && (sender.parentElement && !sender.parentElement.hasAttribute('contenteditable'));
    });

    t875_addHandler(element, 'mouseup', function () {
        if (preventSelection) {
            t875_removeSelection();
        }
        preventSelection = false;
    });

    t875_addHandler(element, 'keydown', t875_killCtrlA);
    t875_addHandler(element, 'keyup', t875_killCtrlA);
    t875_addHandler(element, 'keydown', t875_killCtrlU);
    t875_addHandler(element, 'keyup', t875_killCtrlU);
    t875_addHandler(element, 'keydown', t875_killAltCmdI);
    t875_addHandler(element, 'keyup', t875_killAltCmdI);
    t875_addHandler(element, 'keydown', t875_killCtrlShiftI);
    t875_addHandler(element, 'keyup', t875_killCtrlShiftI);
}


function t875_addHandler(element, event, handler) {
    if (element.attachEvent) {
        element.attachEvent('on' + event, handler);
    } else if (element.addEventListener) {
        element.addEventListener(event, handler, false);
    }
}


function t875_removeSelection() {
    if (window.getSelection) {
        window.getSelection().removeAllRanges();
    } else if (document.selection && document.selection.clear) {
        document.selection.clear();
    }
}


function t875_killCtrlU(event) {
    t875_returnPrevent(event);

    var key = event.keyCode || event.which;
    if ((event.ctrlKey && key == 'U'.charCodeAt(0)) || (event.altKey && event.metaKey && (key == 'U'.charCodeAt(0) || key == 'u'.charCodeAt(0)))) {
        if (event.preventDefault) {
            event.preventDefault();
        } else {
            event.returnValue = false;
        }
    }
}


function t875_killAltCmdI(event) {
    t875_returnPrevent(event);

    var key = event.keyCode || event.which;
    if (event.altKey && event.metaKey && (key == 'I'.charCodeAt(0) || key == 'i'.charCodeAt(0))) {
        if (event.preventDefault) {
            event.preventDefault();
        } else {
            event.returnValue = false;
        }
    }
}


function t875_killCtrlShiftI(event) {
    t875_returnPrevent(event);

    var key = event.keyCode || event.which;
    if (event.shiftKey && event.ctrlKey && (key == 'I'.charCodeAt(0) || key == 'i'.charCodeAt(0))) {
        if (event.preventDefault) {
            event.preventDefault();
        } else {
            event.returnValue = false;
        }
    }
}


function t875_killCtrlA(event) {
    var event = event || window.event;
    var sender = event.target || event.srcElement;
    if (sender && (sender.tagName.match(/INPUT|TEXTAREA|BUTTON/i) || sender.hasAttribute('contenteditable') || (sender.parentElement && sender.parentElement.hasAttribute('contenteditable')))) { return; }

    var key = event.keyCode || event.which;
    if ((event.ctrlKey && key == 'A'.charCodeAt(0)) || (event.metaKey && key == 'A'.charCodeAt(0))) {
        t875_removeSelection();
        if (event.preventDefault) {
            event.preventDefault();
        } else {
            event.returnValue = false;
        }
    }
}


function t875_returnPrevent(event) {
    var event = event || window.event;
    var sender = event.target || event.srcElement;
    if (sender && (sender.tagName.match(/INPUT|TEXTAREA/i) || sender.hasAttribute('contenteditable') || (sender.parentElement && sender.parentElement.hasAttribute('contenteditable')))) { return; }
}
 
function t881_init(recid) {
	var rec = document.getElementById('rec' + recid);
	t881_addWebinar(rec);
	t881_setHeight(rec);
	
	window.addEventListener('scroll', t_throttle(function () {
		t881_addWebinar(rec);
	}, 200));
	
	window.addEventListener('resize', t_throttle(function () {
		t881_setHeight(rec);
	}, 200));
	
	if (typeof jQuery !== 'undefined') {
		$(rec).find('.t881').bind('displayChanged', function () {
			t881_setHeight(rec);
		});
	} else {
		var currentBlock = rec.querySelector('.t881');
		if (currentBlock) {
			currentBlock.addEventListener('displayChanged', function () {
				t881_setHeight(rec);
			});
		}
	}
}


function t881_addWebinar(rec) {
	var wrap = rec.querySelector('.t881__webinar-wrap');
	var player = rec.querySelector('.t881__webinar-player');
	var wrapperWebinarLoad = wrap ? wrap.getAttribute('data-webinar-load') : null;
	var scrollDiffHeigth = 100;
	var wrapperTopPos = wrap ? wrap.getBoundingClientRect().top : 0;
	var webinarId = wrap ? wrap.getAttribute('data-webinar-id') : null;
	
	if (wrapperTopPos - window.innerHeight - scrollDiffHeigth < 0 && player && wrap && wrapperWebinarLoad === 'false') {
		wrap.setAttribute('data-webinar-load', 'true');
		player.insertAdjacentHTML('afterbegin', '<iframe width="100%" height="100%" src="https://www.youtube.com/embed/' + webinarId +
			'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>');
	}
}


function t881_setHeight(rec) {
	var webinar = rec.querySelector('.t881__webinar-player');
	var comments = rec.querySelector('.t881__webinar-comments');
	var playerIframe = rec.querySelector('.t881__webinar-player iframe');
	var commentsIframe = rec.querySelector('.t881__webinar-comments iframe');
	var webinarHeight = webinar ? webinar.offsetWidth * 9 / 16 : 0;
	
	if (webinar) webinar.style.height = webinarHeight + 'px';
	if (playerIframe) playerIframe.style.height = webinarHeight + 'px';
	
	if (window.innerWidth > 640) {
		if (comments) comments.style.height = webinarHeight + 'px';
		if (commentsIframe) commentsIframe.style.height = webinarHeight + 'px';
	}
} 
function t886_init(recid) {
    var el = $('#rec' + recid);
    var block = el.find('.t886');
    var closeBtn = el.find('.t886__btn');
    var storageItem = block.attr('data-storage-item');
    var lastOpen = null;

    if (typeof localStorage === 'object') {
        try {
            lastOpen = localStorage.getItem(storageItem);
        } catch (e) {
            console.log('Your web browser does not support localStorage.');
        }
    }

    if (lastOpen == null) {
        block.removeClass('t886_closed');
    }

    closeBtn.click(function (e) {
        block.addClass('t886_closed');
        if (typeof localStorage === 'object') {
            try {
                localStorage.setItem(storageItem, Math.floor(Date.now() / 1000));
            } catch (e) {
                console.log('Your web browser does not support localStorage.');
            }
        }
        e.preventDefault();
    });
} 
function t887_init(recid) {
    var el = $('#rec' + recid);
    var block = el.find('.t887');
    var closeIcon = el.find('.t887__icon-close');
    var storageItem = block.attr("data-storage-item");
    var lastOpen = null;
    
    if (typeof localStorage === 'object') {
    	try {
    		lastOpen = localStorage.getItem(storageItem);
    	} catch (e) {
    		console.log('Your web browser does not support localStorage.');
    	}
    }

    if (lastOpen == null) {
        block.removeClass('t887_closed');
    }

    closeIcon.click(function (e) {
        block.addClass('t887_closed');
        if (typeof localStorage === 'object') {
        	try {
        		localStorage.setItem(storageItem, Math.floor(Date.now() / 1000));
        	} catch (e) {
        		console.log('Your web browser does not support localStorage.');
        	}
        }
        e.preventDefault();
    });
} 
function t889_init(recId) {
    var rec = document.getElementById('rec' + recId);
    var container = rec.querySelector('.t889');

    t889_setHeight(recId);

    window.addEventListener('resize', t_throttle(function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        t889_setHeight(recId);
    }));

    /* TODO: jq event */
    $(container).on('displayChanged', function() {
        t889_setHeight(recId);
    });

    /* container.addEventListener('displayChanged', function() {
        t889_setHeight(recId);
    }); */

    if (window.isMobile) {
        window.addEventListener('orientationchange', function() {
            t889_setHeight(recId);
        });
    }
}

function t889_setHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t889');
    if (!container) return;
    var wrapper = rec.querySelector('.t889__wrapper');
    var imageWrap = rec.querySelector('.t889__blockimg');
    var image = imageWrap.querySelector('img');
    var content = rec.querySelector('.t889__content');
    var textWrapperHeight = t889_outerHeight(content);
    var newImage = new Image();
    var imageSrc = image.getAttribute('data-original') || image.getAttribute('src');

    newImage.src = imageSrc;
    
    newImage.addEventListener('load', function() {
        if (window.innerWidth > 960) {
            var imageStyle = getComputedStyle(imageWrap, null);
            var imagePaddingTop = parseInt(imageStyle.paddingTop) || 0;
            var imagePaddingBottom = parseInt(imageStyle.paddingBottom) || 0;
            var imageHeight = image.clientHeight - (imagePaddingTop + imagePaddingBottom);

            if (textWrapperHeight >= imageHeight) {
                wrapper.style.height = textWrapperHeight + 'px';
            } else {
                wrapper.style.height = imageHeight + 'px';
            }
        } else {
            wrapper.style.height = null;
        }
    });
}

function t889_outerHeight(element) {
    if (!element) return;
    var height = element.offsetHeight;
    var style = getComputedStyle(element);
  
    height += parseInt(style.marginTop) + parseInt(style.marginBottom);
    return height;
} 
function t890_init(recId, offset) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t890');
    if (!container) return;

    var button = rec.querySelector('.t890__arrow');
    var windowOffset = '';

    if (offset) {
        windowOffset = offset;
    } else {
        windowOffset = window.innerHeight;
    }

    rec.setAttribute('data-animationappear', 'off');
    rec.style.opacity = 1;

    window.addEventListener('scroll', t_throttle(function() {
        if (window.pageYOffset > windowOffset) {
            container.style.display = 'block';
        } else {
            t890__fadeOut(container);
        }
    }, 200));

    button.addEventListener('click', t890__scrollToTop);
}

function t890__fadeOut(el) {
    if (el.style.display === 'none') return;

    var opacity = 1;
    var timer = setInterval(function () {
        el.style.opacity = opacity;
        opacity -= 0.1;
        if (opacity <= 0.1) {
            clearInterval(timer);
            el.style.display = 'none';
            el.style.opacity = null;
        }
    }, 20);
}

function t890__scrollToTop() {
    var duration = 700;
    var start = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
    var change = 0 - start;
    var currentTime = 0;
    var increment = 16; /* same amount of milliseconds as requestAnimationFrame */

    document.body.setAttribute('data-scrollable', 'true');

    /* easeInOutCubic animation included in the library */
    function t890__easeInOutCubic(currentTime) {
        if ((currentTime /= duration / 2) < 1) {
            return change / 2 * currentTime * currentTime * currentTime + start;
        } else {
            return change / 2 * ((currentTime -= 2) * currentTime * currentTime + 2) + start;
        }
    }

    function t890__animateScroll() {
        currentTime += increment;

        window.scrollTo(0, t890__easeInOutCubic(currentTime));

        if (currentTime < duration) {
            setTimeout(t890__animateScroll, increment);
        } else {
            document.body.removeAttribute('data-scrollable');
        }
    }

    t890__animateScroll();
} 
function t898_init(recid) {
    var rec = $('#rec' + recid);
    rec.attr('data-animationappear', 'off');
    rec.css('opacity', '1');
    
    var whatsAppElement = rec.find('.t898__icon-whatsapp_wrapper');
    var whatsAppHref = whatsAppElement.attr('href');
    if (typeof whatsAppHref !== 'undefined') {
        t898_removeExtraSymbolsFromWhatsApp(rec, whatsAppElement, whatsAppHref);
    }
    
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
}


function t898_removeExtraSymbolsFromWhatsApp(rec, whatsAppElement, whatsAppHref) {
    if (whatsAppHref && whatsAppHref.indexOf('?text=') !== -1) {
        var whatsAppHrefArr = whatsAppHref.split('?text=');
        whatsAppHrefArr[0] = whatsAppHrefArr[0].replace(/[\(\)+-]/g, '');
        whatsAppHref = whatsAppHrefArr[0] + '?text=' + whatsAppHrefArr[1];
    } else {
        whatsAppHref = whatsAppHref.replace(/[\(\)+-]/, '');
    }
    
    whatsAppElement.attr('href', whatsAppHref);
}
 
function t899_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t899');
    if (!container) return;

    t899_setMinHeight(recId);

    window.addEventListener('resize', t_throttle(function() {
        if (window.noAdaptive && window.noAdaptive === true && window.isMobile) return;
        t899_setMinHeight(recId);
    }));

    /* TODO: jq event */
    $(container).bind('displayChanged', function() {
        t899_setMinHeight(recId);
    });

    /*container.addEventListener('displayChanged', function() {
        t899_setMinHeight(recId);
    });*/

    if (window.isMobile) {
        /* TODO: jq event */
        $(window).on('orientationchange', function () {
            t899_setMinHeight(recId);
        });

       /* window.addEventListener('orientationchange', function () {
            t899_setMinHeight(recId);
        });*/
    }
}

function t899_setMinHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t899');
    if (!container) return;
    var wrappers = rec.querySelectorAll('.t899__wrapper');

    for (var i = 0; i < wrappers.length; i++) {
        var wrapper = wrappers[i];
        var wrapperHeight = wrapper.offsetHeight;
        var symbol = wrapper.querySelector('.t899__symbol');
        var symbolHeight = symbol ? symbol.offsetHeight : 0;

        if (symbolHeight > wrapperHeight) {
            wrapper.style.minHeight = symbolHeight + 'px';
        }
    }
} 
function t902_init(recid) {
    var el = $('#rec' + recid);

    t902_unifyHeights(recid);

    $(window).bind('resize', t_throttle(function () {
        t902_unifyHeights(recid);
    }));

    el.find('.t902').bind('displayChanged', function () {
        t902_unifyHeights(recid);
    });
}

function t902_unifyHeights(recid) {
    var el = $('#rec' + recid);
    var wrappers = el.find('.t902__wrap');

    if ($(window).width() > 960) {
        el.find('.t902__row').each(function (i, row) {
            var highestBox = 0;
            $(row).find('.t902__inner-col').each(function (i, col) {
                var wrapper = $(col).find('.t902__wrap');

                var colHeight = wrapper.outerHeight();
                if (colHeight > highestBox) {
                    highestBox = colHeight;
                }
            });
            if (highestBox > 0) {
                $('.t902__inner-col', this).css('height', highestBox);
                $('.t902__bgimg', this).css('height', highestBox);
            }
        });
    } else {
        $('.t902__inner-col').css('height', 'auto');
        $('.t902__bgimg').css('height', 'auto');
    }
    
    wrappers.each(function(i, wrapper) {
        var wrapperHeight = $(wrapper).outerHeight();
        var content = $(wrapper).find('.t902__content');
        var contentHeight = content.outerHeight();
        if (wrapperHeight < contentHeight) {
            $(wrapper).css('min-height', contentHeight + 'px')
        }
    });
}
 
function t905_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t905');
    if (!container) return;

    t905_unifyHeights(recId);

    window.addEventListener('resize', function() {
        t905_unifyHeights(recId);
    });

    window.addEventListener('load', function() {
        t905_unifyHeights(recId);
    });

    /* TODO: jq event */
    $(container).on('displayChanged', function () {
        t905_unifyHeights(recId);
    });

    /*container.addEventListener('displayChanged', function() {
        t905_unifyHeights(recId);
    });*/
}

function t905_unifyHeights(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t905');
    if (!container) return;
    var cards = rec.querySelectorAll('.t905__card');

    for (var i = 0; i < cards.length; i++) {
        var card = cards[i];
        var image = card.querySelector('.t905__image');
        var imageHeight = image.offsetHeight;
        var content = card.querySelector('.t905__content');
        var contentHeight = content.offsetHeight;

        if (contentHeight > imageHeight) {
            image.style.height = contentHeight + 'px';
            image.style.paddingBottom = 'initial';
        }
    }
} 
window.t906showvideo = function (recid) {
	if (document.readyState !== 'loading') {
		t906_showVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t906_showVideo(recid);
		});
	}
	
	function t906_showVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t906__video-container');
		var videoCover = rec.querySelector('.t906__cover');
		var videoCarrier = rec.querySelector('.t906__video-carier');
		
		var youTubeID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
		var videoURL = youTubeID ? 'https://www.youtube.com/embed/' + youTubeID : '';
		
		document.body.classList.add('t906__overflow');
		if (videoCover) videoCover.classList.add('t906__hidden');
		if (videoContainer) videoContainer.classList.remove('t906__hidden');
		
		if (videoCarrier) {
			videoCarrier.innerHTML = '<iframe id="youtubeiframe' + recid + '" class="t906__iframe" width="100%" height="540" src="' +
				videoURL +
				'?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe><a class="t906__close-link" href="javascript:t906hidevideo(\'' +
				recid + '\');"><div class="t906__close"></div></a>';
		}
	}
};

window.t906hidevideo = function (recid) {
	if (document.readyState !== 'loading') {
		t906_hideVideo(recid);
	} else {
		document.addEventListener('DOMContentLoaded', function () {
			t906_hideVideo(recid);
		});
	}
	
	function t906_hideVideo(recid) {
		var rec = document.getElementById('rec' + recid);
		if (!rec) return;
		var videoContainer = rec.querySelector('.t906__video-container');
		var videoCover = rec.querySelector('.t906__cover');
		var videoCarrier = rec.querySelector('.t906__video-carier');
		
		document.body.classList.remove('t906__overflow');
		if (videoCover) videoCover.classList.remove('t906__hidden');
		if (videoContainer) videoContainer.classList.add('t906__hidden');
		if (videoCarrier) videoCarrier.innerHTML = '<div class="t906__video-bg2"></div>';
	}
}; 
function t908_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t908');
    if (!container) return;
    var items = rec.querySelectorAll('.t908__item');
    var imageContainers = rec.querySelectorAll('.t908__box-img');
    
    if (items && items.length > 0) {
        items[0].classList.add('t908__item_active');
    }
    if (imageContainers && imageContainers.length > 0) {
        imageContainers[0].classList.add('t908__box-img_active');
    }

    t908_changeActiveTab(items, imageContainers);
}

function t908_changeActiveTab(items, imageContainers) {
    var allRecords = document.getElementById('allrecords');
    var mode = allRecords.getAttribute('data-tilda-mode');
    var isLazy = allRecords.getAttribute('data-tilda-lazy');
    var currentTab = '0';

    for (var i = 0; i < items.length; i++) {
        items[i].addEventListener('click', function() {
            var item = this;

            currentTab = item.getAttribute('data-item-number');

            for (var j = 0; j < items.length; j++) {
                items[j].classList.remove('t908__item_active');
            }

            for (var j = 0; j < imageContainers.length; j++) {
                imageContainers[j].classList.remove('t908__box-img_active');
            }

            item.classList.add('t908__item_active');

            for (var j = 0; j < imageContainers.length; j++) {
                var imageContainer = imageContainers[j];

                if (imageContainer.getAttribute('data-item-content-number') === currentTab) {
                    imageContainer.classList.add('t908__box-img_active');
                }
            }

            if (!mode) {
                if (window.lazy === 'y' || isLazy === 'yes') {
                    t_onFuncLoad('t_lazyload_update', function () {
                        t_lazyload_update();
                    });
                }
            }
        });
    }
} 
function t911_init(recid) {
  t911_checkPhoneNumber(recid);
}

function t911_checkPhoneNumber(recid) {
  var el = $('#rec' + recid);
  var whatsapp = el.find('.t911__whatsapp').attr('data-messenger-whatsapp');
  var telegram = el.find('.t911__telegram').attr('data-messenger-telegram');
  var telegramLink = el
    .find('.t911__telegram_link')
    .attr('data-messenger-telegram-link');
  var vk = el.find('.t911__vk').attr('data-messenger-vk');
  var skype = el.find('.t911__skype').attr('data-messenger-skype');
  var skypeChat = el
    .find('.t911__skype_chat')
    .attr('data-messenger-skype-chat');
  var mail = el.find('.t911__mail').attr('data-messenger-mail');
  var viber = el.find('.t911__viber').attr('data-messenger-viber');
  var fb = el.find('.t911__fb').attr('data-messenger-fb');
  var phone = el.find('.t911__phone').attr('data-messenger-phone');

  if (typeof telegramLink != 'undefined') {
    if (telegramLink.search(/http/i) !== -1) {
      el.find('.t911__telegram_link').attr('href', telegramLink);
    } else {
      if (telegramLink.search(/tg/i) !== -1) {
        el.find('.t911__telegram_link').attr('href', telegramLink);
      } else {
        el.find('.t911__telegram_link').attr('href', 'https://' + telegramLink);
      }
    }
  }

  if (typeof whatsapp != 'undefined') {
    el.find('.t911__whatsapp').attr(
      'href',
      'https://api.whatsapp.com/send?phone=' +
        whatsapp.replace(/[+?^${}()|[\]\\\s]/g, '')
    );
  }

  el.find('.t911__telegram').attr('href', 'https://t.me/' + telegram);
  el.find('.t911__vk').attr('href', 'https://vk.me/' + vk);

  if (typeof skype != 'undefined') {
    el.find('.t911__skype').attr(
      'href',
      'skype:' + skype.replace(/[+?^${}()|[\]\\\s]/g, '') + '?call'
    );
  }

  if (typeof skypeChat != 'undefined') {
    el.find('.t911__skype_chat').attr(
      'href',
      'skype:' + skypeChat.replace(/[+?^${}()|[\]\\\s]/g, '') + '?chat'
    );
  }

  if (typeof viber != 'undefined') {
    el.find('.t911__viber').attr(
      'href',
      'viber://chat?number=%2B' + viber.replace(/[+?^${}()|[\]\\\s]/g, '')
    );
  }

  el.find('.t911__mail').attr('href', 'mailto:' + mail);

  el.find('.t911__fb').attr('href', 'https://m.me/' + fb);

  if (typeof phone != 'undefined') {
    el.find('.t911__phone').attr(
      'href',
      'tel:+' + phone.replace(/[+?^${}()|[\]\\\s]/g, '')
    );
  }
}
 
function t912_init(recid) {
    var el = $("#rec" + recid);

    t912_setHeight(recid);

    $(window).bind("resize", t_throttle(function () {
        if (typeof window.noAdaptive !== "undefined" && window.noAdaptive === true && window.isMobile) { return; }
        t912_setHeight(recid);
    }));

    el.find(".t912").bind("displayChanged", function () {
        t912_setHeight(recid);
    });

    if (window.isMobile) {
        $(window).on("orientationchange", function () {
            t912_setHeight(recid);
        });
    }
}

function t912_setHeight(recid) {
    var el = $("#rec" + recid);
    var imgWrapper = el.find(".t912__imgwrapper");
    $(imgWrapper).each(function(i, el) {
    	var img = new Image();
        var imgSrc = $(el).find("img").data("original") || $(el).find("img").attr("src");
        $(img).attr("src", imgSrc);
        $(img).load(function() {
            var width = $(el).width();
            var height = img.height;
            if(img.width > width) {
                height = img.height*(width/img.width);
            } else {
                $(el).find("img").width(width);
                height = img.height*(width/img.width);
            }
            $(el).css("padding-bottom", height);
        });
    });
}
 
function t922_init(recid){
  setTimeout(function(){
    $('#rec'+recid+' .t-cover__carrier').addClass('js-product-img');
    t_onFuncLoad('t_prod__init', function () {
        t_prod__init(recid);
    });
  }, 500);

  $('body').trigger('twishlist_addbtn');
} 
function t923_init(recid) {
    var el = $('#rec' + recid);

    t923_unifyHeights(recid);

    $(window).on('resize', t_throttle(function () {
        t923_unifyHeights(recid);
    }));

    el.find(".t923").on("displayChanged", function () {
        t923_unifyHeights(recid);
    });

    $(window).on('load', function () {
        t923_unifyHeights(recid);
    });
}

function t923_unifyHeights(recid) {
    var el = $('#rec' + recid);
    var cols = el.find(".t923__content");

    var maxHeight = 0;

    cols.each(function () {
        var text = $(this).find(".t923__textwrapper");
        var btns = $(this).find(".t923__btn-wrapper, .t923__btntext-wrapper");
        var itemHeight = text.outerHeight() + btns.outerHeight();

        if (itemHeight > maxHeight) {
            maxHeight = itemHeight;
        }
    });

    cols.each(function (i, el) {
        var height = $(el).css("height");
        if (height !== maxHeight + 'px') {
            $(el).css("height", maxHeight);
        }
    });

    t_onFuncLoad('t_slds_updateSlider', function () {
        t_slds_updateSlider(recid);
    });
}
 
function t937_init(recid, styles) {
	var rec = document.getElementById('rec' + recid);
	var playlist = rec.querySelector('.t937__playlist-wrap');
	var videoColumn = rec.querySelector('.t937__col_video');
	var videoData = t937_parseData(recid);
	var params = t937_getUrlParametrs(recid);
	var activeVideoId = params.activeVideoId;
	
	t937_setSizes(recid, styles);
	t937_renderVideoCount(videoData, recid, styles);
	t937_renderPlaylist(videoData, activeVideoId, recid, styles);
	t937_renderVideoFrame(videoData, activeVideoId, recid, styles);
	if (videoColumn) videoColumn.style.height = '';
	if (playlist) playlist.style.visibility = 'visible';
	t937_addEvents(recid, styles);
}

function t937_getUrlParametrs(recid) {
	var activeRecId;
	var activeVideoId;
	var hash = window.location.hash;
	
	if (hash && hash.indexOf('#tlection=') === -1) {
		activeRecId = recid;
		activeVideoId = 1;
	} else {
		var params = hash.replace('#tlection=', '').split('_');
		activeRecId = params[0];
		activeVideoId = +recid === +activeRecId ? params[1] : 1;
	}
	
	return {
		activeRecId: activeRecId,
		activeVideoId: activeVideoId,
	};
}

function t937_parseData(recid) {
	var rec = document.getElementById('rec' + recid);
	var recData = rec ? rec.querySelector('.t937__data') : null;
	var data = recData ? recData.innerHTML : '';
	var videos = [];
	
	if (data) {
		data = data.replace(/&amp;/gi, '&');
		var segments = data.split('\n');
		
		for (var i = 0; i < segments.length; i++) {
			/* url; title; time; description */
			var segment = segments[i];
			var parts = segment.split(';');
			var video = t937_getVideoData(parts);
			if (video.url || video.section) {
				videos.push(video);
			}
		}
	}
	return videos;
}

function t937_getVideoData(data) {
	/* If string contains '[...]', return as not a video data but section */
	var first = data[0].trim();
	if (first.indexOf('[') === 0 && first.indexOf(']') === first.length - 1) {
		return {
			section: first.slice(1, -1),
		};
	}
	
	var url = data[0] && data[0].length ? data[0].trim() : null;
	var title = data[1] ? data[1].trim() : null;
	var time = data[2] ? data[2].trim() : null;
	var description = data[3] ? data[3].trim() : null;
	var type = null;
	if (/youtube.com|youtu.be/gi.test(url)) {
		type = 'youtube';
	}
	if (/vimeo.com/gi.test(url)) {
		type = 'vimeo';
	}
	
	return {
		url: url,
		title: title,
		time: time,
		description: description,
		type: type,
	};
}

function t937_renderPlaylist(videoData, activeVideoId, recid, styles) {
	var rec = document.getElementById('rec' + recid);
	var container = rec.querySelector('.t937__playlist');
	if (container) container.dataVideoContent = videoData;
	if (container) container.dataPlaylistStyles = styles;
	var videoCount = 1;
	t937_setSizes(recid, styles);
	
	if (container) container.innerHTML = '';
	
	/* Define styles */
	var mainColor = styles.mainColor.length ? 'color: ' + styles.mainColor + ';' : '';
	var secondaryColor = styles.secondaryColor.length ? 'color: ' + styles.secondaryColor + ';' : '';
	var border = styles.borderColor.length ? 'border-bottom: 1px solid ' + styles.borderColor + ';' : '';
	
	t937_renderFade(recid, styles.bgColor);
	
	for (var i = 0; i < videoData.length; i++) {
		var data = videoData[i];
		var id = i + 1;
		var isActive = Number(id) === Number(activeVideoId);
		var item;
		
		if (Object.prototype.hasOwnProperty.call(data, 'section')) {
			item = document.createElement('div');
			item.classList.add('t937__playlist-item', 't937__playlist-item_section');
			item.setAttribute('style', border);
			var itemChild = document.createElement('div');
			itemChild.classList.add('t937__playlist-section', 't-name', 't-name_xs');
			itemChild.setAttribute('style', mainColor);
			itemChild.textContent = data.section;
			item.insertAdjacentElement('beforeend', itemChild);
		} else {
			var title = data.title && data.title.length ? data.title : t937_translate('videoTitle');
			var time = data.time ? data.time : '';
			var linkBgColor = isActive && styles.linkBgColor.length ? 'background-color: ' + styles.linkBgColor + ';' : '';
			
			item = document.createElement('div');
			item.classList.add('t937__playlist-item');
			item.setAttribute('data-video-id', id.toString());
			item.setAttribute('style', border);
			item.setAttribute('onclick', 'window.t937_onVideoClick('+id+', ' +recid+ ')');
			
			var playlistLink = document.createElement('div');
			if (isActive) {
				playlistLink.classList.add('t937__playlist-link', 't-text', 't-text_xs', 't937__playlist-link_active');
			} else {
				playlistLink.classList.add('t937__playlist-link', 't-text', 't-text_xs');
			}
			playlistLink.setAttribute('style', linkBgColor);
			
			var playlistNumber = document.createElement('div');
			playlistNumber.classList.add('t937__playlist-number');
			playlistNumber.setAttribute('style', secondaryColor);
			playlistNumber.textContent = videoCount.toString();
			
			var playlistTitle = document.createElement('div');
			playlistTitle.classList.add('t937__playlist-title');
			playlistTitle.setAttribute('style', mainColor);
			playlistTitle.textContent = title;
			
			var playlistTime = document.createElement('div');
			playlistTime.classList.add('t937__playlist-time');
			playlistTime.setAttribute('style', secondaryColor);
			playlistTime.textContent = time;
			
			playlistLink.insertAdjacentElement('beforeend', playlistNumber);
			playlistLink.insertAdjacentElement('beforeend', playlistTitle);
			playlistLink.insertAdjacentElement('beforeend', playlistTime);
			item.insertAdjacentElement('beforeend', playlistLink);
			
			item.addEventListener('mousemove', function (e) {
				var currentItem = e.target.closest('.t937__playlist-item');
				currentItem.style.backgroundColor = styles.linkBgColor.length ? styles.linkBgColor : '#F0F0F0';
			});
			
			item.addEventListener('mouseout', function (e) {
				var currentItem = e.target.closest('.t937__playlist-item');
				currentItem.style.backgroundColor = '';
			});
			
			videoCount++;
		}
		if (container) container.insertAdjacentElement('beforeend', item);
	}
}

function t937_renderVideoFrame(data, activeVideoId, recid) {
	var rec = document.getElementById('rec' + recid);
	var frame;
	var video;
	var container = rec ? rec.querySelector('.t937__video') : null;
	var height = container ? container.offsetWidth * 0.5625 : 0;
	if (container) container.classList.remove('t937__video_empty');
	var id;
	
	/* check that data[activeVideoId] is video, not a section */
	for (var i = activeVideoId - 1; i < data.length; i++) {
		if (data[i].url) {
			video = data[i];
			t937_renderDescription(video, recid);
			break;
		}
	}
	
	if (!data.length || !video || !video.type) {
		if (container) container.classList.add('t937__video_empty');
		frame = document.createElement('div');
		frame.classList.add('t937__system-message');
		frame.textContent = !data.length ? t937_translate('noData') : t937_translate('wrongFormat');
	} else if (video.type === 'youtube') {
		var regex = /youtu(?:.*\/v\/|.*v\=|\.be\/)([A-Za-z0-9_\-]{11})/;
		id = video.url.match(regex);
		if (id !== null) {
			id = id[1];
		}
		
		frame = document.createElement('iframe');
		frame.classList.add('t937__video-frame', 't937__video-frame_youtube');
		frame.width = '100%';
		frame.height = height.toString();
		frame.src = 'https://www.youtube.com/embed/' + id + '?rel=0&fmt=18&html5=1&enablejsapi=1';
		frame.frameBorder = '0';
		frame.setAttribute('allow', 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture');
		frame.setAttribute('allowfullscreen', '');
	} else if (video.type === 'vimeo') {
		var idMatch = /vimeo[^/]*\/(\d+)\/?(\w*)\/?/i.exec(video.url);
		id = idMatch ? idMatch[1] : null;
		var hash = idMatch ? '?h=' + idMatch[2] : null;
		var timecodeMatch = /#t=(\d*h)?(\d*m)?\d*s$/i.exec(video.url);
		var timecode = timecodeMatch ? '/' + timecodeMatch[0] : '';
		if (!id) {
			if (container) container.classList.add('t937__video_empty');
			frame = document.createElement('div');
			frame.classList.add('t937__system-message');
			frame.textContent = t937_translate('wrongFormat');
		} else {
			frame = document.createElement('iframe');
			frame.classList.add('t937__video-frame', 't937__video-frame_vimeo');
			frame.title = 'vimeo-player';
			frame.width = '100%';
			frame.height = height.toString();
			frame.src = 'https://player.vimeo.com/video/' + id + hash + timecode;
			frame.frameBorder = '0';
			frame.setAttribute('allowfullscreen', '');
		}
	}
	if (container) {
		container.innerHTML = '';
		container.insertAdjacentElement('beforeend', frame);
	}
}

function t937_renderDescription(videoData, recid) {
	var rec = document.getElementById('rec' + recid);
	var wrapper = rec ? rec.querySelector('.t937__col_description') : null;
	var titleContainer = wrapper ? wrapper.querySelector('.t937__video-title') : null;
	var descriptionContainer = wrapper ? wrapper.querySelector('.t937__video-description') : null;
	
	if (wrapper) wrapper.classList.add('t937__col_hidden');
	if (titleContainer) titleContainer.innerHTML = '';
	if (descriptionContainer) descriptionContainer.innerHTML = '';
	
	if (!videoData.description) return;
	
	if (wrapper) wrapper.classList.remove('t937__col_hidden');
	var title = videoData.title && videoData.title.length ? videoData.title : t937_translate('videoTitle');
	var descriptionContent = t937_parseDescription(videoData.description);
	
	titleContainer.textContent = title;
	Array.prototype.forEach.call(descriptionContent, function (content) {
		if (descriptionContainer) descriptionContainer.insertAdjacentElement('beforeend', content);
	});
	
}

function t937_renderVideoCount(data, recid, styles) {
	var rec = document.getElementById('rec' + recid);
	var subheading = rec ? rec.querySelector('.t937__subheading-title') : null;
	var icon = rec ? rec.querySelector('.t937__subheading-icon') : null;
	var size = 0;
	var color = styles.secondaryColor.length ? styles.secondaryColor.replace('#', '%23') : '%23111111';
	
	if (icon) icon.style.backgroundImage = 'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 16 16\' width=\'16\' height=\'16\'%3E%3Ctitle%3Evideo playlist%3C/title%3E%3Cg class=\'nc-icon-wrapper\' stroke-width=\'1\' fill=' +
		'\'' + color + '\'' + ' stroke=' + '\'' + color + '\'' +
		'%3E%3Crect x=\'0.5\' y=\'2.5\' width=\'15\' height=\'12\' rx=\'1\' fill=\'none\' stroke=' + '\'' + color + '\'' +
		' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3Cpolygon points=\'6.5 5.5 11.5 8.5 6.5 11.5 6.5 5.5\' fill=\'none\' stroke-linecap=\'round\' stroke-linejoin=\'round\' data-color=\'color-2\'/%3E%3Cline x1=\'3.5\' y1=\'0.5\' x2=\'12.5\' y2=\'0.5\' fill=\'none\' stroke=' +
		'\'' + color + '\'' + ' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3E%3C/g%3E%3C/svg%3E\"';
	
	for (var item in data) {
		if (!data[item].section) {
			size++;
		}
	}
	var videoPart = t937_translate('videoPart');
	if (subheading) subheading.textContent = size + ' ' + videoPart;
}

function t937_renderFade(recid, color) {
	color = color.length ? color : '#ffffff';
	var rec = document.getElementById('rec' + recid);
	var playlistFade = rec ? rec.querySelector('.t937__playlist-fade') : null;
	var colorFrom = t937_hex2rgb(color, 0);
	var colorTo = t937_hex2rgb(color, 1);
	if (playlistFade) playlistFade.style.backgroundImage = 'linear-gradient(' + colorFrom + ' 0%, ' + colorTo + ' 90%)';
}

function t937_parseDescription(string) {
	var result = [];
	var parts = string.split('<br>');
	var res;
	
	parts.forEach(function (part) {
		if (!part.length) {
			res = document.createElement('br');
			result.push(res);
		} else {
			res = document.createElement('p');
			res.classList.add('t937__paragraph');
			res.innerHTML = part;
			result.push(res);
		}
	});
	return result;
}

function t937_setSizes(recid, styles) {
	var rec = document.getElementById('rec' + recid);
	var playlistWrapper = rec ? rec.querySelector('.t937__playlist-wrap') : null;
	var iframe = rec ? rec.querySelector('.t937__video-frame') : null;
	var playlistCol = rec ? rec.querySelector('.t937__col_playlist') : null;
	var description = rec ? rec.querySelector('.t937__description') : null;
	var videoCol = rec ? rec.querySelector('.t937__video') : null;
	var videoColWidth = videoCol ? videoCol.offsetWidth : 0;
	
	/* Set 9:16 player sides */
	var height = videoColWidth * 0.5625;
	if (iframe) iframe.setAttribute('height', height.toString());
	
	if (window.innerWidth >= 960) {
		if (description) description.style.width = videoColWidth + 'px';
		if (playlistWrapper) playlistWrapper.style.height = height + 'px';
		if (playlistWrapper) playlistWrapper.style.maxHeight = '';
		
		if (styles.playlistWidth.length) {
			if (playlistCol) playlistCol.style.width = parseInt(styles.playlistWidth, 10) + 'px';
		}
	} else {
		if (playlistWrapper) playlistWrapper.style.maxHeight = height + 'px';
		if (playlistWrapper) playlistWrapper.style.height = '';
		if (playlistCol) playlistCol.style.width = '';
		if (description) description.style.width = '';
	}
}

function t937_translate(keyword) {
	var dict = [];
	
	dict['videoTitle'] = {
		RU: 'Без названия',
		EN: 'Untitled video',
		FR: 'Vidéo sans titre',
		DE: 'Video ohne Titel',
		ES: 'Video sin título',
		PT: 'Bez tytułu wideo',
		UK: 'Відео без назви',
		JA: '無題の動画',
		ZH: '无标题的视频',
		PL: 'Bez tytułu',
	};
	
	dict['videoPart'] = {
		RU: 'видео',
		EN: 'videos',
		FR: 'vidéos',
		DE: 'videos',
		ES: 'videos',
		PT: 'filmy',
		UK: 'відео',
		JA: 'ビデオ',
		ZH: '影片',
		PL: 'video',
	};
	
	dict['noData'] = {
		RU: 'Пожалуйста, добавьте хотя бы одно видео в плейлист',
		EN: 'Please add at least one video to the playlist',
		UK: 'Будь ласка, додайте хоча б одне відео в плейлист',
		PL: 'Proszę dodać jeden filmik do listy',
	};
	
	dict['wrongFormat'] = {
		RU: 'Пожалуйста, проверьте корректность заполненных данных',
		EN: 'Please check that the data is filled in correctly',
		UK: 'Будь ласка, перевірте коректність заповнених даних',
		PL: 'Sprawdź poprawność danych',
	};
	
	var lang = window.browserLang;
	
	if (dict[keyword] !== undefined) {
		if (dict[keyword][lang] !== undefined && dict[keyword][lang] !== '') {
			return dict[keyword][lang];
		} else {
			return dict[keyword]['EN'];
		}
	}
	return 'Text not found #' + keyword;
}

function t937_hex2rgb(hex, opacity) {
	var h = hex.replace('#', '');
	h = h.match(new RegExp('(.{' + h.length / 3 + '})', 'g'));
	
	for (var i = 0; i < h.length; i++) {
		h[i] = parseInt(h[i].length === 1 ? h[i] + h[i] : h[i], 16);
	}
	
	if (typeof opacity != 'undefined') {
		h.push(opacity);
	}
	
	return 'rgba(' + h.join(',') + ')';
}

function t937_addEvents(recid, styles) {
	window.addEventListener('resize', t_throttle(function () {
		t937_setSizes(recid, styles);
	}));
	
	if (typeof jQuery !== 'undefined') {
		$('.t937').bind('displayChanged', function () {
			t937_setSizes(recid, styles);
		});
	} else {
		var currentBlocks = document.querySelectorAll('.t937');
		Array.prototype.forEach.call(currentBlocks, function (block) {
			block.addEventListener('displayChanged', function () {
				t937_setSizes(recid, styles);
			});
		});
	}
	
	/* Render/Remove playlist borrom fade */
	var rec = document.getElementById('rec' + recid);
	var playlistWrap = rec ? rec.querySelector('.t937__playlist-wrap') : null;
	var playlistFade = rec ? rec.querySelector('.t937__playlist-fade') : null;
	
	if (playlistWrap) {
		playlistWrap.addEventListener('scroll', function () {
			var currentHeight = playlistWrap.offsetHeight;
			var scrollTop = playlistWrap.scrollTop;
			var scrollHeight = playlistWrap.scrollHeight;
			var marginBottom = 30;
			if (currentHeight + scrollTop >= scrollHeight - marginBottom) {
				if (playlistFade) playlistFade.style.backgroundImage = '';
			} else {
				t937_renderFade(recid, styles.bgColor);
			}
		});
	}
}

function t937_onVideoClick(id, recid) {
	var rec = document.getElementById('rec' + recid);
	var container = rec ? rec.querySelector('.t937__playlist') : null;
	var videoData = container ? container.dataVideoContent : null;
	var styles = container ? container.dataPlaylistStyles : null;
	window.location.hash = 'tlection=' + recid + '_' + id;
	
	t937_renderPlaylist(videoData, id, recid, styles);
	t937_renderVideoFrame(videoData, id, recid, styles);
	t937_playVideo(recid);
}

function t937_playVideo(recid) {
	var rec = document.getElementById('rec' + recid);
	var videoFrame = rec ? rec.querySelector('.t937__video-frame') : null;
	if (videoFrame && videoFrame.classList.contains('t937__video-frame_youtube')) {
		videoFrame.addEventListener('load', function () {
			var command = 'playVideo';
			videoFrame.contentWindow.postMessage('{"event":"command","func":"' + command + '","args":""}', '*');
		});
	}
} 
function t938_init(recId, margin) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t938');
    if (!container) return;

    t938_setImageHeight(rec, margin);

    window.addEventListener('resize', t_throttle(function() {
        t938_setImageHeight(rec, margin);
    }));

    /* TODO: jq event */
    $(container).bind('displayChanged', function() {
        t938_setImageHeight(rec, margin);
    });

    /*container.addEventListener('displayChanged', function() {
        t938_setImageHeight(rec, margin);
    });*/
}

function t938_setImageHeight(rec, margin) {
    if (!rec) return;
    var container = rec.querySelector('.t938');
    if (!container) return;
    var image = rec.querySelector('.t938__background-image');

    if (window.innerWidth <= 960) {
        image.style.height = null;
        image.style.width = null;
    } else {
        image.style.height = 'calc(100% + ' + margin + 'px)';
    }

    image.style.visibility = null;
} 
function t943_init(recId, previewMode) {
    t943_showButton(recId, previewMode);
    window.addEventListener('scroll', t_throttle(function() {
        t943_showButton(recId, previewMode);
    }, 200));
}

function t943_showButton(recId, previewMode) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var button = rec.querySelector('.t943__btn');
    if (!button) return;

    var body = document.body;
    var html = document.documentElement;
    var windowWidth = window.innerWidth;
    var windowHeight = screen.height;
    var scrollHeight = Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight
    );
    var scrollTop = window.scrollY;
    var appearOffset = button.getAttribute('data-appearoffset');
    var hideOffset = button.getAttribute('data-hideoffset');

    if (previewMode && appearOffset && windowWidth < 960) {
        if (appearOffset.indexOf('vh') > -1) {
            appearOffset = Math.floor((screen.height * (parseInt(appearOffset) / 100)));
        }

        appearOffset = parseInt(appearOffset, 10);

        if (scrollTop >= appearOffset) {
            button.classList.remove('t943__btn_hidden');
        } else {
            button.classList.add('t943__btn_hidden');
        }
    }

    if (previewMode && hideOffset && windowWidth < 960) {
        if (hideOffset.indexOf('vh') > -1) {
            hideOffset = Math.floor((screen.height * (parseInt(hideOffset) / 100)));
        }

        hideOffset = parseInt(hideOffset, 10);

        if (scrollHeight - hideOffset <= windowHeight + scrollTop) {
            button.classList.add('t943__btn_hidden');
        } else if (!appearOffset && scrollTop > appearOffset) { /* if appearOffset was set either, then keep button visible until the first rule above is true */
            button.classList.remove('t943__btn_hidden');
        }
    }
} 
function t945_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t945');
    if (!container) return;

    rec.setAttribute('data-animationappear', 'off');
    rec.setAttribute('data-popup-subscribe-inited', 'y');
    rec.style.opacity = 1;

    var popup = rec.querySelector('.t-popup');
    var popupTooltipHook = popup.getAttribute('data-tooltip-hook');
    var analitics = popup.getAttribute('data-track-popup');
    var hrefs = rec.querySelectorAll('a[href*="#"]');
    var popupCloseBtn = popup.querySelector('.t-popup__close');

    if (popupTooltipHook) {
        var recBlocks = document.querySelectorAll('.r');

        for (var i = 0; i < recBlocks.length; i++) {
            recBlocks[i].addEventListener('click', function(event) {
                var target = event.target;
                var href = target.closest('a[href="' + popupTooltipHook + '"]') ? target : false;

                if (!href) return;

                event.preventDefault();
                t945_showPopup(recId);
                t945_resizePopup(recId);
                t945__lazyLoad();

                if (analitics) {
                    Tilda.sendEventToStatistics(analitics, popupTooltipHook);
                }
            });
        }
    }

    t945_checkPopupHeight(recId);

    window.addEventListener('resize', function() {
        t945_checkPopupHeight(recId);
    });

    for (var i = 0; i < hrefs.length; i++) {
        hrefs[i].addEventListener('click', function() {
            var url = this.getAttribute('href');

            if (!url || url.substring(0, 7) != '#price:') {
                t945_closePopup();

                if (!url || url.substring(0, 7) == '#popup:') {
                    setTimeout(function() {
                        document.body.classList.add('t-body_popupshowed');
                    }, 300);
                }
            }
        });
    }

    popupCloseBtn.addEventListener('click', t945_closePopup);
}

function t945_checkPopupHeight(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var popup = rec.querySelector('.t945__popup');
    if (!popup) return;

    var popupStyle = getComputedStyle(popup, null);
    var popupPaddingTop = parseInt(popupStyle.paddingTop) || 0;
    var popupPaddingBottom = parseInt(popupStyle.paddingBottom) || 0;
    var popupHeight = popup.clientHeight - (popupPaddingTop + popupPaddingBottom);

    if (window.innerHeight < popupHeight + 20) {
        popup.classList.add('t945__popup_scroll');
    } else {
        popup.classList.remove('t945__popup_scroll');
    }
}

function t945_lockScroll() {
    var documentBody = document.body;

    if (!documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = (typeof window.pageYOffset !== 'undefined') ? window.pageYOffset : (document.documentElement || documentBody.parentNode || documentBody).scrollTop;

        documentBody.classList.add('t-body_scroll-locked');
        documentBody.style.top = '-' + bodyScrollTop + 'px';
        documentBody.setAttribute('data-popup-scrolltop', bodyScrollTop);
    }
}

function t945_unlockScroll() {
    var documentBody = document.body;

    if (documentBody.classList.contains('t-body_scroll-locked')) {
        var bodyScrollTop = documentBody.getAttribute('data-popup-scrolltop');

        documentBody.classList.remove('t-body_scroll-locked');
        documentBody.style.top = null;
        documentBody.removeAttribute('data-popup-scrolltop');
        document.documentElement.scrollTop = parseInt(bodyScrollTop);
    }
}

function t945_showPopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t945');
    if (!container) return;

    var popup = rec.querySelector('.t-popup');
    var popupContainer = popup.querySelector('.t-popup__container');
    var range = rec.querySelector('.t-range');
    var documentBody = document.body;

    popup.style.display = 'block';

    if (range) t945__triggerEvent(range, 'popupOpened');

    setTimeout(function() {
        if (popupContainer) popupContainer.classList.add('t-popup__container-animated');
        popup.classList.add('t-popup_show');
    }, 50);

    documentBody.classList.add('t-body_popupshowed');
    documentBody.classList.add('t945__body_popupshowed');

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        setTimeout(function() {
            t945_lockScroll();
        }, 500);
    }

    document.addEventListener('keydown', t945_escClosePopup);
    t945__lazyLoad();
}

function t945_escClosePopup(event) {
    if (event.key === 'Escape') t945_closePopup();
}

function t945_closePopup() {
    var popupAll = document.querySelectorAll('.t-popup');

    document.body.classList.remove('t-body_popupshowed');
    document.body.classList.remove('t945__body_popupshowed');

    for (var i = 0; i < popupAll.length; i++) {
        popupAll[i].classList.remove('t-popup_show');
    }

    /* fix IOS11 cursor bug + general IOS background scroll */
    if (/iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream) {
        t945_unlockScroll();
    }

    setTimeout(function() {
        var popupHide = document.querySelectorAll('.t-popup:not(.t-popup_show)');

        for (var i = 0; i < popupHide.length; i++) {
            popupHide[i].style.display = 'none';
        }
    }, 300);

    document.removeEventListener('keydown', t945_escClosePopup);
}

function t945_resizePopup(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var popupContainer = rec.querySelector('.t-popup__container');
    if (!popupContainer) return;
    var popupStyle = getComputedStyle(popupContainer, null);
    var popupPaddingTop = parseInt(popupStyle.paddingTop) || 0;
    var popupPaddingBottom = parseInt(popupStyle.paddingBottom) || 0;
    var popupHeight = popupContainer.clientHeight - (popupPaddingTop + popupPaddingBottom);

    if (popupHeight > (window.innerHeight - 120)) {
        popupContainer.classList.add('t-popup__container-static');
    } else {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

/* deprecated */
function t945_sendPopupEventToStatistics(popupName) {
    var virtPage = '/tilda/popup/';
    var virtTitle = 'Popup: ';

    if (popupName.substring(0,7) == '#popup:') {
        popupName = popupName.substring(7);
    }

    virtPage += popupName;
    virtTitle += popupName;

    if (window.Tilda && typeof Tilda.sendEventToStatistics == 'function') {
        Tilda.sendEventToStatistics(virtPage, virtTitle, '', 0);
    } else {
        if (ga) {
            if (window.mainTracker != 'tilda') {
                ga('send', {'hitType': 'pageview', 'page': virtPage, 'title': virtTitle});
            }
        }

        if (window.mainMetrika && window[window.mainMetrika]) {
            window[window.mainMetrika].hit(virtPage, {title: virtTitle,referer: window.location.href});
        }
    }
}

function t945__triggerEvent(el, eventName) {
    var event;
    if (typeof window.CustomEvent === 'function') {
        event = new CustomEvent(eventName);
    } else if (document.createEvent) {
        event = document.createEvent('HTMLEvents');
        event.initEvent(eventName, true, false);
    } else if (document.createEventObject) {
        event = document.createEventObject();
        event.eventType = eventName;
    }

    event.eventName = eventName;

    if (el.dispatchEvent) {
        el.dispatchEvent(event);
    } else if (el.fireEvent) {
        el.fireEvent('on' + event.eventType, event);
    } else if (el[eventName]) {
        el[eventName]();
    } else if (el['on' + eventName]) {
        el['on' + eventName]();
    }

    if (t945__checkJqueryEvent(el, eventName)) {
        $(el).trigger(eventName);
    }
}

function t945__checkJqueryEvent(element, eventName) {
    var events = $._data(element, 'events') || false;
    var isEvent = false;

    if (events) {
        for (var key in events) {
            if (key === eventName) {
                isEvent = true;
                break;
            }
        }
    }

    return isEvent;
}

function t945_onSuccess(form) {
    /* TODO: jqeury in js */
    if (!(form instanceof Element)) form = form[0];

    var inputsWrapper = form.querySelector('.t-form__inputsbox');

    inputsWrapper.classList.add('t945__inputsbox_hidden');

    /* TODO: После обновления файла tilda-forms поправить data на глобальный объект для получения success url */
    var successUrl = $(form).data('success-url');

    if (successUrl) {
        setTimeout(function() {
            window.location.href = successUrl;
        }, 500);
    }
}

function t945__lazyLoad() {
    if (window.lazy === 'y' || document.getElementById('allrecords').getAttribute('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            t_lazyload_update();
        });
    }
} 
/* no init */ 
function t958_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t958');
    if (!container) return;
    var sliderContainer = rec.querySelector('.t958__slidecontainer');
    var items = rec.querySelectorAll('.t958__item');
    var cards = rec.querySelectorAll('.t958__card');
    var totalSlides = items.length;
    var sliderWidth = parseFloat(getComputedStyle(items[0], null).width.replace('px', ''));

    t958_checkSize(rec);
    sliderContainer.style.width = (sliderWidth * totalSlides) + 'px';

    window.addEventListener('resize', t_throttle(function() {
        t958_findVisibleCards(rec);
        t958_initPopup(rec);
        t958_checkSize(rec);

        sliderWidth = parseFloat(getComputedStyle(items[0], null).width.replace('px', ''));
        sliderContainer.style.width = (sliderWidth * totalSlides) + 'px';

        var matrix = (getComputedStyle(sliderContainer, null).transform || '').replace(/[^0-9\-.,]/g, '').split(',');
        var x = matrix[12] || matrix[4];

        if (-((totalSlides - 1) * sliderWidth) > x) {
            sliderContainer.style.transform = 'translate(-' + (totalSlides - 1) * sliderWidth + 'px, 0)';
        }
    }));

    /*TODO: jq event*/
    $(container).bind('displayChanged', function() {
        sliderContainer.style.width = '100%';

        setTimeout(function() {
            sliderWidth = parseFloat(getComputedStyle(items[0], null).width.replace('px', ''));
            sliderContainer.style.width = (sliderWidth * totalSlides) + 'px';

            t958_checkSize(rec);
            t958_findVisibleCards(rec);
            t958_initPopup(rec);
        }, 300);
    });

    /*container.addEventListener('displayChanged', function() {
        sliderContainer.style.width = '100%';

        setTimeout(function() {
            sliderWidth = parseFloat(getComputedStyle(items[0], null).width.replace('px', ''));
            sliderContainer.style.width = (sliderWidth * totalSlides) + 'px';

            t958_checkSize(rec);
            t958_findVisibleCards(rec);
            t958_initPopup(rec);
        }, 300);
    });*/

    rec.querySelector('.t958__next').addEventListener('click', function() {
        t958_slide(rec, 'right');
    });

    rec.querySelector('.t958__previous').addEventListener('click', function() {
        t958_slide(rec, 'left');
    });

    if (window.innerWidth > 640) {
        t958_findVisibleCards(rec);
    } else {
        t958_initSliderSwipe(rec);

        for (var i = 0; i < cards.length; i++) {
            cards[i].classList.add('t958__card-visible');
        }
    }

    t958_initPopup(rec);
}

function t958_checkSize(rec) {
    var cards = rec.querySelectorAll('.t958__card_preview');
    var mores = rec.querySelectorAll('.t958__more-wrapper');
    var blockHeight = rec.querySelector('.t958__height');
    var maxWidth = parseFloat(getComputedStyle(blockHeight, null).width.replace('px', ''));
    var windowMargin = 80;
    var windowWidth = window.innerWidth;
    var cardMaxWidth = windowWidth - windowMargin;

    if (maxWidth > windowWidth) {
        for (var i = 0; i < cards.length; i++) {
            cards[i].style.maxWidth = cardMaxWidth + 'px';
        }
        for (var i = 0; i < mores.length; i++) {
            mores[i].style.maxWidth = cardMaxWidth + 'px';
        }
    } else {
        for (var i = 0; i < cards.length; i++) {
            cards[i].style.maxWidth = '';
        }
        for (var i = 0; i < mores.length; i++) {
            mores[i].style.maxWidth = '';
        }
    }

    for (var i = 0; i < cards.length; i++) {
        var card = cards[i];
        var cardStyle = getComputedStyle(card, null);
        var cardPaddingTop = parseInt(cardStyle.paddingTop) || 0;
        var cardPaddingBottom = parseInt(cardStyle.paddingBottom) || 0;
        var cardHeight = card.clientHeight - (cardPaddingTop + cardPaddingBottom);
        var cardInner = card.querySelector('.t958__card-inner');
        var cardInnerHeight = cardInner.offsetHeight;

        if (cardHeight <= cardInnerHeight) {
            card.classList.add('t958__card_fade');
        } else {
            card.classList.remove('t958__card_fade');
        }
    }
}

function t958_initSliderSwipe(rec) {
    var sliderWrapper = rec.querySelector('.t958__gallery');
    var totalSlides = rec.querySelectorAll('.t958__item').length;
    var timeout;
    var isScrolling = false;

    if (typeof Hammer !== 'undefined') {
        delete Hammer.defaults.cssProps.userSelect;

        var hammer = new Hammer(sliderWrapper, {
            domEvents: true,
            inputClass: Hammer.TouchInput,
            recognizers: [
                [Hammer.Swipe, {
                    direction: Hammer.DIRECTION_HORIZONTAL
                }]
            ]
        });

        window.addEventListener('scroll', function() {
            isScrolling = true;

            clearTimeout(timeout);
            timeout = setTimeout(function() {
                isScrolling = false;
            }, 250);
        });

        if (totalSlides == 1) return false;

        hammer.on('swipeleft', function(event) {
            if (isScrolling) return false;

            sliderWrapper.setAttribute('data-slider-touch', 'yes');

            if (event.isFinal) {
                t958_slide(rec, 'right');
                sliderWrapper.setAttribute('data-slider-touch', '');
            }
        });

        hammer.on('swiperight', function(event) {
            if (isScrolling) return false;

            sliderWrapper.setAttribute('data-slider-touch', 'yes');

            if (event.isFinal) {
                t958_slide(rec, 'left');
                sliderWrapper.setAttribute('data-slider-touch', '');
            }
        });
    }
}

function t958_slide(rec, direction) {
    var allrecords = document.getElementById('allrecords');
    var container = rec.querySelector('.t958__slidecontainer');
    var items = rec.querySelectorAll('.t958__item');
    var totalSlides = items.length;
    var sliderWidth = parseFloat(getComputedStyle(items[0], null).width.replace('px', ''));
    var position = parseInt(container.getAttribute('data-slide-pos'), 10);

    if (direction === 'right') {
        container.setAttribute('data-slide-pos', ++position);

        if (position >= totalSlides) {
            position = 0;
            container.setAttribute('data-slide-pos', position);
        }
    } else {
        container.setAttribute('data-slide-pos', --position);

        if (position <= -1) {
            position = totalSlides - 1;
            container.setAttribute('data-slide-pos', position);
        }
    }

    container.style.transform = 'translate(-' + sliderWidth * position + 'px, 0)';
    container.style.transitionDuration = '.3s';

    setTimeout(function() {
        t958_findVisibleCards(rec);
    }, 350);

    if (window.lazy === 'y' || allrecords.getAttribute('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function() {
            t_lazyload_update();
        });
    }
}

function t958_findVisibleCards(rec) {
    var cards = rec.querySelectorAll('.t958__card');
    var prevControl = rec.querySelector('.t958__previous');
    var nextControl = rec.querySelector('.t958__next');

    for (var i = 0; i < cards.length; i++) {
        var card = cards[i];

        card.classList.remove('t958__card-left');
        card.classList.remove('t958__card-right');
        card.classList.remove('t958__card-visible');

        var windowWidth = window.innerWidth;
        var cardLeftPos = card.getBoundingClientRect().left;
        var cardRightPos = cardLeftPos + parseFloat(getComputedStyle(card, null).width.replace('px', ''));

        if (cardLeftPos <= 0 && cardRightPos >= 0) {
            card.classList.add('t958__card-left');
        } else if (cardLeftPos <= windowWidth && cardRightPos >= windowWidth) {
            card.classList.add('t958__card-right');
        } else if (cardLeftPos >= 0 && cardRightPos <= windowWidth) {
            card.classList.add('t958__card-visible');
        }
    }

    var leftCard = rec.querySelector('.t958__card-left');
    var rightCard = rec.querySelector('.t958__card-right');

    if (leftCard) {
        var leftCardRect = leftCard.getBoundingClientRect().left;
        var leftCardWidth = parseFloat(getComputedStyle(leftCard, null).width.replace('px', ''));
        var leftCardOffset = leftCardWidth - Math.abs(leftCardRect);

        if (leftCardOffset >= 30) {
            prevControl.style.width = leftCardOffset + 'px';
        } else {
            prevControl.style.width = 100 + 'px';
        }
    }

    if (rightCard) {
        var rightCardRect = rightCard.getBoundingClientRect().left;
        var rightCardStyle = getComputedStyle(rightCard, null);
        var paddingLeft = parseInt(rightCardStyle.paddingLeft) || 0;
        var paddingRight = parseInt(rightCardStyle.paddingRight) || 0;
        var rightCardWidth = rightCard.clientWidth - (paddingLeft + paddingRight);
        var rightCardOffset = rightCardWidth - (rightCardRect + rightCardWidth - window.innerWidth);

        if (rightCardOffset >= 30) {
            nextControl.style.width = rightCardOffset + 'px';
        } else {
            nextControl.style.width = 100 + 'px';
        }
    }
}

function t958_initPopup(rec) {
    if (rec.querySelector('.t958').classList.contains('t958_preview')) return;

    var fadeCards = rec.querySelectorAll('.t958__card_fade[data-review-block^="review"]');

    for (var i = 0; i < fadeCards.length; i++) {
        fadeCards[i].addEventListener('click', function() {
            var card = this;

            if (card.classList.contains('t958__card-visible')) {
                t958_showPopup(rec);

                var popup = rec.querySelector('.t-popup');
                var reviewId = card.getAttribute('data-review-block').replace('review', '');
                var reviewPopup = popup.querySelector('.t958__popup-item[data-review-index="' + reviewId + '"]');
                var popupItems = popup.querySelectorAll('.t958__popup-item');

                for (var i = 0; i < popupItems.length; i++) {
                    popupItems[i].style.display = 'none';
                }

                reviewPopup.style.display = 'block';
            }
        });
    }
}

function t958_checkPopupSize(rec) {
    var popupContainer = rec.querySelector('.t-popup__container');
    var popupHeight = parseFloat(getComputedStyle(popupContainer, null).height.replace('px', ''));
    var windowMargin = 120;
    var windowHeight = window.innerHeight - windowMargin;

    if (popupHeight > windowHeight) {
        popupContainer.classList.add('t-popup__container-static');
    } else {
        popupContainer.classList.remove('t-popup__container-static');
    }
}

function t958_showPopup(rec) {
    var allrecords = document.getElementById('allrecords');
    var popup = rec.querySelector('.t-popup');
    var popupContainer = rec.querySelector('.t-popup__container');
    var popupClose = rec.querySelector('.t-popup__close');

    popup.style.display = 'block';

    setTimeout(function() {
        popupContainer.classList.add('t-popup__container-animated');
        popup.classList.add('t-popup_show');

        t958_checkPopupSize(rec);

        if (window.lazy === 'y' || allrecords.getAttribute('data-tilda-lazy') === 'yes') {
            t_onFuncLoad('t_lazyload_update', function() {
                t_lazyload_update();
            });
        }
    }, 50);

    document.body.classList.add('t-body_popupshowed');

    popup.removeEventListener('mousedown', t958_mousedownEvent);
    popup.addEventListener('mousedown', t958_mousedownEvent);

    popupClose.removeEventListener('click', t958_closePopup);
    popupClose.addEventListener('click', t958_closePopup);

    document.removeEventListener('keydown', t958_keydownEvent);
    document.addEventListener('keydown', t958_keydownEvent);
}

function t958_mousedownEvent(event) {
    var windowWidth = window.innerWidth;
    var maxScrollBarWidth = 17;
    var windowWithoutScrollBar = windowWidth - maxScrollBarWidth;

    if (event.clientX > windowWithoutScrollBar) return;

    if (event.target == this) t958_closePopup();
}

function t958_keydownEvent(event) {
    if (event.keyCode == 27) t958_closePopup();
}

function t958_closePopup() {
    var popupShow = document.querySelector('.t-popup.t-popup_show');

    document.body.classList.remove('t-body_popupshowed');
    popupShow.classList.remove('t-popup_show');

    setTimeout(function() {
        var popups = document.querySelectorAll('.t-popup:not(.t-popup_show)');

        document.body.scrollTop = 0;

        for (var i = 0; i < popups.length; i++) {
            popups[i].style.display = 'none';
        }
    }, 300);
} 
function t959__init(recid) {
    var el = $('#rec' + recid);

    $(window).on('resize', t_throttle(function () {
        t959_unifyHeights(recid);
    }));

    $(window).on('load', function () {
        t959_unifyHeights(recid);
    });

    el.find('.t959').on('displayChanged', t_throttle(function () {
        t959_unifyHeights(recid);
    }));
    
    t959__updateLazyLoad(recid);
}

function t959__updateLazyLoad(recid) {
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            var scrollContainer = $("#rec" + recid + " .t959__container_mobile-flex");
            var curMode = $(".t-records").attr("data-tilda-mode");

            if (scrollContainer.length && curMode != "edit" && curMode != "preview" && window.isMobile) {
                scrollContainer.on('touchmove', t_throttle(function () {
                    t_lazyload_update();
                }));
            }
        });
    }
}

function t959_unifyHeights(recid) {
    $('#rec' + recid + ' .t959 .t959__container').each(function () {
        var highestBox = 0,
            curwidth = $(this).find('.t959__card-inner').width(),
            currow = $(this),
            ratio = $('#rec' + recid + ' .t959__container').attr('data-ratio');

        var minHeightFromRatio;

        switch (ratio) {
            case '16_9':
                minHeightFromRatio = curwidth * 0.5625;
                break;
            case '4_3':
                minHeightFromRatio = curwidth * 0.75;
                break;
            case '3_2':
                minHeightFromRatio = curwidth * 0.6666;
                break;
            case '1_1':
                minHeightFromRatio = curwidth;
                break;
            case '2_3':
                minHeightFromRatio = curwidth * 1.5;
                break;
            case '3_4':
                minHeightFromRatio = curwidth * 1.3333;
                break;
            case '9_16':
                minHeightFromRatio = curwidth * 1.7777;
                break;
        }

        currow.find('.t959__card-content').each(function () {
            var cardContent = $(this);
            var titleHeight = cardContent.find('.t959__card-title').outerHeight(true);
            var descrHeight = cardContent.find('.t959__card-desc').outerHeight(true);
            var colHeight = titleHeight + descrHeight;
            if (colHeight > highestBox) {
                highestBox = colHeight;
            }
        });

        if (highestBox > minHeightFromRatio) {
            currow.find('.t959__card-inner').css('padding-bottom', highestBox + 'px');
        } else {
            currow.find('.t959__card-inner').css('padding-bottom', '');
        }
    });
} 
function t966_init(recid) {
    var hook = $('#rec' + recid + ' .t966').attr('data-tooltip-hook');
    if (typeof hook === 'undefined' || hook === '') {
        return;
    }
    var hookLinks = $('a[href=\'' + hook + '\'][data-submenu-disallowed!="yes"]');
    /* Убрала t-menu__link-item, были баги в других меню */
    hookLinks.addClass('t966__tm-link');
    hookLinks.attr('data-tooltip-menu-id', recid);
    
    var parentMenu = hookLinks.closest('[data-menu]');
    var tooltipMenu = $('#rec' + recid + ' .t966__tooltip-menu');

    tooltipMenu.attr('data-pos-fixed', 'no');
    if (parentMenu.length && parentMenu.css('position') == 'fixed') {
        tooltipMenu.attr('data-pos-fixed', 'yes');
    }
    
    t966_addArrow(recid, hookLinks);
    t966_setUpMenu(recid, hookLinks);
    t966_highlight();
}

function t966_divideMenu(recid, rows) {
    if (rows === '') {
        rows = 1;
    }

    var el = $('#rec' + recid).find('.t966');
    var menu = $('#rec' + recid + ' .t966__menu-item-wrapper');
    var list = $('#rec' + recid + ' .t966__menu-list');
    var count = menu.length;
    var max = Math.ceil(count / rows);

    if ($(window).width() < 980 && el.attr('data-sort-mobile') == "yes") { 
        return;
    }
    
    var rowclass = '';

    switch (rows) {
        case '1':
            rowclass = 't966__menu-list-row_100';
            break;
        case '2':
            rowclass = 't966__menu-list-row_50';
            break;
        case '3':
            rowclass = 't966__menu-list-row_33';
            break;
        case '4':
            rowclass = 't966__menu-list-row_25';
            break;
    }

    for (var i = 0; i < max; i++) {
        list.append('<div class="t966__menu-list-row ' + rowclass + '"></div>');
    }

    var listRows = list.find('.t966__menu-list-row');

    menu.each(function(index) {
        $(this).appendTo(listRows[index % max]);
    });

    var curMode = $('.t-records').attr('data-tilda-mode');
    if (curMode === 'edit') {
        $('.t966__tooltip-menu').css('display', 'block');
    }
}


function t966_setUpMenu(recid, hookLinks) {
    var submenu = $('#rec' + recid + ' .t966__tooltip-menu');
    var content = submenu.find('t966__content');

    var vIndent = $('#rec' + recid + ' .t966').attr('data-tooltip-margin');
    var timer;
    hookLinks.add(submenu).on('mouseover', function () {
        if (!window.isMobile || $(window).width() >= 980) {
            /*if submenu is hovered while disappearing*/
            if ($(this).hasClass('t966__tooltip-menu') && !$(this).hasClass('t966__tooltip-menu_show')) {
                return;
            }
            clearTimeout(timer);
            /*if link is already hoverd and now hover is on submenu element*/
            if ($(this).hasClass('t966__tooltip-menu') && submenu.hasClass('t966__tooltip-menu_show')) {
                return;
            }
            var curAnchor = $(this);
            t966_showSubmenu(recid, curAnchor, submenu, vIndent);
        }
    });
    
    hookLinks.add(submenu).on('mouseout', function (event) {
        if (!window.isMobile || $(window).width() >= 980) {
            timer = setTimeout(function () {
                t966_hideSubmenu(recid, submenu);
            }, 300);
        }
    });
    
    $(document).on('click', function(e) {
        if (submenu.attr('data-mobiletooltip') === 'yes') {
            if (!submenu.is(e.target) && submenu.has(e.target).length === 0 && (!$(e.target).is(hookLinks) && !$(e.target).is(hookLinks.children()))) {
                t966_hideSubmenu(recid, submenu);
            }
        }
    });

    hookLinks.on('click', function (e) {
        e.preventDefault();

        if (window.isMobile && $(window).width() < 980) {
            if ($(this).hasClass('t-menu__link-item')) {
                if (submenu.hasClass('t966__tooltip-menu_show') || $(this).next().hasClass('t966__tooltip-menu_mobile')) {
                    var submenu_mobile = $(this).next();
                    t966_hideSubmenu(recid, submenu_mobile);
                } else {
                    var curAnchor = $(this);
                    var submenu_mobile = submenu.clone();
                    submenu_mobile.addClass('t966__tooltip-menu_mobile');
                    t966_showSubmenu(recid, curAnchor, submenu_mobile, vIndent);
                }
            } else {
                /*if submenu is hovered while disappearing*/
                if ($(this).hasClass('t966__tooltip-menu') && !$(this).hasClass('t966__tooltip-menu_show')) {
                    return;
                }
                clearTimeout(timer);
                /*if link is already hoverd and now hover is on submenu element*/
                if ($(this).hasClass('t966__tooltip-menu') && submenu.hasClass('t966__tooltip-menu_show')) {
                    return;
                }
                var curAnchor = $(this);
                t966_showSubmenu(recid, curAnchor, submenu, vIndent);
                
                var tooltips = $('#rec' + recid + ' .t966__tooltip-menu[data-mobiletootlip="yes"]');
                if (tooltips.length !== 0) {
                    t966_hideSubmenu(recid, tooltips);
                }
            }

        }
    });
    $(window).bind('scroll', t_throttle(function () {
        content.hover(function() {
            /* to do nothing */
        }, function(){
            if (submenu.hasClass('t966__tooltip-menu_show') || hookLinks.filter('.t966__tm-link_active').next().hasClass('t966__tooltip-menu_mobile')) {
                var submenu_mobile = hookLinks.filter('.t966__tm-link_active').next();
                t966_hideSubmenu(recid, submenu_mobile);
            }
        });
    }, 300));

    $(window).bind('resize', t_throttle(function () {
        if (!window.isMobile || $(window).width() >= 980) {
            t966_hideSubmenu(recid, $('.t966__tooltip-menu_mobile'));
        }
    }, 300));
    $('.t966__tooltip-menu a[href*="#"]').click(function () {
        t966_hideSubmenu(recid, submenu);
        $('.t450, .t199__mmenu, .t280, .t282, .t204__burger, .t451, .t466').trigger('clickedAnchorInTooltipMenu');

        $('.t966__tooltip-menu a[href*="#"]').removeClass('t-active');
        $(this).addClass('t-active');
    });
}


function t966_showSubmenu(recid, curAnchor, submenu, vIndent) {
    if (window.isMobile && $(window).width() < 980 && curAnchor.hasClass('t-menu__link-item')) {
        submenu.insertAfter(curAnchor);
        
        $('.t966__tooltip-menu a[href*="#"]').click(function () {
            t966_hideSubmenu(recid, submenu);
            $('.t966__tooltip-menu a[href*="#"]').removeClass('t-active');
            $(this).addClass('t-active');
        });
    
        submenu.parents('.t228').trigger('overflow').trigger('showME601a');;
        
        submenu.css({
            'position': 'static',
            'opacity': '1'
            });
        
        if (submenu.closest('.t280').length > 0 || submenu.closest('.t450').length > 0 || submenu.closest('.t451').length > 0) {
		    submenu.show();
		} else {
            submenu.slideDown();
		}

        submenu.addClass('t966__tooltip-menu_show');
        curAnchor.addClass('t966__tm-link_active');
        
        if (window.lazy == 'y') {
            t_lazyload_update();
        }
        return;
    }
    
    if (!curAnchor.hasClass('t-menu__link-item')) {
        submenu.find('.t966__tooltip-menu-corner-border').css('opacity', '1');
        submenu.find('.t966__tooltip-menu-corner').css('opacity', '1');
        if (window.isMobile && $(window).width() < 980) {
            submenu.attr('data-mobiletooltip', 'yes');
        }
    }
    
    var isFirefox = navigator.userAgent.search("Firefox") !== -1;
    var submenuHeight = submenu.outerHeight();
    var submenuWidth = submenu.outerWidth();
    var anchorHeight = curAnchor.height();
    var anchorWidth = curAnchor.width();
    if (curAnchor.hasClass('t-btn')) {
        anchorWidth = curAnchor.outerWidth();
    }
    var winHeight = $(window).height();
    var winWidth = $(window).width();
    var scrollTop = $(window).scrollTop();
    var anchorTop = curAnchor.offset().top;
    var anchorLeft = curAnchor.offset().left;
    
    var corner = submenu.find('.t966__tooltip-menu-corner');
    var cornerBorder = submenu.find('.t966__tooltip-menu-corner-border');
    var cornerLeft;
    
    var menuFixed = submenu.attr('data-pos-fixed');
    
    var parentZeroMenu = curAnchor.closest('.t396__artboard');

    /* window-submenu horizontal margin, needed if submenu doesn't fit by its width */
    var menuWindowMargin = 10;
    var arrowHeight = 10;
    var vIndentDefault = 25;
    
    if (typeof vIndent != 'undefined' && vIndent != '') {
        vIndent = vIndent.replace('px', '') * 1;
        /*add arrow*/
        vIndent = vIndent + arrowHeight;
    } else {
        vIndent = vIndentDefault;
    }
   
    var posy;
	if (menuFixed == 'yes') {
	    posy = (curAnchor.offset().top - scrollTop) + anchorHeight + vIndent;
	    submenu.css('position', 'fixed');
	} else {
	    posy = curAnchor.offset().top + anchorHeight + vIndent;
	}
	
    var posx = anchorLeft;

    if (parentZeroMenu.hasClass('t396__artboard_scale') && window.tn_scale_factor) {
        posx = isFirefox ? posx : posx * window.tn_scale_factor;
        anchorLeft = isFirefox ? anchorLeft : anchorLeft * window.tn_scale_factor;
        anchorWidth = anchorWidth * window.tn_scale_factor;
    }
    if (posy + submenuHeight > scrollTop + winHeight && posy >= submenuHeight && posy - scrollTop > submenuHeight) {
        posy = Math.max(posy - submenuHeight - anchorHeight - vIndent * 2, scrollTop);
        corner.removeClass('t966__tooltip-menu-corner_bottom').addClass('t966__tooltip-menu-corner_top');
        cornerBorder.removeClass('t966__tooltip-menu-corner-border_bottom').addClass('t966__tooltip-menu-corner-border_top');
    } else {
        corner.removeClass('t966__tooltip-menu-corner_top').addClass('t966__tooltip-menu-corner_bottom');
        cornerBorder.removeClass('t966__tooltip-menu-corner-border_top').addClass('t966__tooltip-menu-corner-border_bottom');
    }
    
    if (posx + submenuWidth / 2 < winWidth) {
        /*show in the center of anchor*/
        posx = posx + (anchorWidth - submenuWidth) / 2;
        /*show near left window border*/
        if (posx < 0) {
            posx = menuWindowMargin;
        }
    } else {
        /*show near right window border*/
        posx = winWidth - submenuWidth - menuWindowMargin;
    }
    
    if (Math.ceil(submenuWidth) + menuWindowMargin*2 > winWidth) {
        posx = menuWindowMargin;
        submenu.css('width', winWidth - menuWindowMargin*2);
    }

    submenu.css({
        'left': posx,
        'top': posy
    });

    submenu[0].offsetHeight;
    submenu.fadeIn(0);
    submenu.addClass('t966__tooltip-menu_show');
    curAnchor.addClass('t966__tm-link_active');
    
    cornerLeft = anchorLeft + Math.floor(anchorWidth / 2) - posx - (arrowHeight / 2);
    
    corner.css('left', cornerLeft);
    cornerBorder.css('left', cornerLeft);
    
    if (submenu.offset().top - $(window).scrollTop() + submenu.height() > $(window).height() && submenu.attr('data-mobiletooltip') !== 'yes') {
        var content = submenu.find('.t966__content');
        var contentPadding = parseInt(content.css('paddingBottom'), 10);
        var paddingWindow = 40;

        var height = $(window).height() - posy - contentPadding - paddingWindow - arrowHeight;
        content.css({
            "overflow-y": "scroll",
            "height": height
        });
    }
    
    if (window.lazy == 'y') {
        t_lazyload_update();
    }
}


function t966_hideSubmenu(recid, submenu) {
    if (submenu.attr('data-mobiletooltip') === 'yes') {
        submenu.attr('data-mobiletooltip', '');
    }
    
    if (submenu.hasClass('t966__tooltip-menu_mobile')) {
        if (submenu.closest('.t280').length > 0 || submenu.closest('.t450').length > 0 || submenu.closest('.t451').length > 0) {
		    submenu.hide(0, function() {
	            submenu.remove();
	        });
		} else {
            submenu.slideUp("normal", function() {
                submenu.parents('.t228').trigger('nooverflow');
                submenu.remove();
            });
		}
        $('.t966__tm-link_active').removeClass('t966__tm-link_active');
        return;
    } else {
        var content = submenu.find('.t966__content');
        
        submenu.css({
            "display": "",
            "left": "",
            "top": "",
            "width": ""
        });
        
        content.css({
            "overflow-y": "",
            "height": ""
        });
        
        submenu.removeClass('t966__tooltip-menu_show');
    }
    
    $('.t966__tm-link_active').removeClass('t966__tm-link_active');
}


function t966_addArrow(recid, hookLinks) {
    var arrow = $('#rec' + recid + ' .t966').attr('data-add-arrow');
    if (typeof arrow == 'undefined' || arrow == '') {
        return;
    }
    hookLinks.each(function (i, el) {
        $(el).append('<div class="t966__arrow"></div>');
    });
}


function t966_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash = window.location.hash;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname == "") {
        pathname = "/";
    }
    $('a[href=\'' + url + '\'] .t966__menu-item-title').addClass('t-active');
    $('a[href=\'' + url + '/\'] .t966__menu-item-title').addClass('t-active');
    $('a[href=\'' + pathname + '\'] .t966__menu-item-title').addClass('t-active');
    $('a[href=\'/' + pathname + '\'] .t966__menu-item-title').addClass('t-active');
    $('a[href=\'' + pathname + '/\'] .t966__menu-item-title').addClass('t-active');
    $('a[href=\'/' + pathname + '/\'] .t966__menu-item-title').addClass('t-active');
    if (hash) {
        $('a[href=\'' + hash + '\'] .t966__menu-item-title').addClass('t-active');
    }
}

 
function t967_createMobileMenu(recid, previewMode) {
    var window_width = $(window).width(),
        el = $("#rec" + recid),
        menu = el.find(".t967"),
        burger = el.find(".t967__mobile");
    burger.click(function (e) {
        menu.fadeToggle(300);
        $(this).toggleClass("t967_opened");
    });
    if ($('#nav269976850').attr('data-appearoffset') !== '' && previewMode !== '' && $('#nav269976850').hasClass('t967__positionfixed')) {
        $(window).bind('resize', t_throttle(function () {
            var window_width = $(window).width();
            if (window_width > 980) {
                t967_appearMenu(recid);
                burger.removeClass("t967_opened");
                menu.fadeOut(0);
            } else {
                menu.css("visibility", "visible");
            }
        }, 200));
    } else {
        $(window).bind('resize', t_throttle(function () {
            var window_width = $(window).width();
            if (window_width > 980) {
                menu.fadeIn(0);
            } else {
                if (!burger.hasClass("t967_opened")) {
                    menu.fadeOut(0);
                }
            }
        }));
    }
}

function t967_setLogoPadding(recid) {
    if ($(window).width() > 980) {
        var menu = $('#rec' + recid + ' .t967');
        var logo = menu.find('.t967__logowrapper');
        var leftpart = menu.find('.t967__leftwrapper');
        var rightpart = menu.find('.t967__rightwrapper');
        leftpart.css("padding-right", logo.width() / 2 + 50);
        rightpart.css("padding-left", logo.width() / 2 + 50);
    }
}

function t967_highlight() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    if (url.substr(url.length - 1) == "/") {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == "/") {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == "/") {
        pathname = pathname.slice(1);
    }
    if (pathname == "") {
        pathname = "/";
    }
    $(".t967__list-item a[href='" + url + "']").addClass("t-active");
    $(".t967__list-item a[href='" + url + "/']").addClass("t-active");
    $(".t967__list-item a[href='" + pathname + "']").addClass("t-active");
    $(".t967__list-item a[href='/" + pathname + "']").addClass("t-active");
    $(".t967__list-item a[href='" + pathname + "/']").addClass("t-active");
    $(".t967__list-item a[href='/" + pathname + "/']").addClass("t-active");
}

function t967_checkAnchorLinks(recid) {
    if ($(window).width() >= 960) {
        var navLinks = $("#rec" + recid + " .t967__desktoplist .t967__list-item a:not(.tooltipstered)[href*='#']");
        if (navLinks.length > 0) {
            t967_catchScroll(navLinks);
        };
    }
}

function t967_catchScroll(navLinks) {
    var clickedSectionId = null,
        sections = new Array(),
        sectionIdTonavigationLink = [],
        interval = 100,
        lastCall, timeoutId;
    navLinks = $(navLinks.get().reverse());
    navLinks.each(function () {
        var cursection = t967_getSectionByHref($(this));
        if (typeof cursection.attr("id") != "undefined") {
            sections.push(cursection);
        }
        sectionIdTonavigationLink[cursection.attr("id")] = $(this);
    });
    t967_updateSectionsOffsets(sections);
    sections.sort(function (a, b) {
        return b.attr("data-offset-top") - a.attr("data-offset-top");
    });
    $(window).bind('resize', t_throttle(function () {
        t967_updateSectionsOffsets(sections);
    }, 200));
    $('.t967').bind('displayChanged', function () {
        t967_updateSectionsOffsets(sections);
    });
    setInterval(function () {
        t967_updateSectionsOffsets(sections);
    }, 5000);
    t967_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);

    navLinks.click(function () {
        var clickedSection = t967_getSectionByHref($(this));
        if (!$(this).hasClass("tooltipstered") && typeof clickedSection.attr("id") != "undefined") {
            navLinks.removeClass('t-active');
            $(this).addClass('t-active');
            clickedSectionId = t967_getSectionByHref($(this)).attr("id");
        }
    });
    $(window).scroll(function () {
        var now = new Date().getTime();
        if (lastCall && now < (lastCall + interval)) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(function () {
                lastCall = now;
                clickedSectionId = t967_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
            }, interval - (now - lastCall));
        } else {
            lastCall = now;
            clickedSectionId = t967_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
        }
    });
}


function t967_updateSectionsOffsets(sections) {
    $(sections).each(function () {
        var curSection = $(this);
        curSection.attr("data-offset-top", curSection.offset().top);
    });
}


function t967_getSectionByHref(curlink) {
    var curLinkValue = curlink.attr("href").replace(/\s+/g, '');
    if (curLinkValue[0] == '/') {
        curLinkValue = curLinkValue.substring(1);
    }
    if (curlink.is('[href*="#rec"]')) {
        return $(".r[id='" + curLinkValue.substring(1) + "']");
    } else {
        return $(".r[data-record-type='215']").has("a[name='" + curLinkValue.substring(1) + "']");
    }
}

function t967_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId) {
    var scrollPosition = $(window).scrollTop(),
        valueToReturn = clickedSectionId;
    /*if first section is not at the page top (under first blocks)*/
    if (sections.length != 0 && clickedSectionId == null && sections[sections.length - 1].attr("data-offset-top") > (scrollPosition + 300)) {
        navLinks.removeClass('t-active');
        return null;
    }

    $(sections).each(function (e) {
        var curSection = $(this),
            sectionTop = curSection.attr("data-offset-top"),
            id = curSection.attr('id'),
            navLink = sectionIdTonavigationLink[id];
        if (((scrollPosition + 300) >= sectionTop) || (sections[0].attr("id") == id && scrollPosition >= $(document).height() - $(window).height())) {
            if (clickedSectionId == null && !navLink.hasClass('t-active')) {
                navLinks.removeClass('t-active');
                navLink.addClass('t-active');
                valueToReturn = null;
            } else {
                if (clickedSectionId != null && id == clickedSectionId) {
                    valueToReturn = null;
                }
            }
            return false;
        }
    });
    return valueToReturn;
}

function t967_setBg(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t967").each(function () {
            var el = $(this);
            if (el.attr('data-bgcolor-setbyscript') == "yes") {
                var bgcolor = el.attr("data-bgcolor-rgba");
                el.css("background-color", bgcolor);
            }
        });
    } else {
        $(".t967").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-hex");
            el.css("background-color", bgcolor);
            el.attr("data-bgcolor-setbyscript", "yes");
        });
    }
}

function t967_appearMenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t967").each(function () {
            var el = $(this);
            var appearoffset = el.attr("data-appearoffset");
            if (appearoffset != "") {
                if (appearoffset.indexOf('vh') > -1) {
                    appearoffset = Math.floor((window.innerHeight * (parseInt(appearoffset) / 100)));
                }

                appearoffset = parseInt(appearoffset, 10);

                if ($(window).scrollTop() >= appearoffset) {
                    if (el.css('visibility') == 'hidden') {
                        el.finish();
                        el.css("top", "-50px");
                        el.css("visibility", "visible");
                        el.animate({
                            "opacity": "1",
                            "top": "0px"
                        }, 200, function () {});
                    }
                    if (el.css("display") == "none") {
                        el.css("display", "block");
                    }
                } else {
                    el.stop();
                    el.css("visibility", "hidden");
                }
            }
        });
    }

}

function t967_changebgopacitymenu(recid) {
    var window_width = $(window).width();
    if (window_width > 980) {
        $(".t967").each(function () {
            var el = $(this);
            var bgcolor = el.attr("data-bgcolor-rgba");
            var bgcolor_afterscroll = el.attr("data-bgcolor-rgba-afterscroll");
            var bgopacityone = el.attr("data-bgopacity");
            var bgopacitytwo = el.attr("data-bgopacity-two");
            var menushadow = el.attr("data-menushadow");
            if (menushadow == '100') {
                var menushadowvalue = menushadow;
            } else {
                var menushadowvalue = '0.' + menushadow;
            }
            if ($(window).scrollTop() > 20) {
                el.css("background-color", bgcolor_afterscroll);
                if (bgopacitytwo == '0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            } else {
                el.css("background-color", bgcolor);
                if (bgopacityone == '0.0' || menushadow == ' ') {
                    el.css("box-shadow", "none");
                } else {
                    el.css("box-shadow", "0px 1px 3px rgba(0,0,0," + menushadowvalue + ")");
                }
            }
        });
    }
} 
function t969_init(recid) {
    var el_rec = $('#rec' + recid);
    var el_branches = el_rec.find('.t969');
    if ($('#tildacopy').length > 0) {
        window.addEventListener('scroll', function(ev) {
            if ((window.innerHeight + window.pageYOffset + 70) >= document.body.offsetHeight) {
                var offsetBottom = 70 - (document.body.offsetHeight - (window.innerHeight + window.pageYOffset));
                el_branches.css('bottom', offsetBottom + 'px');
            } else {
                el_branches.css('bottom', '0px');
            }
        });
    }
} 
function t970_init(recid) {
    var el_rec = $('#rec' + recid);
    var el_widget = el_rec.find('.t970');
    var el_closeBtn = el_rec.find('.t970__btn-close');
    var el_mainCheckbox = el_rec.find('#ny-widget-checkbox');

    el_closeBtn.on('click', function() {
        if (el_widget.attr('data-nywidget-hide') == 'yes') {
          el_widget.hide();
        } else {
            el_mainCheckbox.prop('checked', false);
        }
    });
    
}
 
function t971_init(recids) {
    recids = recids.split(',');
    recids.forEach(function(item) {
        t971_createSnowfall(item);
    });
}

function t971_getRandom(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function t971_createSnowfall(recid) {
    var snowSettings = {
        number: 50,
        minDuration: 10,
        maxDuration: 20,
    }
  
    var el_snowfallWrapper, 
        snowfallHeight, 
        wrappertype; 
    var wrapperblock = $('#rec' + recid); 
    if (recid && wrapperblock) { 
        var zeroattr = wrapperblock.attr('data-record-type'); 
        if (zeroattr == 396) { 
            wrappertype = " .t396__artboard"; 
        } else { 
            wrappertype = " .t-cover"; 
        } 
        el_snowfallWrapper = $('#rec' + recid + wrappertype); 
        var isWrapperPositioned = (el_snowfallWrapper.length > 0) && (el_snowfallWrapper.css('position') !== 'static'); 
        if (isWrapperPositioned) { 
            snowfallHeight = el_snowfallWrapper.height() + 'px'; 
        } else { 
            el_snowfallWrapper = $('body'); 
            snowfallHeight = Math.round(window.innerHeight) + 'px'; 
        } 
         
    } else { 
        el_snowfallWrapper = $('body'); 
        snowfallHeight = Math.round(window.innerHeight) + 'px'; 
    }
  
  
    var style = 
    '.t971__snowfall { ' +
        'position: absolute; ' +
        'top: 0; ' +
        'width: 100%;' +
        'height: ' + snowfallHeight + ';' +
        'backface-visibility: hidden;' +
        'pointer-events: none;' +
        'z-index: 50000; ' +
        'display: block; ' +
        'overflow: hidden; ' +
        'pointer-events: none; ' +
    '} ' +
    '.t971__snowflake { ' +
        'position: absolute; ' +
        'left: 0; ' +
        'top: 0; ' +
        'display: none;' +
    '} ';
    
    el_snowfallWrapper.append('<div id="t971__snowfall" class="t971__snowfall"></div>');
    var el_snowfallContainer = $('.t971__snowfall');
  
    var styleRule = '';
    var snowfall = '';
    var snowflake = [
        '<svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M15.934 1V29.739M29.72 14.795H1M26.273 4.448L5.595 25.141M26.273 25.141L5.595 4.448M20.529 4.448H11.339M20.529 25.141H11.339M26.273 19.393V10.196M5.595 19.393V10.196" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        '<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M7.319 1V13.6453M13.637 7.3226H1M11.797 2.8585L2.858 11.804M11.797 11.804L2.858 2.8585" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        '<svg width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M13.636 1V26.2906M26.273 13.6453H1M22.827 22.8419L4.446 4.4488M22.827 4.4488L4.446 22.8419L13.6365 13.6453L22.827 4.4488ZM6.744 6.7479H20.529V20.5428H6.744V6.7479Z" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        '<svg width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" d="M13.637 1V26.291M26.273 13.645H1M22.664 4.61299L4.612 22.678M22.664 22.678L4.612 4.61299M17.245 2.806L13.625 6.41899L10.024 2.806H17.245ZM10.024 24.484L13.625 21.774L17.245 24.484H10.024ZM24.467 17.258L20.857 13.655L24.467 10.033V17.258ZM2.804 10.033L6.414 13.655L2.804 17.258V10.033Z" stroke="white" stroke-linecap="round" stroke-linejoin="round"/></svg>'
    ];

    for (i = 1; i <= snowSettings.number; i++) {
  
        var parentHeight = snowfallHeight,
            leftStart = Math.round(window.innerWidth / (100 / t971_getRandom(0, 100))),
            leftOffset = Math.round(window.innerWidth / (100 / t971_getRandom(-10, 10))),
            leftEnd = leftStart + leftOffset,
            duration = t971_getRandom(snowSettings.minDuration, snowSettings.maxDuration),
            delay = t971_getRandom(1, 30).toFixed(2) * -1,
            opacity = Math.random().toFixed(2),
            flakeStyle = t971_getRandom(0,3);
            
          styleRule = 
            '.t971__snowflake:nth-child(' + i + ') {' +
                'max-width: 40px;' + 
                'max-height: 40px;' + 
                'display: block;' +
                'opacity: ' + opacity + ';' + 
                '-moz-animation: snow-' + i + ' ' + duration + 's ' + delay + 's '+ 'linear infinite;' +
                '-webkit-animation: snow-' + i + ' ' + duration + 's ' + delay + 's '+ 'linear infinite;' +
                'animation: snow-' + i + ' ' + duration + 's ' + delay + 's '+ 'linear infinite;' +
            '}' +
        
            '@keyframes snow-' + i + ' {' +
                '0% {' +
                    'transform: translate(' + leftStart + 'px, -10px)' + 
                '}' +
                '80% {' +
                    'opacity: ' + opacity + ';' + 
                '}' +

                '100% {' +
                    'opacity: 0;' +
                    'transform: translate(' + leftEnd + 'px, ' + parentHeight + ')' + 
                '}' +
            '}';
      
      
        style += styleRule;  
        snowfall += '<div class="t971__snowflake">' + snowflake[flakeStyle] + '</div>';
    }
  
    el_snowfallContainer.append(snowfall);
    $('head').append('<style>' + style + '</style>');
} 
function t972_init(recid) {
	if (t972_getCookie('t_cookiesConsentGiven')) {
		t972_acceptCookies();
		return;
	} else {
		var el_rec = $('#rec' + recid);
		var wrapper = el_rec.find('.t972');
		wrapper.removeClass('t972_closed');
		t972_addEvents(recid);
		t972_addCookieEvents(recid);
		t972_translateToggle(recid);
	}
}

function t972_initPreview(recid) {
	t972_addEvents(recid);
	t972_translateToggle(recid);
}

function t972_getCookie(name) {
	var matches = document.cookie.match(
		new RegExp('(?:^|; )' + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)')
	);
	var cookie = matches ? { name: name, val: decodeURIComponent(matches[1]) } : null;
	return cookie;
}

function t972_createCookie(name, value, days) {
	var expires;
	if (days) {
		var date = new Date();
		var dayInMs = 24 * 60 * 60 * 1000;
		date.setTime(date.getTime() + days * dayInMs);
		expires = '; expires=' + date.toGMTString();
	} else {
		expires = '';
	}
	document.cookie = name + '=' + value + expires + '; path=/';
}

function t972_confirmCookies(list) {
	var cookiesForm = $('.t972__categories');
	if (list === 'all') {
		$('.t972__categories :input[name="cookie_type"]').each(function (index, el) {
			$(this).prop('checked', true);
		});
	}
	var selectedCookies = cookiesForm.serializeArray().map(function (item) {
		return item.value;
	});

	var allowedCookiesList = JSON.stringify(selectedCookies);
	t972_createCookie('t_cookiesCategories', allowedCookiesList, 365);

	t972_acceptCookies();
}

function t972_acceptCookies() {
	var allowedCookiesList = t972_getCookie('t_cookiesCategories').val;
	var scriptsList = $('script[data-tilda-cookie-type]');
	scriptsList.each(function (index) {
		var $this = $(this);
		if (allowedCookiesList.indexOf($this.attr('data-tilda-cookie-type')) !== -1) {
			if ($this.attr('type') && $this.attr('type') === 'text/plain') {
				var str = $this.html();
				$this.html('');
				$this.attr('type', 'text/javascript');
				$this.html(str.replace('}, 2000);', '}, 200);'));
				if (allowedCookiesList.indexOf('advertising') == -1) {
					if (str.indexOf('google-analytics') !== -1) {
						$this.html(str.replace('auto', '{ storeGac: false }'));
					}
				}
				if (allowedCookiesList.indexOf('analytics') !== -1) {
					if (typeof tildastat == 'function') {
						tildastat('cookieenabled');
					} else {
						setTimeout(function () {
							if (typeof tildastat == 'function') {
								tildastat('cookieenabled');
							}
						}, 1000);
					}
				}
				$this.attr('data-tilda-cookie-consent', 'accepted');
			}
			if ($this.attr('data-src')) {
				$this.attr('src', $this.attr('data-src'));
				$this.attr('data-tilda-cookie-consent', 'accepted');
			}
		}
	});

	t972_createCookie('t_cookiesConsentGiven', 'true', 365);
}

function t972_addEvents(recid) {
	var el_rec = $('#rec' + recid);
	var wrapper = el_rec.find('.t972');
	var settingsBtn = wrapper.find('.t972__settings-btn');
	var settingsHeader = wrapper.find('.t972__settings-header');
	var categoryTitle = wrapper.find('.t972__category-header');
	var categoryToggle = wrapper.find('.t972__toggle-input');

	var cookiesBanner = wrapper.find('.t972__banner');
	var settingsBanner = wrapper.find('.t972__settings');

	settingsBtn.click(function () {
		cookiesBanner.css('display', 'none');
		settingsBanner.css('display', 'flex');
	});
	settingsHeader.click(function () {
		cookiesBanner.css('display', 'block');
		settingsBanner.css('display', 'none');
	});
	categoryTitle.click(function () {
		var categoryBody = $(this).closest('.t972__category').find('.t972__category-body');
		$(this).toggleClass('t972__opened');
		categoryBody.slideToggle();
	});
	categoryToggle.change(function () {
		var toggleText = $(this).closest('.t972__category-toggle').find('.t972__toggle-txt');
		if (this.checked) {
			toggleText.addClass('t972__category-enabled');
			toggleText.text(t972_trans('enabled'));
		} else {
			toggleText.removeClass('t972__category-enabled');
			toggleText.text(t972_trans('disabled'));
		}
	});
}
function t972_addCookieEvents(recid) {
	var el_rec = $('#rec' + recid);
	var wrapper = el_rec.find('.t972');
	var confirmBtn = wrapper.find('.t972__confirm-btn');
	var acceptBtn = wrapper.find('.t972__accept-btn');

	var cookiesBanner = wrapper.find('.t972__banner');
	var settingsBanner = wrapper.find('.t972__settings');

	confirmBtn.click(function () {
		t972_confirmCookies('selected');
		cookiesBanner.css('display', 'none');
		settingsBanner.css('display', 'none');
	});
	acceptBtn.click(function () {
		t972_confirmCookies('all');
		cookiesBanner.css('display', 'none');
		settingsBanner.css('display', 'none');
	});
}
function t972_translateToggle(recid) {
	var el_rec = $('#rec' + recid);
	var wrapper = el_rec.find('.t972');
	var category = wrapper.find('.t972__category-toggle');
	var categoryText = category.find('.t972__toggle-txt');
	categoryText.each(function (index) {
		var $this = $(this);
		if ($this.hasClass('js_always-enabled')) {
			$this.text(t972_trans('alwaysEnabled'));
		} else {
			var categoryInput = $this.parent().find('.t972__toggle-input');
			if (categoryInput.is(':checked')) {
				$this.text(t972_trans('enabled'));
			} else {
				$this.text(t972_trans('disabled'));
			}
		}
	});
}
function t972_trans(key) {
	var data = {
		alwaysEnabled: {
			EN: 'Always Enabled',
			RU: 'Всегда разрешено',
			FR: 'Toujours actif',
			DE: 'Immer aktiv',
			ES: 'Activas siempre',
			PT: 'Sempre ativos',
			JA: '常にアクティブ',
			ZH: '始終啟用',
			UK: 'Завжди дозволено',
			PL: 'Zawsze aktywne',
			KK: 'Әрқашан қосылады',
			IT: 'Sempre attivi',
			LV: 'Vienmēr iespējots',
		},
		enabled: {
			EN: 'Enabled',
			RU: 'Разрешено',
			FR: 'Actif',
			DE: 'Aktiv',
			ES: 'Activas',
			PT: 'Ativos',
			JA: 'アクティブ',
			ZH: '启用',
			UK: 'Дозволено',
			PL: 'Aktywne',
			KK: 'Қосылды',
			IT: 'Attivi',
			LV: 'Iespējots',
		},
		disabled: {
			EN: 'Disabled',
			RU: 'Запрещено',
			FR: 'Désactivé',
			DE: 'Inaktiv',
			ES: 'Discapacitado',
			PT: 'Desativado',
			JA: 'オフにした',
			ZH: '已禁用',
			UK: 'Вимкнено',
			PL: 'Wyłączone',
			KK: 'Өшірілген',
			IT: 'Disabilitato',
			LV: 'Atspējots',
		},
	};

	var lang = window.browserLang.toUpperCase();

	return lang && data[key][lang] ? data[key][lang] : data[key]['EN'];
}
 
function t975_init(recid) {
	var el_rec = $('#rec' + recid);
	var el_menu = el_rec.find('.t975');
    t975_findActiveItem(recid);
    el_menu.removeClass('t975__beforeready');
    t975_checkAnchorLinks(recid);
    t975_detectIphone(el_menu);
    if (el_menu.attr('data-hidemenuonscroll') || t975_detectIphone(el_menu)) {
        t975_handleScroll(el_menu);
    }
    if ($('#tildacopy').length > 0 && $(document).height() > 800) {
        t975_addCopyrightMargin(el_menu);
    }
}
function t975_addCopyrightMargin(el_menu) {
    var menuHeight = el_menu.height();
    $('#tildacopy').css('paddingBottom', menuHeight);
    t975_handleScroll(el_menu);
}
function t975_detectIphone(el_menu) {
    var isIphone = /iPhone/.test(navigator.userAgent) && !window.MSStream;
    var aspect = window.screen.width / window.screen.height;
    var iphoneAspect = "0.462";
    if (isIphone && aspect.toFixed(3) === iphoneAspect) {
        return true;
    }
}
function t975_findActiveItem(recid) {
	var url = window.location.href;
	var pathname = window.location.pathname;
	var hash = window.location.hash;
	if (url.substr(url.length - 1) == '/') {
		url = url.slice(0, -1);
	}
	if (pathname.substr(pathname.length - 1) == '/') {
		pathname = pathname.slice(0, -1);
	}
	if (pathname.charAt(0) == '/') {
		pathname = pathname.slice(1);
	}
	if (pathname == '') {
		pathname = '/';
	}
	$(".t975__list-item a[href='" + url + "'] ").addClass('t-active');
	$(".t975__list-item a[href='" + url + "/']").addClass('t-active');
	$(".t975__list-item a[href='" + pathname + "']").addClass('t-active');
	$(".t975__list-item a[href='/" + pathname + "']").addClass('t-active');
	$(".t975__list-item a[href='" + pathname + "/']").addClass('t-active');
	$(".t975__list-item a[href='/" + pathname + "/']").addClass('t-active');
	if (hash) {
		$(".t975__list-item a[href='" + hash + "']").addClass('t-active');
	}
}

function t975_checkAnchorLinks(recid) {
	var navLinks = $('#rec' + recid + " .t975__list-item a:not(.tooltipstered)[href*='#']");
	if (navLinks.length > 0) {
		t975_catchScroll(navLinks, recid);
	}
}

function t975_catchScroll(navLinks, recid) {
	var clickedSectionId = null,
		sections = new Array(),
		sectionIdTonavigationLink = [];
	var el_rec = $('#rec' + recid);
	var el_menu = el_rec.find('.t975');

	navLinks = $(navLinks.get().reverse());
	navLinks.each(function() {
		var cursection = t975_getSectionByHref($(this));
		if (typeof cursection.attr('id') != 'undefined') {
			sections.push(cursection);
		}
		sectionIdTonavigationLink[cursection.attr('id')] = $(this);
	});
	t975_updateSectionsOffsets(sections);
	sections.sort(function(a, b) {
		return b.attr('data-offset-top') - a.attr('data-offset-top');
	});

	t975_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);

	navLinks.click(function() {
		var clickedSection = t975_getSectionByHref($(this));
		if (!$(this).hasClass('tooltipstered') && typeof clickedSection.attr('id') != 'undefined') {
			navLinks.removeClass('t-active');
			$(this).addClass('t-active');
			clickedSectionId = t975_getSectionByHref($(this)).attr('id');
		}
	});
	
    /* events */
	$(window).bind('resize', t_throttle(function() {
		t975_updateSectionsOffsets(sections);
	}));
	el_menu.bind('displayChanged', function() {
		t975_updateSectionsOffsets(sections);
	});
	$(window).bind('scroll', t_throttle(function () {
	    clickedSectionId = t975_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
	}));
}

function t975_updateSectionsOffsets(sections) {
	$(sections).each(function() {
		var curSection = $(this);
		curSection.attr('data-offset-top', curSection.offset().top);
	});
}

function t975_getSectionByHref(curlink) {
	var curLinkValue = curlink.attr('href').replace(/\s+/g, '').replace(/.*#/, '');
	if (curlink.is('[href*="#rec"]')) {
		return $(".r[id='" + curLinkValue + "']");
	} else {
		return $(".r[data-record-type='215']").has("a[name='" + curLinkValue + "']");
	}
}

function t975_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId) {
	var scrollPosition = $(window).scrollTop(),
		valueToReturn = clickedSectionId;
	/*if first section is not at the page top (under first blocks)*/
	if (sections.length != 0 && clickedSectionId == null && sections[sections.length - 1].attr('data-offset-top') > scrollPosition + 300) {
		navLinks.removeClass('t-active');
		return null;
	}

	$(sections).each(function(e) {
		var curSection = $(this),
			sectionTop = curSection.attr('data-offset-top'),
			sectionId = curSection.attr('id'),
			navLink = sectionIdTonavigationLink[sectionId];
		if (scrollPosition + 300 >= sectionTop || (sections[0].attr('id') == sectionId && scrollPosition >= $(document).height() - $(window).height())) {
			if (clickedSectionId == null && !navLink.hasClass('t-active')) {
				navLinks.removeClass('t-active');
				navLink.addClass('t-active');
				valueToReturn = null;
			} else {
				if (clickedSectionId !== null && sectionId == clickedSectionId) {
					valueToReturn = null;
				}
			}
			return false;
		}
	});
	return valueToReturn;
}

function t975_handleScroll(el_menu) {
	var isScrolling;
	var lastScrollTop = 0;
	var delta = 5;
	var initialHeight = window.innerHeight;
	var maxHeight = initialHeight;
	var menuPadding;

	$(window).bind('scroll', t_throttle(function () {
		var currentScrollTop = $(this).scrollTop();
		if (Math.abs(lastScrollTop - currentScrollTop) <= delta) return;
		if (t975_detectIphone(el_menu)) {
			if ($('#tildacopy').length > 0 && $(document).height() > 800) {
			    var menuHeight = el_menu.outerHeight();
                $('#tildacopy').css('paddingBottom', menuHeight);
			}
		}
		if (el_menu.attr('data-hidemenuonscroll')) {
			currentScrollTop > lastScrollTop ? el_menu.slideDown(240) : el_menu.slideUp();
		}
		
		lastScrollTop = currentScrollTop;
	}));

}
 
function t976_highlight(recid) {
	var url = window.location.href;
	var pathname = window.location.pathname;
	var hash = window.location.hash;
	if (url.substr(url.length - 1) === '/') {
		url = url.slice(0, -1);
	}
	if (pathname.substr(pathname.length - 1) === '/') {
		pathname = pathname.slice(0, -1);
	}
	if (pathname.charAt(0) === '/') {
		pathname = pathname.slice(1);
	}
	if (pathname === '') {
		pathname = '/';
	}
	
	var shouldBeActiveElements = document.querySelectorAll(
		'.t976__list-item a[href=\'' + url + '\'], ' +
		'.t976__list-item a[href=\'' + url + '/\'], ' +
		'.t976__list-item a[href=\'' + pathname + '\'], ' +
		'.t976__list-item a[href=\'/' + pathname + '\'], ' +
		'.t976__list-item a[href=\'' + pathname + '/\'], ' +
		'.t976__list-item a[href=\'/' + pathname + '/\'], ' +
		'.t976__list-item a[href=\'/' + hash + '/\']');
	
	Array.prototype.forEach.call(shouldBeActiveElements, function (link) {
		link.classList.add('t-active');
	});
}

/*deprecated*/
function t976_checkAnchorLinks(recid) {}
 
function t978_init(recid, cols, openOnClick) {
    var hook = $('#rec' + recid + ' .t978').attr('data-tooltip-hook');
    if (typeof hook === 'undefined' || hook === '') {
        return;
    }

    var hookLinks = $('a[href="' + hook + '"]');
    hookLinks.addClass('t978__tm-link');
    hookLinks.attr('data-tooltip-menu-id', recid);

    var parentMenu = hookLinks.closest('[data-menu]');
    var tooltipMenu = $('#rec' + recid + ' .t978__tooltip-menu');
    tooltipMenu.attr('data-pos-fixed', 'no');

    if (parentMenu.length && parentMenu.css('position') == 'fixed') {
        tooltipMenu.attr('data-pos-fixed', 'yes');
    }

    t978_addArrow(recid, hookLinks);
    t978_setUpMenu(recid, hookLinks, cols, openOnClick);
    t978_findActiveItem();
}

function t978_preview(recid, cols) {
    var tooltipMenu = $('#rec' + recid + ' .t978__tooltip-menu');
    var content = tooltipMenu.find('.t978__content');
    var submenuContainer = content.find('.t978__submenu-container');
    var submenuWrapper = content.find('.t978__submenu-wrapper');

    submenuWrapper.each(function () {
        var submenuItems = $(this).find('.t978__submenu-item');
        t978_divideMenu(submenuItems, cols);
    });

    var submenuActiveLink = content.find('.t978__menu-link[data-menu-submenu-hook!=""]');
    var submenuHook = $(submenuActiveLink[0]).attr('data-menu-submenu-hook');
    if (submenuHook) {
        var activeSubmenuContainer = content.find('.t978__submenu-wrapper[data-submenu-hook="' + submenuHook + '"]');
        var activeSubmenu = activeSubmenuContainer.find('.t978__submenu');

        if ($(window).width() > 980) {
            activeSubmenuContainer.show();
            submenuContainer.show();
            activeSubmenu.addClass('t978__submenu_show');
        }
    }
}

function t978_divideMenu(items, cols) {
    if (cols === '') {
        cols = 1;
    }

    var itemsPerCol = [],
        minItemsPerCol = Math.floor(items.length / cols),
        remainder = items.length % cols,
        pointer = 0;

    var colclass = 't978__menu-col_' + cols;

    for (var i = 0; i < cols; i++) {
        itemsPerCol[i] = i < remainder ? minItemsPerCol + 1 : minItemsPerCol;
        items
            .slice(pointer, pointer + itemsPerCol[i])
            .wrapAll('<div class="t978__menu-col ' + colclass + '"></div>');
        pointer += itemsPerCol[i];
    }
}

function t978_setUpMenu(recid, hookLinks, cols, openOnClick) {
    var tooltipMenu = $('#rec' + recid + ' .t978__tooltip-menu');
    var content = tooltipMenu.find('.t978__content');
    var submenuWrapper = tooltipMenu.find('.t978__submenu-wrapper');

    submenuWrapper.each(function () {
        var submenuItems = $(this).find('.t978__submenu-item');
        t978_divideMenu(submenuItems, cols);
    });

    var vIndent = $('#rec' + recid + ' .t978').attr('data-tooltip-margin');

    if ($(window).width() > 980) {
        t978_addEventsDesktop(tooltipMenu, hookLinks, vIndent, openOnClick);
    } else {
        t978_addEventsMobile(tooltipMenu, hookLinks, vIndent, openOnClick);
    }

    $(window).bind('scroll', t_throttle(function () {
        content.mouseleave(function () {
            if (tooltipMenu.hasClass('t978__tooltip-menu_show') || hookLinks.filter('.t978__tm-link_active').next().hasClass('t978__tooltip-menu_mobile')) {
                var tooltip_mobile = hookLinks.filter('.t978__tm-link_active').next();
                t978_hideTooltipmenu(tooltip_mobile);
            }
        });
    }, 300));
    $('.t978__tooltip-menu a[href*="#"]').click(function () {
        t978_hideTooltipmenu(tooltipMenu, $(this));
        $('.t450, .t199__mmenu, .t280, .t282, .t204__burger, .t451, .t466').trigger('clickedAnchorInTooltipMenu');
        $('.t978__tooltip-menu a[href*="#"]').removeClass('t-active');
        $(this).addClass('t-active');
    });
}

function t978_addEventsDesktop(tooltipMenu, hookLinks, vIndent, openOnClick) {
    var menuLinks = tooltipMenu.find('.t978__menu-link');
    var submenuContainer = tooltipMenu.find('.t978__submenu-container');
    var submenuWrapper = tooltipMenu.find('.t978__submenu-wrapper');
    var timer;
    var curAnchor;

    hookLinks.add(tooltipMenu).on('mouseover', function (e) {
        e.preventDefault();
        if ($(this).hasClass('t978__tooltip-menu') && !$(this).hasClass('t978__tooltip-menu_show')) {
            return;
        }
        clearTimeout(timer);
        if ($(this).hasClass('t978__tooltip-menu') && tooltipMenu.hasClass('t978__tooltip-menu_show')) {
            return;
        }
        curAnchor = $(this);
        t978_showTooltipmenu(curAnchor, tooltipMenu, vIndent);
        t978_addSubmenuEvents(tooltipMenu, openOnClick);
    });
    hookLinks.add(tooltipMenu).on('mouseout', function () {
        timer = setTimeout(function () {
            t978_hideTooltipmenu(tooltipMenu);
            t978_resetSubmenu(menuLinks, submenuWrapper, submenuContainer);
        }, 300);
    });

    $(window).bind('resize', t_throttle(function () {
        t978_hideTooltipmenu($('.t978__tooltip-menu_mobile'));
    }, 300));
}

function t978_addEventsMobile(tooltipMenu, hookLinks, vIndent, openOnClick) {
    var curAnchor;
    hookLinks.on('click', function (e) {
        e.preventDefault();
        var tooltip_mobile;
        var submenuLinks = tooltipMenu.find('.t978__menu-link');
        var submenuContainer = tooltipMenu.find('.t978__submenu-container');
        var submenuWrapper = tooltipMenu.find('.t978__submenu-wrapper');

        if (tooltipMenu.hasClass('t978__tooltip-menu_show') || hookLinks.filter('.t978__tm-link_active').next().hasClass('t978__tooltip-menu_mobile')) {
            tooltip_mobile = hookLinks.filter('.t978__tm-link_active').next();
            t978_hideTooltipmenu(tooltip_mobile, $(this));
        } else {
            curAnchor = $(this);
            tooltip_mobile = tooltipMenu.clone();
            tooltip_mobile.addClass('t978__tooltip-menu_mobile');

            t978_showTooltipmenu(curAnchor, tooltip_mobile, vIndent);
        }
        t978_addSubmenuEvents(tooltip_mobile, openOnClick);
    });
}

function t978_showTooltipmenu(curAnchor, tooltipmenu, vIndent) {
    if ($(window).width() <= 980) {
        tooltipmenu.insertAfter(curAnchor);
        tooltipmenu.parents('.t228').trigger('overflow');
        tooltipmenu.css({
            position: 'static'
        });
        tooltipmenu.addClass('t978__tooltip-menu_show');
        if (tooltipmenu.closest('.t280').length > 0 || tooltipmenu.closest('.t450').length > 0 || tooltipmenu.closest('.t451').length > 0) {
            tooltipmenu.show();
        } else {
            tooltipmenu.slideDown();
        }

        curAnchor.addClass('t978__tm-link_active');

        if (window.lazy == 'y') {
            t_lazyload_update();
        }
    } else {
        t978_positionTooltipmenu(curAnchor, tooltipmenu, vIndent);
        if (window.lazy == 'y') {
            t_lazyload_update();
        }
    }
}

function t978_positionTooltipmenu(curAnchor, tooltipMenu, vIndent) {
    t978_positionTooltipmenuX(curAnchor, tooltipMenu);
    t978_positionTooltipmenuY(curAnchor, tooltipMenu, vIndent);

    tooltipMenu.fadeIn(0);
    tooltipMenu.addClass('t978__tooltip-menu_show');
    curAnchor.addClass('t978__tm-link_active');

}

function t978_positionTooltipmenuX(curAnchor, tooltipMenu) {
    var menu = tooltipMenu.find('.t978__menu');
    var corner = tooltipMenu.find('.t978__tooltip-menu-corner');
    var cornerBorder = tooltipMenu.find('.t978__tooltip-menu-corner-border');

    var winWidth = $(window).width();
    var menuWidth = menu.outerWidth();
    var tooltipmenuWidth = tooltipMenu.outerWidth();
    var anchorWidth = curAnchor.width();
    if (curAnchor.hasClass('t-btn')) {
        anchorWidth = curAnchor.outerWidth();
    }

    var anchorLeft = curAnchor.offset().left;
    var cornerLeft;
    var menuX, initialMenuX;

    var anchorCenter, menuCenter;

    var arrowHeight = 10;
    var menuPos = 'left';
    var menuWindowMargin = 10;
    var minMenuWidth = 200;

    initialMenuX = (anchorLeft + anchorWidth / 2) - menuWidth / 2;
    anchorX = anchorLeft;

    if ((initialMenuX + menuWidth) > winWidth - minMenuWidth) {
        menuPos = 'right';
        menu.css('order', '1');
        anchorX = winWidth - (anchorLeft + anchorWidth);

        menuX = winWidth - initialMenuX - tooltipmenuWidth;
        if (initialMenuX + tooltipmenuWidth > winWidth - menuWindowMargin) {
            menuX = menuWindowMargin;
        }
    } else {
        menuX = initialMenuX;
        if (initialMenuX < menuWindowMargin) {
            menuX = menuWindowMargin;
        }
    }

    cornerLeft = menuWidth / 2 - arrowHeight / 2;

    anchorCenter = anchorX + anchorWidth / 2;
    menuCenter = menuX + menuWidth / 2;

    if (menuCenter != anchorCenter) {
        if (menuX < anchorX) {
            cornerLeft = (anchorX - menuX) + anchorWidth / 2 - arrowHeight / 2;
        } else {
            cornerLeft = anchorWidth / 2 - arrowHeight / 2;
        }
    }

    corner.css(menuPos, cornerLeft);
    cornerBorder.css(menuPos, cornerLeft);

    tooltipMenu.css(menuPos, menuX);

}

function t978_positionTooltipmenuY(curAnchor, tooltipMenu, vIndent) {
    var tooltipmenuHeight = tooltipMenu.outerHeight();
    var winHeight = $(window).height();
    var scrollTop = $(window).scrollTop();
    var anchorHeight = curAnchor.height();
    var menuFixed = tooltipMenu.attr('data-pos-fixed');

    var corner = tooltipMenu.find('.t978__tooltip-menu-corner');
    var cornerBorder = tooltipMenu.find('.t978__tooltip-menu-corner-border');

    var arrowHeight = 10;
    var vIndentDefault = 25;

    if (typeof vIndent != 'undefined' && vIndent != '') {
        vIndent = vIndent.replace('px', '') * 1;
        /*add arrow*/
        vIndent = vIndent + arrowHeight;
    } else {
        vIndent = vIndentDefault;
    }

    var posy;
    if (menuFixed == 'yes') {
        posy = (curAnchor.offset().top - scrollTop) + anchorHeight + vIndent;
        tooltipMenu.css('position', 'fixed');
    } else {
        posy = curAnchor.offset().top + anchorHeight + vIndent;
    }

    if (
        posy + tooltipmenuHeight > scrollTop + winHeight &&
        posy >= tooltipmenuHeight &&
        posy - scrollTop > tooltipmenuHeight
    ) {
        posy = Math.max(
            posy - tooltipmenuHeight - anchorHeight - vIndent * 2,
            scrollTop
        );
        tooltipMenu
            .removeClass('t978__tooltip-menu_bottom')
            .addClass('t978__tooltip-menu_top');
        corner
            .removeClass('t978__tooltip-menu-corner_bottom')
            .addClass('t978__tooltip-menu-corner_top');
        cornerBorder
            .removeClass('t978__tooltip-menu-corner-border_bottom')
            .addClass('t978__tooltip-menu-corner-border_top');
    } else {
        tooltipMenu
            .removeClass('t978__tooltip-menu_top')
            .addClass('t978__tooltip-menu_bottom');
        corner
            .removeClass('t978__tooltip-menu-corner_top')
            .addClass('t978__tooltip-menu-corner_bottom');
        cornerBorder
            .removeClass('t978__tooltip-menu-corner-border_top')
            .addClass('t978__tooltip-menu-corner-border_bottom');
    }
    tooltipMenu.css('top', posy);
}

function t978_hideTooltipmenu(tooltipmenu, link) {
    var menu = tooltipmenu.find('.t978__menu');
    var corner = tooltipmenu.find('.t978__tooltip-menu-corner');
    var cornerBorder = tooltipmenu.find('.t978__tooltip-menu-corner-border');
    var menuHookLink = link ? link : tooltipmenu.closest().find('.t978__tm-link_active');
    if (tooltipmenu.hasClass('t978__tooltip-menu_mobile')) {
        if (tooltipmenu.closest('.t280').length > 0 || tooltipmenu.closest('.t450').length > 0 || tooltipmenu.closest('.t451').length > 0) {
            tooltipmenu.hide(0, function () {
                tooltipmenu.remove();
            });

        } else {
            tooltipmenu.slideUp('normal', function () {
                tooltipmenu.remove();
            });
        }
        menuHookLink.removeClass('t978__tm-link_active');
        return;
    } else {
        var content = tooltipmenu.find('.t978__content');

        tooltipmenu.css({
            display: '',
            left: '',
            right: '',
            top: '',
            width: '',
        });
        menu.css('order', '');
        content.css({
            'overflow-y': '',
            height: '',
        });
        corner.css({
            left: '',
            right: ''
        });
        cornerBorder.css({
            left: '',
            right: ''
        });

        tooltipmenu.removeClass('t978__tooltip-menu_show');
    }
    $('.t978__tm-link_active').removeClass('t978__tm-link_active');
}

function t978_addSubmenuEvents(tooltipMenu, openOnClick) {
    var submenuLinks = tooltipMenu.find('.t978__menu-link');
    var submenuContainer = tooltipMenu.find('.t978__submenu-container');
    var submenuWrapper = tooltipMenu.find('.t978__submenu-wrapper');
    var submenuContent = tooltipMenu.find('.t978__submenu-content');
    var timer;
    var submenuOpened = false;

    submenuLinks.off();
    if ($(window).width() > 980) {
        if (openOnClick == 'on') {
            submenuLinks.on('click', function (e) {
                var submenuHook = $(this).attr('data-menu-submenu-hook');
                if (submenuHook) {
                    e.preventDefault();
                    if (submenuOpened) {
                        t978_resetSubmenu(submenuLinks, submenuWrapper, submenuContainer);
                        submenuOpened = false;
                    } else {
                        $(this).addClass('t978__menu-activelink');
                        t978_showSubmenu(tooltipMenu, submenuHook);
                        submenuOpened = true;
                    }
                }
            });
        } else {
            submenuLinks.add(submenuContent).on('mouseover', function (e) {
                if ($(e.target).is(submenuLinks.not('.t978__menu-activelink')) || $(e.target).parent().is(submenuLinks.not('.t978__menu-activelink'))) {
                    t978_resetSubmenu(submenuLinks, submenuWrapper, submenuContainer);
                }
                var submenuHook = $(this).attr('data-menu-submenu-hook');
                if (submenuHook) {
                    $(this).addClass('t978__menu-hoverlink');
                    t978_showSubmenu(tooltipMenu, submenuHook);
                }
                clearTimeout(timer);
            });
            submenuLinks.add(submenuContent).on('mouseout', function (e) {
                var submenuHook = $(this).attr('data-menu-submenu-hook');
                if (submenuHook) {
                    timer = setTimeout(function () {
                        t978_resetSubmenu(submenuLinks, submenuWrapper, submenuContainer);
                    }, 300);
                }
            });
        }
    }

    submenuLinks.on('click', function (e) {
        var submenuHook = $(this).attr('data-menu-submenu-hook');
        if (submenuHook) {
            e.preventDefault();
            if ($(window).width() <= 980) {
                if ($(this).hasClass('t978__menu-activelink')) {
                    t978_hideSubmenu(tooltipMenu, submenuHook);
                } else {
                    $(this).addClass('t978__menu-activelink');
                    t978_showSubmenu(tooltipMenu, submenuHook);
                    clearTimeout(timer);
                }
            }
        }
    })
}

function t978_showSubmenu(tooltipMenu, submenuHook) {
    var content = tooltipMenu.find('.t978__content');
    var submenuContainer = content.find('.t978__submenu-container');
    var submenuWrapper = content.find(
        '.t978__submenu-wrapper[data-submenu-hook="' + submenuHook + '"]'
    );
    var activeLinkWrapper = content
        .find('.t978__menu-link[data-menu-submenu-hook="' + submenuHook + '"]')
        .parent();

    tooltipMenu.parents('.t228').trigger('overflow');
    
    if ($(window).width() <= 980) {
        submenuWrapper.insertAfter(activeLinkWrapper);
        if (content.closest('.t280').length > 0 || content.closest('.t450').length > 0 || content.closest('.t451').length > 0) {
            submenuContainer.addClass('t978__submenu_show');
            submenuWrapper.addClass('t978__submenu_show');
        } else {
            submenuWrapper.slideDown();
        }
    } else {
        submenuContainer.addClass('t978__submenu_show');
        submenuWrapper.addClass('t978__submenu_show');
    }

}

function t978_hideSubmenu(tooltipMenu, submenuHook) {
    var content = tooltipMenu.find('.t978__content');
    var submenuContainer = content.find('.t978__submenu-container');
    var submenuWrapper = content.find(
        '.t978__submenu-wrapper[data-submenu-hook="' + submenuHook + '"]'
    );
    var activeLink = content.find('.t978__menu-link[data-menu-submenu-hook="' + submenuHook + '"]');

    activeLink.removeClass('t978__menu-activelink');
    activeLink.removeClass('t978__menu-hoverlink');
    if ($(window).width() <= 980) {
        if (content.closest('.t280').length > 0 || content.closest('.t450').length > 0 || content.closest('.t451').length > 0) {
            submenuContainer.removeClass('t978__submenu_show');
            submenuWrapper.removeClass('t978__submenu_show');
        } else {
            submenuContainer.slideUp();
            submenuWrapper.slideUp();
        }
    } else {
        submenuContainer.removeClass('t978__submenu_show');
        submenuWrapper.removeClass('t978__submenu_show');
    }
}

function t978_resetSubmenu(submenuLinks, submenuWrapper, submenuContainer) {
    submenuLinks.each(function () {
        $(this).removeClass('t978__menu-activelink');
        $(this).removeClass('t978__menu-hoverlink');
    });
    if ($(window).width() <= 980) {
        submenuContainer.slideUp();
        submenuWrapper.slideUp();

    } else {
        submenuWrapper.each(function () {
            $(this).removeClass('t978__submenu_show');
        });
        submenuContainer.each(function () {
            $(this).removeClass('t978__submenu_show');
        });
    }
}

function t978_addArrow(recid, hookLinks) {
    var arrow = $('#rec' + recid + ' .t978').attr('data-add-arrow');
    if (typeof arrow == 'undefined' || arrow == '') {
        return;
    }
    hookLinks.each(function (i, el) {
        $(el).append('<div class="t978__arrow"></div>');
    });
}

function t978_findActiveItem() {
    var url = window.location.href;
    var pathname = window.location.pathname;
    var hash = window.location.hash;
    if (url.substr(url.length - 1) == '/') {
        url = url.slice(0, -1);
    }
    if (pathname.substr(pathname.length - 1) == '/') {
        pathname = pathname.slice(0, -1);
    }
    if (pathname.charAt(0) == '/') {
        pathname = pathname.slice(1);
    }
    if (pathname == '') {
        pathname = '/';
    }
    $("a[href='" + url + "'].t978__menu-link").addClass('t-active');
    $("a[href='" + url + "/'].t978__menu-link").addClass('t-active');
    $("a[href='" + pathname + "'].t978__menu-link").addClass('t-active');
    $("a[href='/" + pathname + "'].t978__menu-link").addClass('t-active');
    $("a[href='" + pathname + "/'].t978__menu-link").addClass('t-active');
    $("a[href='/" + pathname + "/'].t978__menu-link").addClass('t-active');
    if (hash) {
        $("a[href='" + hash + "'].t978__menu-link").addClass('t-active');
    }

    $("a[href='" + url + "'].t978__submenu-link").addClass('t-active');
    $("a[href='" + url + "/'].t978__submenu-link").addClass('t-active');
    $("a[href='" + pathname + "'].t978__submenu-link").addClass('t-active');
    $("a[href='/" + pathname + "'].t978__submenu-link").addClass('t-active');
    $("a[href='" + pathname + "/'].t978__submenu-link").addClass('t-active');
    $("a[href='/" + pathname + "/'].t978__submenu-link").addClass('t-active');
    if (hash) {
        $("a[href='" + hash + "'].t978__submenu-link").addClass('t-active');
    }
} 
function t979_init(recid, rowheight, guttersizer) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var grid = rec.querySelector('.t979__grid');
	var items = rec.querySelectorAll('.t979__grid-item');
	var images = rec.querySelectorAll('.t979__image');
	var overlayList = rec.querySelectorAll('.t979__overlay');
	
	if (guttersizer === '') guttersizer = 0;
	
	t979_reverse(grid);
	t979_initMasonry(rec, recid, grid, rowheight, guttersizer, images);
	
	/*TODO jQuery*/
	if (typeof jQuery !== 'undefined') {
		$(rec).find('.t979').bind('displayChanged', t_throttle(function () {
			var gutterSizer = parseInt(guttersizer, 10);
			var heightSizer = parseInt(rowheight, 10);
			var containerWidth = grid ? grid.offsetWidth : 0;
			var imageWidths = t979_getImageWidths(grid, heightSizer);
			var rows = t979_divideRows(imageWidths, containerWidth);
			var heights = [];
			
			t979_fitItemsByWidth(rows, heights, containerWidth, heightSizer, gutterSizer);
			t979_updateItems(grid, rows, heights, gutterSizer);
			t979_updateGridHeight(grid, heights, gutterSizer);
		}));
	} else {
		var currentBlock = rec.querySelector('.t979');
		currentBlock.addEventListener('displayChanged', t_throttle(function () {
			var gutterSizer = parseInt(guttersizer, 10);
			var heightSizer = parseInt(rowheight, 10);
			var containerWidth = grid ? grid.offsetWidth : 0;
			var imageWidths = t979_getImageWidths(grid, heightSizer);
			var rows = t979_divideRows(imageWidths, containerWidth);
			var heights = [];
			
			t979_fitItemsByWidth(rows, heights, containerWidth, heightSizer, gutterSizer);
			t979_updateItems(grid, rows, heights, gutterSizer);
			t979_updateGridHeight(grid, heights, gutterSizer);
		}));
	}

	
	window.addEventListener('resize', t_throttle(function () {
		var gutterSizer = parseInt(guttersizer, 10);
		var heightSizer = parseInt(rowheight, 10);
		var containerWidth = grid ? grid.offsetWidth : 0;
		var imageWidths = t979_getImageWidths(grid, heightSizer);
		var rows = t979_divideRows(imageWidths, containerWidth);
		var heights = [];
		
		t979_fitItemsByWidth(rows, heights, containerWidth, heightSizer, gutterSizer);
		t979_updateItems(grid, rows, heights, gutterSizer);
		t979_updateGridHeight(grid, heights, gutterSizer);
	}));
	
	t_onFuncLoad('imagesLoaded', function () {
		imagesLoaded(grid, function () {
			t979_initMasonry(rec, recid, grid, rowheight, guttersizer, images);
			Array.prototype.forEach.call(images, function (img) {
				img.src = img.getAttribute('data-original');
				img.style.display = 'block';
			});
			setTimeout(function () {
				t979_showOverlay(overlayList, items);
			}, 500);
		});
	});
	
	Array.prototype.forEach.call(overlayList, function (overlay) {
		if (overlay.classList.contains('t979__overlay_preview')) {
			setTimeout(function () {
				t979_showOverlay([overlay], items);
			}, 1000);
		}
	});
}

function t979_showOverlay(overlayList, items) {
	if (window.innerWidth >= 1024) {
		Array.prototype.forEach.call(overlayList, function (overlay) {
			overlay.style.display = 'block';
		});
	} else {
		Array.prototype.forEach.call(items, function (item) {
			item.addEventListener('click', function () {
				var currentOverlay = item.querySelector('.t979__overlay');
				if (currentOverlay && currentOverlay.style.opacity === '0') {
					Array.prototype.forEach.call(overlayList, function (overlay) {
						overlay.style.opacity = overlay === currentOverlay ? '1' : '0';
					});
				} else {
					currentOverlay.style.opacity = '0';
				}
			});
		});
	}
}

function t979_reverse(grid) {
	if (grid && grid.classList.contains('t979__grid_reverse')) {
		for (var i = grid.childElementCount - 2; i >= 0; i--) {
			grid.appendChild(grid.children[i]);
		}
	}
}

function t979_initMasonry(rec, recid, grid, rowheight, guttersizer, images) {
	var gutterSizer = parseInt(guttersizer, 10);
	var heightSizer = parseInt(rowheight, 10);
	
	Array.prototype.forEach.call(images, function (img) {
		img.addEventListener('load', function () {
			var containerWidth = grid ? grid.offsetWidth : 0;
			var imageWidths = t979_getImageWidths(grid, heightSizer);
			var rows = t979_divideRows(imageWidths, containerWidth);
			var heights = [];
			
			t979_fitItemsByWidth(rows, heights, containerWidth, heightSizer, gutterSizer);
			t979_updateItems(grid, rows, heights, gutterSizer);
			t979_updateGridHeight(grid, heights, gutterSizer);
		});
	});
}

function t979_getImageWidths(grid, heightSizer) {
	var imageWidths = [];
	if (!grid) return false;
	var images = grid.querySelectorAll('.t979__image');
	Array.prototype.forEach.call(images, function (img) {
		imageWidths.push(img.naturalWidth * heightSizer / img.naturalHeight);
	});
	return imageWidths;
}

function t979_divideRows(imageWidths, containerWidth) {
	var rows = [];
	var curRow = 0;
	var rowWidth = 0;
	
	imageWidths.forEach(function (item) {
		rowWidth += item;
		
		if (typeof rows[curRow] == 'undefined') {
			rows[curRow] = [];
		}
		rows[curRow].push(item);
		
		if (rowWidth >= containerWidth) {
			curRow += 1;
			rowWidth = 0;
		}
	});
	
	return rows;
}

function t979_fitItemsByWidth(rows, heights, containerWidth, heightSizer, gutterSizer) {
	rows.forEach(function (row) {
		var sumWidth = 0;
		var thresholdRatio = 1.5;
		var rowWidth = containerWidth - gutterSizer * (row.length - 1);
		
		row.forEach(function (width) {
			sumWidth += width;
		});
		
		var ratio = rowWidth / sumWidth;
		if (ratio < thresholdRatio) {
			row.forEach(function (width, curRow) {
				width *= ratio;
				row[curRow] = width;
			});
			
			heights.push(heightSizer * ratio);
		} else {
			heights.push(heightSizer);
		}
		
		sumWidth = 0;
		
		row.forEach(function (width) {
			sumWidth += width;
		});
	});
}

function t979_updateItems(grid, rows, heights, gutterSizer) {
	if (!grid) return false;
	var curRow = 0;
	var curCol = 0;
	var top = 0;
	var left = 0;
	var width = 0;
	var height = 0;
	var items = grid.querySelectorAll('.t979__grid-item');
	
	Array.prototype.forEach.call(items, function (item) {
		if (curCol >= rows[curRow].length) {
			top += heights[curRow];
			curRow++;
			curCol = 0;
			if (curRow !== 0) {
				top += gutterSizer;
			}
			left = 0;
		}
		left += rows[curRow][curCol - 1] ? rows[curRow][curCol - 1] + gutterSizer : 0;
		width = rows[curRow][curCol];
		height = heights[curRow];
		
		item.style.top = top + 'px';
		item.style.left = left + 'px';
		item.style.width = width + 'px';
		item.style.height = height + 'px';
		
		curCol++;
	});
}

function t979_updateGridHeight(grid, heights, gutterSizer) {
	var sumHeight = heights.reduce(function (cur, acc) {
		return cur + acc + gutterSizer;
	}, 0);
	sumHeight -= gutterSizer;
	if (grid) grid.style.height = sumHeight + 'px';
} 
function t982_init(recId) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t982');
    if (!container) return;
    var itemWrappers = rec.querySelectorAll('.t982__itemwrapper');
    var socials = rec.querySelectorAll('.t982__socials');

    for (var i = 0; i < socials.length; i++) {
        var social = socials[i];
        var socialAttr = social.getAttribute('data-social-links');
        var links = [];

        social.removeAttribute('data-social-links');

        if (socialAttr) {
            links = socialAttr.split(',');

            for (var j = 0; j < links.length; j++) {
                t982_addSocialsItem(links[j].trim(), social);
            }
        }
    }

    t982_setEqualHeight(itemWrappers);
    
    $(container).bind('displayChanged', function() {
        t982_setEqualHeight(itemWrappers);
    });

    /*container.addEventListener('displayChanged', t_throttle(function() {
        t982_setEqualHeight(itemWrappers);
    }));*/
}

function t982_addSocialsItem(link, socialWrapper) {
	var item = t982_findSocialsItem(link);

	if (item) {
		var block = '';
		block = '<div class="t982__socials-item">';
		block += '<a href="' + link + '"  class="t982__socials-link" target="_blank" rel="nofollow noopener noreferrer">';
		block += item.title;
		block += '</a>';
		block += '</div>';

		socialWrapper.append(block);
	}
}
function t982_findSocialsItem(link) {
    var socials = [
        {
            title: 'Facebook',
            str: ['facebook', 'fb.com']
        }, {
            title: 'Twitter',
            str: ['twitter']
        }, {
            title: 'Vkontakte',
            str: ['vk.com', 'vk.me']
        }, {
            title: 'Odnoklassniki',
            str: ['ok.ru']
        }, {
            title: 'Behance',
            str: ['behance']
        }, {
            title: 'Vimeo',
            str: ['vimeo']
        }, {
            title: 'YouTube',
            str: ['youtube', 'youtu.be']
        }, {
            title: 'Instagram',
            str: ['instagram']
        }, {
            title: 'Pinterest',
            str: ['pinterest']
        }, {
            title: 'LinkedIn',
            str: ['linkedin']
        }, {
            title: 'SoundCloud',
            str: ['soundcloud']
        }, {
            title: 'Telegram',
            str: ['telegram', 't.me']
        }, {
            title: 'WhatsApp',
            str: ['wa.me']
        }
    ];

    var socialsItem;

    Array.prototype.forEach.call(socials, function(item) { 
        Array.prototype.forEach.call(item.str, function(s) {
            if (link.indexOf(s) !== -1) socialsItem = item;
        });
    });

    return socialsItem;
}

function t982_setEqualHeight(itemWrappers) {
    var maxHeight = 0;
    
    for (var i = 0; i < itemWrappers.length; i++) {
        itemWrappers[i].style.height = '';
    }

    for (var i = 0; i < itemWrappers.length; i++) {
        var itemWrapper = itemWrappers[i];
        var itemWrapperStyle = getComputedStyle(itemWrapper, null);
        var itemWrapperPaddingTop = parseInt(itemWrapperStyle.paddingTop) || 0;
        var itemWrapperPaddingBottom = parseInt(itemWrapperStyle.paddingBottom) || 0;
        var itemWrapperHeight = itemWrapper.clientHeight - (itemWrapperPaddingTop + itemWrapperPaddingBottom);

        if (itemWrapperHeight > maxHeight) maxHeight = itemWrapperHeight;
    }
    
    if (window.innerWidth >= 960) {
        for (var i = 0; i < itemWrappers.length; i++) {
            itemWrappers[i].style.height = maxHeight + 'px';
        }
    } else {
        for (var i = 0; i < itemWrappers.length; i++) {
            itemWrappers[i].style.height = 'auto';
        }
    }
} 
function t983_init(recid) {
    var rec = $('#rec' + recid);

    t983_unifyHeights(recid);
    t983_translateBlock(recid);

    $(window).on('resize', t_throttle(function () {
        if (typeof window.noAdaptive != 'undefined' && window.noAdaptive == true && window.isMobile) { return; }
        t983_unifyHeights(recid);
        t983_translateBlock(recid);
    }));

    $(window).on('load', function () {
        t983_unifyHeights(recid);
        t983_translateBlock(recid);
    });

    rec.find('.t983').on('displayChanged', t_throttle(function () {
        t983_unifyHeights(recid);
        t983_translateBlock(recid);
    }));
    
    t983__updateLazyLoad(recid);
}

function t983__updateLazyLoad(recid) {
    if (window.lazy === 'y' || $('#allrecords').attr('data-tilda-lazy') === 'yes') {
        t_onFuncLoad('t_lazyload_update', function () {
            var scrollContainer = $("#rec" + recid + " .t983__container_mobile-flex");
            var curMode = $(".t-records").attr("data-tilda-mode");

            if (scrollContainer.length && curMode != "edit" && curMode != "preview" && window.isMobile) {
                scrollContainer.on('touchmove', t_throttle(function () {
                    t_lazyload_update();
                }));
            }
        });
    }

}

function t983_translateBlock(recid) {
    var el = $('#rec' + recid);
    var blockHover = el.find('.t983__card-block_hover');
    var wrapMarginBottom = 35;
    var isMobile = window.isMobile || $(window).width() < 960;

    blockHover.each(function () {
        var block = $(this);
        var blockWrapper = block.parents('.t983__card-block-wrapper');
        var colWrapHeight = block.parents('.t983__card').height();
        var diff = colWrapHeight - block.outerHeight() - wrapMarginBottom * 2;
        var blockDiff = block.find('.t983__card-hide').outerHeight();

        blockWrapper.css('transform', 'translateY(' + diff + 'px)');
        if (!isMobile) {
            block.css('transform', 'translateY(' + blockDiff + 'px)');
        } else {
            block.css('transform', '');
        }
    });

    if (blockHover.length === 0) {
        var row = (isMobile ? el.find('.t983__container') : el.find('.t983__row'));

        row.each(function () {
            var block = $(this).find('.t983__card-block');
            var maxHeightInRow = 0;
            var colWrapHeight = block.parents('.t983__card').height();

            block.each(function () {
                var blockDescHeight = $(this).find('.t983__card-hide').outerHeight();

                if (blockDescHeight > maxHeightInRow) {
                    maxHeightInRow = blockDescHeight;
                }
            });

            block.each(function () {
                var blockTitleHeight = $(this).find('.t983__card-show').outerHeight();

                var diff = colWrapHeight - blockTitleHeight - maxHeightInRow - wrapMarginBottom * 2;
                $(this).css('transform', 'translateY(' + diff + 'px)');
            });
        });
    }
}

function t983_unifyHeights(recid) {
    var el = $('#rec' + recid);
    el.find('.t983 .t-container .t983__row').each(function () {
        var highestBox = 0;
        var currow = $(this);
        var curwidth = currow.find('.t983__card').width();
        var ratio = el.find('.t983__container').attr('data-ratio');
        var minHeightFromRatio = 0;

        switch (ratio) {
            case '16_9':
                minHeightFromRatio = curwidth * 0.5625;
                break;
            case '4_3':
                minHeightFromRatio = curwidth * 0.75;
                break;
            case '3_2':
                minHeightFromRatio = curwidth * 0.6666;
                break;
            case '1_1':
                minHeightFromRatio = curwidth;
                break;
            case '2_3':
                minHeightFromRatio = curwidth * 1.5;
                break;
            case '3_4':
                minHeightFromRatio = curwidth * 1.3333;
                break;
            case '9_16':
                minHeightFromRatio = curwidth * 1.7777;
                break;
        }

        currow.find('.t983__card-content').each(function () {
            var cardContent = $(this);
            var colHeight = cardContent.outerHeight();
            if (colHeight > highestBox) {
                highestBox = colHeight;
            }
        });

        if (highestBox > minHeightFromRatio) {
            currow.find('.t983__card-wrapper').css('padding-bottom', highestBox + 'px');
        } else {
            currow.find('.t983__card-wrapper').css('padding-bottom', '');
        }
    });
} 
function t985_init(recid, searchVariants) {
    var rec = $('#rec' + recid);

    if (searchVariants.length > 0) {
        t985_addSearchVariants(recid, searchVariants);
    }
    
    rec.find('.t985__search-widget-icon').on('click', function() {
        t985_showSearch(rec); 
    });
    
    rec.find('.t985__close-icon').on('click', function() {
        t985_hideSearch(rec); 
    });
    
    rec.find('.t985__overlay').on('click', function(e) {
       var target = $(e.target);
       
       if(!target.is(".t985__widgetheader") && !target.parents().is(".t985__widgetheader")) {
           t985_hideSearch(rec); 
       }
    });
}

function t985_addSearchVariants(recid, searchVariants) {
    var rec = $('#rec' + recid);
    var searchArray = searchVariants.split(',');
    var container = rec.find('.t985__searchvariants');
    for(var i = 0; i < searchArray.length; i++) {
        var variant = searchArray[i];
        container.append('<div class="t985__searchvariant t-text t-text_xs">' + variant + '</div>');
    }
}

function t985_showSearch(rec) {
    rec.find('.t985__overlay').show();
    rec.find('.t985__search-widget-icon').hide();
}

function t985_hideSearch(rec) {
    rec.find('.t985__overlay').hide();
    rec.find('.t985__search-widget-icon').show();
}

 
function t986_init(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var openBtn = rec.querySelector('.t986__playbutton');
	var closeBg = rec.querySelector('.t986__closevideo-bg');
	if (openBtn) {
		openBtn.addEventListener('click', function (e) {
			e.preventDefault();
			t986_showVideo(recid);
		});
	}
	if (closeBg) {
		closeBg.addEventListener('click', function () {
			t986_hideVideo(recid);
		});
	}
}

function t986_showVideo(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var videoContainer = rec.querySelector('.t986__video-container');
	var videoCover = rec.querySelector('.t986__cover');
	var videoCarrier = rec.querySelector('.t986__video-carier');
	
	var youTubeID = videoContainer ? videoContainer.getAttribute('data-content-popup-video-url-youtube') : '';
	var videoURL = youTubeID ? 'https://www.youtube.com/embed/' + youTubeID : '';
	
	document.body.classList.add('t986__overflow');
	if (videoCover) videoCover.classList.add('t986__hidden');
	if (videoContainer) videoContainer.classList.remove('t986__hidden');
	
	if (videoCarrier) {
		var iframe = document.createElement('iframe');
		iframe.id = 'youtubeiframe' + recid;
		iframe.classList.add('t986__iframe');
		iframe.width = '100%';
		iframe.height = '540';
		iframe.src = videoURL + '?rel=0&autoplay=1';
		iframe.frameBorder = '0';
		iframe.setAttribute('allowfullscreen', '');
		var closeLink = document.createElement('a');
		closeLink.classList.add('t986__close-link');
		var closeLinkContent = document.createElement('div');
		closeLinkContent.classList.add('t986__close');
		closeLink.insertAdjacentElement('beforeend', closeLinkContent);
		videoCarrier.innerHTML = '';
		videoCarrier.insertAdjacentElement('beforeend', iframe);
		videoCarrier.insertAdjacentElement('beforeend', closeLink);
	}
	
	document.addEventListener('click', function (e) {
		if (e.target.closest('.t986__close-link')) {
			t986_hideVideo(recid);
		}
	});
}

function t986_hideVideo(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	var videoContainer = rec.querySelector('.t986__video-container');
	var videoCover = rec.querySelector('.t986__cover');
	var videoCarrier = rec.querySelector('.t986__video-carier');
	
	document.body.classList.remove('t986__overflow');
	if (videoCover) videoCover.classList.remove('t986__hidden');
	if (videoContainer) videoContainer.classList.add('t986__hidden');
	if (videoCarrier) videoCarrier.innerHTML = '<div class="t986__video-bg2"></div>';
} 
function t988_init(recid, donation) {
    var el = $('#rec' + recid),
        priceInput = el.find('.t988__price'),
        priceBtn = el.find('.t988__pricebtn'),
        priceBtnOther = el.find('.t988__price-other'),
        submitBtn = el.find('.t988__submit');
    
    priceBtn.each(function() {
        if ($(this).hasClass('t988__pricebtn_active')) {
            priceInput.val($(this).val());
        }
    });

    priceBtn.on('click', function() {
        if (!$(this).hasClass('t988__price-other')) {
            priceInput.val($(this).val());
            priceInput.hide();
        }
        priceBtn.removeClass('t988__pricebtn_active');
        $(this).addClass('t988__pricebtn_active');
    });
    
    priceBtnOther.on('click', function() {
        priceInput.val('').show().focus();
    });
    priceInput.on('focus', function() {
        $(this).removeClass('t988__price_error');
    });
    submitBtn.on('click', function(e){
        var link = $(this).parent(),
            amount = priceInput.val(),
			match = amount.match(/(\d+\.?\,?\d*)/g),
            href;

        if(!amount || amount==0 || !match || match[0]==0) {
            priceInput.addClass('t988__price_error');
            submitBtn.addClass('t988__submit_error');
            setTimeout(function() {
                submitBtn.removeClass('t988__submit_error');
            }, 300);
            return false;
        } else {
            href = '#order:' + donation + '=' + match[0];
            $(link).attr('href', href);
        }
    });
} 
function t989_init(recid) {
	var allRec = document.getElementById('allrecords');
	var lazyMode = allRec ? allRec.getAttribute('data-tilda-lazy') : '';
	var rec = document.getElementById('rec' + recid);
	var bulletsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var slides = rec.querySelectorAll('.t-slds__item');
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var currentBlock = rec.querySelector('.t989');
	var activePos = bulletsWrapper ? bulletsWrapper.getAttribute('data-thumbs-active') : '0';
	
	Array.prototype.forEach.call(slides, function (slide, i) {
		if (i === parseInt(activePos, 10)) slide.classList.add('t-slds__item_active');
	});
	
	Array.prototype.forEach.call(bullets, function (bullet, i) {
		if (i === parseInt(activePos, 10)) bullet.classList.add('t-slds__item_active');
	});
	
	t_onFuncLoad('t_sldsInit', function () {
		t_sldsInit(recid);
		t989_checkArrowsDisplay(rec);
	});
	
	var thumbsTimeout = bulletsWrapper ? bulletsWrapper.getAttribute('data-thumbs-timeout') : '';
	
	if (thumbsTimeout > 0) {
		t989_thumbs_initAutoPlay(rec);
	}
	
	window.addEventListener('resize', t_throttle(function () {
			t989_checkArrowsDisplay(rec);
			t_slds_updateSlider(recid);
			if (window.lazy === 'y' || lazyMode === 'yes') {
				t_onFuncLoad('t_lazyload_update', function () {
					t_lazyload_update();
				});
			}
		}, 300)
	);
	
	if (currentBlock) {
		currentBlock.addEventListener('displayChanged', function () {
			t_onFuncLoad('t_slds_updateSlider', function () {
				t_slds_updateSlider(recid);
			});
			if (window.lazy === 'y' || lazyMode === 'yes') {
				t_onFuncLoad('t_lazyload_update', function () {
					t_lazyload_update();
				});
			}
		});
	}
	
	t989_addEvents(rec);
}

function t989_addEvents(rec) {
	var bulletsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var arrowRight = rec.querySelector('.t989__arrow-right');
	var arrowLeft = rec.querySelector('.t989__arrow-left');
	var mobileWrapperRight = rec.querySelector('.t989__mobile-arrows .t-slds__arrow_wrapper-right');
	var mobileWrapperLeft = rec.querySelector('.t989__mobile-arrows .t-slds__arrow_wrapper-left');
	var thumbsTimeout = bulletsWrapper ? bulletsWrapper.getAttribute('data-thumbs-timeout') : '';
	
	if (arrowRight) {
		arrowRight.addEventListener('click', function () {
			t989_next(rec);
			if (thumbsTimeout > 0) t989_thumbs_initAutoPlay(rec);
		});
	}
	
	if (arrowLeft) {
		arrowLeft.addEventListener('click', function () {
			t989_prev(rec);
			if (thumbsTimeout > 0) t989_thumbs_initAutoPlay(rec);
		});
	}
	
	if (mobileWrapperRight) {
		mobileWrapperRight.addEventListener('click', function () {
			t989_next(rec);
			if (thumbsTimeout > 0) t989_thumbs_initAutoPlay(rec);
		});
	}
	
	if (mobileWrapperLeft) {
		mobileWrapperLeft.addEventListener('click', function () {
			t989_prev(rec);
			if (thumbsTimeout > 0) t989_thumbs_initAutoPlay(rec);
		});
	}
	
	Array.prototype.forEach.call(bullets, function (bullet) {
		bullet.addEventListener('click', function () {
			t989_slideIntoView(rec, bullet);
			if (thumbsTimeout > 0) t989_thumbs_initAutoPlay(rec);
		});
	});
}

function t989_checkArrowsDisplay(rec) {
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var arrowRight = rec.querySelector('.t989__arrow-right');
	var arrowLeft = rec.querySelector('.t989__arrow-left');
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var thumbsCycle = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-cycle') : null;
	var activeThumb = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-active') : '0';
	
	if (thumbsCycle === 'yes') {
		if (arrowLeft) arrowLeft.style.display = 'block';
		if (arrowLeft) arrowRight.style.display = 'block';
	} else {
		if (arrowLeft) arrowLeft.style.display = parseInt(activeThumb, 10) > 0 ? 'block' : 'none';
		if (arrowLeft) arrowRight.style.display = parseInt(activeThumb, 10) < bullets.length - 1 ? 'block' : 'none';
	}
}

function t989_slideIntoView(rec, bullet) {
	var container = rec.querySelector('.t989__thumbsbullets-container');
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var containerWidth = container ? container.offsetWidth : 0;
	var containerLeftPos = container ? container.getBoundingClientRect().left + window.pageXOffset : 0;
	var containerRightPos = containerLeftPos + containerWidth;
	var thumbsCycle = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-cycle') : null;
	var bulletFor = bullet.getAttribute('data-slide-bullet-for');
	var bulletRightPos = bullet.offsetWidth + bullet.getBoundingClientRect().left + window.pageXOffset;
	
	var hiddenPart;
	var direction;
	
	if (bulletRightPos > containerRightPos) {
		hiddenPart = bulletRightPos - containerRightPos;
		direction = 'right';
	}
	
	if (container && container.getBoundingClientRect().left > bullet.getBoundingClientRect().left) {
		hiddenPart = (container.getBoundingClientRect().left - bullet.getBoundingClientRect().left) + 12;
		direction = 'left';
	}
	
	if (parseInt(bulletFor, 10)) {
		var slideID = (parseInt(bulletFor, 10) - 1).toString();
		if (thumbsWrapper) thumbsWrapper.setAttribute('data-thumbs-active', slideID);
	}
	
	if (hiddenPart) {
		t989_slide(rec, direction, hiddenPart);
	}
	
	if (thumbsCycle !== 'yes') {
		setTimeout(function () {
			t989_checkArrowsDisplay(rec);
		}, 300);
	}
}

function t989_next(rec) {
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var thumbsCycle = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-cycle') : null;
	var activeThumb = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-active') : '0';
	var activeThumbValue = parseInt(activeThumb, 10);
	
	if (activeThumbValue < bullets.length) {
		activeThumbValue++;
	}
	if (activeThumbValue === bullets.length && thumbsCycle === 'yes') {
		activeThumbValue = 0;
	}
	
	/*todo проверить*/
	var activeBullet = bullets[activeThumbValue];
	if (activeBullet) activeBullet.click();
}

function t989_prev(rec) {
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var activeThumb = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-active') : '0';
	var activeThumbValue = parseInt(activeThumb, 10);
	var thumbsCycle = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-cycle') : null;
	
	if (activeThumbValue > 0) {
		activeThumbValue--;
	} else if (thumbsCycle === 'yes') {
		activeThumbValue = bullets.length - 1;
	}
	
	var slide = bullets.length ? bullets[activeThumbValue] : null;
	if (slide) slide.click();
	if (thumbsWrapper) thumbsWrapper.setAttribute('data-thumbs-active', activeThumbValue);
}

function t989_slide(rec, direction, offset) {
	var allRec = document.getElementById('allrecords');
	var lazyMode = allRec ? allRec.getAttribute('data-tilda-lazy') : '';
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var dataSlideOffset = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-offset') : '0';
	var slideOffsetValue = parseInt(dataSlideOffset, 10);
	var slideOffset;
	
	if (direction === 'right') {
		slideOffset = slideOffsetValue + Math.abs(offset) + 12;
	} else {
		slideOffset = slideOffsetValue > Math.abs(offset) ? slideOffsetValue - Math.abs(offset) : 0;
	}
	
	if (thumbsWrapper) {
		thumbsWrapper.style.transform = 'translate(-' + slideOffset + 'px, 0)';
		thumbsWrapper.style.transitionDuration = '.3s';
		thumbsWrapper.setAttribute('data-thumbs-offset', slideOffset);
	}
	
	if (window.lazy === 'y' || lazyMode === 'yes') {
		t_onFuncLoad('t_lazyload_update', function () {
			t_lazyload_update();
		});
	}
}

function t989_thumbs_initAutoPlay(rec) {
	var thumbsWrapper = rec.querySelector('.t-slds__thumbsbullet-wrapper');
	var bullets = rec.querySelectorAll('.t-slds__thumbsbullet');
	var timeOut = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-timeout') : '0';
	var intervalID = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-interval-id') : null;
	var activeThumb = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-active') : '0';
	var thumbsCycle = thumbsWrapper ? thumbsWrapper.getAttribute('data-thumbs-cycle') : null;
	
	timeOut = parseInt(timeOut, 10);
	activeThumb = parseInt(activeThumb, 10);
	
	if (parseInt(intervalID, 10)) {
		clearInterval(parseInt(intervalID, 10));
	}
	
	var thumbsIntervalId = setInterval(function () {
		t989_next(rec);
	}, timeOut);
	
	if (thumbsWrapper) thumbsWrapper.setAttribute('data-thumbs-interval-id', thumbsIntervalId.toString());
	
	if (bullets.length - 1 === activeThumb && thumbsCycle !== 'yes') {
		if (intervalID) {
			clearInterval(thumbsIntervalId);
		}
	}
} 
function t992_init(recid) {
	t992_highlight();
	t992_checkAnchorLinks(recid);
}

function t992_highlight() {
	var url = window.location.href;
	var pathname = window.location.pathname;
	var hash = window.location.hash;
	if (url.substr(url.length - 1) === '/') url = url.slice(0, -1);
	if (pathname.substr(pathname.length - 1) === '/') pathname = pathname.slice(0, -1);
	if (pathname.charAt(0) === '/') pathname = pathname.slice(1);
	if (!pathname) pathname = '/';
	
	var links = document.querySelectorAll(
		'.t992__list-item a[href=\'"' + url + '"\'], ' +
		'.t992__list-item a[href=\'"' + pathname + '"\']');
	
	Array.prototype.forEach.call(links, function (link) {
		link.classList.add('t-active');
	});
	
	if (hash) {
		var hashLinks = document.querySelectorAll('.t992__list-item a[href=\'' + hash + '\']');
		Array.prototype.forEach.call(hashLinks, function (link) {
			link.classList.add('t-active');
		});
	}
}

function t992_checkAnchorLinks(recid) {
	var navLinks = document.querySelectorAll('#rec' + recid + ' .t992__list-item a:not(.tooltipstered)[href*=\'#\']');
	if (navLinks.length > 0) {
		t992_catchScroll(navLinks);
	}
}

function t992_catchScroll(navLinks) {
	var clickedSectionId = null;
	var sections = [];
	var sectionIdTonavigationLink = [];
	var interval = 100;
	var lastCall;
	var timeoutId;
	var reversedNavLinks = [];
	
	for (var i = navLinks.length - 1; i >= 0; i--) {
		reversedNavLinks.push(navLinks[i]);
	}
	
	reversedNavLinks.forEach(function (link) {
		var curSection = t992_getSectionByHref(link);
		if (curSection && curSection.getAttribute('id')) {
			sections.push(curSection);
			sectionIdTonavigationLink[curSection.getAttribute('id')] = link;
		}
	});
	
	t992_updateSectionsOffsets(sections);
	
	sections.sort(function (a, b) {
		return b.getAttribute('data-offset-top') - a.getAttribute('data-offset-top');
	});
	
	window.addEventListener('resize', t_throttle(function () {
			t992_updateSectionsOffsets(sections);
		}, 200)
	);
	
	if (typeof jQuery !== 'undefined') {
		$('.t992').bind('displayChanged', function () {
			t992_updateSectionsOffsets(sections);
		});
	} else {
		var footerBlocks = document.querySelectorAll('.t992');
		Array.prototype.forEach.call(footerBlocks, function (footer) {
			footer.addEventListener('displayChanged', function () {
				t992_updateSectionsOffsets(sections);
			});
		});
	}
	
	setInterval(function () {
		t992_updateSectionsOffsets(sections);
	}, 5000);
	t992_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
	
	Array.prototype.forEach.call(navLinks, function (navLink) {
		navLink.addEventListener('click', function () {
			var clickedSection = t992_getSectionByHref(navLink);
			if (!navLink.classList.contains('tooltipstered') && clickedSection && clickedSection.id) {
				Array.prototype.forEach.call(navLinks, function (link) {
					if (link === navLink) {
						link.classList.add('t-active');
					} else {
						link.classList.remove('t-active');
					}
				});
				/*TODO в качестве аргумента передается строка, хотя должен быть элемент*/
				clickedSectionId = t992_getSectionByHref(navLink.id);
			}
		});
	});
	
	window.addEventListener('scroll', function () {
		var now = new Date().getTime();
		if (lastCall && now < lastCall + interval) {
			clearTimeout(timeoutId);
			timeoutId = setTimeout(function () {
				lastCall = now;
				clickedSectionId = t992_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
			}, interval - (now - lastCall));
		} else {
			lastCall = now;
			clickedSectionId = t992_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId);
		}
	});
}

function t992_updateSectionsOffsets(sections) {
	Array.prototype.forEach.call(sections, function (section) {
		section.setAttribute('data-offset-top', section.getBoundingClientRect().top + window.pageYOffset);
	});
}

function t992_getSectionByHref(curlink) {
	var currentLinkValue = curlink.href ? curlink.href.replace(/\s+/g, '').replace(/.*#/, '') : '';
	if (currentLinkValue.indexOf('#rec') !== -1) {
		return document.querySelector('.r[id="currentLinkValue"]');
	} else {
		var section;
		var els = document.querySelectorAll('.r[data-record-type="215"]');
		Array.prototype.forEach.call(els, function (el) {
			if (el.querySelector('a[name=\'' + currentLinkValue + '\']')) {
				section = el;
			}
		});
		return section;
	}
}

function t992_highlightNavLinks(navLinks, sections, sectionIdTonavigationLink, clickedSectionId) {
	var scrollPosition = window.pageYOffset;
	var valueToReturn = clickedSectionId;
	/*if first section is not at the page top (under first blocks)*/
	var lastOffsetTop = sections.length ? sections[sections.length - 1].getAttribute('data-offset-top') : null;
	if (sections.length && !clickedSectionId && lastOffsetTop && lastOffsetTop > scrollPosition + 300) {
		Array.prototype.forEach.call(navLinks, function (navLink) {
			navLink.classList.remove('t-active');
		});
		return null;
	}
	
	Array.prototype.forEach.call(sections, function (section) {
		var sectionTop = section.getAttribute('data-offset-top');
		var id = section.getAttribute('id');
		var navLink = sectionIdTonavigationLink[id];
		var documentHeight = Math.max(
			document.body.scrollHeight, document.documentElement.scrollHeight,
			document.body.offsetHeight, document.documentElement.offsetHeight,
			document.body.clientHeight, document.documentElement.clientHeight
		);
		var windowHeight = window.innerHeight;
		
		if (scrollPosition + 300 >= sectionTop || sections[0].id === id && scrollPosition >= documentHeight - windowHeight) {
			if (clickedSectionId === null && !navLink.classList.contains('t-active')) {
				Array.prototype.forEach.call(navLink, function (link) {
					link.classList.remove('t-active');
				});
				navLink.classList.add('t-active');
				valueToReturn = null;
			} else {
				if (clickedSectionId != null && id === clickedSectionId) {
					valueToReturn = null;
				}
			}
			return false;
		}
	});
	return valueToReturn;
} 
function t994_init(recid) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return false;
	var container = rec.querySelector('.t994__slidecontainer');
	var items = rec.querySelectorAll('.t994__item');
	var slides = rec.querySelectorAll('.t994__item-wrapper');
	var currentBlock = rec.querySelector('.t994');
	var loaders = rec.querySelectorAll('.t994__loader');
	var isPreview = currentBlock ? currentBlock.classList.contains('t994_preview') : false;
	var autoPlayInit = container ? container.getAttribute('data-slider-timeout') : '0';
	var hasTimeout = parseFloat(autoPlayInit) > 0;
	
	if (window.innerWidth > 960) {
		t994_setHeightValueForDesktop(slides, rec);
		
		var activeSlide = rec.querySelector('.t994__item.t-slds__item_active');
		if (!activeSlide && items.length) items[0].classList.add('t-slds__item_active');
		
	} else {
		if (container) container.style.transform = 'translate(0, 0)';
		if (container) container.setAttribute('data-slide-offset', '0');
		t994_calcHeight(rec);
	}
	
	if (hasTimeout && t994_checkVisibility(rec)) {
		t994_initAutoPlay(rec);
	}
	
	var autoPlayInitted = container ? container.getAttribute('data-slider-autoplay-initted') : '';
	var isAutoplayInitted = autoPlayInitted === 'yes';
	window.addEventListener('scroll', t_throttle(function () {
		if (hasTimeout && t994_checkVisibility(rec) && !isAutoplayInitted) {
			t994_initAutoPlay(rec);
		}
	}, 100));
	
	if (currentBlock) {
		currentBlock.addEventListener('displayChanged', function () {
			if (window.innerWidth > 960) t994_setHeightValueForDesktop(slides, rec);
			
			if (container) container.style.transitionDuration = '0s';
			if (container) container.style.transform = 'translate(0, 0)';
			if (container) container.setAttribute('data-slide-pos', '0');
			
			Array.prototype.forEach.call(items, function (item) {
				item.style.transitionDuration = '0s';
			});
			t994_goToSlide(rec, 0);
		});
	}
	
	window.addEventListener('resize', function () {
		t994_changeHeightandOffsetOnResize(container, items);
		t994_calcHeight(rec);
	});
	
	window.addEventListener('orientationchange', function () {
		t994_changeHeightandOffsetOnResize(container, items);
		t994_calcHeight(rec);
	});
	
	if (isPreview || !autoPlayInit || isNaN(parseInt(autoPlayInit, 10))) {
		var pos = container ? container.getAttribute('data-slide-pos') : '0';
		Array.prototype.forEach.call(loaders, function (loader, i) {
			var loaderInner = loader.querySelector('.t994__loader-inner');
			if (i <= +pos && loaderInner) loaderInner.style.width = '100%';
		});
	}
	
	Array.prototype.forEach.call(items, function (item, i) {
		item.addEventListener('click', function () {
			t994_goToSlide(rec, i);
		});
	});
	
	var rightArrow = rec.querySelector('.t-slds__arrow_wrapper-right');
	var leftArrow = rec.querySelector('.t-slds__arrow_wrapper-left');
	
	if (rightArrow) {
		rightArrow.addEventListener('click', function () {
			t994_slide(rec, 'right');
		});
	}
	
	if (leftArrow) {
		leftArrow.addEventListener('click', function () {
			t994_slide(rec, 'left');
		});
	}
	
	Array.prototype.forEach.call(loaders, function (loader, i) {
		loader.addEventListener('click', function () {
			t994_goToSlide(rec, i);
		});
	});
	
	if (!isPreview && (!autoPlayInit || parseInt(autoPlayInit, 10) === 0)) {
		var stopBtn = rec.querySelector('.t994__stopbtn');
		if (stopBtn) stopBtn.style.display = 'none';
	}
	
	if (window.innerWidth < 960) {
		t994_calcHeight(rec);
		t994_initSliderSwipe(rec);
	}
}

function t994_changeHeightandOffsetOnResize(container, items) {
	var pos = container ? container.getAttribute('data-slide-pos') : '0';
	var itemWidth = items[0] ? items[0].offsetWidth : 0;
	var offset = itemWidth * pos;
	
	if (container) container.style.transitionDuration = '0s';
	if (container) container.style.transform = 'translate(-' + offset + 'px, 0)';
	Array.prototype.forEach.call(items, function (item) {
		item.style.transitionDuration = '0s';
	});
}

function t994_setHeightValueForDesktop(slides, rec) {
	var aspectRatio = 9 / 16;
	var slideHeight = slides[0] ? slides[0].offsetHeight : 0;
	var slideWidth = slideHeight * aspectRatio;
	
	Array.prototype.forEach.call(slides, function (slide) {
		slide.style.width = slideWidth + 'px';
	});
	
	var slideParent = rec.querySelector('.t994__slidecontainer');
	var fullWidth = slides[0] ? slides.length * (slideWidth + 40) : 0;
	if (slideParent) slideParent.style.width = fullWidth + 'px';
	
	var widthWrapper = rec.querySelector('.t994__width-wrapper');
	if (widthWrapper) widthWrapper.style.maxWidth = (slideWidth + 40) + 'px';
}

function t994_checkVisibility(el) {
	var winBottom = window.pageYOffset + window.innerHeight;
	var elTop = el.getBoundingClientRect().top + window.pageYOffset;
	return (elTop + 100 <= winBottom);
}

function t994_calcHeight(el) {
	var slidecontainer = el.querySelector('.t994__slidecontainer');
	var widthWrapper = el.querySelector('.t994__width-wrapper');
	var items = el.querySelectorAll('.t994__item');
	var itemWrappers = el.querySelectorAll('.t994__item-wrapper');
	
	if (window.isMobile) {
		var height = document.documentElement.clientHeight;
		if (slidecontainer) slidecontainer.style.height = height + 'px';
		if (widthWrapper) widthWrapper.style.height = height + 'px';
		
		Array.prototype.forEach.call(items, function (item) {
			item.style.height = height + 'px';
		});
		
		Array.prototype.forEach.call(itemWrappers, function (wrapper) {
			wrapper.style.height = height + 'px';
		});
	}
}

function t994_goToSlide(el, id) {
	var container = el.querySelector('.t994__slidecontainer');
	var loaderInners = el.querySelectorAll('.t994__loader-inner');
	var items = el.querySelectorAll('.t994__item');
	var currentBlock = el.querySelector('.t994');
	var itemWidth = items.length ? items[0].offsetWidth : 0;
	var sliderTimeOut = container ? container.getAttribute('data-slider-timeout') : '0';
	var sliderPos = container ? container.getAttribute('data-slide-pos') : '0';
	var isPreview = currentBlock ? currentBlock.classList.contains('t994_preview') : false;
	
	if (+sliderPos === id) return;
	
	var allRec = document.getElementById('allrecords');
	var lazyMode = allRec ? allRec.getAttribute('data-tilda-lazy') : '';
	
	if (window.lazy === 'y' || lazyMode === 'yes') {
		t_onFuncLoad('t_lazyload_update', function () {
			setTimeout(t_lazyload_update(), 500);
		});
	}

	Array.prototype.forEach.call(items, function (item, i) {
		i === id ? item.classList.add('t-slds__item_active') : item.classList.remove('t-slds__item_active');
	});
	
	if (container) container.setAttribute('data-slide-pos', id);
	var offset = itemWidth * id;
	
	Array.prototype.forEach.call(items, function (item) {
		item.style.transitionDuration = '.3s';
	});
	
	if (container) container.style.transform = 'translate(-' + offset + 'px, 0)';
	if (container) container.style.transitionDuration = '.3s';
	
	Array.prototype.forEach.call(loaderInners, function (inner, i) {
		inner.style.width = '0';
		if (isPreview || isNaN(parseInt(sliderTimeOut, 10))) {
			inner.style.width = i <= id ? '100%' : '0';
		} else {
			inner.style.width = i < id ? '100%' : '0';
		}
	});
	
	if (!isPreview && container && container.getAttribute('data-slider-paused') === 'no') {
		t994_playSlider(parseInt(sliderTimeOut, 10), el);
	}
	
	var arrowLeft = el.querySelector('.t-slds__arrow_wrapper-left');
	var arrowRight = el.querySelector('.t-slds__arrow_wrapper-right');
	
	switch (id) {
		case 0:
			if (arrowLeft) arrowLeft.style.display = 'none';
			if (arrowRight) arrowRight.style.display = 'block';
			break;
		case (items.length - 1):
			if (arrowLeft) arrowLeft.style.display = 'block';
			if (arrowRight) arrowRight.style.display = 'none';
			break;
		default:
			if (arrowLeft) arrowLeft.style.display = 'block';
			if (arrowRight) arrowRight.style.display = 'block';
			break;
	}
}

function t994_playSlider(time, el) {
	if (el instanceof jQuery && el.length) {
		el = el.get(0);
	}
	var sliderWrapper = el.querySelector('.t994__slidecontainer');
	var loaders = el.querySelectorAll('.t994__loader');
	var pos = sliderWrapper ? sliderWrapper.getAttribute('data-slide-pos') : '0';
	var currentLoader = loaders[parseInt(pos, 10)];
	var currentLoaderInner = currentLoader ? currentLoader.querySelector('.t994__loader-inner') : null;
	var playBtn = el.querySelector('.t994__playbtn');
	var stopBtn = el.querySelector('.t994__stopbtn');
	
	if (sliderWrapper) sliderWrapper.setAttribute('data-slider-paused', 'no');
	
	
	if (playBtn) playBtn.style.display = 'none';
	if (stopBtn) stopBtn.style.display = 'block';
	
	if (window.t994_animateSliderBar) {
		clearInterval(window.t994_animateSliderBar);
		window.t994_animateSliderBar = 0;
	}
	
	if (time && currentLoaderInner) {
		t994_animateSlideBar(currentLoaderInner, time, el, pos, loaders);
	}
}

function t994_animateSlideBar(currentLoaderInner, time, el, pos, loaders) {
	if (currentLoaderInner.style.width === '100%') {
		currentLoaderInner.style.width = '0';
	}
	var increasedWidth = parseInt(currentLoaderInner.style.width, 10) || 0;
	var step = (1000 - increasedWidth * 10) / time;
	window.t994_animateSliderBar = setInterval(function () {
		increasedWidth += step;
		currentLoaderInner.style.width = increasedWidth + '%';
		if (parseInt(currentLoaderInner.style.width, 10) >= 100) {
			t994_slide(el, 'right');
			if (+pos === loaders.length - 1) {
				clearInterval(window.t994_animateSliderBar);
				window.t994_animateSliderBar = 0;
			}
		}
	}, 10);
}

function t994_initAutoPlay(el) {
	var container = el.querySelector('.t994__slidecontainer');
	var loaders = el.querySelectorAll('.t994__loader');
	var playBtn = el.querySelector('.t994__playbtn');
	var stopBtn = el.querySelector('.t994__stopbtn');
	var sliderTimeOut = container ? container.getAttribute('data-slider-timeout') : '0';
	var currentPos = container ? container.getAttribute('data-slide-pos') : '0';
	var progress = 0;
	
	t994_playSlider(parseInt(sliderTimeOut, 10), el);
	
	if (stopBtn) {
		stopBtn.addEventListener('click', function () {
			stopBtn.style.display = 'none';
			if (playBtn) playBtn.style.display = 'block';
			if (window.t994_animateSliderBar) {
				clearInterval(window.t994_animateSliderBar);
				window.t994_animateSliderBar = 0;
			}
			if (container) container.setAttribute('data-slider-paused', 'yes');
		});
	}
	
	if (playBtn) {
		playBtn.addEventListener('click', function () {
			playBtn.style.display = 'none';
			if (stopBtn) stopBtn.style.display = 'block';
			
			currentPos = container ? container.getAttribute('data-slide-pos') : '0';
			var currentLoader = loaders[parseInt(currentPos, 10)];
			var loaderWidth = currentLoader ? currentLoader.offsetWidth : 0;
			var currentLoaderInner = currentLoader ? currentLoader.querySelector('.t994__loader-inner') : null;
			progress = currentLoaderInner ? currentLoaderInner.offsetWidth : 0;
			t994_playSlider(sliderTimeOut - (progress / loaderWidth * sliderTimeOut), el);
			if (container) container.setAttribute('data-slider-paused', 'no');
		});
	}
	
	if (window.innerWidth < 960 && container) {
		container.addEventListener('touchstart', function (e) {
			if (window.t994_animateSliderBar) {
				clearInterval(window.t994_animateSliderBar);
				window.t994_animateSliderBar = 0;
			}
			if (e.target.classList.contains('t994__title') || e.target.classList.contains('t994__descr')) {
				e.target.classList.add('t994__txt-selectable');
			}
		});
		
		container.addEventListener('touchend', function () {
			var allText = document.querySelectorAll('.t994__title, .t994__descr');
			Array.prototype.forEach.call(allText, function (text) {
				text.classList.remove('t994__txt-selectable');
			});
			currentPos = container ? container.getAttribute('data-slide-pos') : '0';
			var currentLoader = loaders[parseInt(currentPos, 10)];
			var curLoaderInner = currentLoader ? currentLoader.querySelector('.t994__loader-inner') : null;
			var curLoaderWidth = currentLoader ? currentLoader.offsetWidth : 0;
			progress = curLoaderInner ? curLoaderInner.offsetWidth : 0;
			t994_playSlider(sliderTimeOut - (progress / curLoaderWidth * sliderTimeOut), el);
		});
	}
	container.setAttribute('data-slider-autoplay-initted', 'yes');
}

function t994_slide(el, direction) {
	var container = el.querySelector('.t994__slidecontainer');
	var loaders = el.querySelectorAll('.t994__loader');
	var items = el.querySelectorAll('.t994__item');
	var currentBlock = el.querySelector('.t994');
	var arrowsWrapperLeft = el.querySelectorAll('.t-slds__arrow_wrapper-left');
	var arrowsWrapperRight = el.querySelectorAll('.t-slds__arrow_wrapper-right');
	
	var sliderTimeOut = container ? container.getAttribute('data-slider-timeout') : '0';
	var currentPos = container ? container.getAttribute('data-slide-pos') : '0';
	var loaderPos = sliderTimeOut > 0 ? +currentPos : +currentPos + 1;
	var isPreview = currentBlock ? currentBlock.classList.contains('t994_preview') : false;
	
	var currentLoader = loaders[loaderPos];
	var currentLoaderInner = currentLoader ? currentLoader.querySelector('.t994__loader-inner') : null;
	
	var sliderLeftPos = container ? container.getAttribute('data-slide-offset') : '0';
	var itemWidth = items[0] ? items[0].offsetWidth : 0;
	
	
	switch (direction) {
		case 'right':
			if (currentPos >= items.length - 1) return;
			
			Array.prototype.forEach.call(arrowsWrapperLeft, function (arrowWrapperLeft) {
				arrowWrapperLeft.style.display = 'block';
			});
			
			if (currentLoaderInner) currentLoaderInner.style.width = '100%';
			if (container) container.setAttribute('data-slide-pos', ++currentPos);
			
			break;
		case 'left':
			Array.prototype.forEach.call(arrowsWrapperRight, function (arrowWrapperRight) {
				arrowWrapperRight.style.display = 'block';
			});
			
			if (currentLoaderInner) currentLoaderInner.style.width = '0';
			if (container) container.setAttribute('data-slide-pos', --currentPos);
			
			var prevLoader = loaders[loaderPos - 1];
			var prevLoaderInner = prevLoader ? prevLoader.querySelector('.t994__loader-inner') : null;
			if (prevLoaderInner) prevLoaderInner.style.width = '0';
			
			if (currentPos < 0 || loaderPos < 0) return;
			
			break;
	}
	
	switch (+currentPos) {
		case 0:
			Array.prototype.forEach.call(arrowsWrapperLeft, function (wrapLeft) {
				wrapLeft.style.display = 'none';
			});
			break;
		case (items.length - 1):
			Array.prototype.forEach.call(arrowsWrapperRight, function (wrapRight) {
				wrapRight.style.display = 'none';
			});
			break;
	}
	
	Array.prototype.forEach.call(items, function (item, i) {
		if (i === +currentPos) {
			item.classList.add('t-slds__item_active');
		} else {
			item.classList.remove('t-slds__item_active');
		}
		item.style.transitionDuration = '.3s';
	});
	
	var offset = sliderLeftPos - itemWidth * currentPos;
	if (container) container.style.transform = 'translate(' + offset + 'px, 0)';
	if (container) container.style.transitionDuration = '.3s';
	
	if (!isPreview && parseInt(sliderTimeOut, 10) > 0 && container && container.getAttribute('data-slider-paused') === 'no') {
		t994_playSlider(parseInt(sliderTimeOut, 10), el);
	}
	
	var allRec = document.getElementById('allrecords');
	var lazyMode = allRec ? allRec.getAttribute('data-tilda-lazy') : '';
	
	if (window.lazy === 'y' || lazyMode === 'yes') {
		t_onFuncLoad('t_lazyload_update', function () {
			t_lazyload_update();
		});
	}
}

function t994_initSliderSwipe(el) {
	var sliderWrapper = el.querySelector('.t994__slidecontainer');
	var totalSlides = el.querySelectorAll('.t994__item').length;
	var timeout;
	var isScrolling = false;
	
	delete Hammer.defaults.cssProps.userSelect;
	
	var hammer = new Hammer(sliderWrapper, {
		domEvents: true,
		inputClass: Hammer.TouchInput,
		recognizers: [
			[Hammer.Pan, {
				direction: Hammer.DIRECTION_HORIZONTAL,
			}],
		],
	});
	
	window.addEventListener('scroll', function () {
		isScrolling = true;
		clearTimeout(timeout);
		timeout = setTimeout(function () {
			isScrolling = false;
		}, 250);
	});
	
	if (totalSlides === 1) return false;
	
	hammer.on('pan', function (event) {
		if (isScrolling) {
			return false;
		}
		var sliderWrapper = el.querySelector('.t994__slidecontainer');
		
		sliderWrapper.setAttribute('data-slider-touch', 'yes');
		if (event.isFinal) {
			if (event.velocityX > 0.4) {
				t994_slide(el, 'left');
			} else if (event.velocityX < -0.4) {
				t994_slide(el, 'right');
			}
			sliderWrapper.setAttribute('data-slider-touch', '');
		}
	});
} 
function t996_init(recid, pad) {
	var rec = document.getElementById('rec' + recid);
	if (!rec) return;
	t996__calcCoverWidth(rec);
	window.addEventListener('resize', t_throttle(function () {
		t996__calcCoverWidth(rec);
	}, 300));
}

function t996__calcCoverWidth(rec) {
	var cover = rec.querySelector('.t996__cover-wrapper');
	var container = rec.querySelector('.t996__container');
	var containerWidth = container ? container.offsetWidth : 0;
	var windowWidth = window.innerWidth;
	var coverWidth = windowWidth - ((windowWidth - containerWidth) / 2);
	if (cover) cover.style.width = coverWidth + 'px';
} 
function t1000_init(recId, margin) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t1000');
    if (!container) return;

    t1000_setImageHeight(rec, margin);

    window.addEventListener('resize', t_throttle(function() {
        t1000_setImageHeight(rec, margin);
    }));

    /* TODO: jq event */
    $(container).bind('displayChanged', function() {
        t1000_setImageHeight(rec, margin);
    });

    /*container.addEventListener('displayChanged', function() {
        t1000_setImageHeight(rec, margin);
    });*/
}

function t1000_setImageHeight(rec, margin) {
    if (!rec) return;
    var container = rec.querySelector('.t1000');
    if (!container) return;
    var image = rec.querySelector('.t1000__background-image');

    if (window.innerWidth <= 960) {
        image.style.height = null;
        image.style.width = null;
    } else {
        image.style.height = 'calc(100% + ' + margin + 'px)';
    }

    image.style.visibility = null;
} 
function t1003_init(recId, angle) {
    var rec = document.getElementById('rec' + recId);
    if (!rec) return;
    var container = rec.querySelector('.t1003');
    if (!container) return;

    t1003_calc(rec, recId, angle);

    window.addEventListener('resize', t_throttle(function() {
        t1003_calc(rec, recId, angle);
    }, 300));

    window.addEventListener('load', function() {
        t1003_calc(rec, recId, angle);
    });
    
    /*TODO: jq event*/
    $(container).bind('displayChanged', function() {
        t1003_calc(rec, recId, angle); 
    });
    
    /*container.addEventListener('displayChanged', function() {
       t1003_calc(rec, recId, angle); 
    });*/
}

function t1003_calc(rec, recId, angle) {
    var wrapper = rec.querySelector('.t1003__wrapper');
    var contentWrapper = rec.querySelector('.t1003__content-wrapper');
    var content = rec.querySelector('.t1003__content');
    var items = content.querySelectorAll('.t1003__item');
    var itemWidth = items[0].offsetWidth;
    var windowWidth = window.innerWidth;
    var itemsToDisplay = parseInt(windowWidth / itemWidth) + 3;
    var direction = '';

    t1003_calcRotatedWidth(rec, angle);

    if (wrapper.getAttribute('data-marquee-direction') === 'opposite') direction = 'right';

    for (var i = 1; i < items.length; i++) {
        t1003__remove(items[i]);
    }

    for (var i = 0; i < itemsToDisplay; i++) {
        if (direction === 'right') {
            content.insertBefore(items[0].cloneNode(true), items[0]);
        } else {
            content.insertBefore(items[0].cloneNode(true), items[0].nextSibling);
        }
    }

    t1003_anim(rec, itemWidth, recId, direction);

    content.style.animationName = 't1003__anim-scrolling_' + recId;
    contentWrapper.style.opacity = '1';
}

function t1003_calcRotatedWidth(rec, angle) {
    var outer = rec.querySelector('.t1003__outer');
    var wrapper = rec.querySelector('.t1003__wrapper');
    
    wrapper.removeAttribute('style');
    angle = parseFloat(angle.replace('deg', ''), 10);

    var windowWidth = window.innerWidth;
    var angleRad = (angle * Math.PI) / 180;
    var sin = Math.sin(angleRad);
    var paddingCoeff = Math.abs(Math.tan(angleRad) / 2);
    var padding = windowWidth * paddingCoeff;
    var rotatedHeight = Math.abs(sin * windowWidth);
    
    wrapper.style.width = 'calc(100vw + ' + padding + 'px)';
    wrapper.style.padding = '0 ' + padding + 'px';

    var wrapperStyle = getComputedStyle(wrapper, null);
    var wrapperPaddingTop = parseInt(wrapperStyle.paddingTop) || 0;
    var wrapperPaddingBottom = parseInt(wrapperStyle.paddingBottom) || 0;
    var wrapperPaddingLeft = parseInt(wrapperStyle.paddingLeft) || 0;
    var wrapperPaddingRight = parseInt(wrapperStyle.paddingRight) || 0;
    var wrapperWidth = wrapper.clientWidth - (wrapperPaddingLeft + wrapperPaddingRight);
    var wrapperHeight = wrapper.clientHeight - (wrapperPaddingTop + wrapperPaddingBottom);
    var operator = (sin < 0) ? '' : '-';
    
    outer.style.height = (rotatedHeight + wrapperHeight) + 'px';
    
    if (window.isIE) {
        wrapper.style.width = '';
        wrapper.style.marginLeft = '-' + wrapperWidth / 2 + 'px';
        wrapper.style.marginTop = operator + wrapperHeight / 2 + 'px';   
    }
}

function t1003_anim(rec, itemWidth, id, direction) {
    var animationName = 't1003__anim-scrolling_' + id;
    var speedAttr = rec.querySelector('.t1003__wrapper').getAttribute('data-marquee-speed');
    var start;
    var end;
    var speed;
    var seconds;
    var styleAnimation = rec.querySelector('#' + animationName);

    if (styleAnimation) t1003__remove(styleAnimation);

    if (!speedAttr) return;

    seconds = parseFloat(speedAttr.replace('s', ''));

    /* время, за которое будет проезжать 100px */
    speed = (itemWidth / 100) * seconds;

    rec.querySelector('.t1003__content').style.animationDuration = speed + 's';

    if (direction === 'right') {
        start = itemWidth * -1;
        end = 0;
    } else {
        start = 0;
        end = itemWidth * -1;
    }

    var style = document.createElement('style');

    style.id = animationName;
    style.innerHTML =
        '@keyframes ' + animationName + '{' +
            '0% {' +
                'transform: translateX(' + start + 'px);' +
                '-webkit-transform: translateX(' + start + 'px);' +
            '}' +
            '100% {' +
                'transform: translateX(' + end + 'px);' +
                '-webkit-transform: translateX(' + end + 'px);' +
            '}' +
        '}';

    rec.appendChild(style);
}

function t1003__remove(el) {
    if (el && el.parentNode) {
        el.parentNode.removeChild(el);
    }
}